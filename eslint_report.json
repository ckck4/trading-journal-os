[{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\.agent\\skills\\superpowers\\.opencode\\plugins\\superpowers.js","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'client' is defined but never used.","line":49,"column":43,"nodeType":"Identifier","messageId":"unusedVar","endLine":49,"endColumn":49},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'directory' is defined but never used.","line":49,"column":51,"nodeType":"Identifier","messageId":"unusedVar","endLine":49,"endColumn":60}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Superpowers plugin for OpenCode.ai\n *\n * Injects superpowers bootstrap context via system prompt transform.\n * Skills are discovered via OpenCode's native skill tool from symlinked directory.\n */\n\nimport path from 'path';\nimport fs from 'fs';\nimport os from 'os';\nimport { fileURLToPath } from 'url';\n\nconst __dirname = path.dirname(fileURLToPath(import.meta.url));\n\n// Simple frontmatter extraction (avoid dependency on skills-core for bootstrap)\nconst extractAndStripFrontmatter = (content) => {\n  const match = content.match(/^---\\n([\\s\\S]*?)\\n---\\n([\\s\\S]*)$/);\n  if (!match) return { frontmatter: {}, content };\n\n  const frontmatterStr = match[1];\n  const body = match[2];\n  const frontmatter = {};\n\n  for (const line of frontmatterStr.split('\\n')) {\n    const colonIdx = line.indexOf(':');\n    if (colonIdx > 0) {\n      const key = line.slice(0, colonIdx).trim();\n      const value = line.slice(colonIdx + 1).trim().replace(/^[\"']|[\"']$/g, '');\n      frontmatter[key] = value;\n    }\n  }\n\n  return { frontmatter, content: body };\n};\n\n// Normalize a path: trim whitespace, expand ~, resolve to absolute\nconst normalizePath = (p, homeDir) => {\n  if (!p || typeof p !== 'string') return null;\n  let normalized = p.trim();\n  if (!normalized) return null;\n  if (normalized.startsWith('~/')) {\n    normalized = path.join(homeDir, normalized.slice(2));\n  } else if (normalized === '~') {\n    normalized = homeDir;\n  }\n  return path.resolve(normalized);\n};\n\nexport const SuperpowersPlugin = async ({ client, directory }) => {\n  const homeDir = os.homedir();\n  const superpowersSkillsDir = path.resolve(__dirname, '../../skills');\n  const envConfigDir = normalizePath(process.env.OPENCODE_CONFIG_DIR, homeDir);\n  const configDir = envConfigDir || path.join(homeDir, '.config/opencode');\n\n  // Helper to generate bootstrap content\n  const getBootstrapContent = () => {\n    // Try to load using-superpowers skill\n    const skillPath = path.join(superpowersSkillsDir, 'using-superpowers', 'SKILL.md');\n    if (!fs.existsSync(skillPath)) return null;\n\n    const fullContent = fs.readFileSync(skillPath, 'utf8');\n    const { content } = extractAndStripFrontmatter(fullContent);\n\n    const toolMapping = `**Tool Mapping for OpenCode:**\nWhen skills reference tools you don't have, substitute OpenCode equivalents:\n- \\`TodoWrite\\` → \\`update_plan\\`\n- \\`Task\\` tool with subagents → Use OpenCode's subagent system (@mention)\n- \\`Skill\\` tool → OpenCode's native \\`skill\\` tool\n- \\`Read\\`, \\`Write\\`, \\`Edit\\`, \\`Bash\\` → Your native tools\n\n**Skills location:**\nSuperpowers skills are in \\`${configDir}/skills/superpowers/\\`\nUse OpenCode's native \\`skill\\` tool to list and load skills.`;\n\n    return `<EXTREMELY_IMPORTANT>\nYou have superpowers.\n\n**IMPORTANT: The using-superpowers skill content is included below. It is ALREADY LOADED - you are currently following it. Do NOT use the skill tool to load \"using-superpowers\" again - that would be redundant.**\n\n${content}\n\n${toolMapping}\n</EXTREMELY_IMPORTANT>`;\n  };\n\n  return {\n    // Use system prompt transform to inject bootstrap (fixes #226 agent reset bug)\n    'experimental.chat.system.transform': async (_input, output) => {\n      const bootstrap = getBootstrapContent();\n      if (bootstrap) {\n        (output.system ||= []).push(bootstrap);\n      }\n    }\n  };\n};\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\.agent\\skills\\superpowers\\lib\\skills-core.js","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":49,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":49,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":166,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":166,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import fs from 'fs';\nimport path from 'path';\nimport { execSync } from 'child_process';\n\n/**\n * Extract YAML frontmatter from a skill file.\n * Current format:\n * ---\n * name: skill-name\n * description: Use when [condition] - [what it does]\n * ---\n *\n * @param {string} filePath - Path to SKILL.md file\n * @returns {{name: string, description: string}}\n */\nfunction extractFrontmatter(filePath) {\n    try {\n        const content = fs.readFileSync(filePath, 'utf8');\n        const lines = content.split('\\n');\n\n        let inFrontmatter = false;\n        let name = '';\n        let description = '';\n\n        for (const line of lines) {\n            if (line.trim() === '---') {\n                if (inFrontmatter) break;\n                inFrontmatter = true;\n                continue;\n            }\n\n            if (inFrontmatter) {\n                const match = line.match(/^(\\w+):\\s*(.*)$/);\n                if (match) {\n                    const [, key, value] = match;\n                    switch (key) {\n                        case 'name':\n                            name = value.trim();\n                            break;\n                        case 'description':\n                            description = value.trim();\n                            break;\n                    }\n                }\n            }\n        }\n\n        return { name, description };\n    } catch (error) {\n        return { name: '', description: '' };\n    }\n}\n\n/**\n * Find all SKILL.md files in a directory recursively.\n *\n * @param {string} dir - Directory to search\n * @param {string} sourceType - 'personal' or 'superpowers' for namespacing\n * @param {number} maxDepth - Maximum recursion depth (default: 3)\n * @returns {Array<{path: string, name: string, description: string, sourceType: string}>}\n */\nfunction findSkillsInDir(dir, sourceType, maxDepth = 3) {\n    const skills = [];\n\n    if (!fs.existsSync(dir)) return skills;\n\n    function recurse(currentDir, depth) {\n        if (depth > maxDepth) return;\n\n        const entries = fs.readdirSync(currentDir, { withFileTypes: true });\n\n        for (const entry of entries) {\n            const fullPath = path.join(currentDir, entry.name);\n\n            if (entry.isDirectory()) {\n                // Check for SKILL.md in this directory\n                const skillFile = path.join(fullPath, 'SKILL.md');\n                if (fs.existsSync(skillFile)) {\n                    const { name, description } = extractFrontmatter(skillFile);\n                    skills.push({\n                        path: fullPath,\n                        skillFile: skillFile,\n                        name: name || entry.name,\n                        description: description || '',\n                        sourceType: sourceType\n                    });\n                }\n\n                // Recurse into subdirectories\n                recurse(fullPath, depth + 1);\n            }\n        }\n    }\n\n    recurse(dir, 0);\n    return skills;\n}\n\n/**\n * Resolve a skill name to its file path, handling shadowing\n * (personal skills override superpowers skills).\n *\n * @param {string} skillName - Name like \"superpowers:brainstorming\" or \"my-skill\"\n * @param {string} superpowersDir - Path to superpowers skills directory\n * @param {string} personalDir - Path to personal skills directory\n * @returns {{skillFile: string, sourceType: string, skillPath: string} | null}\n */\nfunction resolveSkillPath(skillName, superpowersDir, personalDir) {\n    // Strip superpowers: prefix if present\n    const forceSuperpowers = skillName.startsWith('superpowers:');\n    const actualSkillName = forceSuperpowers ? skillName.replace(/^superpowers:/, '') : skillName;\n\n    // Try personal skills first (unless explicitly superpowers:)\n    if (!forceSuperpowers && personalDir) {\n        const personalPath = path.join(personalDir, actualSkillName);\n        const personalSkillFile = path.join(personalPath, 'SKILL.md');\n        if (fs.existsSync(personalSkillFile)) {\n            return {\n                skillFile: personalSkillFile,\n                sourceType: 'personal',\n                skillPath: actualSkillName\n            };\n        }\n    }\n\n    // Try superpowers skills\n    if (superpowersDir) {\n        const superpowersPath = path.join(superpowersDir, actualSkillName);\n        const superpowersSkillFile = path.join(superpowersPath, 'SKILL.md');\n        if (fs.existsSync(superpowersSkillFile)) {\n            return {\n                skillFile: superpowersSkillFile,\n                sourceType: 'superpowers',\n                skillPath: actualSkillName\n            };\n        }\n    }\n\n    return null;\n}\n\n/**\n * Check if a git repository has updates available.\n *\n * @param {string} repoDir - Path to git repository\n * @returns {boolean} - True if updates are available\n */\nfunction checkForUpdates(repoDir) {\n    try {\n        // Quick check with 3 second timeout to avoid delays if network is down\n        const output = execSync('git fetch origin && git status --porcelain=v1 --branch', {\n            cwd: repoDir,\n            timeout: 3000,\n            encoding: 'utf8',\n            stdio: 'pipe'\n        });\n\n        // Parse git status output to see if we're behind\n        const statusLines = output.split('\\n');\n        for (const line of statusLines) {\n            if (line.startsWith('## ') && line.includes('[behind ')) {\n                return true; // We're behind remote\n            }\n        }\n        return false; // Up to date\n    } catch (error) {\n        // Network down, git error, timeout, etc. - don't block bootstrap\n        return false;\n    }\n}\n\n/**\n * Strip YAML frontmatter from skill content, returning just the content.\n *\n * @param {string} content - Full content including frontmatter\n * @returns {string} - Content without frontmatter\n */\nfunction stripFrontmatter(content) {\n    const lines = content.split('\\n');\n    let inFrontmatter = false;\n    let frontmatterEnded = false;\n    const contentLines = [];\n\n    for (const line of lines) {\n        if (line.trim() === '---') {\n            if (inFrontmatter) {\n                frontmatterEnded = true;\n                continue;\n            }\n            inFrontmatter = true;\n            continue;\n        }\n\n        if (frontmatterEnded || !inFrontmatter) {\n            contentLines.push(line);\n        }\n    }\n\n    return contentLines.join('\\n').trim();\n}\n\nexport {\n    extractFrontmatter,\n    findSkillsInDir,\n    resolveSkillPath,\n    checkForUpdates,\n    stripFrontmatter\n};\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\.agent\\skills\\superpowers\\skills\\systematic-debugging\\condition-based-waiting-example.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\.agent\\skills\\superpowers\\skills\\writing-skills\\render-graphs.js","messages":[{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":16,"column":12,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":16,"endColumn":25},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":17,"column":14,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":17,"endColumn":29},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":18,"column":22,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":18,"endColumn":46}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"#!/usr/bin/env node\n\n/**\n * Render graphviz diagrams from a skill's SKILL.md to SVG files.\n *\n * Usage:\n *   ./render-graphs.js <skill-directory>           # Render each diagram separately\n *   ./render-graphs.js <skill-directory> --combine # Combine all into one diagram\n *\n * Extracts all ```dot blocks from SKILL.md and renders to SVG.\n * Useful for helping your human partner visualize the process flows.\n *\n * Requires: graphviz (dot) installed on system\n */\n\nconst fs = require('fs');\nconst path = require('path');\nconst { execSync } = require('child_process');\n\nfunction extractDotBlocks(markdown) {\n  const blocks = [];\n  const regex = /```dot\\n([\\s\\S]*?)```/g;\n  let match;\n\n  while ((match = regex.exec(markdown)) !== null) {\n    const content = match[1].trim();\n\n    // Extract digraph name\n    const nameMatch = content.match(/digraph\\s+(\\w+)/);\n    const name = nameMatch ? nameMatch[1] : `graph_${blocks.length + 1}`;\n\n    blocks.push({ name, content });\n  }\n\n  return blocks;\n}\n\nfunction extractGraphBody(dotContent) {\n  // Extract just the body (nodes and edges) from a digraph\n  const match = dotContent.match(/digraph\\s+\\w+\\s*\\{([\\s\\S]*)\\}/);\n  if (!match) return '';\n\n  let body = match[1];\n\n  // Remove rankdir (we'll set it once at the top level)\n  body = body.replace(/^\\s*rankdir\\s*=\\s*\\w+\\s*;?\\s*$/gm, '');\n\n  return body.trim();\n}\n\nfunction combineGraphs(blocks, skillName) {\n  const bodies = blocks.map((block, i) => {\n    const body = extractGraphBody(block.content);\n    // Wrap each subgraph in a cluster for visual grouping\n    return `  subgraph cluster_${i} {\n    label=\"${block.name}\";\n    ${body.split('\\n').map(line => '  ' + line).join('\\n')}\n  }`;\n  });\n\n  return `digraph ${skillName}_combined {\n  rankdir=TB;\n  compound=true;\n  newrank=true;\n\n${bodies.join('\\n\\n')}\n}`;\n}\n\nfunction renderToSvg(dotContent) {\n  try {\n    return execSync('dot -Tsvg', {\n      input: dotContent,\n      encoding: 'utf-8',\n      maxBuffer: 10 * 1024 * 1024\n    });\n  } catch (err) {\n    console.error('Error running dot:', err.message);\n    if (err.stderr) console.error(err.stderr.toString());\n    return null;\n  }\n}\n\nfunction main() {\n  const args = process.argv.slice(2);\n  const combine = args.includes('--combine');\n  const skillDirArg = args.find(a => !a.startsWith('--'));\n\n  if (!skillDirArg) {\n    console.error('Usage: render-graphs.js <skill-directory> [--combine]');\n    console.error('');\n    console.error('Options:');\n    console.error('  --combine    Combine all diagrams into one SVG');\n    console.error('');\n    console.error('Example:');\n    console.error('  ./render-graphs.js ../subagent-driven-development');\n    console.error('  ./render-graphs.js ../subagent-driven-development --combine');\n    process.exit(1);\n  }\n\n  const skillDir = path.resolve(skillDirArg);\n  const skillFile = path.join(skillDir, 'SKILL.md');\n  const skillName = path.basename(skillDir).replace(/-/g, '_');\n\n  if (!fs.existsSync(skillFile)) {\n    console.error(`Error: ${skillFile} not found`);\n    process.exit(1);\n  }\n\n  // Check if dot is available\n  try {\n    execSync('which dot', { encoding: 'utf-8' });\n  } catch {\n    console.error('Error: graphviz (dot) not found. Install with:');\n    console.error('  brew install graphviz    # macOS');\n    console.error('  apt install graphviz     # Linux');\n    process.exit(1);\n  }\n\n  const markdown = fs.readFileSync(skillFile, 'utf-8');\n  const blocks = extractDotBlocks(markdown);\n\n  if (blocks.length === 0) {\n    console.log('No ```dot blocks found in', skillFile);\n    process.exit(0);\n  }\n\n  console.log(`Found ${blocks.length} diagram(s) in ${path.basename(skillDir)}/SKILL.md`);\n\n  const outputDir = path.join(skillDir, 'diagrams');\n  if (!fs.existsSync(outputDir)) {\n    fs.mkdirSync(outputDir);\n  }\n\n  if (combine) {\n    // Combine all graphs into one\n    const combined = combineGraphs(blocks, skillName);\n    const svg = renderToSvg(combined);\n    if (svg) {\n      const outputPath = path.join(outputDir, `${skillName}_combined.svg`);\n      fs.writeFileSync(outputPath, svg);\n      console.log(`  Rendered: ${skillName}_combined.svg`);\n\n      // Also write the dot source for debugging\n      const dotPath = path.join(outputDir, `${skillName}_combined.dot`);\n      fs.writeFileSync(dotPath, combined);\n      console.log(`  Source: ${skillName}_combined.dot`);\n    } else {\n      console.error('  Failed to render combined diagram');\n    }\n  } else {\n    // Render each separately\n    for (const block of blocks) {\n      const svg = renderToSvg(block.content);\n      if (svg) {\n        const outputPath = path.join(outputDir, `${block.name}.svg`);\n        fs.writeFileSync(outputPath, svg);\n        console.log(`  Rendered: ${block.name}.svg`);\n      } else {\n        console.error(`  Failed: ${block.name}`);\n      }\n    }\n  }\n\n  console.log(`\\nOutput: ${outputDir}/`);\n}\n\nmain();\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\.agent\\skills\\ui-ux-pro-max-skill\\cli\\src\\commands\\init.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\.agent\\skills\\ui-ux-pro-max-skill\\cli\\src\\commands\\update.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\.agent\\skills\\ui-ux-pro-max-skill\\cli\\src\\commands\\versions.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\.agent\\skills\\ui-ux-pro-max-skill\\cli\\src\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\.agent\\skills\\ui-ux-pro-max-skill\\cli\\src\\types\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\.agent\\skills\\ui-ux-pro-max-skill\\cli\\src\\utils\\detect.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\.agent\\skills\\ui-ux-pro-max-skill\\cli\\src\\utils\\extract.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\.agent\\skills\\ui-ux-pro-max-skill\\cli\\src\\utils\\github.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\.agent\\skills\\ui-ux-pro-max-skill\\cli\\src\\utils\\logger.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\.agent\\skills\\ui-ux-pro-max-skill\\cli\\src\\utils\\template.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'readdir' is defined but never used.","line":1,"column":50,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":57,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"readdir"},"fix":{"range":[47,56],"text":""},"desc":"Remove unused variable \"readdir\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'platformName' is assigned a value but never used.","line":76,"column":23,"nodeType":"Identifier","messageId":"unusedVar","endLine":76,"endColumn":35}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { readFile, mkdir, writeFile, cp, access, readdir } from 'node:fs/promises';\r\nimport { join, dirname } from 'node:path';\r\nimport { fileURLToPath } from 'node:url';\r\n\r\nconst __dirname = dirname(fileURLToPath(import.meta.url));\r\n// After bun build: dist/index.js -> ../assets = cli/assets ✓\r\nconst ASSETS_DIR = join(__dirname, '..', 'assets');\r\n\r\nexport interface PlatformConfig {\r\n  platform: string;\r\n  displayName: string;\r\n  installType: 'full' | 'reference';\r\n  folderStructure: {\r\n    root: string;\r\n    skillPath: string;\r\n    filename: string;\r\n  };\r\n  scriptPath: string;\r\n  frontmatter: Record<string, string> | null;\r\n  sections: {\r\n    quickReference: boolean;\r\n  };\r\n  title: string;\r\n  description: string;\r\n  skillOrWorkflow: string;\r\n}\r\n\r\n// Map AIType to platform config file name\r\nconst AI_TO_PLATFORM: Record<string, string> = {\r\n  claude: 'claude',\r\n  cursor: 'cursor',\r\n  windsurf: 'windsurf',\r\n  antigravity: 'agent',\r\n  copilot: 'copilot',\r\n  kiro: 'kiro',\r\n  opencode: 'opencode',\r\n  roocode: 'roocode',\r\n  codex: 'codex',\r\n  qoder: 'qoder',\r\n  gemini: 'gemini',\r\n  trae: 'trae',\r\n  continue: 'continue',\r\n  codebuddy: 'codebuddy',\r\n  droid: 'droid',\r\n};\r\n\r\nasync function exists(path: string): Promise<boolean> {\r\n  try {\r\n    await access(path);\r\n    return true;\r\n  } catch {\r\n    return false;\r\n  }\r\n}\r\n\r\n/**\r\n * Load platform configuration from JSON file\r\n */\r\nexport async function loadPlatformConfig(aiType: string): Promise<PlatformConfig> {\r\n  const platformName = AI_TO_PLATFORM[aiType];\r\n  if (!platformName) {\r\n    throw new Error(`Unknown AI type: ${aiType}`);\r\n  }\r\n\r\n  const configPath = join(ASSETS_DIR, 'templates', 'platforms', `${platformName}.json`);\r\n  const content = await readFile(configPath, 'utf-8');\r\n  return JSON.parse(content) as PlatformConfig;\r\n}\r\n\r\n/**\r\n * Load all available platform configs\r\n */\r\nexport async function loadAllPlatformConfigs(): Promise<Map<string, PlatformConfig>> {\r\n  const configs = new Map<string, PlatformConfig>();\r\n\r\n  for (const [aiType, platformName] of Object.entries(AI_TO_PLATFORM)) {\r\n    try {\r\n      const config = await loadPlatformConfig(aiType);\r\n      configs.set(aiType, config);\r\n    } catch {\r\n      // Skip if config doesn't exist\r\n    }\r\n  }\r\n\r\n  return configs;\r\n}\r\n\r\n/**\r\n * Load a template file\r\n */\r\nasync function loadTemplate(templateName: string): Promise<string> {\r\n  const templatePath = join(ASSETS_DIR, 'templates', templateName);\r\n  return readFile(templatePath, 'utf-8');\r\n}\r\n\r\n/**\r\n * Render frontmatter section\r\n */\r\nfunction renderFrontmatter(frontmatter: Record<string, string> | null): string {\r\n  if (!frontmatter) return '';\r\n\r\n  const lines = ['---'];\r\n  for (const [key, value] of Object.entries(frontmatter)) {\r\n    // Quote values that contain special characters\r\n    if (value.includes(':') || value.includes('\"') || value.includes('\\n')) {\r\n      lines.push(`${key}: \"${value.replace(/\"/g, '\\\\\"')}\"`);\r\n    } else {\r\n      lines.push(`${key}: ${value}`);\r\n    }\r\n  }\r\n  lines.push('---', '');\r\n  return lines.join('\\n');\r\n}\r\n\r\n/**\r\n * Render skill file content from template\r\n */\r\nexport async function renderSkillFile(config: PlatformConfig): Promise<string> {\r\n  // Load base template\r\n  let content = await loadTemplate('base/skill-content.md');\r\n\r\n  // Load quick reference if needed\r\n  let quickReferenceContent = '';\r\n  if (config.sections.quickReference) {\r\n    quickReferenceContent = await loadTemplate('base/quick-reference.md');\r\n  }\r\n\r\n  // Build the final content\r\n  const frontmatter = renderFrontmatter(config.frontmatter);\r\n\r\n  // Replace placeholders\r\n  // Add newline before quick reference content if it exists\r\n  const quickRefWithNewline = quickReferenceContent ? '\\n' + quickReferenceContent : '';\r\n\r\n  content = content\r\n    .replace(/\\{\\{TITLE\\}\\}/g, config.title)\r\n    .replace(/\\{\\{DESCRIPTION\\}\\}/g, config.description)\r\n    .replace(/\\{\\{SCRIPT_PATH\\}\\}/g, config.scriptPath)\r\n    .replace(/\\{\\{SKILL_OR_WORKFLOW\\}\\}/g, config.skillOrWorkflow)\r\n    .replace(/\\{\\{QUICK_REFERENCE\\}\\}/g, quickRefWithNewline);\r\n\r\n  return frontmatter + content;\r\n}\r\n\r\n/**\r\n * Copy data and scripts to target directory\r\n */\r\nasync function copyDataAndScripts(targetSkillDir: string): Promise<void> {\r\n  const dataSource = join(ASSETS_DIR, 'data');\r\n  const scriptsSource = join(ASSETS_DIR, 'scripts');\r\n\r\n  const dataTarget = join(targetSkillDir, 'data');\r\n  const scriptsTarget = join(targetSkillDir, 'scripts');\r\n\r\n  // Copy data\r\n  if (await exists(dataSource)) {\r\n    await mkdir(dataTarget, { recursive: true });\r\n    await cp(dataSource, dataTarget, { recursive: true });\r\n  }\r\n\r\n  // Copy scripts\r\n  if (await exists(scriptsSource)) {\r\n    await mkdir(scriptsTarget, { recursive: true });\r\n    await cp(scriptsSource, scriptsTarget, { recursive: true });\r\n  }\r\n}\r\n\r\n/**\r\n * Generate platform files for a specific AI type\r\n * All platforms use self-contained installation with data and scripts\r\n */\r\nexport async function generatePlatformFiles(\r\n  targetDir: string,\r\n  aiType: string\r\n): Promise<string[]> {\r\n  const config = await loadPlatformConfig(aiType);\r\n  const createdFolders: string[] = [];\r\n\r\n  // Determine full skill directory path\r\n  const skillDir = join(\r\n    targetDir,\r\n    config.folderStructure.root,\r\n    config.folderStructure.skillPath\r\n  );\r\n\r\n  // Create directory structure\r\n  await mkdir(skillDir, { recursive: true });\r\n\r\n  // Render and write skill file\r\n  const skillContent = await renderSkillFile(config);\r\n  const skillFilePath = join(skillDir, config.folderStructure.filename);\r\n  await writeFile(skillFilePath, skillContent, 'utf-8');\r\n  createdFolders.push(config.folderStructure.root);\r\n\r\n  // Copy data and scripts into the skill directory (self-contained)\r\n  await copyDataAndScripts(skillDir);\r\n\r\n  return createdFolders;\r\n}\r\n\r\n/**\r\n * Generate files for all AI types\r\n */\r\nexport async function generateAllPlatformFiles(targetDir: string): Promise<string[]> {\r\n  const allFolders = new Set<string>();\r\n\r\n  for (const aiType of Object.keys(AI_TO_PLATFORM)) {\r\n    try {\r\n      const folders = await generatePlatformFiles(targetDir, aiType);\r\n      folders.forEach(f => allFolders.add(f));\r\n    } catch {\r\n      // Skip if generation fails for a platform\r\n    }\r\n  }\r\n\r\n  return Array.from(allFolders);\r\n}\r\n\r\n/**\r\n * Get list of supported AI types\r\n */\r\nexport function getSupportedAITypes(): string[] {\r\n  return Object.keys(AI_TO_PLATFORM);\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\check_constraints.js","messages":[{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":2,"column":18,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":2,"endColumn":31}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"const connStr = 'postgresql://postgres:3eL31nbc81S087Pf@db.tyqiutuslbbjplogheab.supabase.co:5432/postgres';\r\nconst { Pool } = require('pg');\r\n\r\nasync function run() {\r\n    const pool = new Pool({ connectionString: connStr, ssl: { rejectUnauthorized: false } });\r\n\r\n    const query = `\r\n    SELECT\r\n      tc.constraint_name,\r\n      tc.constraint_type\r\n    FROM information_schema.table_constraints AS tc\r\n    WHERE tc.table_name = 'daily_summaries';\r\n  `;\r\n    const result = await pool.query(query);\r\n    console.log(\"Constraints on daily_summaries:\");\r\n    console.table(result.rows);\r\n    process.exit(0);\r\n}\r\nrun();\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\check_indexes.js","messages":[{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":1,"column":12,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":1,"endColumn":25},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":3,"column":18,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":3,"endColumn":31}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"const fs = require('fs');\r\nconst connStr = 'postgresql://postgres:3eL31nbc81S087Pf@db.tyqiutuslbbjplogheab.supabase.co:5432/postgres';\r\nconst { Pool } = require('pg');\r\n\r\nasync function run() {\r\n    const pool = new Pool({ connectionString: connStr, ssl: { rejectUnauthorized: false } });\r\n\r\n    const query = `\r\n    SELECT\r\n      i.relname as index_name,\r\n      a.attname as column_name,\r\n      ix.indisunique as is_unique,\r\n      ix.indisprimary as is_primary\r\n    FROM\r\n      pg_class t,\r\n      pg_class i,\r\n      pg_index ix,\r\n      pg_attribute a\r\n    WHERE\r\n      t.oid = ix.indrelid\r\n      and i.oid = ix.indexrelid\r\n      and a.attrelid = t.oid\r\n      and a.attnum = ANY(ix.indkey)\r\n      and t.relkind = 'r'\r\n      and t.relname = 'daily_summaries';\r\n  `;\r\n    const result = await pool.query(query);\r\n    fs.writeFileSync('C:\\\\Users\\\\proch\\\\Desktop\\\\TRADINGJOURNAL\\\\db_indexes.json', JSON.stringify(result.rows, null, 2));\r\n    process.exit(0);\r\n}\r\nrun();\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\check_prop_templates.js","messages":[{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":2,"column":18,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":2,"endColumn":31}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"const connStr = 'postgresql://postgres:3eL31nbc81S087Pf@db.tyqiutuslbbjplogheab.supabase.co:5432/postgres';\r\nconst { Pool } = require('pg');\r\n\r\nasync function run() {\r\n    const pool = new Pool({ connectionString: connStr, ssl: { rejectUnauthorized: false } });\r\n\r\n    const query = `\r\n    SELECT column_name, data_type \r\n    FROM information_schema.columns \r\n    WHERE table_schema = 'public' \r\n    AND table_name = 'prop_templates';\r\n  `;\r\n    const result = await pool.query(query);\r\n    console.table(result.rows);\r\n    process.exit(0);\r\n}\r\nrun();\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\drizzle.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\eslint.config.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\force_recalc.js","messages":[{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":1,"column":12,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":1,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'accountId' is assigned a value but never used.","line":4,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":4,"endColumn":20},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'userId' is assigned a value but never used.","line":5,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":5,"endColumn":17},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":8,"column":22,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":8,"endColumn":35}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"const fs = require('fs');\r\n\r\nasync function run() {\r\n    const accountId = \"5543c7b8-3e91-4aa7-9577-7bb69f70d2ca\"; // need to get this from DB\r\n    const userId = \"c1b52bc7-feab-4959-bee2-6f2df6cecf33\";   // need to get this from DB\r\n    // wait, I can just query DB for distinct account_id and user_id from trades\r\n    const connStr = 'postgresql://postgres:3eL31nbc81S087Pf@db.tyqiutuslbbjplogheab.supabase.co:5432/postgres';\r\n    const { Pool } = require('pg');\r\n    const pool = new Pool({ connectionString: connStr, ssl: { rejectUnauthorized: false } });\r\n\r\n    const trades = await pool.query('SELECT DISTINCT user_id, account_id, trading_day FROM trades WHERE account_id IS NOT NULL');\r\n    const toRecalc = trades.rows;\r\n\r\n    fs.writeFileSync('C:\\\\Users\\\\proch\\\\Desktop\\\\TRADINGJOURNAL\\\\to_recalc.json', JSON.stringify(toRecalc, null, 2));\r\n\r\n    // Let's also delete all from daily_summaries\r\n    await pool.query('DELETE FROM daily_summaries');\r\n\r\n    process.exit(0);\r\n}\r\nrun();\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\force_recalc.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'path' is defined but never used.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":12,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"path"},"fix":{"range":[22,48],"text":""},"desc":"Remove unused import declaration."}]},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":5,"column":20,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":5,"endColumn":35},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":6,"column":1,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":6,"endColumn":18},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":12,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[458,461],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[458,461],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":12,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[466,469],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[466,469],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import fs from 'fs';\r\nimport path from 'path';\r\nimport { recalcSummaries } from './src/lib/services/recalc-summaries';\r\n\r\nconst configPath = require('path').resolve('./.env.local');\r\nrequire('dotenv').config({ path: configPath });\r\n\r\nasync function run() {\r\n    const data = JSON.parse(fs.readFileSync('C:\\\\Users\\\\proch\\\\Desktop\\\\TRADINGJOURNAL\\\\to_recalc.json', 'utf8'));\r\n\r\n    // Sort data by trading_day to ensure cumulative PnL works\r\n    data.sort((a: any, b: any) => new Date(a.trading_day).getTime() - new Date(b.trading_day).getTime());\r\n\r\n    for (const row of data) {\r\n        try {\r\n            console.log(`Recalculating account ${row.account_id} for day ${row.trading_day}`);\r\n            await recalcSummaries(row.user_id, row.account_id, row.trading_day);\r\n        } catch (err) {\r\n            console.error(`Error on ${row.trading_day}:`, err);\r\n        }\r\n    }\r\n\r\n    console.log('Done');\r\n}\r\n\r\nrun();\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\migrate_mll.js","messages":[{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":2,"column":18,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":2,"endColumn":31}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"const connStr = 'postgresql://postgres:3eL31nbc81S087Pf@db.tyqiutuslbbjplogheab.supabase.co:5432/postgres';\r\nconst { Pool } = require('pg');\r\n\r\nasync function run() {\r\n    const pool = new Pool({ connectionString: connStr, ssl: { rejectUnauthorized: false } });\r\n\r\n    const query = `\r\n    ALTER TABLE prop_templates ADD COLUMN IF NOT EXISTS max_loss_limit numeric(10,2);\r\n  `;\r\n    try {\r\n        await pool.query(query);\r\n        console.log(\"Migration successful\");\r\n    } catch (err) {\r\n        console.error(err);\r\n    }\r\n    process.exit(0);\r\n}\r\nrun();\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\next.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\postcss.config.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\query_pnl.js","messages":[{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":1,"column":12,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":1,"endColumn":25},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":6,"column":26,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":6,"endColumn":45},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":19,"column":30,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":19,"endColumn":43}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"const fs = require('fs');\r\nconst connStr = 'postgresql://postgres:3eL31nbc81S087Pf@db.tyqiutuslbbjplogheab.supabase.co:5432/postgres';\r\n\r\nasync function run() {\r\n    try {\r\n        const postgres = require('postgres');\r\n        const sql = postgres(connStr, { ssl: 'require' });\r\n\r\n        const summaries = await sql`SELECT trading_day as date, net_pnl FROM daily_summaries ORDER BY trading_day DESC LIMIT 10`;\r\n        const tradesTotal = await sql`SELECT SUM(net_pnl) as total FROM trades WHERE account_id IS NOT NULL`;\r\n\r\n        fs.writeFileSync('C:\\\\Users\\\\proch\\\\Desktop\\\\TRADINGJOURNAL\\\\pnl_verify.json', JSON.stringify({\r\n            summaries: summaries,\r\n            tradesTotal: tradesTotal[0].total\r\n        }, null, 2));\r\n        process.exit(0);\r\n    } catch (e) {\r\n        if (e.code === 'MODULE_NOT_FOUND') {\r\n            const { Pool } = require('pg');\r\n            const pool = new Pool({ connectionString: connStr, ssl: { rejectUnauthorized: false } });\r\n            const summaries = await pool.query('SELECT trading_day as date, net_pnl FROM daily_summaries ORDER BY trading_day DESC LIMIT 10');\r\n            const tradesTotal = await pool.query('SELECT SUM(net_pnl) as total FROM trades WHERE account_id IS NOT NULL');\r\n\r\n            fs.writeFileSync('C:\\\\Users\\\\proch\\\\Desktop\\\\TRADINGJOURNAL\\\\pnl_verify.json', JSON.stringify({\r\n                summaries: summaries.rows,\r\n                tradesTotal: tradesTotal.rows[0].total\r\n            }, null, 2));\r\n            process.exit(0);\r\n        } else {\r\n            console.error(e);\r\n            process.exit(1);\r\n        }\r\n    }\r\n}\r\nrun();\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\app\\(app)\\analytics\\[dimension]\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\app\\(app)\\analytics\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\app\\(app)\\coach\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\app\\(app)\\finance\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\app\\(app)\\goals\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\app\\(app)\\grading\\configure\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\app\\(app)\\grading\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\app\\(app)\\journal\\[tradeId]\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\app\\(app)\\journal\\calendar\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\app\\(app)\\journal\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\app\\(app)\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\app\\(app)\\leaks\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\app\\(app)\\ledger\\new\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\app\\(app)\\ledger\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\app\\(app)\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\app\\(app)\\prop\\[evalId]\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\app\\(app)\\prop\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\app\\(app)\\settings\\accounts\\accounts-client.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\app\\(app)\\settings\\accounts\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\app\\(app)\\settings\\dashboard\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\app\\(app)\\settings\\data\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\app\\(app)\\settings\\grading\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\app\\(app)\\settings\\instruments\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\app\\(app)\\settings\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\app\\(app)\\settings\\preferences\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\app\\(app)\\settings\\prop-templates\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\app\\(app)\\settings\\routines\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\app\\(app)\\settings\\sessions\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\app\\(app)\\settings\\strategies\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\app\\(app)\\settings\\tags\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\app\\(app)\\strategies\\[id]\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\app\\(app)\\strategies\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\app\\(auth)\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\app\\(auth)\\login\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\app\\(auth)\\register\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'router' is assigned a value but never used.","line":10,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":10,"endColumn":15}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\r\n\r\nimport { useState } from 'react'\r\nimport Link from 'next/link'\r\nimport { useRouter } from 'next/navigation'\r\nimport { createClient } from '@/lib/supabase/client'\r\nimport { cn } from '@/lib/utils'\r\n\r\nexport default function RegisterPage() {\r\n  const router = useRouter()\r\n  const [email, setEmail] = useState('')\r\n  const [password, setPassword] = useState('')\r\n  const [confirmPassword, setConfirmPassword] = useState('')\r\n  const [error, setError] = useState<string | null>(null)\r\n  const [success, setSuccess] = useState(false)\r\n  const [loading, setLoading] = useState(false)\r\n\r\n  async function handleSubmit(e: React.FormEvent) {\r\n    e.preventDefault()\r\n    setError(null)\r\n\r\n    if (password !== confirmPassword) {\r\n      setError('Passwords do not match')\r\n      return\r\n    }\r\n\r\n    if (password.length < 8) {\r\n      setError('Password must be at least 8 characters')\r\n      return\r\n    }\r\n\r\n    setLoading(true)\r\n    const supabase = createClient()\r\n    const { error } = await supabase.auth.signUp({ email, password })\r\n\r\n    if (error) {\r\n      setError(error.message)\r\n      setLoading(false)\r\n    } else {\r\n      setSuccess(true)\r\n    }\r\n  }\r\n\r\n  if (success) {\r\n    return (\r\n      <div className=\"w-full max-w-[400px] text-center\">\r\n        <div className=\"rounded-xl border border-[var(--color-green)] bg-[var(--color-green-muted)] p-6\">\r\n          <h2 className=\"text-lg font-semibold text-[var(--color-green)]\">Check your email</h2>\r\n          <p className=\"mt-2 text-sm text-[var(--muted-foreground)]\">\r\n            We sent a confirmation link to <strong className=\"text-[var(--foreground)]\">{email}</strong>.\r\n            Click it to activate your account.\r\n          </p>\r\n        </div>\r\n        <p className=\"mt-4 text-sm text-[var(--muted-foreground)]\">\r\n          <Link href=\"/login\" className=\"text-[var(--color-accent-primary)] hover:text-[var(--color-accent-hover)] transition-colors\">\r\n            Back to sign in\r\n          </Link>\r\n        </p>\r\n      </div>\r\n    )\r\n  }\r\n\r\n  return (\r\n    <div className=\"w-full max-w-[400px]\">\r\n      {/* Logo / Title */}\r\n      <div className=\"mb-8 text-center\">\r\n        <h1 className=\"text-2xl font-semibold text-[var(--foreground)]\">Create Account</h1>\r\n        <p className=\"mt-1 text-sm text-[var(--muted-foreground)]\">Start your trading journal</p>\r\n      </div>\r\n\r\n      {/* Card */}\r\n      <div className=\"rounded-xl border border-[var(--border)] bg-[var(--card)] p-6 shadow-[var(--shadow-md)]\">\r\n        <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n          {/* Error */}\r\n          {error && (\r\n            <div className=\"rounded-md border border-[var(--color-red)] bg-[var(--color-red-muted)] px-3 py-2 text-sm text-[var(--color-red)]\">\r\n              {error}\r\n            </div>\r\n          )}\r\n\r\n          {/* Email */}\r\n          <div className=\"space-y-1.5\">\r\n            <label htmlFor=\"email\" className=\"text-xs font-medium text-[var(--muted-foreground)] uppercase tracking-wide\">\r\n              Email\r\n            </label>\r\n            <input\r\n              id=\"email\"\r\n              type=\"email\"\r\n              autoComplete=\"email\"\r\n              required\r\n              value={email}\r\n              onChange={(e) => setEmail(e.target.value)}\r\n              className={cn(\r\n                'w-full rounded-md border border-[var(--border)] bg-[var(--background)]',\r\n                'px-3 py-2 text-sm text-[var(--foreground)] placeholder:text-[var(--muted-foreground)]',\r\n                'focus:border-[var(--color-accent-primary)] focus:outline-none focus:ring-1 focus:ring-[var(--color-accent-primary)]',\r\n                'transition-colors duration-150'\r\n              )}\r\n              placeholder=\"you@example.com\"\r\n            />\r\n          </div>\r\n\r\n          {/* Password */}\r\n          <div className=\"space-y-1.5\">\r\n            <label htmlFor=\"password\" className=\"text-xs font-medium text-[var(--muted-foreground)] uppercase tracking-wide\">\r\n              Password\r\n            </label>\r\n            <input\r\n              id=\"password\"\r\n              type=\"password\"\r\n              autoComplete=\"new-password\"\r\n              required\r\n              value={password}\r\n              onChange={(e) => setPassword(e.target.value)}\r\n              className={cn(\r\n                'w-full rounded-md border border-[var(--border)] bg-[var(--background)]',\r\n                'px-3 py-2 text-sm text-[var(--foreground)] placeholder:text-[var(--muted-foreground)]',\r\n                'focus:border-[var(--color-accent-primary)] focus:outline-none focus:ring-1 focus:ring-[var(--color-accent-primary)]',\r\n                'transition-colors duration-150'\r\n              )}\r\n              placeholder=\"••••••••\"\r\n            />\r\n          </div>\r\n\r\n          {/* Confirm password */}\r\n          <div className=\"space-y-1.5\">\r\n            <label htmlFor=\"confirm-password\" className=\"text-xs font-medium text-[var(--muted-foreground)] uppercase tracking-wide\">\r\n              Confirm Password\r\n            </label>\r\n            <input\r\n              id=\"confirm-password\"\r\n              type=\"password\"\r\n              autoComplete=\"new-password\"\r\n              required\r\n              value={confirmPassword}\r\n              onChange={(e) => setConfirmPassword(e.target.value)}\r\n              className={cn(\r\n                'w-full rounded-md border border-[var(--border)] bg-[var(--background)]',\r\n                'px-3 py-2 text-sm text-[var(--foreground)] placeholder:text-[var(--muted-foreground)]',\r\n                'focus:border-[var(--color-accent-primary)] focus:outline-none focus:ring-1 focus:ring-[var(--color-accent-primary)]',\r\n                'transition-colors duration-150'\r\n              )}\r\n              placeholder=\"••••••••\"\r\n            />\r\n          </div>\r\n\r\n          {/* Submit */}\r\n          <button\r\n            type=\"submit\"\r\n            disabled={loading}\r\n            className={cn(\r\n              'w-full rounded-md px-4 py-2 text-sm font-medium',\r\n              'bg-[var(--primary)] text-[var(--primary-foreground)]',\r\n              'hover:bg-[var(--color-accent-hover)] transition-colors duration-150',\r\n              'disabled:cursor-not-allowed disabled:opacity-60'\r\n            )}\r\n          >\r\n            {loading ? 'Creating account…' : 'Create Account'}\r\n          </button>\r\n        </form>\r\n      </div>\r\n\r\n      {/* Login link */}\r\n      <p className=\"mt-4 text-center text-sm text-[var(--muted-foreground)]\">\r\n        Already have an account?{' '}\r\n        <Link href=\"/login\" className=\"text-[var(--color-accent-primary)] hover:text-[var(--color-accent-hover)] transition-colors\">\r\n          Sign in\r\n        </Link>\r\n      </p>\r\n    </div>\r\n  )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\app\\(auth)\\register\\register-form.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\app\\api\\accounts\\[id]\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\app\\api\\accounts\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\app\\api\\analytics\\breakdowns\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\app\\api\\analytics\\daily\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\app\\api\\analytics\\recalc\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\app\\api\\analytics\\summary\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\app\\api\\confluences\\[id]\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":52,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":52,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1821,1824],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1821,1824],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":89,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":89,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3066,3069],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3066,3069],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server'\r\nimport { createClient } from '@/lib/supabase/server'\r\nimport { createAdminClient } from '@/lib/supabase/admin'\r\nimport { z } from 'zod'\r\n\r\nconst UpdateConfluenceSchema = z.object({\r\n    name: z.string().min(1).optional(),\r\n    weight: z.number().optional(),\r\n    category: z.enum(['Risk Management', 'Execution', 'Discipline', 'Strategy', 'Efficiency', 'Custom']).optional(),\r\n})\r\n\r\nexport async function PATCH(req: Request, props: { params: Promise<{ id: string }> }) {\r\n    try {\r\n        const params = await props.params;\r\n        const supabase = await createClient()\r\n        const { data: { user } } = await supabase.auth.getUser()\r\n\r\n        if (!user) {\r\n            return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\r\n        }\r\n\r\n        const body = await req.json()\r\n        const parsed = UpdateConfluenceSchema.safeParse(body)\r\n\r\n        if (!parsed.success) {\r\n            return NextResponse.json({ error: 'Invalid payload', details: parsed.error.issues }, { status: 400 })\r\n        }\r\n\r\n        // Verify ownership\r\n        const { data: existing, error: fetchError } = await supabase\r\n            .from('confluences')\r\n            .select('id')\r\n            .eq('id', params.id)\r\n            .eq('user_id', user.id)\r\n            .single()\r\n\r\n        if (fetchError || !existing) {\r\n            return NextResponse.json({ error: 'Not Found' }, { status: 404 })\r\n        }\r\n\r\n        const adminClient = createAdminClient()\r\n        const { data: updated, error } = await adminClient\r\n            .from('confluences')\r\n            .update(parsed.data)\r\n            .eq('id', params.id)\r\n            .select()\r\n            .single()\r\n\r\n        if (error) throw error\r\n\r\n        return NextResponse.json({ data: updated })\r\n    } catch (error: any) {\r\n        console.error('Failed to update confluence:', error)\r\n        return NextResponse.json({ error: error.message || 'Internal Server Error' }, { status: 500 })\r\n    }\r\n}\r\n\r\nexport async function DELETE(req: Request, props: { params: Promise<{ id: string }> }) {\r\n    try {\r\n        const params = await props.params;\r\n        const supabase = await createClient()\r\n        const { data: { user } } = await supabase.auth.getUser()\r\n\r\n        if (!user) {\r\n            return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\r\n        }\r\n\r\n        // Verify ownership\r\n        const { data: existing, error: fetchError } = await supabase\r\n            .from('confluences')\r\n            .select('id')\r\n            .eq('id', params.id)\r\n            .eq('user_id', user.id)\r\n            .single()\r\n\r\n        if (fetchError || !existing) {\r\n            return NextResponse.json({ error: 'Not Found' }, { status: 404 })\r\n        }\r\n\r\n        const adminClient = createAdminClient()\r\n        const { error } = await adminClient\r\n            .from('confluences')\r\n            .delete()\r\n            .eq('id', params.id)\r\n\r\n        if (error) throw error\r\n\r\n        return NextResponse.json({ success: true })\r\n    } catch (error: any) {\r\n        console.error('Failed to delete confluence:', error)\r\n        return NextResponse.json({ error: error.message || 'Internal Server Error' }, { status: 500 })\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\app\\api\\confluences\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":41,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":41,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1320,1323],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1320,1323],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":81,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":81,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2616,2619],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2616,2619],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server'\r\nimport { createClient } from '@/lib/supabase/server'\r\nimport { createAdminClient } from '@/lib/supabase/admin'\r\nimport { z } from 'zod'\r\n\r\nconst CreateConfluenceSchema = z.object({\r\n    strategy_id: z.string().uuid(),\r\n    name: z.string().min(1),\r\n    weight: z.number().optional().default(1.0),\r\n    category: z.enum(['Risk Management', 'Execution', 'Discipline', 'Strategy', 'Efficiency', 'Custom']).optional().default('Execution'),\r\n})\r\n\r\nexport async function GET(req: Request) {\r\n    try {\r\n        const supabase = await createClient()\r\n        const { data: { user } } = await supabase.auth.getUser()\r\n\r\n        if (!user) {\r\n            return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\r\n        }\r\n\r\n        const { searchParams } = new URL(req.url)\r\n        const strategy_id = searchParams.get('strategy_id')\r\n\r\n        let query = supabase\r\n            .from('confluences')\r\n            .select('*')\r\n            .eq('user_id', user.id)\r\n            .order('category')\r\n            .order('name')\r\n\r\n        if (strategy_id) {\r\n            query = query.eq('strategy_id', strategy_id)\r\n        }\r\n\r\n        const { data, error } = await query\r\n\r\n        if (error) throw error\r\n\r\n        return NextResponse.json({ data })\r\n    } catch (error: any) {\r\n        console.error('Failed to fetch confluences:', error)\r\n        return NextResponse.json({ error: error.message || 'Internal Server Error' }, { status: 500 })\r\n    }\r\n}\r\n\r\nexport async function POST(req: Request) {\r\n    try {\r\n        const supabase = await createClient()\r\n        const { data: { user } } = await supabase.auth.getUser()\r\n\r\n        if (!user) {\r\n            return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\r\n        }\r\n\r\n        const body = await req.json()\r\n        const parsed = CreateConfluenceSchema.safeParse(body)\r\n\r\n        if (!parsed.success) {\r\n            return NextResponse.json({ error: 'Invalid payload', details: parsed.error.issues }, { status: 400 })\r\n        }\r\n\r\n        const { strategy_id, name, weight, category } = parsed.data\r\n\r\n        const adminClient = createAdminClient()\r\n        const { data: newConfluence, error } = await adminClient\r\n            .from('confluences')\r\n            .insert({\r\n                user_id: user.id,\r\n                strategy_id,\r\n                name,\r\n                weight,\r\n                category\r\n            })\r\n            .select()\r\n            .single()\r\n\r\n        if (error) throw error\r\n\r\n        return NextResponse.json({ data: newConfluence })\r\n    } catch (error: any) {\r\n        console.error('Failed to create confluence:', error)\r\n        return NextResponse.json({ error: error.message || 'Internal Server Error' }, { status: 500 })\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\app\\api\\dashboard\\layouts\\[id]\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\app\\api\\dashboard\\layouts\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\app\\api\\dashboard\\widgets\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\app\\api\\discipline\\checkin\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":26,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":26,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[927,930],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[927,930],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":32,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":32,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1097,1100],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1097,1100],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":63,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":63,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2025,2028],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2025,2028],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":96,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":96,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3149,3152],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3149,3152],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from \"next/server\";\r\nimport { createClient } from \"@/lib/supabase/server\";\r\n\r\nexport async function GET(req: Request) {\r\n    try {\r\n        const { searchParams } = new URL(req.url);\r\n        const datesParam = searchParams.get('dates');\r\n        if (datesParam) {\r\n            const dateList = datesParam.split(',');\r\n            const supabase = await createClient();\r\n            const { data: { user } } = await supabase.auth.getUser();\r\n            if (!user?.id) {\r\n                return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\r\n            }\r\n\r\n            const { data, error } = await supabase\r\n                .from(\"routine_checkins\")\r\n                .select(\"*\")\r\n                .eq(\"user_id\", user.id)\r\n                .in(\"checkin_date\", dateList);\r\n\r\n            if (error) {\r\n                throw error;\r\n            }\r\n\r\n            const map: Record<string, any> = {};\r\n            dateList.forEach((d: string) => {\r\n                map[d] = null;\r\n            });\r\n\r\n            if (data) {\r\n                data.forEach((row: any) => {\r\n                    map[row.checkin_date] = row;\r\n                });\r\n            }\r\n\r\n            return NextResponse.json({ data: map });\r\n        }\r\n\r\n        let date = searchParams.get('date');\r\n        if (!date) {\r\n            date = new Date().toISOString().split('T')[0];\r\n        }\r\n\r\n        const supabase = await createClient();\r\n        const { data: { user } } = await supabase.auth.getUser();\r\n        if (!user?.id) {\r\n            return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\r\n        }\r\n\r\n        const { data, error } = await supabase\r\n            .from(\"routine_checkins\")\r\n            .select(\"*\")\r\n            .eq(\"user_id\", user.id)\r\n            .eq(\"checkin_date\", date)\r\n            .single();\r\n\r\n        if (error && error.code !== \"PGRST116\") {\r\n            throw error;\r\n        }\r\n\r\n        return NextResponse.json({ data: data || null });\r\n    } catch (error: any) {\r\n        return NextResponse.json({ error: error.message }, { status: 500 });\r\n    }\r\n}\r\n\r\nexport async function POST(req: Request) {\r\n    try {\r\n        const supabase = await createClient();\r\n        const { data: { user } } = await supabase.auth.getUser();\r\n        if (!user?.id) {\r\n            return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\r\n        }\r\n\r\n        const body = await req.json();\r\n        const date = body.date || new Date().toISOString().split('T')[0];\r\n        const followed = body.followed_routine ?? false;\r\n\r\n        const { data, error } = await supabase\r\n            .from(\"routine_checkins\")\r\n            .upsert({\r\n                user_id: user.id,\r\n                checkin_date: date,\r\n                followed_routine: followed,\r\n                notes: body.notes || null,\r\n                updated_at: new Date().toISOString()\r\n            }, {\r\n                onConflict: \"user_id, checkin_date\"\r\n            })\r\n            .select()\r\n            .single();\r\n\r\n        if (error) throw error;\r\n        return NextResponse.json({ data });\r\n    } catch (error: any) {\r\n        return NextResponse.json({ error: error.message }, { status: 500 });\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\app\\api\\discipline\\history\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":50,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":50,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1916,1919],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1916,1919],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":54,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":54,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2023,2026],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2023,2026],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":64,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":64,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2387,2390],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2387,2390],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":91,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":91,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3608,3611],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3608,3611],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":94,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":94,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3781,3784],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3781,3784],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":136,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":136,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5376,5379],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5376,5379],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from \"next/server\";\r\nimport { createClient } from \"@/lib/supabase/server\";\r\nimport { createAdminClient } from \"@/lib/supabase/admin\";\r\n\r\nexport async function GET(req: Request) {\r\n    try {\r\n        const { searchParams } = new URL(req.url);\r\n        const days = parseInt(searchParams.get('days') || '30', 10);\r\n\r\n        const supabase = await createClient();\r\n        const { data: { user } } = await supabase.auth.getUser();\r\n        if (!user?.id) return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\r\n\r\n        const adminClient = createAdminClient();\r\n        const { data: settings } = await adminClient\r\n            .from(\"finance_settings\")\r\n            .select(\"discipline_weights\")\r\n            .eq(\"user_id\", user.id)\r\n            .single();\r\n\r\n        const weights = settings?.discipline_weights || { grade_weight: 70, routine_weight: 30 };\r\n        const gw = Number(weights.grade_weight);\r\n        const rw = Number(weights.routine_weight);\r\n\r\n        // Calculate boundary date\r\n        const d = new Date();\r\n        d.setDate(d.getDate() - days);\r\n        const boundaryDate = d.toISOString().split('T')[0];\r\n\r\n        // Fetch checkins\r\n        const { data: checkins } = await supabase\r\n            .from(\"routine_checkins\")\r\n            .select(\"checkin_date, followed_routine\")\r\n            .eq(\"user_id\", user.id)\r\n            .gte(\"checkin_date\", boundaryDate);\r\n\r\n        // Fetch trades & grades\r\n        // inner join using Supabase: trades(id, trading_day, trade_grades(grade))\r\n        const { data: trades } = await supabase\r\n            .from(\"trades\")\r\n            .select(`\r\n                id,\r\n                trading_day,\r\n                trade_grades!left ( grade )\r\n            `)\r\n            .eq(\"user_id\", user.id)\r\n            .gte(\"trading_day\", boundaryDate);\r\n\r\n        // Group by day map\r\n        const dayMap: Record<string, any> = {};\r\n\r\n        // Populate from checkins\r\n        if (checkins) {\r\n            checkins.forEach((c: any) => {\r\n                if (!dayMap[c.checkin_date]) {\r\n                    dayMap[c.checkin_date] = { date: c.checkin_date, checkin: null, trades: [] };\r\n                }\r\n                dayMap[c.checkin_date].checkin = c.followed_routine;\r\n            });\r\n        }\r\n\r\n        // Populate from trades\r\n        if (trades) {\r\n            trades.forEach((t: any) => {\r\n                if (!dayMap[t.trading_day]) {\r\n                    dayMap[t.trading_day] = { date: t.trading_day, checkin: null, trades: [] };\r\n                }\r\n                // extract grade if exists\r\n                let grade = null;\r\n                if (t.trade_grades) {\r\n                    if (Array.isArray(t.trade_grades) && t.trade_grades.length > 0) {\r\n                        grade = t.trade_grades[0].grade;\r\n                    } else if (!Array.isArray(t.trade_grades) && t.trade_grades.grade) {\r\n                        grade = t.trade_grades.grade;\r\n                    }\r\n                }\r\n                dayMap[t.trading_day].trades.push({ hasGrade: !!grade, topGrade: grade ? ['A+', 'A', 'B+'].includes(grade) : false });\r\n            });\r\n        }\r\n\r\n        // Compute scores\r\n        const results = [];\r\n        for (const [date, data] of Object.entries(dayMap)) {\r\n            let routine_score: number | null = null;\r\n            if (data.checkin !== null) {\r\n                routine_score = data.checkin ? 100 : 0;\r\n            }\r\n\r\n            let grade_score: number | null = null;\r\n            let graded_trades = 0;\r\n            const gradedList = data.trades.filter((tx: any) => tx.hasGrade);\r\n            if (gradedList.length > 0) {\r\n                graded_trades = gradedList.length;\r\n                const topCount = gradedList.filter((tx: any) => tx.topGrade).length;\r\n                grade_score = (topCount / graded_trades) * 100;\r\n            }\r\n\r\n            let final_score: number | null = null;\r\n            if (routine_score === null && grade_score === null) {\r\n                continue; // Skip days with no data\r\n            } else if (routine_score !== null && grade_score === null) {\r\n                final_score = routine_score;\r\n            } else if (routine_score === null && grade_score !== null) {\r\n                final_score = grade_score;\r\n            } else if (routine_score !== null && grade_score !== null) {\r\n                final_score = (grade_score * (gw / 100)) + (routine_score * (rw / 100));\r\n            }\r\n\r\n            if (final_score !== null) {\r\n                final_score = Math.round(final_score * 10) / 10;\r\n            }\r\n\r\n            let label = \"No data\";\r\n            if (final_score !== null) {\r\n                if (final_score >= 90) label = \"Excellent\";\r\n                else if (final_score >= 75) label = \"Good\";\r\n                else if (final_score >= 60) label = \"Average\";\r\n                else if (final_score >= 40) label = \"Poor\";\r\n                else label = \"Critical\";\r\n            }\r\n\r\n            results.push({\r\n                date,\r\n                score: final_score,\r\n                label,\r\n                followed_routine: data.checkin,\r\n                graded_trades\r\n            });\r\n        }\r\n\r\n        // Sort desc\r\n        results.sort((a, b) => b.date.localeCompare(a.date));\r\n\r\n        return NextResponse.json({ data: results });\r\n\r\n    } catch (error: any) {\r\n        return NextResponse.json({ error: error.message }, { status: 500 });\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\app\\api\\discipline\\score\\route.ts","messages":[{"ruleId":"prefer-const","severity":2,"message":"'total_trades' is never reassigned. Use 'const' instead.","line":41,"column":13,"nodeType":"Identifier","messageId":"useConst","endLine":41,"endColumn":25,"fix":{"range":[1437,1479],"text":"const total_trades = dayTrades?.length || 0;"}},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":44,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":44,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1580,1583],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1580,1583],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":52,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":52,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1916,1919],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1916,1919],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":110,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":110,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4055,4058],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4055,4058],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":1,"fixableWarningCount":0,"source":"import { NextResponse } from \"next/server\";\r\nimport { createClient } from \"@/lib/supabase/server\";\r\nimport { createAdminClient } from \"@/lib/supabase/admin\";\r\n\r\nexport async function GET(req: Request) {\r\n    try {\r\n        const { searchParams } = new URL(req.url);\r\n        let date = searchParams.get('date');\r\n        if (!date) {\r\n            date = new Date().toISOString().split('T')[0];\r\n        }\r\n\r\n        const supabase = await createClient();\r\n        const { data: { user } } = await supabase.auth.getUser();\r\n        if (!user?.id) return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\r\n\r\n        // 1. Fetch routine_checkins for date\r\n        const { data: checkin } = await supabase\r\n            .from(\"routine_checkins\")\r\n            .select(\"followed_routine\")\r\n            .eq(\"user_id\", user.id)\r\n            .eq(\"checkin_date\", date)\r\n            .single();\r\n\r\n        let routine_score: number | null = null;\r\n        if (checkin) {\r\n            routine_score = checkin.followed_routine ? 100 : 0;\r\n        }\r\n\r\n        // 2. Fetch grades for trades on this date\r\n        const { data: dayTrades, error: tradesErr } = await supabase\r\n            .from(\"trades\")\r\n            .select(\"id\")\r\n            .eq(\"user_id\", user.id)\r\n            .eq(\"trading_day\", date);\r\n\r\n        if (tradesErr) throw tradesErr;\r\n\r\n        let grade_score: number | null = null;\r\n        let graded_trades = 0;\r\n        let total_trades = dayTrades?.length || 0;\r\n\r\n        if (dayTrades && dayTrades.length > 0) {\r\n            const tradeIds = dayTrades.map((t: any) => t.id);\r\n            const { data: grades } = await supabase\r\n                .from(\"trade_grades\")\r\n                .select(\"grade\")\r\n                .in(\"trade_id\", tradeIds);\r\n\r\n            if (grades && grades.length > 0) {\r\n                graded_trades = grades.length;\r\n                const topGrades = grades.filter((g: any) => ['A+', 'A', 'B+'].includes(g.grade)).length;\r\n                grade_score = (topGrades / graded_trades) * 100;\r\n            }\r\n        }\r\n\r\n        // 3. Fetch weights\r\n        const adminClient = createAdminClient();\r\n        const { data: settings } = await adminClient\r\n            .from(\"finance_settings\")\r\n            .select(\"discipline_weights\")\r\n            .eq(\"user_id\", user.id)\r\n            .single();\r\n\r\n        const weights = settings?.discipline_weights || { grade_weight: 70, routine_weight: 30 };\r\n        const gw = Number(weights.grade_weight);\r\n        const rw = Number(weights.routine_weight);\r\n\r\n        // 4. Calculate Final Score\r\n        let final_score: number | null = null;\r\n\r\n        if (routine_score === null && grade_score === null) {\r\n            final_score = null;\r\n        } else if (routine_score !== null && grade_score === null) {\r\n            final_score = routine_score;\r\n        } else if (routine_score === null && grade_score !== null) {\r\n            final_score = grade_score;\r\n        } else if (routine_score !== null && grade_score !== null) {\r\n            final_score = (grade_score * (gw / 100)) + (routine_score * (rw / 100));\r\n        }\r\n\r\n        if (final_score !== null) {\r\n            final_score = Math.round(final_score * 10) / 10;\r\n        }\r\n\r\n        // 5. Determine label\r\n        let label = \"No data\";\r\n        if (final_score !== null) {\r\n            if (final_score >= 90) label = \"Excellent\";\r\n            else if (final_score >= 75) label = \"Good\";\r\n            else if (final_score >= 60) label = \"Average\";\r\n            else if (final_score >= 40) label = \"Poor\";\r\n            else label = \"Critical\";\r\n        }\r\n\r\n        return NextResponse.json({\r\n            data: {\r\n                score: final_score,\r\n                label,\r\n                grade_score,\r\n                routine_score,\r\n                grade_weight: gw,\r\n                routine_weight: rw,\r\n                graded_trades,\r\n                total_trades,\r\n                followed_routine: checkin ? checkin.followed_routine : null\r\n            }\r\n        });\r\n\r\n    } catch (error: any) {\r\n        return NextResponse.json({ error: error.message }, { status: 500 });\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\app\\api\\discipline\\settings\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":26,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":26,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[950,953],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[950,953],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":54,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":54,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2317,2320],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2317,2320],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":77,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":77,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3123,3126],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3123,3126],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from \"next/server\";\r\nimport { createClient } from \"@/lib/supabase/server\";\r\nimport { createAdminClient } from \"@/lib/supabase/admin\";\r\n\r\nexport async function GET() {\r\n    try {\r\n        const supabase = await createClient();\r\n        const { data: { user } } = await supabase.auth.getUser();\r\n        if (!user?.id) return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\r\n\r\n        const adminClient = createAdminClient();\r\n        const { data, error } = await adminClient\r\n            .from(\"finance_settings\")\r\n            .select(\"discipline_weights\")\r\n            .eq(\"user_id\", user.id)\r\n            .single();\r\n\r\n        if (error && error.code !== \"PGRST116\") throw error;\r\n\r\n        let weights = data?.discipline_weights;\r\n        if (!weights) {\r\n            weights = { grade_weight: 70, routine_weight: 30 };\r\n        }\r\n\r\n        return NextResponse.json({ data: weights });\r\n    } catch (error: any) {\r\n        return NextResponse.json({ error: error.message }, { status: 500 });\r\n    }\r\n}\r\n\r\nexport async function POST(req: Request) {\r\n    try {\r\n        const supabase = await createClient();\r\n        const { data: { user } } = await supabase.auth.getUser();\r\n        if (!user?.id) return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\r\n\r\n        const body = await req.json();\r\n        const gradeWeight = Number(body.grade_weight) || 0;\r\n        const routineWeight = Number(body.routine_weight) || 0;\r\n\r\n        if (gradeWeight + routineWeight !== 100) {\r\n            return NextResponse.json({ error: \"Weights must sum to 100\" }, { status: 400 });\r\n        }\r\n\r\n        const adminClient = createAdminClient();\r\n        // Fetch existing first Since upsert replaces entire row if not careful, but Supabase UI upsert updates provided columns if row exists, unless it's a true replace.\r\n        // Actually, Supabase `upsert` with returning updates only specified columns if it exists, BUT if the row doesn't exist, it might fail if we don't provide all NOT NULL columns (like grading_weights which has default, but better to be safe).\r\n        const { data: existing } = await adminClient\r\n            .from(\"finance_settings\")\r\n            .select(\"*\")\r\n            .eq(\"user_id\", user.id)\r\n            .single();\r\n\r\n        let payload: any = {};\r\n        if (existing) {\r\n            payload = {\r\n                ...existing,\r\n                discipline_weights: { grade_weight: gradeWeight, routine_weight: routineWeight },\r\n                updated_at: new Date().toISOString()\r\n            };\r\n        } else {\r\n            payload = {\r\n                user_id: user.id,\r\n                discipline_weights: { grade_weight: gradeWeight, routine_weight: routineWeight }\r\n            };\r\n        }\r\n\r\n        const { data, error } = await adminClient\r\n            .from(\"finance_settings\")\r\n            .upsert(payload, { onConflict: \"user_id\" })\r\n            .select(\"discipline_weights\")\r\n            .single();\r\n\r\n        if (error) throw error;\r\n        return NextResponse.json({ data: data.discipline_weights });\r\n\r\n    } catch (error: any) {\r\n        return NextResponse.json({ error: error.message }, { status: 500 });\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\app\\api\\finance\\cashflow\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":113,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":113,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4091,4094],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4091,4094],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from \"next/server\";\r\nimport { createClient } from \"@/lib/supabase/server\";\r\nimport { createAdminClient } from \"@/lib/supabase/admin\";\r\n\r\nexport async function GET() {\r\n    try {\r\n        const supabase = await createClient();\r\n        const { data: { user } } = await supabase.auth.getUser();\r\n        if (!user?.id) {\r\n            return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\r\n        }\r\n\r\n        const adminClient = createAdminClient();\r\n\r\n        // Fetch all data needed\r\n        const [expensesRes, payoutsRes] = await Promise.all([\r\n            adminClient.from(\"expenses\").select(\"*\").eq(\"user_id\", user.id),\r\n            adminClient.from(\"finance_payouts\").select(\"*\").eq(\"user_id\", user.id)\r\n        ]);\r\n\r\n        if (expensesRes.error) throw expensesRes.error;\r\n        if (payoutsRes.error) throw payoutsRes.error;\r\n\r\n        const expenses = expensesRes.data || [];\r\n        const payouts = payoutsRes.data || [];\r\n\r\n        const now = new Date();\r\n        const currentYear = now.getFullYear();\r\n        const currentMonth = now.getMonth(); // 0-11\r\n\r\n        // Helper to format \"Jan 2026\"\r\n        const formatMonth = (date: Date) => {\r\n            return date.toLocaleDateString('en-US', { month: 'short', year: 'numeric' });\r\n        };\r\n\r\n        // Initialize 12 months arrays (from 11 months ago to this month)\r\n        const last12Months: string[] = [];\r\n        const last6MonthsSet = new Set<string>();\r\n\r\n        for (let i = 11; i >= 0; i--) {\r\n            const d = new Date(currentYear, currentMonth - i, 1);\r\n            const mStr = formatMonth(d);\r\n            last12Months.push(mStr);\r\n            if (i < 6) last6MonthsSet.add(mStr);\r\n        }\r\n\r\n        const inflowsMap = new Map<string, number>(last12Months.map(m => [m, 0]));\r\n        const outflowsMap = new Map<string, number>(last12Months.map(m => [m, 0]));\r\n\r\n        let totalInflows12mo = 0;\r\n        let totalOutflows12mo = 0;\r\n        let avgMonthlyBurnSum = 0; // sum for the last 6 months\r\n\r\n        expenses.forEach(exp => {\r\n            const d = new Date(exp.date);\r\n            const amt = Number(exp.amount) || 0;\r\n            const monthStr = formatMonth(d);\r\n\r\n            if (outflowsMap.has(monthStr)) {\r\n                outflowsMap.set(monthStr, outflowsMap.get(monthStr)! + amt);\r\n                totalOutflows12mo += amt;\r\n                if (last6MonthsSet.has(monthStr)) {\r\n                    avgMonthlyBurnSum += amt;\r\n                }\r\n            }\r\n        });\r\n\r\n        payouts.forEach(pay => {\r\n            if (pay.status !== 'received') return;\r\n            const d = new Date(pay.date);\r\n            const amt = Number(pay.amount) || 0;\r\n            const monthStr = formatMonth(d);\r\n\r\n            if (inflowsMap.has(monthStr)) {\r\n                inflowsMap.set(monthStr, inflowsMap.get(monthStr)! + amt);\r\n                totalInflows12mo += amt;\r\n            }\r\n        });\r\n\r\n        const avgMonthlyBurn = avgMonthlyBurnSum / 6;\r\n        const netCashPosition = totalInflows12mo - totalOutflows12mo;\r\n\r\n        const monthlyFlow = last12Months.map(month => {\r\n            const inf = inflowsMap.get(month)!;\r\n            const outf = outflowsMap.get(month)!;\r\n            return {\r\n                month,\r\n                inflows: inf,\r\n                outflows: outf,\r\n                net: inf - outf\r\n            };\r\n        });\r\n\r\n        const cumulativePosition: { month: string, cumulative: number }[] = [];\r\n        let runningTotal = 0;\r\n        last12Months.forEach(month => {\r\n            const inf = inflowsMap.get(month)!;\r\n            const outf = outflowsMap.get(month)!;\r\n            runningTotal += (inf - outf);\r\n            cumulativePosition.push({ month, cumulative: runningTotal });\r\n        });\r\n\r\n        const result = {\r\n            totalInflows12mo,\r\n            totalOutflows12mo,\r\n            avgMonthlyBurn,\r\n            netCashPosition,\r\n            monthlyFlow,\r\n            cumulativePosition\r\n        };\r\n\r\n        return NextResponse.json({ data: result });\r\n    } catch (error: any) {\r\n        return NextResponse.json({ error: error.message || \"Internal Server Error\" }, { status: 500 });\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\app\\api\\finance\\expenses\\[id]\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":29,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":29,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1002,1005],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1002,1005],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":55,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":55,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1882,1885],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1882,1885],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from \"next/server\";\r\nimport { createClient } from \"@/lib/supabase/server\";\r\nimport { createAdminClient } from \"@/lib/supabase/admin\";\r\n\r\nexport async function PATCH(req: Request, { params }: { params: Promise<{ id: string }> }) {\r\n    try {\r\n        const supabase = await createClient();\r\n        const { data: { user } } = await supabase.auth.getUser();\r\n        if (!user?.id) {\r\n            return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\r\n        }\r\n\r\n        const resolvedParams = await params;\r\n        const id = resolvedParams.id;\r\n        const body = await req.json();\r\n\r\n        const adminClient = createAdminClient();\r\n        const { data, error } = await adminClient\r\n            .from(\"expenses\")\r\n            .update(body)\r\n            .eq(\"id\", id)\r\n            .eq(\"user_id\", user.id)\r\n            .select()\r\n            .single();\r\n\r\n        if (error) throw error;\r\n\r\n        return NextResponse.json({ data });\r\n    } catch (error: any) {\r\n        return NextResponse.json({ error: error.message || \"Internal Server Error\" }, { status: 500 });\r\n    }\r\n}\r\n\r\nexport async function DELETE(req: Request, { params }: { params: Promise<{ id: string }> }) {\r\n    try {\r\n        const supabase = await createClient();\r\n        const { data: { user } } = await supabase.auth.getUser();\r\n        if (!user?.id) {\r\n            return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\r\n        }\r\n\r\n        const resolvedParams = await params;\r\n        const id = resolvedParams.id;\r\n\r\n        const adminClient = createAdminClient();\r\n        const { error } = await adminClient\r\n            .from(\"expenses\")\r\n            .delete()\r\n            .eq(\"id\", id)\r\n            .eq(\"user_id\", user.id);\r\n\r\n        if (error) throw error;\r\n\r\n        return NextResponse.json({ success: true });\r\n    } catch (error: any) {\r\n        return NextResponse.json({ error: error.message || \"Internal Server Error\" }, { status: 500 });\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\app\\api\\finance\\expenses\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":23,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[800,803],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[800,803],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":58,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":58,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1888,1891],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1888,1891],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from \"next/server\";\r\nimport { createClient } from \"@/lib/supabase/server\";\r\nimport { createAdminClient } from \"@/lib/supabase/admin\";\r\n\r\nexport async function GET() {\r\n    try {\r\n        const supabase = await createClient();\r\n        const { data: { user } } = await supabase.auth.getUser();\r\n        if (!user?.id) {\r\n            return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\r\n        }\r\n\r\n        const adminClient = createAdminClient();\r\n        const { data, error } = await adminClient\r\n            .from(\"expenses\")\r\n            .select(\"*\")\r\n            .eq(\"user_id\", user.id)\r\n            .order(\"date\", { ascending: false });\r\n\r\n        if (error) throw error;\r\n\r\n        return NextResponse.json({ data: data || [] });\r\n    } catch (error: any) {\r\n        return NextResponse.json({ error: error.message || \"Internal Server Error\" }, { status: 500 });\r\n    }\r\n}\r\n\r\nexport async function POST(req: Request) {\r\n    try {\r\n        const supabase = await createClient();\r\n        const { data: { user } } = await supabase.auth.getUser();\r\n        if (!user?.id) {\r\n            return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\r\n        }\r\n\r\n        const body = await req.json();\r\n        const { amount, category, vendor, description, date, tags, is_recurring } = body;\r\n\r\n        const adminClient = createAdminClient();\r\n        const { data, error } = await adminClient\r\n            .from(\"expenses\")\r\n            .insert({\r\n                user_id: user.id,\r\n                amount,\r\n                category,\r\n                vendor,\r\n                description,\r\n                date,\r\n                tags,\r\n                is_recurring\r\n            })\r\n            .select()\r\n            .single();\r\n\r\n        if (error) throw error;\r\n\r\n        return NextResponse.json({ data });\r\n    } catch (error: any) {\r\n        return NextResponse.json({ error: error.message || \"Internal Server Error\" }, { status: 500 });\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\app\\api\\finance\\overview\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":160,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":160,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6095,6098],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6095,6098],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from \"next/server\";\r\nimport { createClient } from \"@/lib/supabase/server\";\r\nimport { createAdminClient } from \"@/lib/supabase/admin\";\r\n\r\nexport async function GET() {\r\n    try {\r\n        const supabase = await createClient();\r\n        const { data: { user } } = await supabase.auth.getUser();\r\n        if (!user?.id) {\r\n            return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\r\n        }\r\n\r\n        const adminClient = createAdminClient();\r\n\r\n        // Fetch all data needed\r\n        const [expensesRes, payoutsRes, subsRes] = await Promise.all([\r\n            adminClient.from(\"expenses\").select(\"*\").eq(\"user_id\", user.id),\r\n            adminClient.from(\"finance_payouts\").select(\"*\").eq(\"user_id\", user.id),\r\n            adminClient.from(\"subscriptions\").select(\"*\").eq(\"user_id\", user.id).eq(\"is_active\", true)\r\n        ]);\r\n\r\n        if (expensesRes.error) throw expensesRes.error;\r\n        if (payoutsRes.error) throw payoutsRes.error;\r\n        if (subsRes.error) throw subsRes.error;\r\n\r\n        const expenses = expensesRes.data || [];\r\n        const payouts = payoutsRes.data || [];\r\n        const activeSubs = subsRes.data || [];\r\n\r\n        const now = new Date();\r\n        const currentYear = now.getFullYear();\r\n        const currentMonth = now.getMonth(); // 0-11\r\n        const lastMonthDate = new Date(currentYear, currentMonth - 1, 1);\r\n\r\n        // Helper to format \"Jan 2026\"\r\n        const formatMonth = (date: Date) => {\r\n            return date.toLocaleDateString('en-US', { month: 'short', year: 'numeric' });\r\n        };\r\n\r\n        // Initialize 6 months trend arrays\r\n        const last6Months: string[] = [];\r\n        for (let i = 5; i >= 0; i--) {\r\n            const d = new Date(currentYear, currentMonth - i, 1);\r\n            last6Months.push(formatMonth(d));\r\n        }\r\n\r\n        const expenseMap = new Map<string, number>(last6Months.map(m => [m, 0]));\r\n        const revenueMap = new Map<string, number>(last6Months.map(m => [m, 0]));\r\n        const categoryMap = new Map<string, number>();\r\n\r\n        let thisMonthExpenses = 0;\r\n        let lastMonthExpenses = 0;\r\n        let ytdSpend = 0;\r\n        let avgMonthlyExpenseSum = 0; // sum for the last 6 full/partial months\r\n\r\n        expenses.forEach(exp => {\r\n            const d = new Date(exp.date);\r\n            const amt = Number(exp.amount) || 0;\r\n            const monthStr = formatMonth(d);\r\n\r\n            // YTD\r\n            if (d.getFullYear() === currentYear) ytdSpend += amt;\r\n\r\n            // This month\r\n            if (d.getFullYear() === currentYear && d.getMonth() === currentMonth) {\r\n                thisMonthExpenses += amt;\r\n            }\r\n\r\n            // Last month\r\n            if (d.getFullYear() === lastMonthDate.getFullYear() && d.getMonth() === lastMonthDate.getMonth()) {\r\n                lastMonthExpenses += amt;\r\n            }\r\n\r\n            // Trend\r\n            if (expenseMap.has(monthStr)) {\r\n                expenseMap.set(monthStr, expenseMap.get(monthStr)! + amt);\r\n                avgMonthlyExpenseSum += amt;\r\n            }\r\n\r\n            // Category (all time or just recent? let's do all time, or maybe YTD? User didn't specify, we'll do all time for now)\r\n            categoryMap.set(exp.category, (categoryMap.get(exp.category) || 0) + amt);\r\n        });\r\n\r\n        let thisMonthRevenue = 0;\r\n        let lastMonthRevenue = 0;\r\n        let ytdEarned = 0;\r\n\r\n        payouts.forEach(pay => {\r\n            if (pay.status !== 'received') return;\r\n            const d = new Date(pay.date);\r\n            const amt = Number(pay.amount) || 0;\r\n            const monthStr = formatMonth(d);\r\n\r\n            // YTD\r\n            if (d.getFullYear() === currentYear) ytdEarned += amt;\r\n\r\n            // This month\r\n            if (d.getFullYear() === currentYear && d.getMonth() === currentMonth) {\r\n                thisMonthRevenue += amt;\r\n            }\r\n\r\n            // Last month\r\n            if (d.getFullYear() === lastMonthDate.getFullYear() && d.getMonth() === lastMonthDate.getMonth()) {\r\n                lastMonthRevenue += amt;\r\n            }\r\n\r\n            // Trend\r\n            if (revenueMap.has(monthStr)) {\r\n                revenueMap.set(monthStr, revenueMap.get(monthStr)! + amt);\r\n            }\r\n        });\r\n\r\n        const activeSubscriptionsMonthly = activeSubs.reduce((sum, sub) => {\r\n            const amt = Number(sub.amount) || 0;\r\n            let monthly = 0;\r\n            if (sub.billing_cycle === 'yearly') monthly = amt / 12;\r\n            else if (sub.billing_cycle === 'weekly') monthly = amt * 4.33;\r\n            else monthly = amt;\r\n            return sum + monthly;\r\n        }, 0);\r\n\r\n        const thisMonthNet = thisMonthRevenue - thisMonthExpenses;\r\n        const lastMonthNet = lastMonthRevenue - lastMonthExpenses;\r\n        const avgMonthlyExpense = avgMonthlyExpenseSum / 6;\r\n\r\n        let ytdROI = 0;\r\n        if (ytdSpend > 0) {\r\n            ytdROI = ((ytdEarned - ytdSpend) / ytdSpend) * 100;\r\n        }\r\n\r\n        const monthlyExpenseTrend = last6Months.map(month => ({ month, amount: expenseMap.get(month)! }));\r\n        const monthlyRevenueTrend = last6Months.map(month => ({ month, amount: revenueMap.get(month)! }));\r\n        const netProfitOverTime = last6Months.map(month => ({\r\n            month,\r\n            amount: revenueMap.get(month)! - expenseMap.get(month)!\r\n        }));\r\n\r\n        const expenseByCategory = Array.from(categoryMap.entries()).map(([category, amount]) => ({\r\n            category,\r\n            amount\r\n        })).sort((a, b) => b.amount - a.amount);\r\n\r\n        const result = {\r\n            thisMonthExpenses,\r\n            thisMonthRevenue,\r\n            thisMonthNet,\r\n            lastMonthNet,\r\n            avgMonthlyExpense,\r\n            activeSubscriptionsMonthly,\r\n            ytdSpend,\r\n            ytdEarned,\r\n            ytdROI,\r\n            monthlyExpenseTrend,\r\n            monthlyRevenueTrend,\r\n            netProfitOverTime,\r\n            expenseByCategory\r\n        };\r\n\r\n        return NextResponse.json({ data: result });\r\n    } catch (error: any) {\r\n        return NextResponse.json({ error: error.message || \"Internal Server Error\" }, { status: 500 });\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\app\\api\\finance\\payouts\\[id]\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":29,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":29,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1009,1012],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1009,1012],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":55,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":55,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1896,1899],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1896,1899],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from \"next/server\";\r\nimport { createClient } from \"@/lib/supabase/server\";\r\nimport { createAdminClient } from \"@/lib/supabase/admin\";\r\n\r\nexport async function PATCH(req: Request, { params }: { params: Promise<{ id: string }> }) {\r\n    try {\r\n        const supabase = await createClient();\r\n        const { data: { user } } = await supabase.auth.getUser();\r\n        if (!user?.id) {\r\n            return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\r\n        }\r\n\r\n        const resolvedParams = await params;\r\n        const id = resolvedParams.id;\r\n        const body = await req.json();\r\n\r\n        const adminClient = createAdminClient();\r\n        const { data, error } = await adminClient\r\n            .from(\"finance_payouts\")\r\n            .update(body)\r\n            .eq(\"id\", id)\r\n            .eq(\"user_id\", user.id)\r\n            .select()\r\n            .single();\r\n\r\n        if (error) throw error;\r\n\r\n        return NextResponse.json({ data });\r\n    } catch (error: any) {\r\n        return NextResponse.json({ error: error.message || \"Internal Server Error\" }, { status: 500 });\r\n    }\r\n}\r\n\r\nexport async function DELETE(req: Request, { params }: { params: Promise<{ id: string }> }) {\r\n    try {\r\n        const supabase = await createClient();\r\n        const { data: { user } } = await supabase.auth.getUser();\r\n        if (!user?.id) {\r\n            return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\r\n        }\r\n\r\n        const resolvedParams = await params;\r\n        const id = resolvedParams.id;\r\n\r\n        const adminClient = createAdminClient();\r\n        const { error } = await adminClient\r\n            .from(\"finance_payouts\")\r\n            .delete()\r\n            .eq(\"id\", id)\r\n            .eq(\"user_id\", user.id);\r\n\r\n        if (error) throw error;\r\n\r\n        return NextResponse.json({ success: true });\r\n    } catch (error: any) {\r\n        return NextResponse.json({ error: error.message || \"Internal Server Error\" }, { status: 500 });\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\app\\api\\finance\\payouts\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":30,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":30,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1074,1077],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1074,1077],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":63,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":63,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2087,2090],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2087,2090],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from \"next/server\";\r\nimport { createClient } from \"@/lib/supabase/server\";\r\nimport { createAdminClient } from \"@/lib/supabase/admin\";\r\n\r\nexport async function GET() {\r\n    try {\r\n        const supabase = await createClient();\r\n        const { data: { user } } = await supabase.auth.getUser();\r\n        if (!user?.id) {\r\n            return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\r\n        }\r\n\r\n        const adminClient = createAdminClient();\r\n        const { data, error } = await adminClient\r\n            .from(\"finance_payouts\")\r\n            .select(\"*, accounts(name)\")\r\n            .eq(\"user_id\", user.id)\r\n            .order(\"date\", { ascending: false });\r\n\r\n        if (error) throw error;\r\n\r\n        // Flatten the accounts(name) into account_name\r\n        const formattedData = data?.map(payout => ({\r\n            ...payout,\r\n            account_name: payout.accounts?.name || null,\r\n            accounts: undefined\r\n        })) || [];\r\n\r\n        return NextResponse.json({ data: formattedData });\r\n    } catch (error: any) {\r\n        return NextResponse.json({ error: error.message || \"Internal Server Error\" }, { status: 500 });\r\n    }\r\n}\r\n\r\nexport async function POST(req: Request) {\r\n    try {\r\n        const supabase = await createClient();\r\n        const { data: { user } } = await supabase.auth.getUser();\r\n        if (!user?.id) {\r\n            return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\r\n        }\r\n\r\n        const body = await req.json();\r\n        const { amount, account_id, date, status, notes } = body;\r\n\r\n        const adminClient = createAdminClient();\r\n        const { data, error } = await adminClient\r\n            .from(\"finance_payouts\")\r\n            .insert({\r\n                user_id: user.id,\r\n                amount,\r\n                account_id,\r\n                date,\r\n                status,\r\n                notes\r\n            })\r\n            .select()\r\n            .single();\r\n\r\n        if (error) throw error;\r\n\r\n        return NextResponse.json({ data });\r\n    } catch (error: any) {\r\n        return NextResponse.json({ error: error.message || \"Internal Server Error\" }, { status: 500 });\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\app\\api\\finance\\settings\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":35,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":35,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1112,1115],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1112,1115],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":64,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":64,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2041,2044],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2041,2044],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from \"next/server\";\r\nimport { createClient } from \"@/lib/supabase/server\";\r\nimport { createAdminClient } from \"@/lib/supabase/admin\";\r\n\r\nexport async function GET() {\r\n    try {\r\n        const supabase = await createClient();\r\n        const { data: { user } } = await supabase.auth.getUser();\r\n        if (!user?.id) {\r\n            return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\r\n        }\r\n\r\n        const adminClient = createAdminClient();\r\n        const { data, error } = await adminClient\r\n            .from(\"finance_settings\")\r\n            .select(\"*\")\r\n            .eq(\"user_id\", user.id)\r\n            .single();\r\n\r\n        if (error && error.code !== \"PGRST116\") { // PGRST116 is \"No rows found\"\r\n            throw error;\r\n        }\r\n\r\n        if (!data) {\r\n            return NextResponse.json({\r\n                data: {\r\n                    fiscal_year_start: 1,\r\n                    vendor_presets: [],\r\n                    custom_tags: []\r\n                }\r\n            });\r\n        }\r\n\r\n        return NextResponse.json({ data });\r\n    } catch (error: any) {\r\n        return NextResponse.json({ error: error.message || \"Internal Server Error\" }, { status: 500 });\r\n    }\r\n}\r\n\r\nexport async function POST(req: Request) {\r\n    try {\r\n        const supabase = await createClient();\r\n        const { data: { user } } = await supabase.auth.getUser();\r\n        if (!user?.id) {\r\n            return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\r\n        }\r\n\r\n        const body = await req.json();\r\n\r\n        const adminClient = createAdminClient();\r\n        const { data, error } = await adminClient\r\n            .from(\"finance_settings\")\r\n            .upsert({\r\n                user_id: user.id,\r\n                ...body,\r\n                updated_at: new Date().toISOString()\r\n            }, { onConflict: 'user_id' })\r\n            .select()\r\n            .single();\r\n\r\n        if (error) throw error;\r\n\r\n        return NextResponse.json({ data });\r\n    } catch (error: any) {\r\n        return NextResponse.json({ error: error.message || \"Internal Server Error\" }, { status: 500 });\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\app\\api\\finance\\subscriptions\\[id]\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":29,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":29,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1007,1010],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1007,1010],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":55,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":55,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1892,1895],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1892,1895],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from \"next/server\";\r\nimport { createClient } from \"@/lib/supabase/server\";\r\nimport { createAdminClient } from \"@/lib/supabase/admin\";\r\n\r\nexport async function PATCH(req: Request, { params }: { params: Promise<{ id: string }> }) {\r\n    try {\r\n        const supabase = await createClient();\r\n        const { data: { user } } = await supabase.auth.getUser();\r\n        if (!user?.id) {\r\n            return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\r\n        }\r\n\r\n        const resolvedParams = await params;\r\n        const id = resolvedParams.id;\r\n        const body = await req.json();\r\n\r\n        const adminClient = createAdminClient();\r\n        const { data, error } = await adminClient\r\n            .from(\"subscriptions\")\r\n            .update(body)\r\n            .eq(\"id\", id)\r\n            .eq(\"user_id\", user.id)\r\n            .select()\r\n            .single();\r\n\r\n        if (error) throw error;\r\n\r\n        return NextResponse.json({ data });\r\n    } catch (error: any) {\r\n        return NextResponse.json({ error: error.message || \"Internal Server Error\" }, { status: 500 });\r\n    }\r\n}\r\n\r\nexport async function DELETE(req: Request, { params }: { params: Promise<{ id: string }> }) {\r\n    try {\r\n        const supabase = await createClient();\r\n        const { data: { user } } = await supabase.auth.getUser();\r\n        if (!user?.id) {\r\n            return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\r\n        }\r\n\r\n        const resolvedParams = await params;\r\n        const id = resolvedParams.id;\r\n\r\n        const adminClient = createAdminClient();\r\n        const { error } = await adminClient\r\n            .from(\"subscriptions\")\r\n            .delete()\r\n            .eq(\"id\", id)\r\n            .eq(\"user_id\", user.id);\r\n\r\n        if (error) throw error;\r\n\r\n        return NextResponse.json({ success: true });\r\n    } catch (error: any) {\r\n        return NextResponse.json({ error: error.message || \"Internal Server Error\" }, { status: 500 });\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\app\\api\\finance\\subscriptions\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":23,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[804,807],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[804,807],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":58,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":58,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1925,1928],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1925,1928],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from \"next/server\";\r\nimport { createClient } from \"@/lib/supabase/server\";\r\nimport { createAdminClient } from \"@/lib/supabase/admin\";\r\n\r\nexport async function GET() {\r\n    try {\r\n        const supabase = await createClient();\r\n        const { data: { user } } = await supabase.auth.getUser();\r\n        if (!user?.id) {\r\n            return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\r\n        }\r\n\r\n        const adminClient = createAdminClient();\r\n        const { data, error } = await adminClient\r\n            .from(\"subscriptions\")\r\n            .select(\"*\")\r\n            .eq(\"user_id\", user.id)\r\n            .order(\"name\", { ascending: true });\r\n\r\n        if (error) throw error;\r\n\r\n        return NextResponse.json({ data: data || [] });\r\n    } catch (error: any) {\r\n        return NextResponse.json({ error: error.message || \"Internal Server Error\" }, { status: 500 });\r\n    }\r\n}\r\n\r\nexport async function POST(req: Request) {\r\n    try {\r\n        const supabase = await createClient();\r\n        const { data: { user } } = await supabase.auth.getUser();\r\n        if (!user?.id) {\r\n            return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\r\n        }\r\n\r\n        const body = await req.json();\r\n        const { name, provider, amount, billing_cycle, next_billing_date, category, is_active } = body;\r\n\r\n        const adminClient = createAdminClient();\r\n        const { data, error } = await adminClient\r\n            .from(\"subscriptions\")\r\n            .insert({\r\n                user_id: user.id,\r\n                name,\r\n                provider,\r\n                amount,\r\n                billing_cycle,\r\n                next_billing_date,\r\n                category,\r\n                is_active\r\n            })\r\n            .select()\r\n            .single();\r\n\r\n        if (error) throw error;\r\n\r\n        return NextResponse.json({ data });\r\n    } catch (error: any) {\r\n        return NextResponse.json({ error: error.message || \"Internal Server Error\" }, { status: 500 });\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\app\\api\\goals\\[id]\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":49,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":49,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1928,1931],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1928,1931],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":84,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":84,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3571,3574],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3571,3574],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":110,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":110,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4453,4456],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4453,4456],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server'\r\nimport { createClient } from '@/lib/supabase/server'\r\nimport { createAdminClient } from '@/lib/supabase/admin'\r\nimport { z } from 'zod'\r\n\r\nconst UpdateGoalSchema = z.object({\r\n    title: z.string().min(1).optional(),\r\n    description: z.string().optional().nullable(),\r\n    goal_type: z.enum(['performance', 'consistency', 'financial', 'custom']).optional(),\r\n    metric: z.string().optional().nullable(),\r\n    unit: z.string().optional().nullable(),\r\n    target_value: z.number().optional(),\r\n    current_value: z.number().optional(),\r\n    deadline: z.string().optional().nullable(),\r\n    status: z.enum(['active', 'completed', 'failed', 'paused']).optional()\r\n})\r\n\r\nexport async function PATCH(req: Request, props: { params: Promise<{ id: string }> }) {\r\n    try {\r\n        const params = await props.params;\r\n        const supabase = await createClient()\r\n        const { data: { user } } = await supabase.auth.getUser()\r\n\r\n        if (!user) {\r\n            return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\r\n        }\r\n\r\n        const body = await req.json()\r\n        const mappedBody = {\r\n            title: body.title,\r\n            description: body.description,\r\n            goal_type: body.goalType ?? body.goal_type,\r\n            metric: body.metric,\r\n            unit: body.unit,\r\n            target_value: body.targetValue ?? body.target_value,\r\n            current_value: body.currentValue ?? body.current_value,\r\n            deadline: body.deadline,\r\n            status: body.status\r\n        }\r\n        const parsed = UpdateGoalSchema.safeParse(mappedBody)\r\n\r\n        if (!parsed.success) {\r\n            return NextResponse.json({ error: 'Invalid payload', details: parsed.error.issues }, { status: 400 })\r\n        }\r\n\r\n        const adminClient = createAdminClient()\r\n\r\n        // Auto-complete logic based on PATCH request\r\n        const updateData: any = { ...parsed.data }\r\n        updateData.updated_at = new Date().toISOString()\r\n\r\n        if (parsed.data.current_value !== undefined && parsed.data.target_value !== undefined) {\r\n            if (parsed.data.current_value >= parsed.data.target_value && (!parsed.data.status || parsed.data.status === 'active')) {\r\n                updateData.status = 'completed'\r\n            }\r\n        } else if (parsed.data.current_value !== undefined || parsed.data.target_value !== undefined) {\r\n            const { data: existingGoal } = await adminClient\r\n                .from('goals')\r\n                .select('*')\r\n                .eq('id', params.id)\r\n                .eq('user_id', user.id)\r\n                .single()\r\n\r\n            if (existingGoal) {\r\n                const newCurrent = parsed.data.current_value !== undefined ? parsed.data.current_value : parseFloat(existingGoal.current_value || '0')\r\n                const newTarget = parsed.data.target_value !== undefined ? parsed.data.target_value : parseFloat(existingGoal.target_value || '0')\r\n                if (newCurrent >= newTarget && existingGoal.status === 'active' && (!parsed.data.status || parsed.data.status === 'active')) {\r\n                    updateData.status = 'completed'\r\n                }\r\n            }\r\n        }\r\n\r\n        const { data: updated, error } = await adminClient\r\n            .from('goals')\r\n            .update(updateData)\r\n            .eq('id', params.id)\r\n            .eq('user_id', user.id)\r\n            .select()\r\n            .single()\r\n\r\n        if (error) throw error\r\n\r\n        return NextResponse.json({ data: updated })\r\n    } catch (error: any) {\r\n        console.error('Failed to update goal:', error)\r\n        return NextResponse.json({ error: error.message || 'Internal Server Error' }, { status: 500 })\r\n    }\r\n}\r\n\r\nexport async function DELETE(req: Request, props: { params: Promise<{ id: string }> }) {\r\n    try {\r\n        const params = await props.params;\r\n        const supabase = await createClient()\r\n        const { data: { user } } = await supabase.auth.getUser()\r\n\r\n        if (!user) {\r\n            return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\r\n        }\r\n\r\n        const adminClient = createAdminClient()\r\n        const { error } = await adminClient\r\n            .from('goals')\r\n            .delete()\r\n            .eq('id', params.id)\r\n            .eq('user_id', user.id)\r\n\r\n        if (error) throw error\r\n\r\n        return NextResponse.json({ success: true })\r\n    } catch (error: any) {\r\n        console.error('Failed to delete goal:', error)\r\n        return NextResponse.json({ error: error.message || 'Internal Server Error' }, { status: 500 })\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\app\\api\\goals\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":54,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":54,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1870,1873],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1870,1873],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":114,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":114,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3989,3992],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3989,3992],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server'\r\nimport { createClient } from '@/lib/supabase/server'\r\nimport { createAdminClient } from '@/lib/supabase/admin'\r\nimport { z } from 'zod'\r\n\r\nconst CreateGoalSchema = z.object({\r\n    title: z.string().min(1),\r\n    description: z.string().optional().nullable(),\r\n    goal_type: z.enum(['performance', 'consistency', 'financial', 'custom']).optional(),\r\n    metric: z.string().optional().nullable(),\r\n    unit: z.string().optional().nullable(),\r\n    target_value: z.number(),\r\n    current_value: z.number().optional(),\r\n    deadline: z.string().optional().nullable(),\r\n    status: z.enum(['active', 'completed', 'failed', 'paused']).optional()\r\n})\r\n\r\nexport async function GET() {\r\n    try {\r\n        const supabase = await createClient()\r\n        const { data: { user } } = await supabase.auth.getUser()\r\n\r\n        if (!user) {\r\n            return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\r\n        }\r\n\r\n        const adminClient = createAdminClient()\r\n        const { data: userGoals, error } = await adminClient\r\n            .from('goals')\r\n            .select('*')\r\n            .eq('user_id', user.id)\r\n            .order('deadline', { ascending: true, nullsFirst: false })\r\n\r\n        if (error) throw error\r\n\r\n        const data = userGoals?.map(g => {\r\n            let progress = 0\r\n            const current = parseFloat(g.current_value || '0')\r\n            const target = parseFloat(g.target_value || '0')\r\n\r\n            if (target !== 0) {\r\n                progress = (current / target) * 100\r\n            }\r\n            if (progress > 100) progress = 100\r\n            if (progress < 0) progress = 0\r\n\r\n            return {\r\n                ...g,\r\n                progress: Number(progress.toFixed(1))\r\n            }\r\n        }) || []\r\n\r\n        return NextResponse.json({ data })\r\n    } catch (error: any) {\r\n        console.error('Failed to fetch goals:', error)\r\n        return NextResponse.json({ error: error.message || 'Internal Server Error' }, { status: 500 })\r\n    }\r\n}\r\n\r\nexport async function POST(req: Request) {\r\n    try {\r\n        const supabase = await createClient()\r\n        const { data: { user } } = await supabase.auth.getUser()\r\n\r\n        if (!user) {\r\n            return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\r\n        }\r\n\r\n        const body = await req.json()\r\n        // Map camelCase to snake_case if necessary, or just expect snake_case from the prompt\r\n        const mappedBody = {\r\n            title: body.title,\r\n            description: body.description ?? body.description,\r\n            goal_type: body.goalType ?? body.goal_type,\r\n            metric: body.metric,\r\n            unit: body.unit,\r\n            target_value: body.targetValue ?? body.target_value,\r\n            current_value: body.currentValue ?? body.current_value,\r\n            deadline: body.deadline,\r\n            status: body.status\r\n        }\r\n\r\n        const parsed = CreateGoalSchema.safeParse(mappedBody)\r\n\r\n        if (!parsed.success) {\r\n            return NextResponse.json({ error: 'Invalid payload', details: parsed.error.issues }, { status: 400 })\r\n        }\r\n\r\n        const {\r\n            title, description, goal_type, metric, unit, target_value, current_value, deadline, status\r\n        } = parsed.data\r\n\r\n        const adminClient = createAdminClient()\r\n        const { data: newGoal, error } = await adminClient\r\n            .from('goals')\r\n            .insert({\r\n                user_id: user.id,\r\n                title,\r\n                description,\r\n                goal_type: goal_type ?? 'performance',\r\n                metric,\r\n                unit,\r\n                target_value,\r\n                current_value: current_value ?? 0,\r\n                deadline,\r\n                status: status ?? 'active'\r\n            })\r\n            .select()\r\n            .single()\r\n\r\n        if (error) throw error\r\n\r\n        return NextResponse.json({ data: newGoal })\r\n    } catch (error: any) {\r\n        console.error('Failed to create goal:', error)\r\n        return NextResponse.json({ error: error.message || 'Internal Server Error' }, { status: 500 })\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\app\\api\\grading\\categories\\[id]\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\app\\api\\grading\\rubrics\\[id]\\categories\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\app\\api\\grading\\rubrics\\[id]\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\app\\api\\grading\\rubrics\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\app\\api\\grading\\summary\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":43,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":43,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1321,1324],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1321,1324],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":58,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":58,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1922,1925],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1922,1925],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server'\r\nimport { createAdminClient } from '@/lib/supabase/admin'\r\nimport { createClient } from '@/lib/supabase/server'\r\n\r\nexport async function GET() {\r\n    try {\r\n        const supabase = await createClient()\r\n        const { data: { user } } = await supabase.auth.getUser()\r\n\r\n        if (!user) {\r\n            return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\r\n        }\r\n\r\n        const adminClient = createAdminClient()\r\n\r\n        // Fetch trade_grades with embedded trades relation\r\n        const { data: grades, error } = await adminClient\r\n            .from('trade_grades')\r\n            .select(`\r\n        id,\r\n        trade_id,\r\n        grade,\r\n        risk_management_score,\r\n        execution_score,\r\n        discipline_score,\r\n        strategy_score,\r\n        efficiency_score,\r\n        created_at,\r\n        trades (\r\n          id,\r\n          trading_day,\r\n          net_pnl\r\n        )\r\n      `)\r\n            .eq('user_id', user.id)\r\n\r\n        if (error) {\r\n            console.error('[grading/summary] DB error:', error)\r\n            return NextResponse.json({ error: 'Failed to fetch grading summary' }, { status: 500 })\r\n        }\r\n\r\n        // Map rows cleanly since PostgREST embeds relation objects\r\n        const mapped = (grades || []).map((row: any) => ({\r\n            id: row.id,\r\n            tradeId: row.trade_id,\r\n            grade: row.grade,\r\n            riskManagementScore: row.risk_management_score,\r\n            executionScore: row.execution_score,\r\n            disciplineScore: row.discipline_score,\r\n            strategyScore: row.strategy_score,\r\n            efficiencyScore: row.efficiency_score,\r\n            createdAt: row.created_at,\r\n            tradingDay: row.trades?.trading_day || null,\r\n            netPnl: row.trades?.net_pnl || \"0\",\r\n        }))\r\n\r\n        return NextResponse.json({ data: mapped })\r\n    } catch (error: any) {\r\n        console.error('[grading/summary] Internal Server Error:', error)\r\n        return NextResponse.json({ error: 'Internal Server Error' }, { status: 500 })\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\app\\api\\habits\\[id]\\complete\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":45,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":45,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1561,1564],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1561,1564],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":82,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":82,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2836,2839],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2836,2839],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server'\r\nimport { createClient } from '@/lib/supabase/server'\r\nimport { createAdminClient } from '@/lib/supabase/admin'\r\nimport { z } from 'zod'\r\n\r\nconst CompleteHabitSchema = z.object({\r\n    date: z.string().optional() // 'YYYY-MM-DD' format expected\r\n})\r\n\r\nexport async function POST(req: Request, props: { params: Promise<{ id: string }> }) {\r\n    try {\r\n        const params = await props.params;\r\n        const supabase = await createClient()\r\n        const { data: { user } } = await supabase.auth.getUser()\r\n\r\n        if (!user) {\r\n            return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\r\n        }\r\n\r\n        let body = {}\r\n        try {\r\n            body = await req.json()\r\n        } catch {\r\n            // body is optional\r\n        }\r\n\r\n        const parsed = CompleteHabitSchema.safeParse(body)\r\n        const targetDate = parsed.success && parsed.data.date ? parsed.data.date : new Date().toISOString().split('T')[0]\r\n\r\n        const adminClient = createAdminClient()\r\n        // By providing an exact duplicate on primary/unique constraint it will return an error, handle gracefully\r\n        const { error } = await adminClient\r\n            .from('habit_completions')\r\n            .insert({\r\n                user_id: user.id,\r\n                habit_id: params.id,\r\n                completed_date: targetDate\r\n            })\r\n\r\n        if (error && error.code !== '23505') {\r\n            throw error\r\n        }\r\n\r\n        return NextResponse.json({ success: true })\r\n    } catch (error: any) {\r\n        console.error('Failed to complete habit:', error)\r\n        return NextResponse.json({ error: error.message || 'Internal Server Error' }, { status: 500 })\r\n    }\r\n}\r\n\r\nexport async function DELETE(req: Request, props: { params: Promise<{ id: string }> }) {\r\n    try {\r\n        const params = await props.params;\r\n        const supabase = await createClient()\r\n        const { data: { user } } = await supabase.auth.getUser()\r\n\r\n        if (!user) {\r\n            return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\r\n        }\r\n\r\n        let body = {}\r\n        try {\r\n            body = await req.json()\r\n        } catch {\r\n            // body is optional\r\n        }\r\n\r\n        const parsed = CompleteHabitSchema.safeParse(body)\r\n        const targetDate = parsed.success && parsed.data.date ? parsed.data.date : new Date().toISOString().split('T')[0]\r\n\r\n        const adminClient = createAdminClient()\r\n        const { error } = await adminClient\r\n            .from('habit_completions')\r\n            .delete()\r\n            .eq('habit_id', params.id)\r\n            .eq('user_id', user.id)\r\n            .eq('completed_date', targetDate)\r\n\r\n        if (error) throw error\r\n\r\n        return NextResponse.json({ success: true })\r\n    } catch (error: any) {\r\n        console.error('Failed to remove habit completion:', error)\r\n        return NextResponse.json({ error: error.message || 'Internal Server Error' }, { status: 500 })\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\app\\api\\habits\\[id]\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":38,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":38,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1380,1383],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1380,1383],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":53,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":53,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1863,1866],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1863,1866],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":79,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":79,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2747,2750],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2747,2750],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server'\r\nimport { createClient } from '@/lib/supabase/server'\r\nimport { createAdminClient } from '@/lib/supabase/admin'\r\nimport { z } from 'zod'\r\n\r\nconst UpdateHabitSchema = z.object({\r\n    name: z.string().min(1).optional(),\r\n    description: z.string().optional().nullable(),\r\n    frequency: z.enum(['daily', 'weekly', 'monthly']).optional(),\r\n    category: z.string().optional(),\r\n    is_active: z.boolean().optional()\r\n})\r\n\r\nexport async function PATCH(req: Request, props: { params: Promise<{ id: string }> }) {\r\n    try {\r\n        const params = await props.params;\r\n        const supabase = await createClient()\r\n        const { data: { user } } = await supabase.auth.getUser()\r\n\r\n        if (!user) {\r\n            return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\r\n        }\r\n\r\n        const body = await req.json()\r\n        const mappedBody = {\r\n            name: body.name,\r\n            description: body.description,\r\n            frequency: body.frequency,\r\n            category: body.category,\r\n            is_active: body.isActive ?? body.is_active\r\n        }\r\n        const parsed = UpdateHabitSchema.safeParse(mappedBody)\r\n\r\n        if (!parsed.success) {\r\n            return NextResponse.json({ error: 'Invalid payload', details: parsed.error.issues }, { status: 400 })\r\n        }\r\n\r\n        const updateData: any = { ...parsed.data }\r\n        updateData.updated_at = new Date().toISOString()\r\n\r\n        const adminClient = createAdminClient()\r\n        const { data: updated, error } = await adminClient\r\n            .from('habits')\r\n            .update(updateData)\r\n            .eq('id', params.id)\r\n            .eq('user_id', user.id)\r\n            .select()\r\n            .single()\r\n\r\n        if (error) throw error\r\n\r\n        return NextResponse.json({ data: updated })\r\n    } catch (error: any) {\r\n        console.error('Failed to update habit:', error)\r\n        return NextResponse.json({ error: error.message || 'Internal Server Error' }, { status: 500 })\r\n    }\r\n}\r\n\r\nexport async function DELETE(req: Request, props: { params: Promise<{ id: string }> }) {\r\n    try {\r\n        const params = await props.params;\r\n        const supabase = await createClient()\r\n        const { data: { user } } = await supabase.auth.getUser()\r\n\r\n        if (!user) {\r\n            return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\r\n        }\r\n\r\n        const adminClient = createAdminClient()\r\n        const { error } = await adminClient\r\n            .from('habits')\r\n            .delete()\r\n            .eq('id', params.id)\r\n            .eq('user_id', user.id)\r\n\r\n        if (error) throw error\r\n\r\n        return NextResponse.json({ success: true })\r\n    } catch (error: any) {\r\n        console.error('Failed to delete habit:', error)\r\n        return NextResponse.json({ error: error.message || 'Internal Server Error' }, { status: 500 })\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\app\\api\\habits\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'frequency' is defined but never used.","line":15,"column":67,"nodeType":"Identifier","messageId":"unusedVar","endLine":15,"endColumn":76},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":112,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":112,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3601,3604],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3601,3604],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":163,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":163,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5264,5267],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5264,5267],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server'\r\nimport { createClient } from '@/lib/supabase/server'\r\nimport { createAdminClient } from '@/lib/supabase/admin'\r\nimport { z } from 'zod'\r\nimport { subDays, isSameDay, parseISO } from 'date-fns'\r\n\r\nconst CreateHabitSchema = z.object({\r\n    name: z.string().min(1),\r\n    description: z.string().optional().nullable(),\r\n    frequency: z.enum(['daily', 'weekly', 'monthly']).optional(),\r\n    category: z.string().optional(),\r\n    is_active: z.boolean().optional()\r\n})\r\n\r\nfunction getHabitStats(completions: { completed_date: string }[], frequency: string) {\r\n    const sortedDates = completions\r\n        .map(c => parseISO(c.completed_date))\r\n        .sort((a, b) => b.getTime() - a.getTime()) // newest first\r\n\r\n    const today = new Date()\r\n    let currentStreak = 0\r\n    let bestStreak = completions.length > 0 ? 1 : 0\r\n\r\n    if (sortedDates.length === 0) {\r\n        return { completedToday: false, currentStreak: 0, bestStreak: 0, weeklyRate: 0 }\r\n    }\r\n\r\n    const completedToday = sortedDates.some(d => isSameDay(d, today))\r\n\r\n    let checkDate = completedToday ? today : subDays(today, 1)\r\n    for (const match of sortedDates) {\r\n        if (isSameDay(match, checkDate)) {\r\n            currentStreak++\r\n            checkDate = subDays(checkDate, 1)\r\n        } else if (match < checkDate) {\r\n            break\r\n        }\r\n    }\r\n\r\n    let maxStreak = 0\r\n    let tempStreak = 0\r\n    let previousDate: Date | null = null\r\n\r\n    const ascendingDates = [...sortedDates].reverse()\r\n    for (const date of ascendingDates) {\r\n        if (!previousDate) {\r\n            tempStreak = 1\r\n        } else {\r\n            const diffTime = Math.abs(date.getTime() - previousDate.getTime());\r\n            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));\r\n            if (diffDays === 1) {\r\n                tempStreak++\r\n            } else {\r\n                tempStreak = 1\r\n            }\r\n        }\r\n        if (tempStreak > maxStreak) {\r\n            maxStreak = tempStreak\r\n        }\r\n        previousDate = date\r\n    }\r\n    bestStreak = maxStreak\r\n\r\n    const oneWeekAgo = subDays(today, 7)\r\n    const last7DaysCompletions = sortedDates.filter(d => d >= oneWeekAgo).length\r\n    const weeklyRate = (last7DaysCompletions / 7) * 100\r\n\r\n    return {\r\n        completedToday,\r\n        currentStreak,\r\n        bestStreak,\r\n        weeklyRate: Number(weeklyRate.toFixed(1))\r\n    }\r\n}\r\n\r\nexport async function GET() {\r\n    try {\r\n        const supabase = await createClient()\r\n        const { data: { user } } = await supabase.auth.getUser()\r\n\r\n        if (!user) {\r\n            return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\r\n        }\r\n\r\n        const adminClient = createAdminClient()\r\n        const { data: userHabits, error: habitsErr } = await adminClient\r\n            .from('habits')\r\n            .select('*')\r\n            .eq('user_id', user.id)\r\n            .order('name', { ascending: true })\r\n\r\n        if (habitsErr) throw habitsErr\r\n\r\n        const { data: allCompletions, error: compErr } = await adminClient\r\n            .from('habit_completions')\r\n            .select('*')\r\n            .eq('user_id', user.id)\r\n\r\n        if (compErr) throw compErr\r\n\r\n        const data = userHabits?.map(h => {\r\n            const compsForHabit = allCompletions?.filter(c => c.habit_id === h.id) || []\r\n            const stats = getHabitStats(compsForHabit, h.frequency)\r\n\r\n            return {\r\n                ...h,\r\n                ...stats\r\n            }\r\n        }) || []\r\n\r\n        return NextResponse.json({ data })\r\n    } catch (error: any) {\r\n        console.error('Failed to fetch habits:', error)\r\n        return NextResponse.json({ error: error.message || 'Internal Server Error' }, { status: 500 })\r\n    }\r\n}\r\n\r\nexport async function POST(req: Request) {\r\n    try {\r\n        const supabase = await createClient()\r\n        const { data: { user } } = await supabase.auth.getUser()\r\n\r\n        if (!user) {\r\n            return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\r\n        }\r\n\r\n        const body = await req.json()\r\n        const mappedBody = {\r\n            name: body.name,\r\n            description: body.description,\r\n            frequency: body.frequency,\r\n            category: body.category,\r\n            is_active: body.isActive ?? body.is_active\r\n        }\r\n\r\n        const parsed = CreateHabitSchema.safeParse(mappedBody)\r\n\r\n        if (!parsed.success) {\r\n            return NextResponse.json({ error: 'Invalid payload', details: parsed.error.issues }, { status: 400 })\r\n        }\r\n\r\n        const {\r\n            name, description, frequency, category, is_active\r\n        } = parsed.data\r\n\r\n        const adminClient = createAdminClient()\r\n        const { data: newHabit, error } = await adminClient\r\n            .from('habits')\r\n            .insert({\r\n                user_id: user.id,\r\n                name,\r\n                description,\r\n                frequency: frequency ?? 'daily',\r\n                category: category ?? 'preparation',\r\n                is_active: is_active ?? true\r\n            })\r\n            .select()\r\n            .single()\r\n\r\n        if (error) throw error\r\n\r\n        return NextResponse.json({ data: newHabit })\r\n    } catch (error: any) {\r\n        console.error('Failed to create habit:', error)\r\n        return NextResponse.json({ error: error.message || 'Internal Server Error' }, { status: 500 })\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\app\\api\\import\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\app\\api\\inngest\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\app\\api\\instruments\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\app\\api\\ledger\\[id]\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":52,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":52,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1760,1763],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1760,1763],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":93,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":93,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3189,3192],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3189,3192],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from \"next/server\";\r\nimport { createClient } from \"@/lib/supabase/server\";\r\nimport { createAdminClient } from \"@/lib/supabase/admin\";\r\n\r\nexport async function PATCH(req: Request, { params }: { params: Promise<{ id: string }> }) {\r\n    try {\r\n        const { id } = await params;\r\n        const supabase = await createClient();\r\n        const { data: { user } } = await supabase.auth.getUser();\r\n        if (!user?.id) {\r\n            return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\r\n        }\r\n\r\n        const body = await req.json();\r\n        const { type, amount, description, category, date } = body;\r\n\r\n        const adminClient = createAdminClient();\r\n\r\n        // Ensure it's a manual entry belonging to the user\r\n        const { data: existing, error: checkErr } = await adminClient\r\n            .from(\"ledger_entries\")\r\n            .select(\"source\")\r\n            .eq(\"id\", id)\r\n            .eq(\"user_id\", user.id)\r\n            .single();\r\n\r\n        if (checkErr || !existing) {\r\n            return NextResponse.json({ error: \"Entry not found\" }, { status: 404 });\r\n        }\r\n\r\n        if (existing.source !== \"manual\") {\r\n            return NextResponse.json({ error: \"Only manual entries can be edited\" }, { status: 400 });\r\n        }\r\n\r\n        const { data, error } = await adminClient\r\n            .from(\"ledger_entries\")\r\n            .update({\r\n                type,\r\n                amount,\r\n                description,\r\n                category,\r\n                date\r\n            })\r\n            .eq(\"id\", id)\r\n            .eq(\"user_id\", user.id)\r\n            .select()\r\n            .single();\r\n\r\n        if (error) throw error;\r\n\r\n        return NextResponse.json({ data });\r\n    } catch (error: any) {\r\n        return NextResponse.json({ error: error.message || \"Internal Server Error\" }, { status: 500 });\r\n    }\r\n}\r\n\r\nexport async function DELETE(req: Request, { params }: { params: Promise<{ id: string }> }) {\r\n    try {\r\n        const { id } = await params;\r\n        const supabase = await createClient();\r\n        const { data: { user } } = await supabase.auth.getUser();\r\n        if (!user?.id) {\r\n            return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\r\n        }\r\n\r\n        const adminClient = createAdminClient();\r\n\r\n        // Ensure it's a manual entry belonging to the user\r\n        const { data: existing, error: checkErr } = await adminClient\r\n            .from(\"ledger_entries\")\r\n            .select(\"source\")\r\n            .eq(\"id\", id)\r\n            .eq(\"user_id\", user.id)\r\n            .single();\r\n\r\n        if (checkErr || !existing) {\r\n            return NextResponse.json({ error: \"Entry not found\" }, { status: 404 });\r\n        }\r\n\r\n        if (existing.source !== \"manual\") {\r\n            return NextResponse.json({ error: \"Only manual entries can be deleted\" }, { status: 400 });\r\n        }\r\n\r\n        const { error } = await adminClient\r\n            .from(\"ledger_entries\")\r\n            .delete()\r\n            .eq(\"id\", id)\r\n            .eq(\"user_id\", user.id);\r\n\r\n        if (error) throw error;\r\n\r\n        return NextResponse.json({ success: true });\r\n    } catch (error: any) {\r\n        return NextResponse.json({ error: error.message || \"Internal Server Error\" }, { status: 500 });\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\app\\api\\ledger\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":59,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":59,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2383,2386],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2383,2386],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":135,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":135,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5301,5304],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5301,5304],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":173,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":173,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6689,6692],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6689,6692],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":211,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":211,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7901,7904],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7901,7904],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from \"next/server\";\r\nimport { createClient } from \"@/lib/supabase/server\";\r\nimport { createAdminClient } from \"@/lib/supabase/admin\";\r\n\r\nexport async function GET() {\r\n    try {\r\n        const supabase = await createClient();\r\n        const { data: { user } } = await supabase.auth.getUser();\r\n        if (!user?.id) {\r\n            return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\r\n        }\r\n\r\n        const adminClient = createAdminClient();\r\n\r\n        // 1. Fetch Trading PnL (for summary metrics only, not line items)\r\n        const { data: trades, error: tradesErr } = await adminClient\r\n            .from(\"trades\")\r\n            .select(\"net_pnl\")\r\n            .eq(\"user_id\", user.id);\r\n        if (tradesErr) throw tradesErr;\r\n\r\n        // 2. Fetch Expenses\r\n        const { data: expenses, error: expensesErr } = await adminClient\r\n            .from(\"expenses\")\r\n            .select(\"id, date, amount, vendor, description, category\")\r\n            .eq(\"user_id\", user.id);\r\n        if (expensesErr) throw expensesErr;\r\n\r\n        // 3. Fetch Payouts (from finance_payouts)\r\n        const { data: payouts, error: payoutsErr } = await adminClient\r\n            .from(\"finance_payouts\")\r\n            .select(\"id, date, amount, status\")\r\n            .eq(\"user_id\", user.id);\r\n        if (payoutsErr) throw payoutsErr;\r\n\r\n        // 4. Fetch Manual Ledger Entries\r\n        const { data: manualEntries, error: manualErr } = await adminClient\r\n            .from(\"ledger_entries\")\r\n            .select(\"id, date, type, amount, description, category, source\")\r\n            .eq(\"user_id\", user.id);\r\n        if (manualErr) throw manualErr;\r\n\r\n        // 5. Fetch Subscriptions for MRR\r\n        const { data: subscriptions, error: subsErr } = await adminClient\r\n            .from(\"subscriptions\")\r\n            .select(\"amount, billing_cycle\")\r\n            .eq(\"user_id\", user.id)\r\n            .eq(\"is_active\", true);\r\n        if (subsErr) throw subsErr;\r\n\r\n        // 6. Fetch Prop Evaluations + Accounts for Funding metrics\r\n        const { data: evals, error: evalsErr } = await adminClient\r\n            .from(\"prop_evaluations\")\r\n            .select(\"stage, status, accounts(starting_balance)\")\r\n            .eq(\"user_id\", user.id);\r\n        if (evalsErr) throw evalsErr;\r\n\r\n        // --- Compute Entries ---\r\n        const combinedEntries: any[] = [];\r\n\r\n        // Trades are intentionally excluded from line items as per user request\r\n\r\n        expenses?.forEach(e => {\r\n            combinedEntries.push({\r\n                id: `exp_${e.id}`,\r\n                date: e.date,\r\n                type: \"expense\",\r\n                amount: parseFloat(e.amount || \"0\"),\r\n                description: e.vendor || e.description || \"Expense\",\r\n                category: e.category || \"General\",\r\n                source: \"expense\"\r\n            });\r\n        });\r\n\r\n        payouts?.forEach(p => {\r\n            if (p.status === \"received\" || p.status === \"paid\" || p.status === \"success\" || p.status === \"Approved\") {\r\n                combinedEntries.push({\r\n                    id: `pay_${p.id}`,\r\n                    date: p.date,\r\n                    type: \"income\",\r\n                    amount: parseFloat(p.amount || \"0\"),\r\n                    description: \"Prop Firm Payout\",\r\n                    category: \"Payout\",\r\n                    source: \"payout\"\r\n                });\r\n            }\r\n        });\r\n\r\n        manualEntries?.forEach(m => {\r\n            combinedEntries.push({\r\n                id: m.id, // Keep the real ID because manual entries can be edited/deleted\r\n                date: m.date,\r\n                type: m.type,\r\n                amount: parseFloat(m.amount || \"0\"),\r\n                description: m.description,\r\n                category: m.category,\r\n                source: m.source || \"manual\"\r\n            });\r\n        });\r\n\r\n        combinedEntries.sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime());\r\n\r\n        // --- Compute Summary ---\r\n        let totalRevenue = 0;\r\n        let totalExpenses = 0;\r\n\r\n        combinedEntries.forEach(c => {\r\n            if (c.type === \"income\") totalRevenue += c.amount;\r\n            if (c.type === \"expense\") totalExpenses += c.amount;\r\n        });\r\n\r\n        // Add positive trading PnL to totalRevenue\r\n        const totalTradingPnl = trades?.reduce((sum, t) => sum + parseFloat(t.net_pnl || \"0\"), 0) || 0;\r\n        if (totalTradingPnl > 0) {\r\n            totalRevenue += totalTradingPnl;\r\n        }\r\n\r\n        const netProfit = totalRevenue - totalExpenses;\r\n        const roi = totalExpenses > 0 ? (netProfit / totalExpenses) * 100 : 0;\r\n\r\n        let monthlyRecurring = 0;\r\n        subscriptions?.forEach(s => {\r\n            const amt = parseFloat(s.amount || \"0\");\r\n            if (s.billing_cycle === \"monthly\") monthlyRecurring += amt;\r\n            else if (s.billing_cycle === \"yearly\") monthlyRecurring += amt / 12;\r\n            else if (s.billing_cycle === \"weekly\") monthlyRecurring += amt * 4.33;\r\n        });\r\n\r\n        let totalFunding = 0;\r\n        let fundedAccountCount = 0;\r\n\r\n        evals?.forEach(ev => {\r\n            if (ev.stage === \"funded\" && ev.status === \"active\") {\r\n                fundedAccountCount++;\r\n                const acct = ev.accounts as any;\r\n                if (acct?.starting_balance) {\r\n                    totalFunding += parseFloat(acct.starting_balance);\r\n                }\r\n            }\r\n        });\r\n\r\n        let paybackPeriod: number | null = null;\r\n        if (netProfit > 0) {\r\n            const monthlyProfit = netProfit / 12;\r\n            if (monthlyProfit > 0) {\r\n                paybackPeriod = totalExpenses / monthlyProfit;\r\n            }\r\n        }\r\n\r\n        return NextResponse.json({\r\n            data: {\r\n                entries: combinedEntries,\r\n                summary: {\r\n                    totalRevenue,\r\n                    totalExpenses,\r\n                    netProfit,\r\n                    roi,\r\n                    monthlyRecurring,\r\n                    totalFunding,\r\n                    fundedAccountCount,\r\n                    paybackPeriod\r\n                },\r\n                propStats: {\r\n                    evalsPurchased: evals?.length || 0,\r\n                    currentlyActive: evals?.filter(e => e.status === \"active\" && e.stage === \"evaluation\").length || 0,\r\n                    passed: evals?.filter(e => e.status === \"passed\").length || 0,\r\n                    funded: fundedAccountCount,\r\n                    failed: evals?.filter(e => e.status === \"failed\").length || 0,\r\n                    totalFunding\r\n                }\r\n            }\r\n        });\r\n    } catch (error: any) {\r\n        return NextResponse.json({ error: error.message || \"Internal Server Error\" }, { status: 500 });\r\n    }\r\n}\r\n\r\nexport async function POST(req: Request) {\r\n    try {\r\n        const supabase = await createClient();\r\n        const { data: { user } } = await supabase.auth.getUser();\r\n        if (!user?.id) {\r\n            return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\r\n        }\r\n\r\n        const body = await req.json();\r\n        const { type, amount, description, category, date } = body;\r\n\r\n        if (!type || !amount || !date) {\r\n            return NextResponse.json({ error: \"type, amount, and date are required\" }, { status: 400 });\r\n        }\r\n\r\n        const adminClient = createAdminClient();\r\n        const { data, error } = await adminClient\r\n            .from(\"ledger_entries\")\r\n            .insert({\r\n                user_id: user.id,\r\n                type,\r\n                amount,\r\n                description,\r\n                category,\r\n                date,\r\n                source: \"manual\"\r\n            })\r\n            .select()\r\n            .single();\r\n\r\n        if (error) throw error;\r\n\r\n        return NextResponse.json({ data });\r\n    } catch (error: any) {\r\n        return NextResponse.json({ error: error.message || \"Internal Server Error\" }, { status: 500 });\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\app\\api\\prop\\evaluations\\[id]\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\app\\api\\prop\\evaluations\\[id]\\status\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\app\\api\\prop\\evaluations\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\app\\api\\prop\\payouts\\[id]\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\app\\api\\prop\\payouts\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\app\\api\\prop\\templates\\[id]\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\app\\api\\prop\\templates\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\app\\api\\sessions\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\app\\api\\strategies\\[id]\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":27,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":27,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[990,993],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[990,993],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":60,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":60,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2104,2107],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2104,2107],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":97,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":97,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3438,3441],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3438,3441],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from \"next/server\";\r\nimport { createClient } from \"@/lib/supabase/server\";\r\nimport { createAdminClient } from \"@/lib/supabase/admin\";\r\n\r\nexport async function GET(req: Request, { params }: { params: Promise<{ id: string }> }) {\r\n    try {\r\n        const { id } = await params;\r\n        if (!id) return NextResponse.json({ error: \"Strategy ID is required\" }, { status: 400 });\r\n\r\n        const supabase = await createClient();\r\n        const { data: { user } } = await supabase.auth.getUser();\r\n        if (!user?.id) {\r\n            return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\r\n        }\r\n\r\n        const adminClient = createAdminClient();\r\n        const { data, error } = await adminClient\r\n            .from(\"strategies\")\r\n            .select(\"*\")\r\n            .eq(\"id\", id)\r\n            .eq(\"user_id\", user.id)\r\n            .single();\r\n\r\n        if (error) throw error;\r\n\r\n        return NextResponse.json({ data });\r\n    } catch (error: any) {\r\n        return NextResponse.json({ error: error.message || \"Internal Server Error\" }, { status: 500 });\r\n    }\r\n}\r\n\r\nexport async function PATCH(req: Request, { params }: { params: Promise<{ id: string }> }) {\r\n    try {\r\n        const { id } = await params;\r\n        if (!id) return NextResponse.json({ error: \"Strategy ID is required\" }, { status: 400 });\r\n\r\n        const supabase = await createClient();\r\n        const { data: { user } } = await supabase.auth.getUser();\r\n        if (!user?.id) {\r\n            return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\r\n        }\r\n\r\n        const body = await req.json();\r\n\r\n        const adminClient = createAdminClient();\r\n        const { data, error } = await adminClient\r\n            .from(\"strategies\")\r\n            .update({\r\n                ...body,\r\n                updated_at: new Date().toISOString()\r\n            })\r\n            .eq(\"id\", id)\r\n            .eq(\"user_id\", user.id)\r\n            .select()\r\n            .single();\r\n\r\n        if (error) throw error;\r\n\r\n        return NextResponse.json({ data });\r\n    } catch (error: any) {\r\n        return NextResponse.json({ error: error.message || \"Internal Server Error\" }, { status: 500 });\r\n    }\r\n}\r\n\r\nexport async function DELETE(req: Request, { params }: { params: Promise<{ id: string }> }) {\r\n    try {\r\n        const { id } = await params;\r\n        if (!id) return NextResponse.json({ error: \"Strategy ID is required\" }, { status: 400 });\r\n\r\n        const supabase = await createClient();\r\n        const { data: { user } } = await supabase.auth.getUser();\r\n        if (!user?.id) {\r\n            return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\r\n        }\r\n\r\n        const adminClient = createAdminClient();\r\n\r\n        // 1. Set strategy_id = null on all associated trades\r\n        const { error: tradesUpdateErr } = await adminClient\r\n            .from(\"trades\")\r\n            .update({ strategy_id: null })\r\n            .eq(\"strategy_id\", id)\r\n            .eq(\"user_id\", user.id);\r\n\r\n        if (tradesUpdateErr) throw tradesUpdateErr;\r\n\r\n        // 2. Delete the strategy\r\n        const { error: stratDeleteErr } = await adminClient\r\n            .from(\"strategies\")\r\n            .delete()\r\n            .eq(\"id\", id)\r\n            .eq(\"user_id\", user.id);\r\n\r\n        if (stratDeleteErr) throw stratDeleteErr;\r\n\r\n        return NextResponse.json({ success: true });\r\n    } catch (error: any) {\r\n        return NextResponse.json({ error: error.message || \"Internal Server Error\" }, { status: 500 });\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\app\\api\\strategies\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":96,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":96,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2879,2882],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2879,2882],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":133,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":133,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3938,3941],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3938,3941],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from \"next/server\";\r\nimport { createClient } from \"@/lib/supabase/server\";\r\nimport { createAdminClient } from \"@/lib/supabase/admin\";\r\n\r\nexport async function GET() {\r\n  try {\r\n    const supabase = await createClient();\r\n    const { data: { user } } = await supabase.auth.getUser();\r\n    if (!user?.id) {\r\n      return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\r\n    }\r\n\r\n    const adminClient = createAdminClient();\r\n\r\n    // 1. Fetch all strategies for the user\r\n    const { data: strategies, error: stratErr } = await adminClient\r\n      .from(\"strategies\")\r\n      .select(\"*\")\r\n      .eq(\"user_id\", user.id)\r\n      .order(\"created_at\", { ascending: false });\r\n\r\n    if (stratErr) throw stratErr;\r\n\r\n    // 2. Fetch all trades to compute stats\r\n    const { data: trades, error: tradesErr } = await adminClient\r\n      .from(\"trades\")\r\n      .select(\"strategy_id, net_pnl\")\r\n      .eq(\"user_id\", user.id)\r\n      .not(\"strategy_id\", \"is\", null);\r\n\r\n    if (tradesErr) throw tradesErr;\r\n\r\n    // 3. Compute stats per strategy\r\n    const strategyStats = new Map();\r\n\r\n    trades?.forEach(trade => {\r\n      const sid = trade.strategy_id;\r\n      const pnl = parseFloat(trade.net_pnl || \"0\");\r\n      const isWin = pnl > 0;\r\n      const isLoss = pnl < 0;\r\n\r\n      if (!strategyStats.has(sid)) {\r\n        strategyStats.set(sid, {\r\n          tradeCount: 0,\r\n          totalPnl: 0,\r\n          winCount: 0,\r\n          grossWinningPnl: 0,\r\n          grossLosingPnl: 0,\r\n        });\r\n      }\r\n\r\n      const stats = strategyStats.get(sid);\r\n      stats.tradeCount++;\r\n      stats.totalPnl += pnl;\r\n\r\n      if (isWin) {\r\n        stats.winCount++;\r\n        stats.grossWinningPnl += pnl;\r\n      } else if (isLoss) {\r\n        stats.grossLosingPnl += Math.abs(pnl);\r\n      }\r\n    });\r\n\r\n    const strategiesWithStats = strategies?.map(strategy => {\r\n      const stats = strategyStats.get(strategy.id) || {\r\n        tradeCount: 0,\r\n        totalPnl: 0,\r\n        winCount: 0,\r\n        grossWinningPnl: 0,\r\n        grossLosingPnl: 0,\r\n      };\r\n\r\n      const winRate = stats.tradeCount > 0\r\n        ? (stats.winCount / stats.tradeCount) * 100\r\n        : null;\r\n\r\n      let profitFactor = null;\r\n      if (stats.tradeCount > 0) {\r\n        if (stats.grossLosingPnl === 0) {\r\n          profitFactor = stats.grossWinningPnl > 0 ? 999 : 0; // Arbitrary high number if no losses\r\n        } else {\r\n          profitFactor = stats.grossWinningPnl / stats.grossLosingPnl;\r\n        }\r\n      }\r\n\r\n      return {\r\n        ...strategy,\r\n        tradeCount: stats.tradeCount,\r\n        totalPnl: stats.totalPnl,\r\n        winRate: winRate !== null ? Number(winRate.toFixed(2)) : null,\r\n        profitFactor: profitFactor !== null ? Number(profitFactor.toFixed(2)) : null\r\n      };\r\n    });\r\n\r\n    return NextResponse.json({ data: strategiesWithStats });\r\n  } catch (error: any) {\r\n    return NextResponse.json({ error: error.message || \"Internal Server Error\" }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function POST(req: Request) {\r\n  try {\r\n    const supabase = await createClient();\r\n    const { data: { user } } = await supabase.auth.getUser();\r\n    if (!user?.id) {\r\n      return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\r\n    }\r\n\r\n    const body = await req.json();\r\n    const { name, description, status, entry_rules, invalidation_conditions } = body;\r\n\r\n    if (!name) {\r\n      return NextResponse.json({ error: \"Strategy name is required\" }, { status: 400 });\r\n    }\r\n\r\n    const adminClient = createAdminClient();\r\n    const { data, error } = await adminClient\r\n      .from(\"strategies\")\r\n      .insert({\r\n        user_id: user.id,\r\n        name,\r\n        description,\r\n        status: status || \"active\",\r\n        entry_rules,\r\n        invalidation_conditions\r\n      })\r\n      .select()\r\n      .single();\r\n\r\n    if (error) throw error;\r\n\r\n    return NextResponse.json({ data });\r\n  } catch (error: any) {\r\n    return NextResponse.json({ error: error.message || \"Internal Server Error\" }, { status: 500 });\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\app\\api\\trades\\[id]\\grade\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":57,"column":67,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":57,"endColumn":70,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2039,2042],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2039,2042],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":60,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":60,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2105,2108],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2105,2108],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":149,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":149,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4647,4650],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4647,4650],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server'\r\nimport { createClient } from '@/lib/supabase/server'\r\nimport { createAdminClient } from '@/lib/supabase/admin'\r\nimport { z } from 'zod'\r\n\r\nconst GradeSchema = z.object({\r\n  grade: z.enum(['A+', 'A', 'B+', 'B', 'B-', 'C']),\r\n  risk_management_score: z.number().optional().nullable(),\r\n  execution_score: z.number().optional().nullable(),\r\n  discipline_score: z.number().optional().nullable(),\r\n  strategy_score: z.number().optional().nullable(),\r\n  efficiency_score: z.number().optional().nullable(),\r\n  notes: z.string().optional().nullable(),\r\n  confluence_ids: z.array(z.string().uuid()).optional().default([]),\r\n})\r\n\r\nexport async function GET(req: Request, props: { params: Promise<{ id: string }> }) {\r\n  try {\r\n    const params = await props.params;\r\n    const supabase = await createClient()\r\n    const { data: { user } } = await supabase.auth.getUser()\r\n\r\n    if (!user) {\r\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\r\n    }\r\n\r\n    const tradeId = params.id\r\n\r\n    // Fetch trade grade\r\n    const { data: gradeData, error: gradeError } = await supabase\r\n      .from('trade_grades')\r\n      .select('*')\r\n      .eq('trade_id', tradeId)\r\n      .eq('user_id', user.id)\r\n      .maybeSingle()\r\n\r\n    if (gradeError) {\r\n      console.error('Error fetching trade grade:', gradeError)\r\n      return NextResponse.json({ error: 'Failed to fetch trade grade' }, { status: 500 })\r\n    }\r\n\r\n    // Fetch selected confluences\r\n    const { data: confluencesData, error: confError } = await supabase\r\n      .from('trade_confluences')\r\n      .select('confluence_id')\r\n      .eq('trade_id', tradeId)\r\n      .eq('user_id', user.id)\r\n\r\n    if (confError) {\r\n      console.error('Error fetching trade confluences:', confError)\r\n      return NextResponse.json({ error: 'Failed to fetch trade confluences' }, { status: 500 })\r\n    }\r\n\r\n    return NextResponse.json({\r\n      data: {\r\n        ...(gradeData || {}),\r\n        confluence_ids: confluencesData ? confluencesData.map((c: any) => c.confluence_id) : []\r\n      }\r\n    })\r\n  } catch (error: any) {\r\n    console.error('Failed to get grade:', error)\r\n    return NextResponse.json({ error: error.message || 'Internal Server Error' }, { status: 500 })\r\n  }\r\n}\r\n\r\nexport async function POST(req: Request, props: { params: Promise<{ id: string }> }) {\r\n  try {\r\n    const params = await props.params;\r\n    const supabase = await createClient()\r\n    const { data: { user } } = await supabase.auth.getUser()\r\n\r\n    if (!user) {\r\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\r\n    }\r\n\r\n    const tradeId = params.id\r\n    const body = await req.json()\r\n    const parsed = GradeSchema.safeParse(body)\r\n\r\n    if (!parsed.success) {\r\n      return NextResponse.json({ error: 'Invalid payload', details: parsed.error.issues }, { status: 400 })\r\n    }\r\n\r\n    const {\r\n      grade, risk_management_score, execution_score, discipline_score,\r\n      strategy_score, efficiency_score, notes, confluence_ids\r\n    } = parsed.data\r\n\r\n    const adminClient = createAdminClient()\r\n\r\n    // 1. Upsert trade_grades\r\n    const { data: upsertedGrade, error: gradeError } = await adminClient\r\n      .from('trade_grades')\r\n      .upsert({\r\n        user_id: user.id,\r\n        trade_id: tradeId,\r\n        grade,\r\n        risk_management_score,\r\n        execution_score,\r\n        discipline_score,\r\n        strategy_score,\r\n        efficiency_score,\r\n        notes,\r\n        updated_at: new Date().toISOString()\r\n      }, { onConflict: 'trade_id' })\r\n      .select()\r\n      .single()\r\n\r\n    if (gradeError) throw gradeError\r\n\r\n    // 2. Update trades.grade column\r\n    const { error: tradeUpdateError } = await adminClient\r\n      .from('trades')\r\n      .update({ grade })\r\n      .eq('id', tradeId)\r\n      .eq('user_id', user.id)\r\n\r\n    if (tradeUpdateError) throw tradeUpdateError\r\n\r\n    // 3. Replace trade_confluences\r\n    // First delete existing\r\n    await adminClient\r\n      .from('trade_confluences')\r\n      .delete()\r\n      .eq('trade_id', tradeId)\r\n      .eq('user_id', user.id)\r\n\r\n    // Then insert new if any\r\n    if (confluence_ids && confluence_ids.length > 0) {\r\n      const inserts = confluence_ids.map(id => ({\r\n        user_id: user.id,\r\n        trade_id: tradeId,\r\n        confluence_id: id\r\n      }))\r\n\r\n      const { error: confInsertError } = await adminClient\r\n        .from('trade_confluences')\r\n        .insert(inserts)\r\n\r\n      if (confInsertError) throw confInsertError\r\n    }\r\n\r\n    return NextResponse.json({\r\n      data: {\r\n        ...upsertedGrade,\r\n        confluence_ids\r\n      }\r\n    })\r\n  } catch (error: any) {\r\n    console.error('Failed to save grade:', error)\r\n    return NextResponse.json({ error: error.message || 'Internal Server Error' }, { status: 500 })\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\app\\api\\trades\\[id]\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\app\\api\\trades\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\app\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\components\\analytics\\analytics-client.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\components\\analytics\\charts.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":73,"column":88,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":73,"endColumn":91,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2014,2017],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2014,2017],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":79,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":79,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2431,2434],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2431,2434],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":250,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":250,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8763,8766],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8763,8766],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":133,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":133,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4513,4516],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4513,4516],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":181,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":181,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6198,6201],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6198,6201],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":449,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":449,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17475,17478],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17475,17478],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":509,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":509,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19277,19280],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19277,19280],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":509,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":509,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19289,19292],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19289,19292],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":509,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":509,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19301,19304],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19301,19304],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":574,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":574,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[21691,21694],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[21691,21694],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\r\n\r\nimport { useState } from 'react'\r\nimport { useQuery } from '@tanstack/react-query'\r\nimport {\r\n  ResponsiveContainer,\r\n  LineChart,\r\n  Line,\r\n  BarChart,\r\n  Bar,\r\n  XAxis,\r\n  YAxis,\r\n  CartesianGrid,\r\n  Tooltip as RechartsTooltip,\r\n  Cell,\r\n} from 'recharts'\r\nimport { Tooltip, TooltipProvider, TooltipTrigger, TooltipContent } from '@/components/ui/tooltip'\r\nimport type { DayResult, BreakdownEntry } from '@/types/analytics'\r\n\r\n// ─── Formatting helpers ───────────────────────────────────────────────────────\r\n\r\nfunction fmtDate(dateStr: string): string {\r\n  const d = new Date(dateStr + 'T12:00:00')\r\n  return `${d.getMonth() + 1}/${d.getDate()}`\r\n}\r\n\r\nfunction fmtDollar(n: number): string {\r\n  const abs = Math.abs(n)\r\n  const sign = n < 0 ? '-' : ''\r\n  return `${sign}$${abs.toFixed(0)}`\r\n}\r\n\r\nfunction fmtLabel(label: unknown): string {\r\n  const s = String(label ?? '')\r\n  if (!s.match(/^\\d{4}-\\d{2}-\\d{2}$/)) return s\r\n  const d = new Date(s + 'T12:00:00')\r\n  return d.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })\r\n}\r\n\r\n// ─── Chart wrapper ────────────────────────────────────────────────────────────\r\n\r\nfunction ChartCard({\r\n  title,\r\n  children,\r\n  className,\r\n}: {\r\n  title: string\r\n  children: React.ReactNode\r\n  className?: string\r\n}) {\r\n  return (\r\n    <div\r\n      className={`rounded-lg border border-[var(--border)] bg-[var(--card)] overflow-hidden ${className ?? ''}`}\r\n    >\r\n      <div className=\"px-4 py-3 border-b border-[var(--border)]\">\r\n        <span className=\"text-xs font-semibold uppercase tracking-wider text-[var(--muted-foreground)]\">\r\n          {title}\r\n        </span>\r\n      </div>\r\n      <div className=\"p-4\">{children}</div>\r\n    </div>\r\n  )\r\n}\r\n\r\nfunction EmptyState() {\r\n  return (\r\n    <div className=\"flex items-center justify-center h-40 text-sm text-[var(--muted-foreground)]\">\r\n      No data for this period\r\n    </div>\r\n  )\r\n}\r\n\r\nfunction CustomAnalyticsTooltip({ active, payload, label, formatter, labelFormatter }: any) {\r\n  if (active && payload && payload.length) {\r\n    const formattedLabel = labelFormatter ? labelFormatter(label) : label\r\n    return (\r\n      <div style={{ backgroundColor: '#14171E', border: '1px solid #2A2F3E', borderRadius: '6px', padding: '8px 12px', fontSize: '12px', color: '#E8EAF0' }}>\r\n        <div style={{ marginBottom: '4px', fontWeight: 500 }}>{formattedLabel}</div>\r\n        {payload.map((entry: any, index: number) => {\r\n          const val = entry.value\r\n          let color = '#E8EAF0'\r\n          if (typeof val === 'number') {\r\n            if (val > 0) color = '#22C55E'\r\n            else if (val < 0) color = '#EF4444'\r\n          } else if (typeof val === 'string' && val.includes('$')) {\r\n            const num = parseFloat(val.replace(/[$,]/g, ''))\r\n            if (num > 0) color = '#22C55E'\r\n            else if (num < 0) color = '#EF4444'\r\n          }\r\n          const [fmtVal, fmtName] = formatter ? formatter(val, entry.name, entry) : [val, entry.name]\r\n          return (\r\n            <div key={index} style={{ display: 'flex', justifyContent: 'space-between', gap: '16px', color }}>\r\n              <span style={{ color: '#8B92A8' }}>{fmtName}</span>\r\n              <span style={{ fontFamily: 'monospace', fontWeight: 600 }}>{fmtVal}</span>\r\n            </div>\r\n          )\r\n        })}\r\n      </div>\r\n    )\r\n  }\r\n  return null\r\n}\r\n\r\n// ─── a. Equity Curve ─────────────────────────────────────────────────────────\r\n\r\nexport function EquityCurveChart({ days }: { days: DayResult[] }) {\r\n  if (!days.length) {\r\n    return <ChartCard title=\"Equity Curve\"><EmptyState /></ChartCard>\r\n  }\r\n\r\n  return (\r\n    <ChartCard title=\"Equity Curve\">\r\n      <ResponsiveContainer width=\"100%\" height={280}>\r\n        <LineChart data={days} margin={{ top: 4, right: 16, bottom: 0, left: 16 }}>\r\n          <CartesianGrid strokeDasharray=\"3 3\" stroke=\"#2A2F3E\" vertical={false} />\r\n          <XAxis\r\n            dataKey=\"tradingDay\"\r\n            tickFormatter={fmtDate}\r\n            tick={{ fill: '#8B92A8', fontSize: 11 }}\r\n            axisLine={false}\r\n            tickLine={false}\r\n            interval=\"preserveStartEnd\"\r\n          />\r\n          <YAxis\r\n            tickFormatter={fmtDollar}\r\n            tick={{ fill: '#8B92A8', fontSize: 11 }}\r\n            axisLine={false}\r\n            tickLine={false}\r\n            width={70}\r\n          />\r\n          <RechartsTooltip\r\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n            formatter={(value: any) => [fmtDollar(value ?? 0), 'Cumulative P&L']}\r\n            labelFormatter={fmtLabel}\r\n            content={<CustomAnalyticsTooltip />}\r\n            cursor={{ fill: 'rgba(255,255,255,0.05)' }}\r\n          />\r\n          <Line\r\n            type=\"monotone\"\r\n            dataKey=\"cumulativePnl\"\r\n            stroke=\"var(--color-accent-primary)\"\r\n            strokeWidth={2}\r\n            dot={false}\r\n            activeDot={{ r: 4, fill: 'var(--color-accent-primary)' }}\r\n          />\r\n        </LineChart>\r\n      </ResponsiveContainer>\r\n    </ChartCard>\r\n  )\r\n}\r\n\r\n// ─── b. Daily P&L Bar Chart ──────────────────────────────────────────────────\r\n\r\nexport function DailyPnlChart({ days }: { days: DayResult[] }) {\r\n  if (!days.length) {\r\n    return <ChartCard title=\"Daily P&L\"><EmptyState /></ChartCard>\r\n  }\r\n\r\n  return (\r\n    <ChartCard title=\"Daily P&L\">\r\n      <ResponsiveContainer width=\"100%\" height={200}>\r\n        <BarChart data={days} margin={{ top: 4, right: 16, bottom: 0, left: 16 }}>\r\n          <CartesianGrid strokeDasharray=\"3 3\" stroke=\"#2A2F3E\" vertical={false} />\r\n          <XAxis\r\n            dataKey=\"tradingDay\"\r\n            tickFormatter={fmtDate}\r\n            tick={{ fill: '#8B92A8', fontSize: 11 }}\r\n            axisLine={false}\r\n            tickLine={false}\r\n            interval=\"preserveStartEnd\"\r\n          />\r\n          <YAxis\r\n            tickFormatter={fmtDollar}\r\n            tick={{ fill: '#8B92A8', fontSize: 11 }}\r\n            axisLine={false}\r\n            tickLine={false}\r\n            width={70}\r\n          />\r\n          <RechartsTooltip\r\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n            formatter={(value: any) => [fmtDollar(value ?? 0), 'Net P&L']}\r\n            labelFormatter={fmtLabel}\r\n            content={<CustomAnalyticsTooltip />}\r\n            cursor={{ fill: 'rgba(255,255,255,0.05)' }}\r\n          />\r\n          <Bar dataKey=\"netPnl\" radius={[2, 2, 0, 0]}>\r\n            {days.map((entry, index) => (\r\n              <Cell\r\n                key={`cell-${index}`}\r\n                fill={entry.netPnl >= 0 ? '#22C55E' : '#EF4444'}\r\n                fillOpacity={0.85}\r\n              />\r\n            ))}\r\n          </Bar>\r\n        </BarChart>\r\n      </ResponsiveContainer>\r\n    </ChartCard>\r\n  )\r\n}\r\n\r\n// ─── c. Calendar Heatmap ─────────────────────────────────────────────────────\r\n\r\nfunction getCalendarCellColor(netPnl: number, maxMagnitude: number): string {\r\n  if (maxMagnitude === 0) return 'rgba(26,30,40,0.6)'\r\n  const intensity = Math.min(Math.abs(netPnl) / maxMagnitude, 1)\r\n  const opacity = 0.2 + intensity * 0.8\r\n  if (netPnl > 0) return `rgba(34, 197, 94, ${opacity.toFixed(2)})`\r\n  if (netPnl < 0) return `rgba(239, 68, 68, ${opacity.toFixed(2)})`\r\n  return 'rgba(26,30,40,0.6)'\r\n}\r\n\r\nfunction getDisciplineCellColor(score: number | null | undefined): string {\r\n  if (score === null || score === undefined) return '#1A1D27'\r\n\r\n  // We use opacity variation within each range to show intensity\r\n  if (score >= 90) {\r\n    const opacity = 0.5 + ((score - 90) / 10) * 0.5\r\n    return `rgba(34, 197, 94, ${opacity.toFixed(2)})` // #22C55E\r\n  }\r\n  if (score >= 75) {\r\n    const opacity = 0.5 + ((score - 75) / 15) * 0.5\r\n    return `rgba(59, 130, 246, ${opacity.toFixed(2)})` // #3B82F6\r\n  }\r\n  if (score >= 60) {\r\n    const opacity = 0.5 + ((score - 60) / 15) * 0.5\r\n    return `rgba(245, 158, 11, ${opacity.toFixed(2)})` // #F59E0B\r\n  }\r\n  if (score >= 40) {\r\n    const opacity = 0.5 + ((score - 40) / 20) * 0.5\r\n    return `rgba(249, 115, 22, ${opacity.toFixed(2)})` // #F97316\r\n  }\r\n  const opacity = 0.5 + (score / 40) * 0.5\r\n  return `rgba(239, 68, 68, ${opacity.toFixed(2)})` // #EF4444\r\n}\r\n\r\nexport function CalendarHeatmap({ days }: { days: DayResult[] }) {\r\n  const [mode, setMode] = useState<'pnl' | 'discipline'>('pnl')\r\n\r\n  const { data: disciplineData } = useQuery({\r\n    queryKey: ['discipline-history', '90d'],\r\n    queryFn: async () => {\r\n      const res = await fetch('/api/discipline/history?days=90')\r\n      if (!res.ok) throw new Error('Failed to fetch discipline history')\r\n      return res.json()\r\n    },\r\n    enabled: mode === 'discipline'\r\n  })\r\n\r\n  const history = disciplineData?.data ?? []\r\n  const disciplineMap = new Map<string, any>()\r\n  for (const item of history) {\r\n    disciplineMap.set(item.date, item)\r\n  }\r\n\r\n  if (!days.length) {\r\n    return <ChartCard title=\"Calendar\"><EmptyState /></ChartCard>\r\n  }\r\n\r\n  const dayMap = new Map<string, DayResult>()\r\n  for (const d of days) {\r\n    dayMap.set(d.tradingDay, d)\r\n  }\r\n\r\n  const sortedDates = days.map((d) => d.tradingDay).sort()\r\n  const startDate = new Date(sortedDates[0] + 'T12:00:00')\r\n  const endDate = new Date(sortedDates[sortedDates.length - 1] + 'T12:00:00')\r\n\r\n  const maxMagnitude = Math.max(...days.map((d) => Math.abs(d.netPnl)), 1)\r\n\r\n  // Align to Monday\r\n  const cur = new Date(startDate)\r\n  const dayOfWeek = cur.getDay() === 0 ? 6 : cur.getDay() - 1\r\n  cur.setDate(cur.getDate() - dayOfWeek)\r\n\r\n  const weeks: (string | null)[][] = []\r\n  while (cur <= endDate) {\r\n    const week: (string | null)[] = []\r\n    for (let d = 0; d < 7; d++) {\r\n      const dateStr = cur.toISOString().split('T')[0]\r\n      week.push(cur <= endDate && cur >= startDate ? dateStr : null)\r\n      cur.setDate(cur.getDate() + 1)\r\n    }\r\n    weeks.push(week)\r\n  }\r\n\r\n  const DAY_LABELS = ['M', 'T', 'W', 'T', 'F', 'S', 'S']\r\n\r\n  return (\r\n    <div className=\"rounded-lg border border-[var(--border)] bg-[var(--card)] overflow-hidden h-full flex flex-col\">\r\n      <div className=\"px-4 py-3 border-b border-[var(--border)] flex items-center justify-between\">\r\n        <span className=\"text-xs font-semibold uppercase tracking-wider text-[var(--muted-foreground)]\">\r\n          Calendar Heatmap\r\n        </span>\r\n        <div className=\"flex bg-[#14171E] rounded-full p-0.5 border border-[#2A2F3E]\">\r\n          <button\r\n            onClick={() => setMode('pnl')}\r\n            className={`px-3 py-1 text-xs font-medium rounded-full transition-all duration-150 ${mode === 'pnl' ? 'bg-[#3B82F6] text-white shadow-sm' : 'text-[#8B92A8] hover:text-[#E8EAF0]'\r\n              }`}\r\n          >\r\n            📈 P&L\r\n          </button>\r\n          <button\r\n            onClick={() => setMode('discipline')}\r\n            className={`px-3 py-1 text-xs font-medium rounded-full transition-all duration-150 ${mode === 'discipline' ? 'bg-[#3B82F6] text-white shadow-sm' : 'text-[#8B92A8] hover:text-[#E8EAF0]'\r\n              }`}\r\n          >\r\n            🎯 Discipline\r\n          </button>\r\n        </div>\r\n      </div>\r\n      <div className=\"p-4 flex-1\">\r\n        <TooltipProvider delayDuration={100}>\r\n          <div className=\"overflow-x-auto\">\r\n            <div className=\"flex gap-1 min-w-0\">\r\n              {/* Day labels column */}\r\n              <div className=\"flex flex-col gap-1 shrink-0 pt-5\">\r\n                {DAY_LABELS.map((label, i) => (\r\n                  <div\r\n                    key={i}\r\n                    className=\"w-5 h-6 flex items-center justify-center text-[10px] text-[var(--muted-foreground)]\"\r\n                  >\r\n                    {label}\r\n                  </div>\r\n                ))}\r\n              </div>\r\n              {/* Weeks */}\r\n              {weeks.map((week, wi) => {\r\n                const firstCell = week.find((d) => d !== null)\r\n                const showMonth =\r\n                  firstCell &&\r\n                  (wi === 0 || new Date(firstCell + 'T12:00:00').getDate() <= 7)\r\n\r\n                return (\r\n                  <div key={wi} className=\"flex flex-col gap-1 shrink-0\">\r\n                    <div className=\"h-5 flex items-center\">\r\n                      {showMonth && (\r\n                        <span className=\"text-[10px] text-[var(--muted-foreground)] whitespace-nowrap\">\r\n                          {new Date(firstCell + 'T12:00:00').toLocaleString('en-US', { month: 'short' })}\r\n                        </span>\r\n                      )}\r\n                    </div>\r\n                    {week.map((dateStr, di) => {\r\n                      if (!dateStr) {\r\n                        return <div key={di} className=\"w-6 h-6 rounded\" style={{ background: 'transparent' }} />\r\n                      }\r\n                      const dayData = dayMap.get(dateStr)\r\n                      const discData = disciplineMap.get(dateStr)\r\n\r\n                      let color = 'rgba(26,30,40,0.4)'\r\n                      if (mode === 'pnl') {\r\n                        color = dayData ? getCalendarCellColor(dayData.netPnl, maxMagnitude) : 'rgba(26,30,40,0.4)'\r\n                      } else if (mode === 'discipline') {\r\n                        color = discData ? getDisciplineCellColor(discData.score) : '#1A1D27'\r\n                      }\r\n                      return (\r\n                        <Tooltip key={di}>\r\n                          <TooltipTrigger asChild>\r\n                            <div\r\n                              className=\"w-6 h-6 rounded cursor-default\"\r\n                              style={{ background: color }}\r\n                            />\r\n                          </TooltipTrigger>\r\n                          <TooltipContent\r\n                            className=\"border-[#2A2F3E] bg-[#14171E] px-3 py-2 text-xs shadow-md\"\r\n                            sideOffset={4}\r\n                          >\r\n                            {mode === 'pnl' ? (\r\n                              <span style={{ color: dayData ? (dayData.netPnl > 0 ? '#22C55E' : dayData.netPnl < 0 ? '#EF4444' : '#E8EAF0') : '#E8EAF0' }}>\r\n                                {dayData\r\n                                  ? `${dateStr}: ${dayData.netPnl >= 0 ? '+' : ''}$${dayData.netPnl.toFixed(2)}`\r\n                                  : dateStr}\r\n                              </span>\r\n                            ) : (\r\n                              <div className=\"flex flex-col gap-1 text-[#E8EAF0]\">\r\n                                <span className=\"font-semibold\">{fmtLabel(dateStr)}</span>\r\n                                {discData ? (\r\n                                  <>\r\n                                    <span style={{ color: getDisciplineCellColor(discData.score) }} className=\"font-medium\">\r\n                                      Discipline Score: {discData.score} · {discData.label}\r\n                                    </span>\r\n                                    <span className=\"text-[#8B92A8]\">\r\n                                      Grades: {discData.components?.grades_score ?? '—'} ({discData.weights?.grade_weight ?? 70}%) · Routine: {discData.components?.routine_score != null ? (discData.components.routine_score > 0 ? '✓' : '✗') : '—'} ({discData.weights?.routine_weight ?? 30}%)\r\n                                    </span>\r\n                                  </>\r\n                                ) : (\r\n                                  <span className=\"text-[#8B92A8]\">No discipline data</span>\r\n                                )}\r\n                              </div>\r\n                            )}\r\n                          </TooltipContent>\r\n                        </Tooltip>\r\n                      )\r\n                    })}\r\n                  </div>\r\n                )\r\n              })}\r\n            </div>\r\n          </div>\r\n        </TooltipProvider>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n\r\n// ─── d. R-Multiple Histogram ─────────────────────────────────────────────────\r\n\r\nconst R_BUCKETS = [\r\n  { label: '< -3R', min: -Infinity, max: -3 },\r\n  { label: '-3 to -2R', min: -3, max: -2 },\r\n  { label: '-2 to -1R', min: -2, max: -1 },\r\n  { label: '-1 to 0R', min: -1, max: 0 },\r\n  { label: '0 to 1R', min: 0, max: 1 },\r\n  { label: '1 to 2R', min: 1, max: 2 },\r\n  { label: '2 to 3R', min: 2, max: 3 },\r\n  { label: '> 3R', min: 3, max: Infinity },\r\n]\r\n\r\nexport function RMultipleHistogram({ rMultiples }: { rMultiples: number[] }) {\r\n  if (!rMultiples.length) {\r\n    return <ChartCard title=\"R-Multiple Distribution\"><EmptyState /></ChartCard>\r\n  }\r\n\r\n  const data = R_BUCKETS.map((bucket) => ({\r\n    label: bucket.label,\r\n    count: rMultiples.filter((r) => r >= bucket.min && r < bucket.max).length,\r\n    isPositive: bucket.min >= 0,\r\n  }))\r\n\r\n  return (\r\n    <ChartCard title=\"R-Multiple Distribution\">\r\n      <ResponsiveContainer width=\"100%\" height={200}>\r\n        <BarChart data={data} margin={{ top: 4, right: 8, bottom: 0, left: 0 }}>\r\n          <CartesianGrid strokeDasharray=\"3 3\" stroke=\"#2A2F3E\" vertical={false} />\r\n          <XAxis\r\n            dataKey=\"label\"\r\n            tick={{ fill: '#8B92A8', fontSize: 10 }}\r\n            axisLine={false}\r\n            tickLine={false}\r\n          />\r\n          <YAxis\r\n            tick={{ fill: '#8B92A8', fontSize: 11 }}\r\n            axisLine={false}\r\n            tickLine={false}\r\n            allowDecimals={false}\r\n            width={30}\r\n          />\r\n          <RechartsTooltip\r\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n            formatter={(value: any) => [value ?? 0, 'Trades']}\r\n            content={<CustomAnalyticsTooltip />}\r\n            cursor={{ fill: 'rgba(255,255,255,0.05)' }}\r\n          />\r\n          <Bar dataKey=\"count\" radius={[2, 2, 0, 0]}>\r\n            {data.map((entry, index) => (\r\n              <Cell\r\n                key={`cell-${index}`}\r\n                fill={entry.isPositive ? '#22C55E' : '#EF4444'}\r\n                fillOpacity={0.8}\r\n              />\r\n            ))}\r\n          </Bar>\r\n        </BarChart>\r\n      </ResponsiveContainer>\r\n    </ChartCard>\r\n  )\r\n}\r\n\r\n// ─── e/f/g. Breakdown Bar Chart (horizontal) ─────────────────────────────────\r\n\r\nexport function BreakdownBarChart({\r\n  data,\r\n  title,\r\n}: {\r\n  data: BreakdownEntry[]\r\n  title: string\r\n}) {\r\n  if (!data.length) {\r\n    return <ChartCard title={title}><EmptyState /></ChartCard>\r\n  }\r\n\r\n  const chartHeight = Math.max(180, data.length * 44)\r\n\r\n  return (\r\n    <ChartCard title={title}>\r\n      <ResponsiveContainer width=\"100%\" height={chartHeight}>\r\n        <BarChart\r\n          layout=\"vertical\"\r\n          data={data}\r\n          margin={{ top: 0, right: 16, bottom: 0, left: 0 }}\r\n        >\r\n          <CartesianGrid strokeDasharray=\"3 3\" stroke=\"#2A2F3E\" horizontal={false} />\r\n          <XAxis\r\n            type=\"number\"\r\n            tickFormatter={fmtDollar}\r\n            tick={{ fill: '#8B92A8', fontSize: 11 }}\r\n            axisLine={false}\r\n            tickLine={false}\r\n          />\r\n          <YAxis\r\n            type=\"category\"\r\n            dataKey=\"label\"\r\n            tick={{ fill: '#E8EAF0', fontSize: 11 }}\r\n            axisLine={false}\r\n            tickLine={false}\r\n            width={80}\r\n          />\r\n          <RechartsTooltip\r\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n            formatter={(value: any, _name: any, props: any) => {\r\n              const entry = props?.payload as BreakdownEntry | undefined\r\n              const wr = entry?.winRate != null ? ` (${entry.winRate.toFixed(0)}% WR)` : ''\r\n              return [`${fmtDollar(value ?? 0)}${wr}`, 'Net P&L']\r\n            }}\r\n            content={<CustomAnalyticsTooltip />}\r\n            cursor={{ fill: 'rgba(255,255,255,0.05)' }}\r\n          />\r\n          <Bar dataKey=\"netPnl\" radius={[0, 2, 2, 0]}>\r\n            {data.map((entry, index) => (\r\n              <Cell\r\n                key={`cell-${index}`}\r\n                fill={entry.netPnl >= 0 ? '#22C55E' : '#EF4444'}\r\n                fillOpacity={0.8}\r\n              />\r\n            ))}\r\n          </Bar>\r\n        </BarChart>\r\n      </ResponsiveContainer>\r\n    </ChartCard>\r\n  )\r\n}\r\n\r\n// ─── h. Duration Histogram ────────────────────────────────────────────────────\r\n\r\nconst DURATION_BUCKETS = [\r\n  { label: '0-1m', minSec: 0, maxSec: 60 },\r\n  { label: '1-2m', minSec: 60, maxSec: 120 },\r\n  { label: '2-5m', minSec: 120, maxSec: 300 },\r\n  { label: '5-10m', minSec: 300, maxSec: 600 },\r\n  { label: '10-30m', minSec: 600, maxSec: 1800 },\r\n  { label: '30-60m', minSec: 1800, maxSec: 3600 },\r\n  { label: '60m+', minSec: 3600, maxSec: Infinity },\r\n]\r\n\r\nexport function DurationHistogram({ durations }: { durations: number[] }) {\r\n  if (!durations.length) {\r\n    return <ChartCard title=\"Trade Duration Distribution\"><EmptyState /></ChartCard>\r\n  }\r\n\r\n  const data = DURATION_BUCKETS.map((b) => ({\r\n    label: b.label,\r\n    count: durations.filter((d) => d >= b.minSec && d < b.maxSec).length,\r\n  }))\r\n\r\n  return (\r\n    <ChartCard title=\"Trade Duration Distribution\">\r\n      <ResponsiveContainer width=\"100%\" height={200}>\r\n        <BarChart data={data} margin={{ top: 4, right: 8, bottom: 0, left: 0 }}>\r\n          <CartesianGrid strokeDasharray=\"3 3\" stroke=\"#2A2F3E\" vertical={false} />\r\n          <XAxis\r\n            dataKey=\"label\"\r\n            tick={{ fill: '#8B92A8', fontSize: 11 }}\r\n            axisLine={false}\r\n            tickLine={false}\r\n          />\r\n          <YAxis\r\n            tick={{ fill: '#8B92A8', fontSize: 11 }}\r\n            axisLine={false}\r\n            tickLine={false}\r\n            allowDecimals={false}\r\n            width={30}\r\n          />\r\n          <RechartsTooltip\r\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n            formatter={(value: any) => [value ?? 0, 'Trades']}\r\n            content={<CustomAnalyticsTooltip />}\r\n            cursor={{ fill: 'rgba(255,255,255,0.05)' }}\r\n          />\r\n          <Bar dataKey=\"count\" fill=\"#3B82F6\" fillOpacity={0.75} radius={[2, 2, 0, 0]} />\r\n        </BarChart>\r\n      </ResponsiveContainer>\r\n    </ChartCard>\r\n  )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\components\\analytics\\kpi-cards.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\components\\dashboard\\balance-drawdown-widget.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\components\\dashboard\\combined-equity-balance-widget.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'drawdownPct' is assigned a value but never used.","line":46,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":46,"endColumn":22}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\r\n\r\nimport { cn } from '@/lib/utils'\r\nimport { LineChart, Line, ResponsiveContainer, Tooltip } from 'recharts'\r\nimport type { BalanceData, EquityPoint } from '@/types/dashboard'\r\n\r\ninterface CombinedEquityBalanceWidgetProps {\r\n    balanceData: BalanceData | null\r\n    equityData: EquityPoint[]\r\n    isLoading?: boolean\r\n}\r\n\r\nfunction fmt$(n: number): string {\r\n    const abs = Math.abs(n)\r\n    const sign = n < 0 ? '-' : n > 0 ? '+' : ''\r\n    return `${sign}$${abs.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`\r\n}\r\n\r\nexport function CombinedEquityBalanceWidget({ balanceData, equityData, isLoading }: CombinedEquityBalanceWidgetProps) {\r\n    if (isLoading) {\r\n        return (\r\n            <div className=\"h-full flex flex-col gap-4 p-1\">\r\n                {/* Top skeleton */}\r\n                <div className=\"flex flex-col gap-2\">\r\n                    <div className=\"flex justify-between\">\r\n                        <div className=\"h-4 w-24 rounded bg-[var(--secondary)] animate-pulse\" />\r\n                        <div className=\"h-4 w-20 rounded bg-[var(--secondary)] animate-pulse\" />\r\n                    </div>\r\n                    <div className=\"h-8 w-36 rounded bg-[var(--secondary)] animate-pulse\" />\r\n                    <div className=\"h-3 w-48 rounded bg-[var(--secondary)] animate-pulse mt-1\" />\r\n                </div>\r\n                {/* Bottom skeleton */}\r\n                <div className=\"flex-1 rounded bg-[var(--secondary)] animate-pulse min-h-[120px]\" />\r\n            </div>\r\n        )\r\n    }\r\n\r\n    if (!balanceData) {\r\n        return (\r\n            <div className=\"h-full flex items-center justify-center\">\r\n                <p className=\"text-sm text-[var(--muted-foreground)]\">Select an account</p>\r\n            </div>\r\n        )\r\n    }\r\n\r\n    const drawdownPct =\r\n        balanceData.maxDailyLossThreshold !== null && balanceData.maxDailyLossThreshold !== 0\r\n            ? Math.min(\r\n                100,\r\n                Math.round((Math.abs(balanceData.maxDailyLoss) / Math.abs(balanceData.maxDailyLossThreshold)) * 100)\r\n            )\r\n            : 0\r\n\r\n    const hasEquityData = equityData.length > 0\r\n    const finalEquityValue = hasEquityData ? equityData[equityData.length - 1].value : 0\r\n    const isEquityPositive = finalEquityValue >= 0\r\n    const strokeColor = isEquityPositive ? '#3B82F6' : '#EF4444'\r\n\r\n    return (\r\n        <div className=\"h-full flex flex-col gap-4 p-1\">\r\n            {/* ── Top Section: Account Balance & Stats ── */}\r\n            <div className=\"flex flex-col\">\r\n                <div className=\"flex items-baseline justify-between mb-1\">\r\n                    <span className=\"text-[11px] font-semibold uppercase tracking-wider text-[var(--muted-foreground)]\">\r\n                        Account Balance\r\n                    </span>\r\n                    <span\r\n                        className={cn(\r\n                            'text-[12px] font-mono',\r\n                            balanceData.netPnl >= 0 ? 'text-[var(--color-green)]' : 'text-[var(--color-red)]'\r\n                        )}\r\n                    >\r\n                        {fmt$(balanceData.netPnl)}\r\n                    </span>\r\n                </div>\r\n\r\n                {/* Current balance */}\r\n                <span className=\"text-3xl font-mono font-bold tracking-tight text-[var(--foreground)]\">\r\n                    ${balanceData.currentBalance.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}\r\n                </span>\r\n\r\n                {/* Start Balance & Drawdown text */}\r\n                <div className=\"flex items-center justify-between mt-2\">\r\n                    <div className=\"text-xs text-[var(--muted-foreground)]\">\r\n                        Started at ${balanceData.startingBalance.toLocaleString('en-US', { minimumFractionDigits: 0, maximumFractionDigits: 0 })}\r\n                    </div>\r\n                    {balanceData.maxDailyLossThreshold !== null && (\r\n                        <div className=\"text-xs text-[var(--muted-foreground)]\">\r\n                            Daily PnL: <span className={balanceData.maxDailyLoss >= 0 ? \"text-[var(--color-green)]\" : \"text-[var(--color-red)]\"}>{fmt$(balanceData.maxDailyLoss)}</span>\r\n                            {' '}<span className=\"opacity-50\">/ {fmt$(balanceData.maxDailyLossThreshold)}</span>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            </div>\r\n\r\n            {/* ── Bottom Section: Equity Curve Chart ── */}\r\n            <div className=\"flex flex-col flex-1 min-h-[140px] border-t border-[var(--border)] pt-4 mt-2\">\r\n                <div className=\"flex items-baseline justify-between mb-2\">\r\n                    <span className=\"text-[11px] font-semibold uppercase tracking-wider text-[var(--muted-foreground)]\">\r\n                        Equity Curve (30d)\r\n                    </span>\r\n                    <span\r\n                        className=\"text-xs font-mono font-medium\"\r\n                        style={{ color: strokeColor }}\r\n                    >\r\n                        {finalEquityValue >= 0 ? '+' : ''}$\r\n                        {Math.abs(finalEquityValue).toLocaleString('en-US', {\r\n                            minimumFractionDigits: 2,\r\n                            maximumFractionDigits: 2,\r\n                        })}\r\n                    </span>\r\n                </div>\r\n\r\n                <div className=\"flex-1 min-h-0 relative\">\r\n                    {!hasEquityData ? (\r\n                        <div className=\"absolute inset-0 flex items-center justify-center\">\r\n                            <p className=\"text-xs text-[var(--muted-foreground)]\">No data yet</p>\r\n                        </div>\r\n                    ) : (\r\n                        <ResponsiveContainer width=\"100%\" height=\"100%\">\r\n                            <LineChart data={equityData} margin={{ top: 8, right: 4, left: 4, bottom: 4 }}>\r\n                                <Tooltip\r\n                                    contentStyle={{\r\n                                        backgroundColor: 'var(--card)',\r\n                                        border: '1px solid var(--border)',\r\n                                        borderRadius: '6px',\r\n                                        fontSize: '11px',\r\n                                        color: 'var(--foreground)',\r\n                                        boxShadow: '0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1)'\r\n                                    }}\r\n                                    formatter={(value: number | undefined) => [\r\n                                        value != null ? `$${value.toLocaleString('en-US', { minimumFractionDigits: 2 })}` : '$0.00',\r\n                                        'Equity',\r\n                                    ]}\r\n                                    labelStyle={{ color: 'var(--muted-foreground)', marginBottom: '4px' }}\r\n                                    labelFormatter={(label) => label}\r\n                                />\r\n                                <Line\r\n                                    type=\"monotone\"\r\n                                    dataKey=\"value\"\r\n                                    stroke={strokeColor}\r\n                                    strokeWidth={2}\r\n                                    dot={false}\r\n                                    activeDot={{ r: 4, fill: strokeColor, stroke: 'var(--card)', strokeWidth: 2 }}\r\n                                />\r\n                            </LineChart>\r\n                        </ResponsiveContainer>\r\n                    )}\r\n                </div>\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\components\\dashboard\\command-center-client.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'WIDGET_IDS' is assigned a value but only used as a type.","line":17,"column":7,"nodeType":"Identifier","messageId":"usedOnlyAsType","endLine":17,"endColumn":17}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\r\n\r\nimport { useQuery } from '@tanstack/react-query'\r\nimport { useFiltersStore } from '@/stores/filters'\r\nimport { CombinedEquityBalanceWidget } from '@/components/dashboard/combined-equity-balance-widget'\r\nimport { DailyDisciplineWidget } from '@/components/dashboard/daily-discipline-widget'\r\nimport { DisciplineHistoryWidget } from '@/components/dashboard/discipline-history-widget'\r\nimport { DailyPnlWidget } from '@/components/dashboard/daily-pnl-widget'\r\nimport { WinRateWidget } from '@/components/dashboard/win-rate-widget'\r\nimport { PropRulesWidget } from '@/components/dashboard/prop-rules-widget'\r\nimport { RecentTradesWidget } from '@/components/dashboard/recent-trades-widget'\r\nimport { GoalsWidget } from '@/components/dashboard/goals-widget'\r\nimport type { WidgetData } from '@/types/dashboard'\r\nimport type { DatePreset } from '@/stores/filters'\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select'\r\n\r\nconst WIDGET_IDS = ['combined', 'discipline', 'history', 'daily', 'winrate', 'prop', 'trades', 'goals'] as const\r\ntype WidgetId = typeof WIDGET_IDS[number]\r\n\r\n// ─── Date range helper ─────────────────────────────────────────────────────────\r\n\r\nfunction getDateRange(\r\n  preset: DatePreset,\r\n  dateFrom: string | null,\r\n  dateTo: string | null\r\n): { from: string; to: string } {\r\n  const today = new Date()\r\n  const pad = (n: number) => n.toString().padStart(2, '0')\r\n  const fmt = (d: Date, endOfDay = false) => {\r\n    const dateStr = `${d.getFullYear()}-${pad(d.getMonth() + 1)}-${pad(d.getDate())}`\r\n    return endOfDay ? `${dateStr}T23:59:59` : `${dateStr}T00:00:00`\r\n  }\r\n\r\n  if (preset === 'today') return { from: fmt(today), to: fmt(today, true) }\r\n  if (preset === 'this_week') {\r\n    const mon = new Date(today)\r\n    const dow = today.getDay()\r\n    mon.setDate(today.getDate() - (dow === 0 ? 6 : dow - 1))\r\n    return { from: fmt(mon), to: fmt(today, true) }\r\n  }\r\n  if (preset === 'this_month') {\r\n    const first = new Date(today.getFullYear(), today.getMonth(), 1)\r\n    return { from: fmt(first), to: fmt(today, true) }\r\n  }\r\n  if (preset === 'last_30d') {\r\n    const d = new Date(today)\r\n    d.setDate(today.getDate() - 29)\r\n    return { from: fmt(d), to: fmt(today, true) }\r\n  }\r\n  return {\r\n    from: dateFrom ? `${dateFrom}T00:00:00` : fmt(today),\r\n    to: dateTo ? `${dateTo}T23:59:59` : fmt(today, true)\r\n  }\r\n}\r\n\r\n// ─── Widget Card Wrapper ───────────────────────────────────────────────────────\r\n\r\nfunction WidgetCard({\r\n  id,\r\n  widgets,\r\n  isLoading,\r\n}: {\r\n  id: WidgetId\r\n  widgets: WidgetData | undefined\r\n  isLoading: boolean\r\n}) {\r\n  return (\r\n    <div className=\"h-full w-full rounded-lg border border-[var(--border)] bg-[var(--card)] p-4 overflow-hidden relative\">\r\n      {id === 'combined' && (\r\n        <CombinedEquityBalanceWidget balanceData={widgets?.balance ?? null} equityData={widgets?.equityCurve ?? []} isLoading={isLoading} />\r\n      )}\r\n      {id === 'discipline' && (\r\n        <DailyDisciplineWidget />\r\n      )}\r\n      {id === 'history' && (\r\n        <DisciplineHistoryWidget />\r\n      )}\r\n      {id === 'daily' && (\r\n        <DailyPnlWidget data={widgets?.dailyPnl ?? null} isLoading={isLoading} />\r\n      )}\r\n      {id === 'winrate' && (\r\n        <WinRateWidget data={widgets?.winRate ?? null} isLoading={isLoading} />\r\n      )}\r\n      {id === 'prop' && (\r\n        <PropRulesWidget data={widgets?.propRules ?? null} isLoading={isLoading} />\r\n      )}\r\n      {id === 'trades' && (\r\n        <RecentTradesWidget data={widgets?.recentTrades ?? []} isLoading={isLoading} />\r\n      )}\r\n      {id === 'goals' && (\r\n        <GoalsWidget data={widgets?.goals ?? []} isLoading={isLoading} />\r\n      )}\r\n    </div>\r\n  )\r\n}\r\n\r\n// ─── Main ─────────────────────────────────────────────────────────────────────\r\n\r\nexport function CommandCenterClient() {\r\n  const { accountIds, datePreset, dateFrom, dateTo, setDatePreset } = useFiltersStore()\r\n  const accountId = accountIds[0] ?? ''\r\n  const { from, to } = getDateRange(datePreset, dateFrom, dateTo)\r\n\r\n  // ─── Fetch widget data ──────────────────────────────────────────────────────\r\n\r\n  const widgetsQuery = useQuery<{ widgets: WidgetData }>({\r\n    queryKey: ['dashboard-widgets', accountId, from, to],\r\n    queryFn: () =>\r\n      fetch(`/api/dashboard/widgets?accountId=${accountId}&from=${from}&to=${to}`).then((r) => {\r\n        if (!r.ok) throw new Error('Failed to fetch widgets')\r\n        return r.json()\r\n      }),\r\n    enabled: !!accountId,\r\n    staleTime: 60_000,\r\n  })\r\n\r\n  const widgets = widgetsQuery.data?.widgets\r\n  const isLoading = widgetsQuery.isLoading\r\n\r\n  // ─── Empty state ────────────────────────────────────────────────────────────\r\n\r\n  if (!accountId) {\r\n    return (\r\n      <div className=\"px-6 py-8\">\r\n        <div className=\"mb-6\">\r\n          <h1 className=\"text-xl font-semibold text-[var(--foreground)]\">Command Center</h1>\r\n          <p className=\"text-sm text-[var(--muted-foreground)] mt-1\">\r\n            Your daily trading cockpit.\r\n          </p>\r\n        </div>\r\n        <div className=\"flex items-center justify-center h-64 rounded-lg border border-dashed border-[var(--border)] bg-[var(--card)]\">\r\n          <p className=\"text-sm text-[var(--muted-foreground)]\">\r\n            Select an account in the toolbar to load your dashboard.\r\n          </p>\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n\r\n  // ─── Render ─────────────────────────────────────────────────────────────────\r\n\r\n  return (\r\n    <div className=\"px-6 py-6\">\r\n      {/* Page header */}\r\n      <div className=\"flex items-center justify-between mb-6\">\r\n        <div>\r\n          <h1 className=\"text-xl font-semibold text-[var(--foreground)]\">Command Center</h1>\r\n          <div className=\"flex items-center gap-3 mt-1.5\">\r\n            <Select\r\n              value={datePreset}\r\n              onValueChange={(val) => setDatePreset(val as DatePreset)}\r\n            >\r\n              <SelectTrigger className=\"w-[140px] h-8 text-xs bg-[#14171E] border border-[#2A2F3E] text-[#E8EAF0] focus:ring-0\">\r\n                <SelectValue placeholder=\"Date Range\" />\r\n              </SelectTrigger>\r\n              <SelectContent className=\"bg-[#14171E] border-[#2A2F3E] text-[#E8EAF0]\">\r\n                <SelectItem value=\"today\">Today</SelectItem>\r\n                <SelectItem value=\"this_week\">This Week</SelectItem>\r\n                <SelectItem value=\"this_month\">This Month</SelectItem>\r\n                <SelectItem value=\"last_30d\">Last 30 Days</SelectItem>\r\n              </SelectContent>\r\n            </Select>\r\n            <span className=\"text-xs text-[var(--muted-foreground)]\">\r\n              {from === to ? from : `${from} → ${to}`}\r\n            </span>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* ── Overview Mode (fixed grid) ────────────────────────────────────────── */}\r\n      <div className=\"flex flex-col gap-4\">\r\n        {/* ROW 1: Combined + Win Rate + Today's PnL */}\r\n        <div className=\"grid grid-cols-12 gap-4\">\r\n          <div className=\"col-span-12 lg:col-span-5\" style={{ minHeight: '340px' }}>\r\n            <WidgetCard id=\"combined\" widgets={widgets} isLoading={isLoading} />\r\n          </div>\r\n          <div className=\"col-span-12 lg:col-span-3\" style={{ minHeight: '340px' }}>\r\n            <WidgetCard id=\"winrate\" widgets={widgets} isLoading={isLoading} />\r\n          </div>\r\n          <div className=\"col-span-12 lg:col-span-4\" style={{ minHeight: '340px' }}>\r\n            <WidgetCard id=\"daily\" widgets={widgets} isLoading={isLoading} />\r\n          </div>\r\n        </div>\r\n\r\n        {/* ROW 2: Discipline History + Daily Discipline + Recent Trades */}\r\n        <div className=\"grid grid-cols-12 gap-4\">\r\n          <div className=\"col-span-12 lg:col-span-4\" style={{ minHeight: '240px' }}>\r\n            <WidgetCard id=\"history\" widgets={widgets} isLoading={isLoading} />\r\n          </div>\r\n          <div className=\"col-span-12 lg:col-span-3\" style={{ minHeight: '240px' }}>\r\n            <WidgetCard id=\"discipline\" widgets={widgets} isLoading={isLoading} />\r\n          </div>\r\n          <div className=\"col-span-12 lg:col-span-5\" style={{ minHeight: '240px' }}>\r\n            <WidgetCard id=\"trades\" widgets={widgets} isLoading={isLoading} />\r\n          </div>\r\n        </div>\r\n\r\n        {/* ROW 3: Prop Rules + Goals */}\r\n        <div className=\"grid grid-cols-12 gap-4\">\r\n          <div className=\"col-span-12 lg:col-span-5\" style={{ minHeight: '240px' }}>\r\n            <WidgetCard id=\"prop\" widgets={widgets} isLoading={isLoading} />\r\n          </div>\r\n          <div className=\"col-span-12 lg:col-span-7\" style={{ minHeight: '240px' }}>\r\n            <WidgetCard id=\"goals\" widgets={widgets} isLoading={isLoading} />\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\components\\dashboard\\daily-discipline-widget.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Card' is defined but never used.","line":4,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":4,"endColumn":14,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Card"},"fix":{"range":[59,64],"text":""},"desc":"Remove unused variable \"Card\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CardContent' is defined but never used.","line":4,"column":16,"nodeType":"Identifier","messageId":"unusedVar","endLine":4,"endColumn":27,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"CardContent"},"fix":{"range":[63,76],"text":""},"desc":"Remove unused variable \"CardContent\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CardHeader' is defined but never used.","line":4,"column":29,"nodeType":"Identifier","messageId":"unusedVar","endLine":4,"endColumn":39,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"CardHeader"},"fix":{"range":[76,88],"text":""},"desc":"Remove unused variable \"CardHeader\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CardTitle' is defined but never used.","line":4,"column":41,"nodeType":"Identifier","messageId":"unusedVar","endLine":4,"endColumn":50,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"CardTitle"},"fix":{"range":[88,99],"text":""},"desc":"Remove unused variable \"CardTitle\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CardDescription' is defined but never used.","line":4,"column":52,"nodeType":"Identifier","messageId":"unusedVar","endLine":4,"endColumn":67,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"CardDescription"},"fix":{"range":[50,148],"text":""},"desc":"Remove unused import declaration."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\r\n\r\nimport { useState } from 'react'\r\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card'\r\nimport { RadialBarChart, RadialBar, ResponsiveContainer, PolarAngleAxis } from 'recharts'\r\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query'\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription, DialogTrigger } from '@/components/ui/dialog'\r\nimport { Settings, Save } from 'lucide-react'\r\nimport { cn } from '@/lib/utils'\r\nimport { Input } from '@/components/ui/input'\r\nimport { Label } from '@/components/ui/label'\r\n\r\nfunction getScoreColor(score: number | null | undefined): string {\r\n    if (score === null || score === undefined) return '#2A2F3E'\r\n    if (score >= 90) return '#22C55E' // green\r\n    if (score >= 75) return '#3B82F6' // blue\r\n    if (score >= 60) return '#F59E0B' // amber\r\n    if (score >= 40) return '#F97316' // orange\r\n    return '#EF4444' // red\r\n}\r\n\r\nfunction WeightsDialog() {\r\n    const queryClient = useQueryClient()\r\n    const [isOpen, setIsOpen] = useState(false)\r\n    const [gradeWeight, setGradeWeight] = useState<number>(70)\r\n    const [routineWeight, setRoutineWeight] = useState<number>(30)\r\n\r\n    // Fetch initial\r\n    const { data: settingsData, isLoading } = useQuery({\r\n        queryKey: ['discipline-settings'],\r\n        queryFn: async () => {\r\n            const res = await fetch('/api/discipline/settings')\r\n            if (!res.ok) throw new Error('Failed to fetch settings')\r\n            return res.json()\r\n        },\r\n        enabled: isOpen\r\n    })\r\n\r\n    // set initial values when data loads\r\n    useState(() => {\r\n        if (settingsData?.data) {\r\n            setGradeWeight(settingsData.data.grade_weight)\r\n            setRoutineWeight(settingsData.data.routine_weight)\r\n        }\r\n    })\r\n\r\n    const mutation = useMutation({\r\n        mutationFn: async () => {\r\n            const res = await fetch('/api/discipline/settings', {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({\r\n                    grade_weight: gradeWeight,\r\n                    routine_weight: routineWeight\r\n                })\r\n            })\r\n            if (!res.ok) throw new Error('Failed to save settings')\r\n            return res.json()\r\n        },\r\n        onSuccess: () => {\r\n            queryClient.invalidateQueries({ queryKey: ['discipline-score'] })\r\n            queryClient.invalidateQueries({ queryKey: ['discipline-settings'] })\r\n            setIsOpen(false)\r\n        }\r\n    })\r\n\r\n    const total = gradeWeight + routineWeight\r\n    const isValid = total === 100\r\n\r\n    return (\r\n        <Dialog open={isOpen} onOpenChange={setIsOpen}>\r\n            <DialogTrigger asChild>\r\n                <button className=\"text-xs text-[var(--muted-foreground)] hover:text-[var(--foreground)] flex items-center gap-1.5 transition-colors mt-4\">\r\n                    Configure weights <Settings size={12} />\r\n                </button>\r\n            </DialogTrigger>\r\n            <DialogContent className=\"sm:max-w-[360px] bg-[var(--card)] border-[var(--border)]\">\r\n                <DialogHeader>\r\n                    <DialogTitle className=\"text-[var(--foreground)]\">Discipline Score Weights</DialogTitle>\r\n                    <DialogDescription className=\"text-[var(--muted-foreground)]\">\r\n                        Must add up to 100%. Adjust how much trades vs. routine affect your final score.\r\n                    </DialogDescription>\r\n                </DialogHeader>\r\n\r\n                {isLoading ? (\r\n                    <div className=\"py-6 flex justify-center text-sm text-[var(--muted-foreground)]\">Loading...</div>\r\n                ) : (\r\n                    <div className=\"space-y-4 py-4\">\r\n                        <div className=\"space-y-2\">\r\n                            <Label className=\"text-xs text-[var(--muted-foreground)]\">Trade Grades Weight (%)</Label>\r\n                            <Input\r\n                                type=\"number\"\r\n                                min=\"0\"\r\n                                max=\"100\"\r\n                                value={gradeWeight}\r\n                                onChange={(e) => setGradeWeight(parseInt(e.target.value) || 0)}\r\n                                className=\"bg-[var(--background)] border-[var(--border)] text-[var(--foreground)]\"\r\n                            />\r\n                        </div>\r\n\r\n                        <div className=\"space-y-2\">\r\n                            <Label className=\"text-xs text-[var(--muted-foreground)]\">Routine Weight (%)</Label>\r\n                            <Input\r\n                                type=\"number\"\r\n                                min=\"0\"\r\n                                max=\"100\"\r\n                                value={routineWeight}\r\n                                onChange={(e) => setRoutineWeight(parseInt(e.target.value) || 0)}\r\n                                className=\"bg-[var(--background)] border-[var(--border)] text-[var(--foreground)]\"\r\n                            />\r\n                        </div>\r\n\r\n                        <div className={cn(\r\n                            \"text-sm font-medium pt-2 text-right\",\r\n                            isValid ? \"text-[var(--color-green)]\" : \"text-[var(--color-red)]\"\r\n                        )}>\r\n                            Total: {total}%\r\n                        </div>\r\n\r\n                        <button\r\n                            onClick={() => mutation.mutate()}\r\n                            disabled={!isValid || mutation.isPending}\r\n                            className=\"w-full flex items-center justify-center gap-2 rounded-md bg-[var(--color-blue)] px-4 py-2 text-sm font-medium shadow-sm transition-colors hover:bg-[var(--color-blue)]/90 disabled:opacity-50 disabled:cursor-not-allowed text-white\"\r\n                        >\r\n                            {mutation.isPending ? 'Saving...' : <><Save size={16} /> Save Weights</>}\r\n                        </button>\r\n                    </div>\r\n                )}\r\n            </DialogContent>\r\n        </Dialog>\r\n    )\r\n}\r\n\r\nfunction ComponentRow({ label, score, weight }: { label: string, score: number | null, weight: number }) {\r\n    const color = getScoreColor(score)\r\n    const isNull = score === null || score === undefined\r\n\r\n    return (\r\n        <div className=\"flex items-center justify-between text-sm py-1.5\">\r\n            <span className=\"text-[var(--muted-foreground)] w-20\">{label}</span>\r\n            <div className=\"flex-1 px-4\">\r\n                <div className=\"h-1.5 w-full rounded-full bg-[var(--border)] overflow-hidden\">\r\n                    <div\r\n                        className=\"h-full transition-all duration-500 rounded-full\"\r\n                        style={{\r\n                            width: `${isNull ? 0 : score}%`,\r\n                            backgroundColor: color\r\n                        }}\r\n                    />\r\n                </div>\r\n            </div>\r\n            <div className=\"flex items-center gap-3 w-16 justify-end\">\r\n                <span className=\"font-mono font-medium text-[var(--foreground)]\">\r\n                    {isNull ? '—' : score}\r\n                </span>\r\n                <span className=\"text-xs text-[var(--muted-foreground)]\">{weight}%</span>\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n\r\nexport function DailyDisciplineWidget() {\r\n    const today = new Date().toISOString().split('T')[0]\r\n\r\n    const { data, isLoading } = useQuery({\r\n        queryKey: ['discipline-score', today],\r\n        queryFn: async () => {\r\n            const res = await fetch(`/api/discipline/score?date=${today}`)\r\n            if (!res.ok) throw new Error('Failed to fetch discipline score')\r\n            return res.json()\r\n        },\r\n        refetchInterval: 60 * 1000 // 60s\r\n    })\r\n\r\n    const scoreData = data?.data\r\n    const score = scoreData?.score\r\n    const label = scoreData?.label\r\n    const components = scoreData?.components || {}\r\n    const weights = scoreData?.weights || { grade_weight: 70, routine_weight: 30 }\r\n\r\n    const color = getScoreColor(score)\r\n\r\n    // Recharts needs an array of data\r\n    const chartData = [{ name: 'score', value: score ?? 0 }]\r\n\r\n    return (\r\n        <div className=\"flex flex-col h-full w-full\">\r\n            <div className=\"mb-4\">\r\n                <h3 className=\"text-sm font-medium text-[var(--foreground)]\">Daily Discipline</h3>\r\n                <p className=\"text-xs text-[var(--muted-foreground)] mt-0.5\">\r\n                    {new Date().toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })}\r\n                </p>\r\n            </div>\r\n\r\n            <div className=\"flex-1 flex flex-col justify-center\">\r\n                {isLoading ? (\r\n                    <div className=\"flex-1 flex items-center justify-center\">\r\n                        <div className=\"h-4 w-4 rounded-full border-2 border-[var(--border)] border-t-[var(--muted-foreground)] animate-spin\" />\r\n                    </div>\r\n                ) : score === null || score === undefined ? (\r\n                    <div className=\"flex-1 flex flex-col items-center justify-center pb-4\">\r\n                        <div className=\"h-[120px] w-[120px] relative\">\r\n                            <ResponsiveContainer width=\"100%\" height=\"100%\">\r\n                                <RadialBarChart\r\n                                    cx=\"50%\" cy=\"50%\" innerRadius=\"70%\" outerRadius=\"100%\"\r\n                                    barSize={10} data={[{ name: 'score', value: 0 }]} startAngle={90} endAngle={-270}\r\n                                >\r\n                                    <PolarAngleAxis type=\"number\" domain={[0, 100]} angleAxisId={0} tick={false} />\r\n                                    <RadialBar background={{ fill: '#2A2F3E' }} dataKey=\"value\" cornerRadius={10} fill=\"#2A2F3E\" />\r\n                                </RadialBarChart>\r\n                            </ResponsiveContainer>\r\n                            <div className=\"absolute inset-0 flex flex-col items-center justify-center\">\r\n                                <span className=\"text-2xl font-bold font-mono text-[var(--muted-foreground)]\">0</span>\r\n                            </div>\r\n                        </div>\r\n                        <p className=\"text-sm text-[var(--muted-foreground)] font-medium mt-4\">No data yet</p>\r\n                        <p className=\"text-[10px] text-[var(--muted-foreground)]/70 text-center max-w-[150px] mt-1\">\r\n                            Grade your trades and check your routine\r\n                        </p>\r\n                    </div>\r\n                ) : (\r\n                    <div className=\"flex flex-col h-full\">\r\n                        {/* Gauge */}\r\n                        <div className=\"flex justify-center mb-6\">\r\n                            <div className=\"h-[140px] w-[140px] relative\">\r\n                                <ResponsiveContainer width=\"100%\" height=\"100%\">\r\n                                    <RadialBarChart\r\n                                        cx=\"50%\" cy=\"50%\" innerRadius=\"75%\" outerRadius=\"100%\"\r\n                                        barSize={12} data={chartData} startAngle={90} endAngle={-270}\r\n                                    >\r\n                                        <PolarAngleAxis type=\"number\" domain={[0, 100]} angleAxisId={0} tick={false} />\r\n                                        <RadialBar\r\n                                            background={{ fill: '#2A2F3E' }}\r\n                                            dataKey=\"value\"\r\n                                            cornerRadius={10}\r\n                                            fill={color}\r\n                                        />\r\n                                    </RadialBarChart>\r\n                                </ResponsiveContainer>\r\n                                <div className=\"absolute inset-0 flex flex-col items-center justify-center mt-1\">\r\n                                    <span className=\"text-3xl font-bold font-mono\" style={{ color }}>{score}</span>\r\n                                    <span className=\"text-xs font-medium uppercase tracking-wider mt-1\" style={{ color }}>{label}</span>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* Breakdown */}\r\n                        <div className=\"space-y-1 mt-auto\">\r\n                            <ComponentRow\r\n                                label=\"Grades\"\r\n                                score={components.grades_score}\r\n                                weight={weights.grade_weight}\r\n                            />\r\n                            <ComponentRow\r\n                                label=\"Routine\"\r\n                                score={components.routine_score}\r\n                                weight={weights.routine_weight}\r\n                            />\r\n                        </div>\r\n                    </div>\r\n                )}\r\n            </div>\r\n\r\n            <WeightsDialog />\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\components\\dashboard\\daily-pnl-widget.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\components\\dashboard\\discipline-history-widget.tsx","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":53,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":53,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2116,2119],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2116,2119],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\components\\dashboard\\equity-curve-widget.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\components\\dashboard\\goals-widget.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\components\\dashboard\\prop-rules-widget.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\components\\dashboard\\recent-trades-widget.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\components\\dashboard\\win-rate-widget.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\components\\finance\\cashflow-tab.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":43,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":43,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1732,1735],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1732,1735],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":53,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":53,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2136,2139],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2136,2139],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":62,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":62,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2476,2479],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2476,2479],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/static-components","severity":2,"message":"Error: Cannot create components during render\n\nComponents created during render will reset their state each time they are created. Declare components outside of render.\n\nC:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\components\\finance\\cashflow-tab.tsx:136:56\n  134 |                                     <XAxis dataKey=\"month\" stroke=\"#888888\" fontSize={12} tickLine={false} axisLine={false} />\n  135 |                                     <YAxis stroke=\"#888888\" fontSize={12} tickLine={false} axisLine={false} tickFormatter={(value) => `$${value}`} />\n> 136 |                                     <Tooltip content={<CustomTooltip />} wrapperStyle={{ outline: 'none' }} />\n      |                                                        ^^^^^^^^^^^^^ This component is created during render\n  137 |                                     <Bar dataKey=\"inflows\" name=\"Inflows\" fill=\"#22C55E\" radius={[4, 4, 0, 0]} />\n  138 |                                     <Bar dataKey=\"outflows\" name=\"Outflows\" fill=\"#EF4444\" radius={[4, 4, 0, 0]} />\n  139 |                                 </BarChart>\n\nC:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\components\\finance\\cashflow-tab.tsx:43:27\n  41 |     };\n  42 |\n> 43 |     const CustomTooltip = ({ active, payload, label }: any) => {\n     |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 44 |         if (!active || !payload?.length) return null;\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 45 |         return (\n     …\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 59 |         );\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 60 |     };\n     | ^^^^^^ The component is created during render here\n  61 |\n  62 |     const tableData = data.monthlyFlow.map((mf: any, i: number) => ({\n  63 |         ...mf,","line":136,"column":56,"nodeType":null,"endLine":136,"endColumn":69},{"ruleId":"react-hooks/static-components","severity":2,"message":"Error: Cannot create components during render\n\nComponents created during render will reset their state each time they are created. Declare components outside of render.\n\nC:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\components\\finance\\cashflow-tab.tsx:160:56\n  158 |                                     <XAxis dataKey=\"month\" stroke=\"#888888\" fontSize={12} tickLine={false} axisLine={false} />\n  159 |                                     <YAxis stroke=\"#888888\" fontSize={12} tickLine={false} axisLine={false} tickFormatter={(value) => `$${value}`} />\n> 160 |                                     <Tooltip content={<CustomTooltip />} wrapperStyle={{ outline: 'none' }} />\n      |                                                        ^^^^^^^^^^^^^ This component is created during render\n  161 |                                     <Area type=\"monotone\" dataKey=\"cumulative\" name=\"Cumulative\" stroke=\"#3B82F6\" fillOpacity={0.2} fill=\"#3B82F6\" />\n  162 |                                 </AreaChart>\n  163 |                             </ResponsiveContainer>\n\nC:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\components\\finance\\cashflow-tab.tsx:43:27\n  41 |     };\n  42 |\n> 43 |     const CustomTooltip = ({ active, payload, label }: any) => {\n     |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 44 |         if (!active || !payload?.length) return null;\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 45 |         return (\n     …\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 59 |         );\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 60 |     };\n     | ^^^^^^ The component is created during render here\n  61 |\n  62 |     const tableData = data.monthlyFlow.map((mf: any, i: number) => ({\n  63 |         ...mf,","line":160,"column":56,"nodeType":null,"endLine":160,"endColumn":69},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":192,"column":68,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":192,"endColumn":71,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9623,9626],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9623,9626],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useQuery } from \"@tanstack/react-query\";\r\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\r\nimport { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, AreaChart, Area } from \"recharts\";\r\nimport { Skeleton } from \"@/components/ui/skeleton\";\r\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\r\n\r\nexport function CashFlowTab() {\r\n    const { data: result, isLoading } = useQuery({\r\n        queryKey: [\"finance\", \"cashflow\"],\r\n        queryFn: async () => {\r\n            const res = await fetch(\"/api/finance/cashflow\");\r\n            if (!res.ok) throw new Error(\"Failed to fetch cashflow data\");\r\n            const json = await res.json();\r\n            return json.data;\r\n        }\r\n    });\r\n\r\n    if (isLoading) {\r\n        return (\r\n            <div className=\"space-y-4\">\r\n                <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-4\">\r\n                    {[...Array(4)].map((_, i) => <Skeleton key={i} className=\"h-32 w-full rounded-xl\" />)}\r\n                </div>\r\n                <div className=\"grid gap-4 md:grid-cols-2\">\r\n                    <Skeleton className=\"h-[400px] w-full rounded-xl\" />\r\n                    <Skeleton className=\"h-[400px] w-full rounded-xl\" />\r\n                </div>\r\n                <Skeleton className=\"h-[400px] w-full rounded-xl\" />\r\n            </div>\r\n        );\r\n    }\r\n\r\n    if (!result) return null;\r\n\r\n    const data = result;\r\n\r\n    const formatCurrency = (val: number) => {\r\n        return new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(val);\r\n    };\r\n\r\n    const CustomTooltip = ({ active, payload, label }: any) => {\r\n        if (!active || !payload?.length) return null;\r\n        return (\r\n            <div style={{\r\n                background: '#14171E',\r\n                border: '1px solid #2A2F3E',\r\n                borderRadius: '6px',\r\n                padding: '8px 12px'\r\n            }}>\r\n                <p style={{ color: '#E8EAF0', marginBottom: 4 }}>{label}</p>\r\n                {payload.map((entry: any, index: number) => (\r\n                    <p key={`item-${index}`} style={{ color: entry.color, fontFamily: 'JetBrains Mono' }}>\r\n                        {entry.name}: {formatCurrency(entry.value)}\r\n                    </p>\r\n                ))}\r\n            </div>\r\n        );\r\n    };\r\n\r\n    const tableData = data.monthlyFlow.map((mf: any, i: number) => ({\r\n        ...mf,\r\n        runningTotal: data.cumulativePosition[i]?.cumulative || 0\r\n    }));\r\n\r\n    // The requirements say 12 months for charts\r\n    // Inflows vs Outflows (grouped BarChart)\r\n    // Cumulative Cash Position (AreaChart)\r\n\r\n    const isDataEmpty = data.totalInflows12mo === 0 && data.totalOutflows12mo === 0;\r\n\r\n    return (\r\n        <div className=\"space-y-4\">\r\n            {/* KPI Row */}\r\n            <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-4\">\r\n                <Card>\r\n                    <CardHeader className=\"pb-2\">\r\n                        <CardTitle className=\"text-sm font-medium text-muted-foreground\">Total Inflows 12mo</CardTitle>\r\n                    </CardHeader>\r\n                    <CardContent>\r\n                        <div className=\"text-2xl font-bold font-mono\">\r\n                            {formatCurrency(data.totalInflows12mo)}\r\n                        </div>\r\n                    </CardContent>\r\n                </Card>\r\n                <Card>\r\n                    <CardHeader className=\"pb-2\">\r\n                        <CardTitle className=\"text-sm font-medium text-muted-foreground\">Total Outflows 12mo</CardTitle>\r\n                    </CardHeader>\r\n                    <CardContent>\r\n                        <div className=\"text-2xl font-bold font-mono\">\r\n                            {formatCurrency(data.totalOutflows12mo)}\r\n                        </div>\r\n                    </CardContent>\r\n                </Card>\r\n                <Card>\r\n                    <CardHeader className=\"pb-2\">\r\n                        <CardTitle className=\"text-sm font-medium text-muted-foreground\">Avg Monthly Burn</CardTitle>\r\n                    </CardHeader>\r\n                    <CardContent>\r\n                        <div className=\"text-2xl font-bold font-mono\">\r\n                            {formatCurrency(data.avgMonthlyBurn)}\r\n                        </div>\r\n                    </CardContent>\r\n                </Card>\r\n                <Card>\r\n                    <CardHeader className=\"pb-2\">\r\n                        <CardTitle className=\"text-sm font-medium text-muted-foreground\">Net Cash Position</CardTitle>\r\n                    </CardHeader>\r\n                    <CardContent>\r\n                        <div className={`text-2xl font-bold font-mono ${data.netCashPosition >= 0 ? 'text-[#22C55E]' : 'text-[#EF4444]'}`}>\r\n                            {formatCurrency(data.netCashPosition)}\r\n                        </div>\r\n                    </CardContent>\r\n                </Card>\r\n            </div>\r\n\r\n            {/* Charts Row */}\r\n            <div className=\"grid gap-4 md:grid-cols-2\">\r\n                <Card className=\"col-span-1\">\r\n                    <CardHeader>\r\n                        <CardTitle>Inflows vs Outflows</CardTitle>\r\n                    </CardHeader>\r\n                    <CardContent className=\"h-[350px]\">\r\n                        {isDataEmpty ? (\r\n                            <div className=\"h-full flex items-center justify-center text-muted-foreground\">\r\n                                No cash flow data yet\r\n                            </div>\r\n                        ) : (\r\n                            <ResponsiveContainer width=\"100%\" height=\"100%\">\r\n                                <BarChart data={data.monthlyFlow}>\r\n                                    <CartesianGrid strokeDasharray=\"3 3\" vertical={false} stroke=\"#2A2F3E\" />\r\n                                    <XAxis dataKey=\"month\" stroke=\"#888888\" fontSize={12} tickLine={false} axisLine={false} />\r\n                                    <YAxis stroke=\"#888888\" fontSize={12} tickLine={false} axisLine={false} tickFormatter={(value) => `$${value}`} />\r\n                                    <Tooltip content={<CustomTooltip />} wrapperStyle={{ outline: 'none' }} />\r\n                                    <Bar dataKey=\"inflows\" name=\"Inflows\" fill=\"#22C55E\" radius={[4, 4, 0, 0]} />\r\n                                    <Bar dataKey=\"outflows\" name=\"Outflows\" fill=\"#EF4444\" radius={[4, 4, 0, 0]} />\r\n                                </BarChart>\r\n                            </ResponsiveContainer>\r\n                        )}\r\n                    </CardContent>\r\n                </Card>\r\n\r\n                <Card className=\"col-span-1\">\r\n                    <CardHeader>\r\n                        <CardTitle>Cumulative Cash Position</CardTitle>\r\n                    </CardHeader>\r\n                    <CardContent className=\"h-[350px]\">\r\n                        {isDataEmpty ? (\r\n                            <div className=\"h-full flex items-center justify-center text-muted-foreground\">\r\n                                No cash flow data yet\r\n                            </div>\r\n                        ) : (\r\n                            <ResponsiveContainer width=\"100%\" height=\"100%\">\r\n                                <AreaChart data={data.cumulativePosition}>\r\n                                    <CartesianGrid strokeDasharray=\"3 3\" vertical={false} stroke=\"#2A2F3E\" />\r\n                                    <XAxis dataKey=\"month\" stroke=\"#888888\" fontSize={12} tickLine={false} axisLine={false} />\r\n                                    <YAxis stroke=\"#888888\" fontSize={12} tickLine={false} axisLine={false} tickFormatter={(value) => `$${value}`} />\r\n                                    <Tooltip content={<CustomTooltip />} wrapperStyle={{ outline: 'none' }} />\r\n                                    <Area type=\"monotone\" dataKey=\"cumulative\" name=\"Cumulative\" stroke=\"#3B82F6\" fillOpacity={0.2} fill=\"#3B82F6\" />\r\n                                </AreaChart>\r\n                            </ResponsiveContainer>\r\n                        )}\r\n                    </CardContent>\r\n                </Card>\r\n            </div>\r\n\r\n            {/* Table */}\r\n            <Card>\r\n                <CardHeader>\r\n                    <CardTitle>Monthly Cash Flow Breakdown</CardTitle>\r\n                </CardHeader>\r\n                <CardContent>\r\n                    {isDataEmpty ? (\r\n                        <div className=\"text-center py-6 text-muted-foreground\">\r\n                            No cash flow data yet. Add expenses and payouts to get started.\r\n                        </div>\r\n                    ) : (\r\n                        <div className=\"rounded-md border border-border\">\r\n                            <Table>\r\n                                <TableHeader>\r\n                                    <TableRow>\r\n                                        <TableHead>Month</TableHead>\r\n                                        <TableHead className=\"text-right\">Inflows</TableHead>\r\n                                        <TableHead className=\"text-right\">Outflows</TableHead>\r\n                                        <TableHead className=\"text-right\">Net</TableHead>\r\n                                        <TableHead className=\"text-right\">Running Total</TableHead>\r\n                                    </TableRow>\r\n                                </TableHeader>\r\n                                <TableBody>\r\n                                    {tableData.reverse().map((row: any, i: number) => (\r\n                                        <TableRow key={i}>\r\n                                            <TableCell>{row.month}</TableCell>\r\n                                            <TableCell className=\"text-right font-mono\">\r\n                                                {formatCurrency(row.inflows)}\r\n                                            </TableCell>\r\n                                            <TableCell className=\"text-right font-mono\">\r\n                                                {formatCurrency(row.outflows)}\r\n                                            </TableCell>\r\n                                            <TableCell className={`text-right font-mono ${row.net > 0 ? 'text-[#22C55E]' : row.net < 0 ? 'text-[#EF4444]' : ''}`}>\r\n                                                {formatCurrency(row.net)}\r\n                                            </TableCell>\r\n                                            <TableCell className={`text-right font-mono ${row.runningTotal > 0 ? 'text-[#22C55E]' : row.runningTotal < 0 ? 'text-[#EF4444]' : ''}`}>\r\n                                                {formatCurrency(row.runningTotal)}\r\n                                            </TableCell>\r\n                                        </TableRow>\r\n                                    ))}\r\n                                </TableBody>\r\n                            </Table>\r\n                        </div>\r\n                    )}\r\n                </CardContent>\r\n            </Card>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\components\\finance\\expenses-tab.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":68,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":68,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3005,3008],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3005,3008],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":84,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":84,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3623,3626],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3623,3626],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useState } from \"react\";\r\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\r\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Label } from \"@/components/ui/label\";\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\r\nimport { Switch } from \"@/components/ui/switch\";\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\r\nimport { AlertDialog, AlertDialogAction, AlertDialogCancel, AlertDialogContent, AlertDialogDescription, AlertDialogFooter, AlertDialogHeader, AlertDialogTitle } from \"@/components/ui/alert-dialog\";\r\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\r\nimport { Skeleton } from \"@/components/ui/skeleton\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { Pencil, Trash2, Check, Loader2, Plus } from \"lucide-react\";\r\nimport { Checkbox } from \"@/components/ui/checkbox\";\r\n\r\ntype Expense = {\r\n    id: string;\r\n    amount: number;\r\n    category: string;\r\n    vendor: string | null;\r\n    description: string | null;\r\n    date: string;\r\n    tags: string[] | null;\r\n    is_recurring: boolean;\r\n};\r\n\r\nexport function ExpensesTab() {\r\n    const queryClient = useQueryClient();\r\n    const [isDialogOpen, setIsDialogOpen] = useState(false);\r\n    const [isDeleteDialogOpen, setIsDeleteDialogOpen] = useState(false);\r\n    const [selectedExpense, setSelectedExpense] = useState<Expense | null>(null);\r\n    const [expenseToDelete, setExpenseToDelete] = useState<string | null>(null);\r\n\r\n    // Form State\r\n    const [amount, setAmount] = useState(\"\");\r\n    const [category, setCategory] = useState(\"\");\r\n    const [vendor, setVendor] = useState(\"\");\r\n    const [description, setDescription] = useState(\"\");\r\n    const [date, setDate] = useState(new Date().toISOString().split(\"T\")[0]);\r\n    const [tags, setTags] = useState(\"\");\r\n    const [isRecurring, setIsRecurring] = useState(false);\r\n    const [addToSubscriptions, setAddToSubscriptions] = useState(false);\r\n\r\n    const { data: expenses, isLoading } = useQuery({\r\n        queryKey: [\"finance\", \"expenses\"],\r\n        queryFn: async () => {\r\n            const res = await fetch(\"/api/finance/expenses\");\r\n            if (!res.ok) throw new Error(\"Failed to fetch expenses\");\r\n            const json = await res.json();\r\n            return json.data as Expense[];\r\n        }\r\n    });\r\n\r\n    const { data: settings } = useQuery({\r\n        queryKey: [\"finance\", \"settings\"],\r\n        queryFn: async () => {\r\n            const res = await fetch(\"/api/finance/settings\");\r\n            if (!res.ok) return null;\r\n            const json = await res.json();\r\n            return json.data;\r\n        }\r\n    });\r\n\r\n    const createMutation = useMutation({\r\n        mutationFn: async (newExpense: any) => {\r\n            const res = await fetch(\"/api/finance/expenses\", {\r\n                method: \"POST\",\r\n                headers: { \"Content-Type\": \"application/json\" },\r\n                body: JSON.stringify(newExpense),\r\n            });\r\n            if (!res.ok) throw new Error(\"Failed to create expense\");\r\n            return res.json();\r\n        },\r\n        onSuccess: () => {\r\n            queryClient.invalidateQueries({ queryKey: [\"finance\"] });\r\n            setIsDialogOpen(false);\r\n        }\r\n    });\r\n\r\n    const updateMutation = useMutation({\r\n        mutationFn: async ({ id, data }: { id: string, data: any }) => {\r\n            const res = await fetch(`/api/finance/expenses/${id}`, {\r\n                method: \"PATCH\",\r\n                headers: { \"Content-Type\": \"application/json\" },\r\n                body: JSON.stringify(data),\r\n            });\r\n            if (!res.ok) throw new Error(\"Failed to update expense\");\r\n            return res.json();\r\n        },\r\n        onSuccess: () => {\r\n            queryClient.invalidateQueries({ queryKey: [\"finance\"] });\r\n            setIsDialogOpen(false);\r\n        }\r\n    });\r\n\r\n    const deleteMutation = useMutation({\r\n        mutationFn: async (id: string) => {\r\n            const res = await fetch(`/api/finance/expenses/${id}`, {\r\n                method: \"DELETE\",\r\n            });\r\n            if (!res.ok) throw new Error(\"Failed to delete expense\");\r\n            return res.json();\r\n        },\r\n        onSuccess: () => {\r\n            queryClient.invalidateQueries({ queryKey: [\"finance\"] });\r\n            setIsDeleteDialogOpen(false);\r\n        }\r\n    });\r\n\r\n    const handleSubmit = (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        const payload = {\r\n            amount: parseFloat(amount),\r\n            category,\r\n            vendor,\r\n            description,\r\n            date,\r\n            tags: tags ? tags.split(\",\").map(t => t.trim()).filter(Boolean) : [],\r\n            is_recurring: isRecurring\r\n        };\r\n\r\n        if (selectedExpense) {\r\n            updateMutation.mutate({ id: selectedExpense.id, data: payload });\r\n        } else {\r\n            createMutation.mutate(payload, {\r\n                onSuccess: () => {\r\n                    if (isRecurring && addToSubscriptions) {\r\n                        fetch(\"/api/finance/subscriptions\", {\r\n                            method: \"POST\",\r\n                            headers: { \"Content-Type\": \"application/json\" },\r\n                            body: JSON.stringify({\r\n                                name: vendor || description || \"New Subscription\",\r\n                                provider: vendor || null,\r\n                                amount: parseFloat(amount),\r\n                                billing_cycle: \"monthly\",\r\n                                category,\r\n                                is_active: true\r\n                            }),\r\n                        }).then(() => {\r\n                            queryClient.invalidateQueries({ queryKey: [\"finance\", \"subscriptions\"] });\r\n                        }).catch(console.error);\r\n                    }\r\n                }\r\n            });\r\n        }\r\n    };\r\n\r\n    const handleEdit = (exp: Expense) => {\r\n        setSelectedExpense(exp);\r\n        setAmount(exp.amount.toString());\r\n        setCategory(exp.category);\r\n        setVendor(exp.vendor || \"\");\r\n        setDescription(exp.description || \"\");\r\n        setDate(exp.date);\r\n        setTags(exp.tags?.join(\", \") || \"\");\r\n        setIsRecurring(exp.is_recurring);\r\n        setAddToSubscriptions(false);\r\n        setIsDialogOpen(true);\r\n    };\r\n\r\n    const handleAddNew = () => {\r\n        setSelectedExpense(null);\r\n        setAmount(\"\");\r\n        setCategory(\"\");\r\n        setVendor(\"\");\r\n        setDescription(\"\");\r\n        setDate(new Date().toISOString().split(\"T\")[0]);\r\n        setTags(\"\");\r\n        setIsRecurring(false);\r\n        setAddToSubscriptions(false);\r\n        setIsDialogOpen(true);\r\n    };\r\n\r\n    if (isLoading) {\r\n        return (\r\n            <div className=\"space-y-4\">\r\n                <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-4\">\r\n                    {[...Array(4)].map((_, i) => <Skeleton key={i} className=\"h-24 w-full rounded-xl\" />)}\r\n                </div>\r\n                <Skeleton className=\"h-[400px] w-full rounded-xl\" />\r\n            </div>\r\n        );\r\n    }\r\n\r\n    const data = expenses || [];\r\n\r\n    const totalExpenses = data.reduce((sum, e) => sum + Number(e.amount), 0);\r\n    const recurringExpenses = data.filter(e => e.is_recurring).reduce((sum, e) => sum + Number(e.amount), 0);\r\n    const largestExpense = data.length > 0 ? Math.max(...data.map(e => Number(e.amount))) : 0;\r\n    const avgExpense = data.length > 0 ? totalExpenses / data.length : 0;\r\n\r\n    const formatCurrency = (val: number) => {\r\n        return new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(val);\r\n    };\r\n\r\n    const formatDate = (dateStr: string) => {\r\n        return new Date(dateStr).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });\r\n    };\r\n\r\n    const isSubmitting = createMutation.isPending || updateMutation.isPending;\r\n\r\n    return (\r\n        <div className=\"space-y-4\">\r\n            {/* KPI Row */}\r\n            <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-4\">\r\n                <Card>\r\n                    <CardHeader className=\"pb-2\">\r\n                        <CardTitle className=\"text-sm font-medium text-muted-foreground\">Total Expenses</CardTitle>\r\n                    </CardHeader>\r\n                    <CardContent>\r\n                        <div className=\"text-2xl font-bold font-mono text-[#EF4444]\">\r\n                            {formatCurrency(totalExpenses)}\r\n                        </div>\r\n                    </CardContent>\r\n                </Card>\r\n                <Card>\r\n                    <CardHeader className=\"pb-2\">\r\n                        <CardTitle className=\"text-sm font-medium text-muted-foreground\">Monthly Recurring</CardTitle>\r\n                    </CardHeader>\r\n                    <CardContent>\r\n                        <div className=\"text-2xl font-bold font-mono text-muted-foreground\">\r\n                            {formatCurrency(recurringExpenses)}\r\n                        </div>\r\n                    </CardContent>\r\n                </Card>\r\n                <Card>\r\n                    <CardHeader className=\"pb-2\">\r\n                        <CardTitle className=\"text-sm font-medium text-muted-foreground\">Largest Expense</CardTitle>\r\n                    </CardHeader>\r\n                    <CardContent>\r\n                        <div className=\"text-2xl font-bold font-mono text-muted-foreground\">\r\n                            {formatCurrency(largestExpense)}\r\n                        </div>\r\n                    </CardContent>\r\n                </Card>\r\n                <Card>\r\n                    <CardHeader className=\"pb-2\">\r\n                        <CardTitle className=\"text-sm font-medium text-muted-foreground\">Avg Expense</CardTitle>\r\n                    </CardHeader>\r\n                    <CardContent>\r\n                        <div className=\"text-2xl font-bold font-mono text-muted-foreground\">\r\n                            {formatCurrency(avgExpense)}\r\n                        </div>\r\n                    </CardContent>\r\n                </Card>\r\n            </div>\r\n\r\n            <div className=\"flex justify-between items-center\">\r\n                <h3 className=\"text-lg font-medium\">All Expenses</h3>\r\n                <Dialog open={isDialogOpen} onOpenChange={setIsDialogOpen}>\r\n                    <DialogTrigger asChild>\r\n                        <Button onClick={handleAddNew} size=\"sm\">\r\n                            <Plus className=\"h-4 w-4 mr-2\" />\r\n                            Add Expense\r\n                        </Button>\r\n                    </DialogTrigger>\r\n                    <DialogContent>\r\n                        <DialogHeader>\r\n                            <DialogTitle>{selectedExpense ? 'Edit Expense' : 'Add Expense'}</DialogTitle>\r\n                        </DialogHeader>\r\n                        <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n                            <div className=\"grid grid-cols-2 gap-4\">\r\n                                <div className=\"space-y-2\">\r\n                                    <Label>Amount</Label>\r\n                                    <Input type=\"number\" step=\"0.01\" required value={amount} onChange={e => setAmount(e.target.value)} />\r\n                                </div>\r\n                                <div className=\"space-y-2\">\r\n                                    <Label>Date</Label>\r\n                                    <Input type=\"date\" required value={date} onChange={e => setDate(e.target.value)} />\r\n                                </div>\r\n                            </div>\r\n                            <div className=\"space-y-2\">\r\n                                <Label>Category</Label>\r\n                                <Select value={category} onValueChange={setCategory} required>\r\n                                    <SelectTrigger>\r\n                                        <SelectValue placeholder=\"Select Category\" />\r\n                                    </SelectTrigger>\r\n                                    <SelectContent>\r\n                                        <SelectItem value=\"Software\">Software</SelectItem>\r\n                                        <SelectItem value=\"Education\">Education</SelectItem>\r\n                                        <SelectItem value=\"Data & News\">Data & News</SelectItem>\r\n                                        <SelectItem value=\"Hardware\">Hardware</SelectItem>\r\n                                        <SelectItem value=\"Prop Firm Fees\">Prop Firm Fees</SelectItem>\r\n                                        <SelectItem value=\"Marketing\">Marketing</SelectItem>\r\n                                        <SelectItem value=\"Other\">Other</SelectItem>\r\n                                    </SelectContent>\r\n                                </Select>\r\n                            </div>\r\n                            <div className=\"space-y-2\">\r\n                                <Label>Vendor</Label>\r\n                                <Input\r\n                                    value={vendor}\r\n                                    onChange={e => setVendor(e.target.value)}\r\n                                    list=\"vendor-presets\"\r\n                                />\r\n                                {settings?.vendor_presets?.length > 0 && (\r\n                                    <datalist id=\"vendor-presets\">\r\n                                        {settings.vendor_presets.map((v: string) => <option key={v} value={v} />)}\r\n                                    </datalist>\r\n                                )}\r\n                            </div>\r\n                            <div className=\"space-y-2\">\r\n                                <Label>Description</Label>\r\n                                <Input value={description} onChange={e => setDescription(e.target.value)} />\r\n                            </div>\r\n                            <div className=\"space-y-2\">\r\n                                <Label>Tags (Comma separated)</Label>\r\n                                <Input\r\n                                    value={tags}\r\n                                    onChange={e => setTags(e.target.value)}\r\n                                    list=\"tag-presets\"\r\n                                />\r\n                                {settings?.custom_tags?.length > 0 && (\r\n                                    <datalist id=\"tag-presets\">\r\n                                        {settings.custom_tags.map((t: string) => <option key={t} value={t} />)}\r\n                                    </datalist>\r\n                                )}\r\n                            </div>\r\n                            <div className=\"space-y-4\">\r\n                                <div className=\"flex items-center space-x-2\">\r\n                                    <Switch id=\"recurring\" checked={isRecurring} onCheckedChange={setIsRecurring} />\r\n                                    <Label htmlFor=\"recurring\">Recurring Expense</Label>\r\n                                </div>\r\n                                {isRecurring && !selectedExpense && (\r\n                                    <div className=\"flex items-center space-x-2 ml-6\">\r\n                                        <Checkbox\r\n                                            id=\"add-to-sub\"\r\n                                            checked={addToSubscriptions}\r\n                                            onCheckedChange={(checked) => setAddToSubscriptions(checked as boolean)}\r\n                                        />\r\n                                        <Label htmlFor=\"add-to-sub\" className=\"text-muted-foreground font-normal\">Also add to subscriptions</Label>\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n                            <Button type=\"submit\" className=\"w-full\" disabled={isSubmitting}>\r\n                                {isSubmitting && <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />}\r\n                                Save Expense\r\n                            </Button>\r\n                        </form>\r\n                    </DialogContent>\r\n                </Dialog>\r\n            </div>\r\n\r\n            <Card>\r\n                <Table>\r\n                    <TableHeader>\r\n                        <TableRow>\r\n                            <TableHead>Date</TableHead>\r\n                            <TableHead>Vendor</TableHead>\r\n                            <TableHead>Category</TableHead>\r\n                            <TableHead className=\"hidden md:table-cell\">Description</TableHead>\r\n                            <TableHead className=\"hidden md:table-cell\">Tags</TableHead>\r\n                            <TableHead className=\"text-right\">Amount</TableHead>\r\n                            <TableHead className=\"text-center\">Recurring</TableHead>\r\n                            <TableHead className=\"text-right\">Actions</TableHead>\r\n                        </TableRow>\r\n                    </TableHeader>\r\n                    <TableBody>\r\n                        {data.length === 0 ? (\r\n                            <TableRow>\r\n                                <TableCell colSpan={8} className=\"text-center text-muted-foreground h-32\">\r\n                                    No expenses yet. Click &apos;Add Expense&apos; to get started.\r\n                                </TableCell>\r\n                            </TableRow>\r\n                        ) : (\r\n                            data.map(exp => (\r\n                                <TableRow key={exp.id}>\r\n                                    <TableCell className=\"whitespace-nowrap\">{formatDate(exp.date)}</TableCell>\r\n                                    <TableCell>{exp.vendor || '-'}</TableCell>\r\n                                    <TableCell>{exp.category}</TableCell>\r\n                                    <TableCell className=\"hidden md:table-cell text-muted-foreground max-w-[200px] truncate\">{exp.description}</TableCell>\r\n                                    <TableCell className=\"hidden md:table-cell\">\r\n                                        <div className=\"flex gap-1 flex-wrap\">\r\n                                            {exp.tags?.map(t => <Badge key={t} variant=\"outline\" className=\"text-xs\">{t}</Badge>)}\r\n                                        </div>\r\n                                    </TableCell>\r\n                                    <TableCell className=\"text-right font-mono text-[#EF4444]\">{formatCurrency(exp.amount)}</TableCell>\r\n                                    <TableCell className=\"text-center\">\r\n                                        {exp.is_recurring && <Check className=\"h-4 w-4 mx-auto text-[#22C55E]\" />}\r\n                                    </TableCell>\r\n                                    <TableCell className=\"text-right\">\r\n                                        <div className=\"flex justify-end gap-2\">\r\n                                            <Button variant=\"ghost\" size=\"icon\" onClick={() => handleEdit(exp)}>\r\n                                                <Pencil className=\"h-4 w-4 text-muted-foreground\" />\r\n                                            </Button>\r\n                                            <Button variant=\"ghost\" size=\"icon\" onClick={() => {\r\n                                                setExpenseToDelete(exp.id);\r\n                                                setIsDeleteDialogOpen(true);\r\n                                            }}>\r\n                                                <Trash2 className=\"h-4 w-4 text-red-500\" />\r\n                                            </Button>\r\n                                        </div>\r\n                                    </TableCell>\r\n                                </TableRow>\r\n                            ))\r\n                        )}\r\n                    </TableBody>\r\n                </Table>\r\n            </Card>\r\n\r\n            <AlertDialog open={isDeleteDialogOpen} onOpenChange={setIsDeleteDialogOpen}>\r\n                <AlertDialogContent>\r\n                    <AlertDialogHeader>\r\n                        <AlertDialogTitle>Delete Expense</AlertDialogTitle>\r\n                        <AlertDialogDescription>\r\n                            Are you sure you want to delete this expense? This action cannot be undone.\r\n                        </AlertDialogDescription>\r\n                    </AlertDialogHeader>\r\n                    <AlertDialogFooter>\r\n                        <AlertDialogCancel>Cancel</AlertDialogCancel>\r\n                        <AlertDialogAction\r\n                            onClick={() => expenseToDelete && deleteMutation.mutate(expenseToDelete)}\r\n                            className=\"bg-red-500 hover:bg-red-600\"\r\n                        >\r\n                            {deleteMutation.isPending ? <Loader2 className=\"h-4 w-4 animate-spin\" /> : \"Delete\"}\r\n                        </AlertDialogAction>\r\n                    </AlertDialogFooter>\r\n                </AlertDialogContent>\r\n            </AlertDialog>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\components\\finance\\finance-client.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\components\\finance\\overview-tab.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CardDescription' is defined but never used.","line":4,"column":52,"nodeType":"Identifier","messageId":"unusedVar","endLine":4,"endColumn":67,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"CardDescription"},"fix":{"range":[117,134],"text":""},"desc":"Remove unused variable \"CardDescription\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":45,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":45,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1752,1755],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1752,1755],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":188,"column":100,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":188,"endColumn":103,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8535,8538],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8535,8538],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/static-components","severity":2,"message":"Error: Cannot create components during render\n\nComponents created during render will reset their state each time they are created. Declare components outside of render.\n\nC:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\components\\finance\\overview-tab.tsx:194:56\n  192 |                                     <XAxis dataKey=\"month\" stroke=\"#888888\" fontSize={12} tickLine={false} axisLine={false} />\n  193 |                                     <YAxis stroke=\"#888888\" fontSize={12} tickLine={false} axisLine={false} tickFormatter={(value) => `$${value}`} />\n> 194 |                                     <Tooltip content={<CustomTooltip />} wrapperStyle={{ outline: 'none' }} />\n      |                                                        ^^^^^^^^^^^^^ This component is created during render\n  195 |                                     <Bar dataKey=\"amount\" name=\"Expenses\" fill=\"#EF4444\" radius={[4, 4, 0, 0]} />\n  196 |                                 </BarChart>\n  197 |                             </ResponsiveContainer>\n\nC:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\components\\finance\\overview-tab.tsx:45:27\n  43 |     };\n  44 |\n> 45 |     const CustomTooltip = ({ active, payload, label }: any) => {\n     |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 46 |         if (!active || !payload?.length) return null;\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 47 |         const value = payload[0]?.value ?? 0;\n     …\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 61 |         );\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 62 |     };\n     | ^^^^^^ The component is created during render here\n  63 |\n  64 |     const COLORS = ['#3B82F6', '#22C55E', '#EF4444', '#F59E0B', '#8B5CF6', '#EC4899', '#06B6D4'];\n  65 |","line":194,"column":56,"nodeType":null,"endLine":194,"endColumn":69},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":208,"column":100,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":208,"endColumn":103,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10056,10059],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10056,10059],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/static-components","severity":2,"message":"Error: Cannot create components during render\n\nComponents created during render will reset their state each time they are created. Declare components outside of render.\n\nC:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\components\\finance\\overview-tab.tsx:214:56\n  212 |                                     <XAxis dataKey=\"month\" stroke=\"#888888\" fontSize={12} tickLine={false} axisLine={false} />\n  213 |                                     <YAxis stroke=\"#888888\" fontSize={12} tickLine={false} axisLine={false} tickFormatter={(value) => `$${value}`} />\n> 214 |                                     <Tooltip content={<CustomTooltip />} wrapperStyle={{ outline: 'none' }} />\n      |                                                        ^^^^^^^^^^^^^ This component is created during render\n  215 |                                     <Bar dataKey=\"amount\" name=\"Revenue\" fill=\"#22C55E\" radius={[4, 4, 0, 0]} />\n  216 |                                 </BarChart>\n  217 |                             </ResponsiveContainer>\n\nC:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\components\\finance\\overview-tab.tsx:45:27\n  43 |     };\n  44 |\n> 45 |     const CustomTooltip = ({ active, payload, label }: any) => {\n     |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 46 |         if (!active || !payload?.length) return null;\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 47 |         const value = payload[0]?.value ?? 0;\n     …\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 61 |         );\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 62 |     };\n     | ^^^^^^ The component is created during render here\n  63 |\n  64 |     const COLORS = ['#3B82F6', '#22C55E', '#EF4444', '#F59E0B', '#8B5CF6', '#EC4899', '#06B6D4'];\n  65 |","line":214,"column":56,"nodeType":null,"endLine":214,"endColumn":69},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":232,"column":96,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":232,"endColumn":99,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11689,11692],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11689,11692],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/static-components","severity":2,"message":"Error: Cannot create components during render\n\nComponents created during render will reset their state each time they are created. Declare components outside of render.\n\nC:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\components\\finance\\overview-tab.tsx:238:56\n  236 |                                     <XAxis dataKey=\"month\" stroke=\"#888888\" fontSize={12} tickLine={false} axisLine={false} />\n  237 |                                     <YAxis stroke=\"#888888\" fontSize={12} tickLine={false} axisLine={false} tickFormatter={(value) => `$${value}`} />\n> 238 |                                     <Tooltip content={<CustomTooltip />} wrapperStyle={{ outline: 'none' }} />\n      |                                                        ^^^^^^^^^^^^^ This component is created during render\n  239 |                                     <Line type=\"monotone\" dataKey=\"amount\" name=\"Net Profit\" stroke=\"#3B82F6\" strokeWidth={2} dot={{ r: 4, fill: '#3B82F6' }} />\n  240 |                                 </LineChart>\n  241 |                             </ResponsiveContainer>\n\nC:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\components\\finance\\overview-tab.tsx:45:27\n  43 |     };\n  44 |\n> 45 |     const CustomTooltip = ({ active, payload, label }: any) => {\n     |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 46 |         if (!active || !payload?.length) return null;\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 47 |         const value = payload[0]?.value ?? 0;\n     …\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 61 |         );\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 62 |     };\n     | ^^^^^^ The component is created during render here\n  63 |\n  64 |     const COLORS = ['#3B82F6', '#22C55E', '#EF4444', '#F59E0B', '#8B5CF6', '#EC4899', '#06B6D4'];\n  65 |","line":238,"column":56,"nodeType":null,"endLine":238,"endColumn":69},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":265,"column":77,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":265,"endColumn":80,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13970,13973],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13970,13973],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":8,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useQuery } from \"@tanstack/react-query\";\r\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\r\nimport { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, LineChart, Line, PieChart, Pie, Cell } from \"recharts\";\r\nimport { Skeleton } from \"@/components/ui/skeleton\";\r\n\r\nexport function OverviewTab() {\r\n    const { data: result, isLoading } = useQuery({\r\n        queryKey: [\"finance\", \"overview\"],\r\n        queryFn: async () => {\r\n            const res = await fetch(\"/api/finance/overview\");\r\n            if (!res.ok) throw new Error(\"Failed to fetch overview data\");\r\n            const json = await res.json();\r\n            return json.data;\r\n        }\r\n    });\r\n\r\n    if (isLoading) {\r\n        return (\r\n            <div className=\"space-y-4\">\r\n                <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-4\">\r\n                    {[...Array(4)].map((_, i) => <Skeleton key={i} className=\"h-32 w-full rounded-xl\" />)}\r\n                </div>\r\n                <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-4\">\r\n                    {[...Array(4)].map((_, i) => <Skeleton key={i} className=\"h-32 w-full rounded-xl\" />)}\r\n                </div>\r\n                <Skeleton className=\"h-[400px] w-full rounded-xl\" />\r\n            </div>\r\n        );\r\n    }\r\n\r\n    if (!result) return null;\r\n\r\n    const data = result;\r\n\r\n    const formatCurrency = (val: number) => {\r\n        return new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(val);\r\n    };\r\n\r\n    const formatPct = (val: number) => {\r\n        return `${val > 0 ? '+' : ''}${val.toFixed(2)}%`;\r\n    };\r\n\r\n    const CustomTooltip = ({ active, payload, label }: any) => {\r\n        if (!active || !payload?.length) return null;\r\n        const value = payload[0]?.value ?? 0;\r\n        const color = value >= 0 ? '#22C55E' : '#EF4444';\r\n        return (\r\n            <div style={{\r\n                background: '#14171E',\r\n                border: '1px solid #2A2F3E',\r\n                borderRadius: '6px',\r\n                padding: '8px 12px'\r\n            }}>\r\n                <p style={{ color: '#E8EAF0', marginBottom: 4 }}>{label}</p>\r\n                <p style={{ color, fontFamily: 'JetBrains Mono' }}>\r\n                    ${Math.abs(value).toFixed(2)}\r\n                </p>\r\n            </div>\r\n        );\r\n    };\r\n\r\n    const COLORS = ['#3B82F6', '#22C55E', '#EF4444', '#F59E0B', '#8B5CF6', '#EC4899', '#06B6D4'];\r\n\r\n    const renderInsights = () => {\r\n        const insights = [];\r\n        if (data.expenseByCategory && data.expenseByCategory.length > 0) {\r\n            insights.push(`Your largest expense category is ${data.expenseByCategory[0].category} at ${formatCurrency(data.expenseByCategory[0].amount)}/mo.`);\r\n        }\r\n        insights.push(`YTD ROI is ${formatPct(data.ytdROI)}.`);\r\n        if (data.activeSubscriptionsMonthly > 0) {\r\n            insights.push(`You have ${formatCurrency(data.activeSubscriptionsMonthly)}/mo in active subscriptions.`);\r\n        }\r\n\r\n        const change = data.thisMonthNet - data.lastMonthNet;\r\n        const dir = change >= 0 ? 'up' : 'down';\r\n        insights.push(`This month you are ${dir} ${formatCurrency(Math.abs(change))} vs last month.`);\r\n\r\n        if (data.ytdSpend === 0 && data.ytdEarned === 0) {\r\n            return <p className=\"text-muted-foreground text-sm\">Add expenses and payouts to see insights.</p>;\r\n        }\r\n\r\n        return (\r\n            <ul className=\"list-disc pl-5 space-y-2 text-sm text-muted-foreground\">\r\n                {insights.map((ins, i) => <li key={i}>{ins}</li>)}\r\n            </ul>\r\n        );\r\n    };\r\n\r\n    return (\r\n        <div className=\"space-y-4\">\r\n            {/* KPI Row 1 */}\r\n            <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-4\">\r\n                <Card>\r\n                    <CardHeader className=\"pb-2\">\r\n                        <CardTitle className=\"text-sm font-medium text-muted-foreground\">This Month Expenses</CardTitle>\r\n                    </CardHeader>\r\n                    <CardContent>\r\n                        <div className=\"text-2xl font-bold font-mono\">\r\n                            {formatCurrency(data.thisMonthExpenses)}\r\n                        </div>\r\n                    </CardContent>\r\n                </Card>\r\n                <Card>\r\n                    <CardHeader className=\"pb-2\">\r\n                        <CardTitle className=\"text-sm font-medium text-muted-foreground\">This Month Revenue</CardTitle>\r\n                    </CardHeader>\r\n                    <CardContent>\r\n                        <div className=\"text-2xl font-bold font-mono\">\r\n                            {formatCurrency(data.thisMonthRevenue)}\r\n                        </div>\r\n                    </CardContent>\r\n                </Card>\r\n                <Card>\r\n                    <CardHeader className=\"pb-2\">\r\n                        <CardTitle className=\"text-sm font-medium text-muted-foreground\">This Month Net</CardTitle>\r\n                    </CardHeader>\r\n                    <CardContent>\r\n                        <div className={`text-2xl font-bold font-mono ${data.thisMonthNet >= 0 ? 'text-[#22C55E]' : 'text-[#EF4444]'}`}>\r\n                            {formatCurrency(data.thisMonthNet)}\r\n                        </div>\r\n                    </CardContent>\r\n                </Card>\r\n                <Card>\r\n                    <CardHeader className=\"pb-2\">\r\n                        <CardTitle className=\"text-sm font-medium text-muted-foreground\">YTD ROI</CardTitle>\r\n                    </CardHeader>\r\n                    <CardContent>\r\n                        <div className={`text-2xl font-bold font-mono ${data.ytdROI >= 0 ? 'text-[#22C55E]' : 'text-[#EF4444]'}`}>\r\n                            {formatPct(data.ytdROI)}\r\n                        </div>\r\n                    </CardContent>\r\n                </Card>\r\n            </div>\r\n\r\n            {/* KPI Row 2 */}\r\n            <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-4\">\r\n                <Card>\r\n                    <CardHeader className=\"pb-2\">\r\n                        <CardTitle className=\"text-sm font-medium text-muted-foreground\">Last Month Net</CardTitle>\r\n                    </CardHeader>\r\n                    <CardContent>\r\n                        <div className=\"text-2xl font-bold font-mono\">\r\n                            {formatCurrency(data.lastMonthNet)}\r\n                        </div>\r\n                    </CardContent>\r\n                </Card>\r\n                <Card>\r\n                    <CardHeader className=\"pb-2\">\r\n                        <CardTitle className=\"text-sm font-medium text-muted-foreground\">Avg Monthly Expense</CardTitle>\r\n                    </CardHeader>\r\n                    <CardContent>\r\n                        <div className=\"text-2xl font-bold font-mono\">\r\n                            {formatCurrency(data.avgMonthlyExpense)}\r\n                        </div>\r\n                    </CardContent>\r\n                </Card>\r\n                <Card>\r\n                    <CardHeader className=\"pb-2\">\r\n                        <CardTitle className=\"text-sm font-medium text-muted-foreground\">Active Subscriptions/mo</CardTitle>\r\n                    </CardHeader>\r\n                    <CardContent>\r\n                        <div className=\"text-2xl font-bold font-mono\">\r\n                            {formatCurrency(data.activeSubscriptionsMonthly)}\r\n                        </div>\r\n                    </CardContent>\r\n                </Card>\r\n                <Card>\r\n                    <CardHeader className=\"pb-2\">\r\n                        <CardTitle className=\"text-sm font-medium text-muted-foreground\">YTD Spend</CardTitle>\r\n                    </CardHeader>\r\n                    <CardContent>\r\n                        <div className=\"text-2xl font-bold font-mono\">\r\n                            {formatCurrency(data.ytdSpend)}\r\n                        </div>\r\n                    </CardContent>\r\n                </Card>\r\n            </div>\r\n\r\n            {/* Charts Row 1 */}\r\n            <div className=\"grid gap-4 md:grid-cols-2\">\r\n                <Card>\r\n                    <CardHeader>\r\n                        <CardTitle className=\"text-sm font-medium text-muted-foreground\">Monthly Expenses</CardTitle>\r\n                    </CardHeader>\r\n                    <CardContent className=\"h-[300px]\">\r\n                        {data.monthlyExpenseTrend?.length > 0 && data.monthlyExpenseTrend.some((d: any) => d.amount > 0) ? (\r\n                            <ResponsiveContainer width=\"100%\" height=\"100%\">\r\n                                <BarChart data={data.monthlyExpenseTrend}>\r\n                                    <CartesianGrid strokeDasharray=\"3 3\" vertical={false} stroke=\"#2A2F3E\" />\r\n                                    <XAxis dataKey=\"month\" stroke=\"#888888\" fontSize={12} tickLine={false} axisLine={false} />\r\n                                    <YAxis stroke=\"#888888\" fontSize={12} tickLine={false} axisLine={false} tickFormatter={(value) => `$${value}`} />\r\n                                    <Tooltip content={<CustomTooltip />} wrapperStyle={{ outline: 'none' }} />\r\n                                    <Bar dataKey=\"amount\" name=\"Expenses\" fill=\"#EF4444\" radius={[4, 4, 0, 0]} />\r\n                                </BarChart>\r\n                            </ResponsiveContainer>\r\n                        ) : (\r\n                            <div className=\"flex items-center justify-center h-full text-muted-foreground text-sm\">No expenses data</div>\r\n                        )}\r\n                    </CardContent>\r\n                </Card>\r\n                <Card>\r\n                    <CardHeader>\r\n                        <CardTitle className=\"text-sm font-medium text-muted-foreground\">Monthly Revenue</CardTitle>\r\n                    </CardHeader>\r\n                    <CardContent className=\"h-[300px]\">\r\n                        {data.monthlyRevenueTrend?.length > 0 && data.monthlyRevenueTrend.some((d: any) => d.amount > 0) ? (\r\n                            <ResponsiveContainer width=\"100%\" height=\"100%\">\r\n                                <BarChart data={data.monthlyRevenueTrend}>\r\n                                    <CartesianGrid strokeDasharray=\"3 3\" vertical={false} stroke=\"#2A2F3E\" />\r\n                                    <XAxis dataKey=\"month\" stroke=\"#888888\" fontSize={12} tickLine={false} axisLine={false} />\r\n                                    <YAxis stroke=\"#888888\" fontSize={12} tickLine={false} axisLine={false} tickFormatter={(value) => `$${value}`} />\r\n                                    <Tooltip content={<CustomTooltip />} wrapperStyle={{ outline: 'none' }} />\r\n                                    <Bar dataKey=\"amount\" name=\"Revenue\" fill=\"#22C55E\" radius={[4, 4, 0, 0]} />\r\n                                </BarChart>\r\n                            </ResponsiveContainer>\r\n                        ) : (\r\n                            <div className=\"flex items-center justify-center h-full text-muted-foreground text-sm\">No revenue data</div>\r\n                        )}\r\n                    </CardContent>\r\n                </Card>\r\n            </div>\r\n\r\n            {/* Charts Row 2 */}\r\n            <div className=\"grid gap-4 md:grid-cols-2\">\r\n                <Card>\r\n                    <CardHeader>\r\n                        <CardTitle className=\"text-sm font-medium text-muted-foreground\">Net Profit Over Time</CardTitle>\r\n                    </CardHeader>\r\n                    <CardContent className=\"h-[300px]\">\r\n                        {data.netProfitOverTime?.length > 0 && data.netProfitOverTime.some((d: any) => d.amount !== 0) ? (\r\n                            <ResponsiveContainer width=\"100%\" height=\"100%\">\r\n                                <LineChart data={data.netProfitOverTime}>\r\n                                    <CartesianGrid strokeDasharray=\"3 3\" vertical={false} stroke=\"#2A2F3E\" />\r\n                                    <XAxis dataKey=\"month\" stroke=\"#888888\" fontSize={12} tickLine={false} axisLine={false} />\r\n                                    <YAxis stroke=\"#888888\" fontSize={12} tickLine={false} axisLine={false} tickFormatter={(value) => `$${value}`} />\r\n                                    <Tooltip content={<CustomTooltip />} wrapperStyle={{ outline: 'none' }} />\r\n                                    <Line type=\"monotone\" dataKey=\"amount\" name=\"Net Profit\" stroke=\"#3B82F6\" strokeWidth={2} dot={{ r: 4, fill: '#3B82F6' }} />\r\n                                </LineChart>\r\n                            </ResponsiveContainer>\r\n                        ) : (\r\n                            <div className=\"flex items-center justify-center h-full text-muted-foreground text-sm\">No profit data</div>\r\n                        )}\r\n                    </CardContent>\r\n                </Card>\r\n                <Card>\r\n                    <CardHeader>\r\n                        <CardTitle className=\"text-sm font-medium text-muted-foreground\">Expense by Category</CardTitle>\r\n                    </CardHeader>\r\n                    <CardContent className=\"h-[300px]\">\r\n                        {data.expenseByCategory?.length > 0 ? (\r\n                            <ResponsiveContainer width=\"100%\" height=\"100%\">\r\n                                <PieChart>\r\n                                    <Pie\r\n                                        data={data.expenseByCategory}\r\n                                        cx=\"50%\"\r\n                                        cy=\"50%\"\r\n                                        innerRadius={60}\r\n                                        outerRadius={100}\r\n                                        paddingAngle={2}\r\n                                        dataKey=\"amount\"\r\n                                        nameKey=\"category\"\r\n                                    >\r\n                                        {data.expenseByCategory.map((entry: any, index: number) => (\r\n                                            <Cell key={`cell-${index}`} fill={COLORS[index % COLORS.length]} />\r\n                                        ))}\r\n                                    </Pie>\r\n                                    <Tooltip\r\n                                        contentStyle={{\r\n                                            background: '#14171E',\r\n                                            border: '1px solid #2A2F3E',\r\n                                            color: '#E8EAF0'\r\n                                        }}\r\n                                        wrapperStyle={{ outline: 'none' }}\r\n                                    />\r\n                                </PieChart>\r\n                            </ResponsiveContainer>\r\n                        ) : (\r\n                            <div className=\"flex items-center justify-center h-full text-muted-foreground text-sm\">No category data</div>\r\n                        )}\r\n                    </CardContent>\r\n                </Card>\r\n            </div>\r\n\r\n            {/* Insights Row */}\r\n            <Card>\r\n                <CardHeader>\r\n                    <CardTitle className=\"text-sm font-medium text-muted-foreground\">Financial Insights</CardTitle>\r\n                </CardHeader>\r\n                <CardContent>\r\n                    {renderInsights()}\r\n                </CardContent>\r\n            </Card>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\components\\finance\\payouts-tab.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":68,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":68,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2856,2859],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2856,2859],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":84,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":84,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3471,3474],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3471,3474],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useState } from \"react\";\r\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\r\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Label } from \"@/components/ui/label\";\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\r\nimport { AlertDialog, AlertDialogAction, AlertDialogCancel, AlertDialogContent, AlertDialogDescription, AlertDialogFooter, AlertDialogHeader, AlertDialogTitle } from \"@/components/ui/alert-dialog\";\r\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\r\nimport { Skeleton } from \"@/components/ui/skeleton\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { Textarea } from \"@/components/ui/textarea\";\r\nimport { Pencil, Trash2, Loader2, Plus } from \"lucide-react\";\r\n\r\ntype Payout = {\r\n    id: string;\r\n    account_id: string | null;\r\n    account_name: string | null;\r\n    amount: number;\r\n    date: string;\r\n    status: \"pending\" | \"received\" | \"rejected\";\r\n    notes: string | null;\r\n};\r\n\r\ntype Account = {\r\n    id: string;\r\n    name: string;\r\n};\r\n\r\nexport function PayoutsTab() {\r\n    const queryClient = useQueryClient();\r\n    const [isDialogOpen, setIsDialogOpen] = useState(false);\r\n    const [isDeleteDialogOpen, setIsDeleteDialogOpen] = useState(false);\r\n    const [selectedPayout, setSelectedPayout] = useState<Payout | null>(null);\r\n    const [payoutToDelete, setPayoutToDelete] = useState<string | null>(null);\r\n\r\n    // Form State\r\n    const [amount, setAmount] = useState(\"\");\r\n    const [accountId, setAccountId] = useState(\"none\");\r\n    const [date, setDate] = useState(new Date().toISOString().split(\"T\")[0]);\r\n    const [status, setStatus] = useState(\"pending\");\r\n    const [notes, setNotes] = useState(\"\");\r\n\r\n    const { data: payouts, isLoading } = useQuery({\r\n        queryKey: [\"finance\", \"payouts\"],\r\n        queryFn: async () => {\r\n            const res = await fetch(\"/api/finance/payouts\");\r\n            if (!res.ok) throw new Error(\"Failed to fetch payouts\");\r\n            const json = await res.json();\r\n            return json.data as Payout[];\r\n        }\r\n    });\r\n\r\n    const { data: accounts, isLoading: isLoadingAccounts } = useQuery({\r\n        queryKey: [\"accounts\"],\r\n        queryFn: async () => {\r\n            const res = await fetch(\"/api/accounts\");\r\n            if (!res.ok) return [];\r\n            const json = await res.json();\r\n            return (json.accounts || []) as Account[];\r\n        }\r\n    });\r\n\r\n    const createMutation = useMutation({\r\n        mutationFn: async (newPayout: any) => {\r\n            const res = await fetch(\"/api/finance/payouts\", {\r\n                method: \"POST\",\r\n                headers: { \"Content-Type\": \"application/json\" },\r\n                body: JSON.stringify(newPayout),\r\n            });\r\n            if (!res.ok) throw new Error(\"Failed to create payout\");\r\n            return res.json();\r\n        },\r\n        onSuccess: () => {\r\n            queryClient.invalidateQueries({ queryKey: [\"finance\"] });\r\n            setIsDialogOpen(false);\r\n        }\r\n    });\r\n\r\n    const updateMutation = useMutation({\r\n        mutationFn: async ({ id, data }: { id: string, data: any }) => {\r\n            const res = await fetch(`/api/finance/payouts/${id}`, {\r\n                method: \"PATCH\",\r\n                headers: { \"Content-Type\": \"application/json\" },\r\n                body: JSON.stringify(data),\r\n            });\r\n            if (!res.ok) throw new Error(\"Failed to update payout\");\r\n            return res.json();\r\n        },\r\n        onSuccess: () => {\r\n            queryClient.invalidateQueries({ queryKey: [\"finance\"] });\r\n            setIsDialogOpen(false);\r\n        }\r\n    });\r\n\r\n    const deleteMutation = useMutation({\r\n        mutationFn: async (id: string) => {\r\n            const res = await fetch(`/api/finance/payouts/${id}`, {\r\n                method: \"DELETE\",\r\n            });\r\n            if (!res.ok) throw new Error(\"Failed to delete payout\");\r\n            return res.json();\r\n        },\r\n        onSuccess: () => {\r\n            queryClient.invalidateQueries({ queryKey: [\"finance\"] });\r\n            setIsDeleteDialogOpen(false);\r\n        }\r\n    });\r\n\r\n    const handleSubmit = (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        const payload = {\r\n            amount: parseFloat(amount),\r\n            account_id: accountId === \"none\" ? null : accountId,\r\n            date,\r\n            status,\r\n            notes: notes || null\r\n        };\r\n\r\n        if (selectedPayout) {\r\n            updateMutation.mutate({ id: selectedPayout.id, data: payload });\r\n        } else {\r\n            createMutation.mutate(payload);\r\n        }\r\n    };\r\n\r\n    const handleEdit = (pay: Payout) => {\r\n        setSelectedPayout(pay);\r\n        setAmount(pay.amount.toString());\r\n        setAccountId(pay.account_id || \"none\");\r\n        setDate(pay.date);\r\n        setStatus(pay.status);\r\n        setNotes(pay.notes || \"\");\r\n        setIsDialogOpen(true);\r\n    };\r\n\r\n    const handleAddNew = () => {\r\n        setSelectedPayout(null);\r\n        setAmount(\"\");\r\n        setAccountId(\"none\");\r\n        setDate(new Date().toISOString().split(\"T\")[0]);\r\n        setStatus(\"pending\");\r\n        setNotes(\"\");\r\n        setIsDialogOpen(true);\r\n    };\r\n\r\n    if (isLoading) {\r\n        return (\r\n            <div className=\"space-y-4\">\r\n                <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-4\">\r\n                    {[...Array(3)].map((_, i) => <Skeleton key={i} className=\"h-24 w-full rounded-xl\" />)}\r\n                </div>\r\n                <Skeleton className=\"h-[400px] w-full rounded-xl\" />\r\n            </div>\r\n        );\r\n    }\r\n\r\n    const data = payouts || [];\r\n\r\n    const totalReceived = data.filter(p => p.status === 'received').reduce((sum, p) => sum + Number(p.amount), 0);\r\n    const totalPending = data.filter(p => p.status === 'pending').reduce((sum, p) => sum + Number(p.amount), 0);\r\n    const payoutCount = data.length;\r\n\r\n    const formatCurrency = (val: number) => {\r\n        return new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(val);\r\n    };\r\n\r\n    const formatDate = (dateStr: string) => {\r\n        return new Date(dateStr).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });\r\n    };\r\n\r\n    const getStatusColor = (status: string) => {\r\n        switch (status) {\r\n            case 'received': return 'bg-[#22C55E]';\r\n            case 'pending': return 'bg-[#F59E0B]';\r\n            case 'rejected': return 'bg-[#EF4444]';\r\n            default: return 'bg-gray-500';\r\n        }\r\n    };\r\n\r\n    const isSubmitting = createMutation.isPending || updateMutation.isPending;\r\n\r\n    return (\r\n        <div className=\"space-y-4\">\r\n            {/* KPI Row */}\r\n            <div className=\"grid gap-4 md:grid-cols-3\">\r\n                <Card>\r\n                    <CardHeader className=\"pb-2\">\r\n                        <CardTitle className=\"text-sm font-medium text-muted-foreground\">Total Received</CardTitle>\r\n                    </CardHeader>\r\n                    <CardContent>\r\n                        <div className=\"text-2xl font-bold font-mono text-[#22C55E]\">\r\n                            {formatCurrency(totalReceived)}\r\n                        </div>\r\n                    </CardContent>\r\n                </Card>\r\n                <Card>\r\n                    <CardHeader className=\"pb-2\">\r\n                        <CardTitle className=\"text-sm font-medium text-muted-foreground\">Total Pending</CardTitle>\r\n                    </CardHeader>\r\n                    <CardContent>\r\n                        <div className=\"text-2xl font-bold font-mono text-[#F59E0B]\">\r\n                            {formatCurrency(totalPending)}\r\n                        </div>\r\n                    </CardContent>\r\n                </Card>\r\n                <Card>\r\n                    <CardHeader className=\"pb-2\">\r\n                        <CardTitle className=\"text-sm font-medium text-muted-foreground\">Payout Count</CardTitle>\r\n                    </CardHeader>\r\n                    <CardContent>\r\n                        <div className=\"text-2xl font-bold font-mono text-muted-foreground\">\r\n                            {payoutCount} <span className=\"text-sm font-normal\">all time</span>\r\n                        </div>\r\n                    </CardContent>\r\n                </Card>\r\n            </div>\r\n\r\n            <div className=\"flex justify-between items-center\">\r\n                <h3 className=\"text-lg font-medium\">All Payouts</h3>\r\n                <Dialog open={isDialogOpen} onOpenChange={setIsDialogOpen}>\r\n                    <DialogTrigger asChild>\r\n                        <Button onClick={handleAddNew} size=\"sm\">\r\n                            <Plus className=\"h-4 w-4 mr-2\" />\r\n                            Add Payout\r\n                        </Button>\r\n                    </DialogTrigger>\r\n                    <DialogContent>\r\n                        <DialogHeader>\r\n                            <DialogTitle>{selectedPayout ? 'Edit Payout' : 'Add Payout'}</DialogTitle>\r\n                        </DialogHeader>\r\n                        <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n                            <div className=\"grid grid-cols-2 gap-4\">\r\n                                <div className=\"space-y-2\">\r\n                                    <Label>Amount</Label>\r\n                                    <Input type=\"number\" step=\"0.01\" required value={amount} onChange={e => setAmount(e.target.value)} />\r\n                                </div>\r\n                                <div className=\"space-y-2\">\r\n                                    <Label>Date</Label>\r\n                                    <Input type=\"date\" required value={date} onChange={e => setDate(e.target.value)} />\r\n                                </div>\r\n                            </div>\r\n                            <div className=\"grid grid-cols-2 gap-4\">\r\n                                <div className=\"space-y-2\">\r\n                                    <Label>Account</Label>\r\n                                    <Select value={accountId} onValueChange={setAccountId}>\r\n                                        <SelectTrigger>\r\n                                            <SelectValue placeholder=\"Select Account\" />\r\n                                        </SelectTrigger>\r\n                                        <SelectContent>\r\n                                            <SelectItem value=\"none\">-- None --</SelectItem>\r\n                                            {isLoadingAccounts ? (\r\n                                                <SelectItem value=\"loading\" disabled>Loading accounts...</SelectItem>\r\n                                            ) : accounts?.length === 0 ? (\r\n                                                <SelectItem value=\"empty\" disabled>No accounts found</SelectItem>\r\n                                            ) : (\r\n                                                accounts?.map((acc: Account) => (\r\n                                                    <SelectItem key={acc.id} value={acc.id}>{acc.name}</SelectItem>\r\n                                                ))\r\n                                            )}\r\n                                        </SelectContent>\r\n                                    </Select>\r\n                                </div>\r\n                                <div className=\"space-y-2\">\r\n                                    <Label>Status</Label>\r\n                                    <Select value={status} onValueChange={setStatus} required>\r\n                                        <SelectTrigger>\r\n                                            <SelectValue placeholder=\"Select Status\" />\r\n                                        </SelectTrigger>\r\n                                        <SelectContent>\r\n                                            <SelectItem value=\"pending\">Pending</SelectItem>\r\n                                            <SelectItem value=\"received\">Received</SelectItem>\r\n                                            <SelectItem value=\"rejected\">Rejected</SelectItem>\r\n                                        </SelectContent>\r\n                                    </Select>\r\n                                </div>\r\n                            </div>\r\n                            <div className=\"space-y-2\">\r\n                                <Label>Notes</Label>\r\n                                <Textarea value={notes} onChange={e => setNotes(e.target.value)} placeholder=\"Optional notes...\" className=\"resize-none\" />\r\n                            </div>\r\n                            <Button type=\"submit\" className=\"w-full\" disabled={isSubmitting}>\r\n                                {isSubmitting && <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />}\r\n                                Save Payout\r\n                            </Button>\r\n                        </form>\r\n                    </DialogContent>\r\n                </Dialog>\r\n            </div>\r\n\r\n            <Card>\r\n                <Table>\r\n                    <TableHeader>\r\n                        <TableRow>\r\n                            <TableHead>Date</TableHead>\r\n                            <TableHead>Account</TableHead>\r\n                            <TableHead className=\"text-right\">Amount</TableHead>\r\n                            <TableHead className=\"text-center\">Status</TableHead>\r\n                            <TableHead className=\"hidden md:table-cell\">Notes</TableHead>\r\n                            <TableHead className=\"text-right\">Actions</TableHead>\r\n                        </TableRow>\r\n                    </TableHeader>\r\n                    <TableBody>\r\n                        {data.length === 0 ? (\r\n                            <TableRow>\r\n                                <TableCell colSpan={6} className=\"text-center text-muted-foreground h-32\">\r\n                                    No payouts recorded yet.\r\n                                </TableCell>\r\n                            </TableRow>\r\n                        ) : (\r\n                            data.map(pay => (\r\n                                <TableRow key={pay.id}>\r\n                                    <TableCell className=\"whitespace-nowrap\">{formatDate(pay.date)}</TableCell>\r\n                                    <TableCell className=\"font-medium\">{pay.account_name || 'N/A'}</TableCell>\r\n                                    <TableCell className=\"text-right font-mono text-[#22C55E]\">+{formatCurrency(pay.amount)}</TableCell>\r\n                                    <TableCell className=\"text-center\">\r\n                                        <Badge className={`capitalize ${getStatusColor(pay.status)} text-white hover:${getStatusColor(pay.status)}`}>\r\n                                            {pay.status}\r\n                                        </Badge>\r\n                                    </TableCell>\r\n                                    <TableCell className=\"hidden md:table-cell text-muted-foreground max-w-[200px] truncate\">{pay.notes || '-'}</TableCell>\r\n                                    <TableCell className=\"text-right\">\r\n                                        <div className=\"flex justify-end gap-2\">\r\n                                            <Button variant=\"ghost\" size=\"icon\" onClick={() => handleEdit(pay)}>\r\n                                                <Pencil className=\"h-4 w-4 text-muted-foreground\" />\r\n                                            </Button>\r\n                                            <Button variant=\"ghost\" size=\"icon\" onClick={() => {\r\n                                                setPayoutToDelete(pay.id);\r\n                                                setIsDeleteDialogOpen(true);\r\n                                            }}>\r\n                                                <Trash2 className=\"h-4 w-4 text-red-500\" />\r\n                                            </Button>\r\n                                        </div>\r\n                                    </TableCell>\r\n                                </TableRow>\r\n                            ))\r\n                        )}\r\n                    </TableBody>\r\n                </Table>\r\n            </Card>\r\n\r\n            <AlertDialog open={isDeleteDialogOpen} onOpenChange={setIsDeleteDialogOpen}>\r\n                <AlertDialogContent>\r\n                    <AlertDialogHeader>\r\n                        <AlertDialogTitle>Delete Payout</AlertDialogTitle>\r\n                        <AlertDialogDescription>\r\n                            Are you sure you want to delete this payout record? This action cannot be undone.\r\n                        </AlertDialogDescription>\r\n                    </AlertDialogHeader>\r\n                    <AlertDialogFooter>\r\n                        <AlertDialogCancel>Cancel</AlertDialogCancel>\r\n                        <AlertDialogAction\r\n                            onClick={() => payoutToDelete && deleteMutation.mutate(payoutToDelete)}\r\n                            className=\"bg-red-500 hover:bg-red-600\"\r\n                        >\r\n                            {deleteMutation.isPending ? <Loader2 className=\"h-4 w-4 animate-spin\" /> : \"Delete\"}\r\n                        </AlertDialogAction>\r\n                    </AlertDialogFooter>\r\n                </AlertDialogContent>\r\n            </AlertDialog>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\components\\finance\\reports-tab.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":117,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":117,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4729,4732],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4729,4732],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":122,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":122,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4980,4983],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4980,4983],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":127,"column":65,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":127,"endColumn":68,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5262,5265],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5262,5265],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":128,"column":68,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":128,"endColumn":71,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5366,5369],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5366,5369],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"prefer-const","severity":2,"message":"'bodyHtml' is never reassigned. Use 'const' instead.","line":133,"column":17,"nodeType":"Identifier","messageId":"useConst","endLine":133,"endColumn":25,"fix":{"range":[5561,8270],"text":"const bodyHtml = `\r\n                <div class=\"kpi-row\">\r\n                    <div class=\"kpi-box\">\r\n                        <div class=\"kpi-title\">Total Income</div>\r\n                        <div class=\"kpi-value font-mono\">${formatCurrency(totalIncome)}</div>\r\n                    </div>\r\n                    <div class=\"kpi-box\">\r\n                        <div class=\"kpi-title\">Total Expenses</div>\r\n                        <div class=\"kpi-value font-mono\">${formatCurrency(totalExpenses)}</div>\r\n                    </div>\r\n                    <div class=\"kpi-box\">\r\n                        <div class=\"kpi-title\">Net Profit</div>\r\n                        <div class=\"kpi-value font-mono ${net >= 0 ? 'text-green' : 'text-red'}\">${formatCurrency(net)}</div>\r\n                    </div>\r\n                </div>\r\n\r\n                <h2>Income (Payouts)</h2>\r\n                ${payouts.length > 0 ? `\r\n                <table>\r\n                    <thead>\r\n                        <tr>\r\n                            <th>Date</th>\r\n                            <th>Amount</th>\r\n                        </tr>\r\n                    </thead>\r\n                    <tbody>\r\n                        ${payouts.map((p: any) => `\r\n                            <tr>\r\n                                <td>${new Date(p.date).toLocaleDateString()}</td>\r\n                                <td class=\"font-mono\">${formatCurrency(Number(p.amount))}</td>\r\n                            </tr>\r\n                        `).join('')}\r\n                    </tbody>\r\n                </table>` : '<p>No income for this period.</p>'}\r\n\r\n                <h2>Expenses</h2>\r\n                ${expenses.length > 0 ? `\r\n                <table>\r\n                    <thead>\r\n                        <tr>\r\n                            <th>Date</th>\r\n                            <th>Vendor</th>\r\n                            <th>Category</th>\r\n                            <th>Description</th>\r\n                            <th>Amount</th>\r\n                        </tr>\r\n                    </thead>\r\n                    <tbody>\r\n                        ${expenses.map((e: any) => `\r\n                            <tr>\r\n                                <td>${new Date(e.date).toLocaleDateString()}</td>\r\n                                <td>${e.vendor || ''}</td>\r\n                                <td>${e.category}</td>\r\n                                <td>${e.description}</td>\r\n                                <td class=\"font-mono\">${formatCurrency(Number(e.amount))}</td>\r\n                            </tr>\r\n                        `).join('')}\r\n                    </tbody>\r\n                </table>` : '<p>No expenses for this period.</p>'}\r\n            `;"}},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":159,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":159,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6766,6769],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6766,6769],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":181,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":181,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7686,7689],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7686,7689],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":220,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":220,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9212,9215],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9212,9215],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":224,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":224,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9370,9373],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9370,9373],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":235,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":235,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9750,9753],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9750,9753],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":240,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":240,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9930,9933],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9930,9933],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"prefer-const","severity":2,"message":"'bodyHtml' is never reassigned. Use 'const' instead.","line":253,"column":17,"nodeType":"Identifier","messageId":"useConst","endLine":253,"endColumn":25,"fix":{"range":[10418,12912],"text":"const bodyHtml = `\r\n                <div class=\"kpi-row\">\r\n                    <div class=\"kpi-box\">\r\n                        <div class=\"kpi-title\">YTD Total Income</div>\r\n                        <div class=\"kpi-value font-mono\">${formatCurrency(ytdIncome)}</div>\r\n                    </div>\r\n                    <div class=\"kpi-box\">\r\n                        <div class=\"kpi-title\">YTD Total Expenses</div>\r\n                        <div class=\"kpi-value font-mono\">${formatCurrency(ytdExpenses)}</div>\r\n                    </div>\r\n                    <div class=\"kpi-box\">\r\n                        <div class=\"kpi-title\">YTD Net Profit</div>\r\n                        <div class=\"kpi-value font-mono ${ytdNet >= 0 ? 'text-green' : 'text-red'}\">${formatCurrency(ytdNet)}</div>\r\n                    </div>\r\n                </div>\r\n\r\n                <h2>Month by Month Breakdown</h2>\r\n                <table>\r\n                    <thead>\r\n                        <tr>\r\n                            <th>Month</th>\r\n                            <th class=\"text-right\">Income</th>\r\n                            <th class=\"text-right\">Expenses</th>\r\n                            <th class=\"text-right\">Net</th>\r\n                        </tr>\r\n                    </thead>\r\n                    <tbody>\r\n                        ${monthlyData.map((m: any) => `\r\n                            <tr>\r\n                                <td>${m.month}</td>\r\n                                <td class=\"text-right font-mono\">${formatCurrency(m.income)}</td>\r\n                                <td class=\"text-right font-mono\">${formatCurrency(m.expenses)}</td>\r\n                                <td class=\"text-right font-mono ${m.net > 0 ? 'text-green' : m.net < 0 ? 'text-red' : ''}\">${formatCurrency(m.net)}</td>\r\n                            </tr>\r\n                        `).join('')}\r\n                    </tbody>\r\n                    <tfoot>\r\n                        <tr>\r\n                            <th><strong>Totals</strong></th>\r\n                            <th class=\"text-right font-mono\"><strong>${formatCurrency(ytdIncome)}</strong></th>\r\n                            <th class=\"text-right font-mono\"><strong>${formatCurrency(ytdExpenses)}</strong></th>\r\n                            <th class=\"text-right font-mono ${ytdNet >= 0 ? 'text-green' : 'text-red'}\"><strong>${formatCurrency(ytdNet)}</strong></th>\r\n                        </tr>\r\n                    </tfoot>\r\n                </table>\r\n            `;"}},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":280,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":280,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11754,11757],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11754,11757],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":324,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":324,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13732,13735],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13732,13735],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"prefer-const","severity":2,"message":"'bodyHtml' is never reassigned. Use 'const' instead.","line":355,"column":17,"nodeType":"Identifier","messageId":"useConst","endLine":355,"endColumn":25,"fix":{"range":[14988,16243],"text":"const bodyHtml = `\r\n                <div class=\"kpi-row\">\r\n                    <div class=\"kpi-box\">\r\n                        <div class=\"kpi-title\">Total Monthly Cost (Active)</div>\r\n                        <div class=\"kpi-value font-mono\">${formatCurrency(totalMonthly)}</div>\r\n                    </div>\r\n                    <div class=\"kpi-box\">\r\n                        <div class=\"kpi-title\">Total Annual Cost (Active)</div>\r\n                        <div class=\"kpi-value font-mono\">${formatCurrency(totalAnnual)}</div>\r\n                    </div>\r\n                </div>\r\n\r\n                <h2>All Subscriptions</h2>\r\n                ${subs.length > 0 ? `\r\n                <table>\r\n                    <thead>\r\n                        <tr>\r\n                            <th>Name</th>\r\n                            <th>Provider</th>\r\n                            <th>Billing Cycle</th>\r\n                            <th class=\"text-right\">Amount</th>\r\n                            <th class=\"text-right\">Annual Cost</th>\r\n                        </tr>\r\n                    </thead>\r\n                    <tbody>\r\n                        ${rowsHtml}\r\n                    </tbody>\r\n                </table>` : '<p>No subscriptions found.</p>'}\r\n            `;"}},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":414,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":414,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17322,17325],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17322,17325],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":415,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":415,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17425,17428],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17425,17428],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":418,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":418,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17536,17539],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17536,17539],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":432,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":432,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18823,18826],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18823,18826],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":441,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":441,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19200,19203],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19200,19203],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"prefer-const","severity":2,"message":"'bodyHtml' is never reassigned. Use 'const' instead.","line":463,"column":17,"nodeType":"Identifier","messageId":"useConst","endLine":463,"endColumn":25,"fix":{"range":[20004,22610],"text":"const bodyHtml = `\r\n                <div class=\"kpi-row\">\r\n                    <div class=\"kpi-box\">\r\n                        <div class=\"kpi-title\">Total Payouts Received</div>\r\n                        <div class=\"kpi-value font-mono\">${formatCurrency(totalPayouts)}</div>\r\n                    </div>\r\n                    <div class=\"kpi-box\">\r\n                        <div class=\"kpi-title\">Total Prop Fees Paid</div>\r\n                        <div class=\"kpi-value font-mono\">${formatCurrency(totalFees)}</div>\r\n                    </div>\r\n                    <div class=\"kpi-box\">\r\n                        <div class=\"kpi-title\">Total Net Profitability</div>\r\n                        <div class=\"kpi-value font-mono ${totalNet >= 0 ? 'text-green' : 'text-red'}\">${formatCurrency(totalNet)}</div>\r\n                    </div>\r\n                </div>\r\n\r\n                <h2>Per Account Breakdown</h2>\r\n                ${rows.length > 0 ? `\r\n                <table>\r\n                    <thead>\r\n                        <tr>\r\n                            <th>Account</th>\r\n                            <th class=\"text-right\">Payouts Received</th>\r\n                            <th class=\"text-right\">Fees Paid</th>\r\n                            <th class=\"text-right\">Net Profit</th>\r\n                        </tr>\r\n                    </thead>\r\n                    <tbody>\r\n                        ${rows.map((r: any) => `\r\n                            <tr>\r\n                                <td>${r.name}</td>\r\n                                <td class=\"text-right font-mono\">${formatCurrency(r.payoutsReceived)}</td>\r\n                                <td class=\"text-right font-mono\">${formatCurrency(r.feesPaid)}</td>\r\n                                <td class=\"text-right font-mono ${r.net > 0 ? 'text-green' : r.net < 0 ? 'text-red' : ''}\">${formatCurrency(r.net)}</td>\r\n                            </tr>\r\n                        `).join('')}\r\n                    </tbody>\r\n                    <tfoot>\r\n                        <tr>\r\n                            <th><strong>Totals</strong></th>\r\n                            <th class=\"text-right font-mono\"><strong>${formatCurrency(totalPayouts)}</strong></th>\r\n                            <th class=\"text-right font-mono\"><strong>${formatCurrency(totalFees)}</strong></th>\r\n                            <th class=\"text-right font-mono ${totalNet >= 0 ? 'text-green' : 'text-red'}\"><strong>${formatCurrency(totalNet)}</strong></th>\r\n                        </tr>\r\n                    </tfoot>\r\n                </table>` : '<p>No data found.</p>'}\r\n            `;"}},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":491,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":491,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[21411,21414],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[21411,21414],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":22,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":4,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useState } from \"react\";\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle, CardFooter } from \"@/components/ui/card\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\r\nimport { FileText, Calendar, CreditCard, TrendingUp, Loader2 } from \"lucide-react\";\r\n\r\nexport function ReportsTab() {\r\n    const currentYear = new Date().getFullYear();\r\n    const currentMonth = new Date().getMonth() + 1; // 1-12\r\n\r\n    const [monthlyMonth, setMonthlyMonth] = useState(currentMonth.toString());\r\n    const [monthlyYear, setMonthlyYear] = useState(currentYear.toString());\r\n    const [yearlyYear, setYearlyYear] = useState(currentYear.toString());\r\n\r\n    const [isGenerating, setIsGenerating] = useState<string | null>(null);\r\n\r\n    const yearOptions = [currentYear, currentYear - 1, currentYear - 2, currentYear - 3];\r\n    const monthOptions = [\r\n        { value: \"1\", label: \"January\" }, { value: \"2\", label: \"February\" },\r\n        { value: \"3\", label: \"March\" }, { value: \"4\", label: \"April\" },\r\n        { value: \"5\", label: \"May\" }, { value: \"6\", label: \"June\" },\r\n        { value: \"7\", label: \"July\" }, { value: \"8\", label: \"August\" },\r\n        { value: \"9\", label: \"September\" }, { value: \"10\", label: \"October\" },\r\n        { value: \"11\", label: \"November\" }, { value: \"12\", label: \"December\" }\r\n    ];\r\n\r\n    const generateHtml = (title: string, bodyContent: string) => {\r\n        return `\r\n            <!DOCTYPE html>\r\n            <html>\r\n            <head>\r\n                <title>${title}</title>\r\n                <style>\r\n                    body {\r\n                        font-family: Arial, sans-serif;\r\n                        color: #000;\r\n                        background: #fff;\r\n                        padding: 40px;\r\n                        line-height: 1.6;\r\n                    }\r\n                    h1 { margin-bottom: 5px; }\r\n                    .date-generated { color: #666; margin-bottom: 30px; font-size: 0.9em; }\r\n                    table {\r\n                        width: 100%;\r\n                        border-collapse: collapse;\r\n                        margin-bottom: 30px;\r\n                    }\r\n                    th, td {\r\n                        border: 1px solid #ddd;\r\n                        padding: 12px;\r\n                        text-align: left;\r\n                    }\r\n                    th {\r\n                        background-color: #f8f9fa;\r\n                        font-weight: 600;\r\n                    }\r\n                    .kpi-row {\r\n                        display: flex;\r\n                        gap: 20px;\r\n                        margin-bottom: 30px;\r\n                    }\r\n                    .kpi-box {\r\n                        border: 1px solid #ddd;\r\n                        padding: 20px;\r\n                        flex: 1;\r\n                        border-radius: 6px;\r\n                    }\r\n                    .kpi-title {\r\n                        font-size: 0.9em;\r\n                        color: #666;\r\n                        text-transform: uppercase;\r\n                        margin-bottom: 5px;\r\n                    }\r\n                    .kpi-value {\r\n                        font-size: 1.5em;\r\n                        font-weight: bold;\r\n                    }\r\n                    .text-right { text-align: right; }\r\n                    .text-green { color: #16a34a; }\r\n                    .text-red { color: #dc2626; }\r\n                    .font-mono { font-family: monospace; }\r\n                </style>\r\n            </head>\r\n            <body>\r\n                <div class=\"print-report\">\r\n                    <h1>${title}</h1>\r\n                    <div class=\"date-generated\">Generated on ${new Date().toLocaleDateString()}</div>\r\n                    ${bodyContent}\r\n                </div>\r\n                <script>\r\n                    window.onload = () => {\r\n                        window.print();\r\n                    };\r\n                </script>\r\n            </body>\r\n            </html>\r\n        `;\r\n    };\r\n\r\n    const formatCurrency = (val: number) => {\r\n        return new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(val);\r\n    };\r\n\r\n    const handleMonthlySummary = async () => {\r\n        setIsGenerating(\"monthly\");\r\n        try {\r\n            const [expRes, payRes] = await Promise.all([\r\n                fetch(\"/api/finance/expenses\"),\r\n                fetch(\"/api/finance/payouts\")\r\n            ]);\r\n\r\n            const expJson = await expRes.json();\r\n            const payJson = await payRes.json();\r\n\r\n            const expenses = (expJson.data || []).filter((e: any) => {\r\n                const d = new Date(e.date);\r\n                return d.getFullYear() === parseInt(monthlyYear) && (d.getMonth() + 1) === parseInt(monthlyMonth);\r\n            });\r\n\r\n            const payouts = (payJson.data || []).filter((p: any) => {\r\n                const d = new Date(p.date);\r\n                return p.status === 'received' && d.getFullYear() === parseInt(monthlyYear) && (d.getMonth() + 1) === parseInt(monthlyMonth);\r\n            });\r\n\r\n            const totalIncome = payouts.reduce((sum: number, p: any) => sum + Number(p.amount), 0);\r\n            const totalExpenses = expenses.reduce((sum: number, e: any) => sum + Number(e.amount), 0);\r\n            const net = totalIncome - totalExpenses;\r\n\r\n            const monthName = monthOptions.find(m => m.value === monthlyMonth)?.label;\r\n\r\n            let bodyHtml = `\r\n                <div class=\"kpi-row\">\r\n                    <div class=\"kpi-box\">\r\n                        <div class=\"kpi-title\">Total Income</div>\r\n                        <div class=\"kpi-value font-mono\">${formatCurrency(totalIncome)}</div>\r\n                    </div>\r\n                    <div class=\"kpi-box\">\r\n                        <div class=\"kpi-title\">Total Expenses</div>\r\n                        <div class=\"kpi-value font-mono\">${formatCurrency(totalExpenses)}</div>\r\n                    </div>\r\n                    <div class=\"kpi-box\">\r\n                        <div class=\"kpi-title\">Net Profit</div>\r\n                        <div class=\"kpi-value font-mono ${net >= 0 ? 'text-green' : 'text-red'}\">${formatCurrency(net)}</div>\r\n                    </div>\r\n                </div>\r\n\r\n                <h2>Income (Payouts)</h2>\r\n                ${payouts.length > 0 ? `\r\n                <table>\r\n                    <thead>\r\n                        <tr>\r\n                            <th>Date</th>\r\n                            <th>Amount</th>\r\n                        </tr>\r\n                    </thead>\r\n                    <tbody>\r\n                        ${payouts.map((p: any) => `\r\n                            <tr>\r\n                                <td>${new Date(p.date).toLocaleDateString()}</td>\r\n                                <td class=\"font-mono\">${formatCurrency(Number(p.amount))}</td>\r\n                            </tr>\r\n                        `).join('')}\r\n                    </tbody>\r\n                </table>` : '<p>No income for this period.</p>'}\r\n\r\n                <h2>Expenses</h2>\r\n                ${expenses.length > 0 ? `\r\n                <table>\r\n                    <thead>\r\n                        <tr>\r\n                            <th>Date</th>\r\n                            <th>Vendor</th>\r\n                            <th>Category</th>\r\n                            <th>Description</th>\r\n                            <th>Amount</th>\r\n                        </tr>\r\n                    </thead>\r\n                    <tbody>\r\n                        ${expenses.map((e: any) => `\r\n                            <tr>\r\n                                <td>${new Date(e.date).toLocaleDateString()}</td>\r\n                                <td>${e.vendor || ''}</td>\r\n                                <td>${e.category}</td>\r\n                                <td>${e.description}</td>\r\n                                <td class=\"font-mono\">${formatCurrency(Number(e.amount))}</td>\r\n                            </tr>\r\n                        `).join('')}\r\n                    </tbody>\r\n                </table>` : '<p>No expenses for this period.</p>'}\r\n            `;\r\n\r\n            const html = generateHtml(`Monthly Financial Summary — ${monthName} ${monthlyYear}`, bodyHtml);\r\n            const win = window.open('', '_blank');\r\n            if (win) {\r\n                win.document.write(html);\r\n                win.document.close();\r\n            }\r\n        } catch (error) {\r\n            console.error(\"Failed to generate report\", error);\r\n        } finally {\r\n            setIsGenerating(null);\r\n        }\r\n    };\r\n\r\n    const handleYearlySummary = async () => {\r\n        setIsGenerating(\"yearly\");\r\n        try {\r\n            const [expRes, payRes] = await Promise.all([\r\n                fetch(\"/api/finance/expenses\"),\r\n                fetch(\"/api/finance/payouts\")\r\n            ]);\r\n\r\n            const expJson = await expRes.json();\r\n            const payJson = await payRes.json();\r\n\r\n            const yearNum = parseInt(yearlyYear);\r\n\r\n            const expenses = (expJson.data || []).filter((e: any) => {\r\n                return new Date(e.date).getFullYear() === yearNum;\r\n            });\r\n\r\n            const payouts = (payJson.data || []).filter((p: any) => {\r\n                return p.status === 'received' && new Date(p.date).getFullYear() === yearNum;\r\n            });\r\n\r\n            const monthlyData = Array.from({ length: 12 }, (_, i) => ({\r\n                month: monthOptions[i].label,\r\n                income: 0,\r\n                expenses: 0,\r\n                net: 0\r\n            }));\r\n\r\n            expenses.forEach((e: any) => {\r\n                const m = new Date(e.date).getMonth();\r\n                monthlyData[m].expenses += Number(e.amount);\r\n            });\r\n\r\n            payouts.forEach((p: any) => {\r\n                const m = new Date(p.date).getMonth();\r\n                monthlyData[m].income += Number(p.amount);\r\n            });\r\n\r\n            monthlyData.forEach(m => {\r\n                m.net = m.income - m.expenses;\r\n            });\r\n\r\n            const ytdIncome = monthlyData.reduce((sum, m) => sum + m.income, 0);\r\n            const ytdExpenses = monthlyData.reduce((sum, m) => sum + m.expenses, 0);\r\n            const ytdNet = ytdIncome - ytdExpenses;\r\n\r\n            let bodyHtml = `\r\n                <div class=\"kpi-row\">\r\n                    <div class=\"kpi-box\">\r\n                        <div class=\"kpi-title\">YTD Total Income</div>\r\n                        <div class=\"kpi-value font-mono\">${formatCurrency(ytdIncome)}</div>\r\n                    </div>\r\n                    <div class=\"kpi-box\">\r\n                        <div class=\"kpi-title\">YTD Total Expenses</div>\r\n                        <div class=\"kpi-value font-mono\">${formatCurrency(ytdExpenses)}</div>\r\n                    </div>\r\n                    <div class=\"kpi-box\">\r\n                        <div class=\"kpi-title\">YTD Net Profit</div>\r\n                        <div class=\"kpi-value font-mono ${ytdNet >= 0 ? 'text-green' : 'text-red'}\">${formatCurrency(ytdNet)}</div>\r\n                    </div>\r\n                </div>\r\n\r\n                <h2>Month by Month Breakdown</h2>\r\n                <table>\r\n                    <thead>\r\n                        <tr>\r\n                            <th>Month</th>\r\n                            <th class=\"text-right\">Income</th>\r\n                            <th class=\"text-right\">Expenses</th>\r\n                            <th class=\"text-right\">Net</th>\r\n                        </tr>\r\n                    </thead>\r\n                    <tbody>\r\n                        ${monthlyData.map((m: any) => `\r\n                            <tr>\r\n                                <td>${m.month}</td>\r\n                                <td class=\"text-right font-mono\">${formatCurrency(m.income)}</td>\r\n                                <td class=\"text-right font-mono\">${formatCurrency(m.expenses)}</td>\r\n                                <td class=\"text-right font-mono ${m.net > 0 ? 'text-green' : m.net < 0 ? 'text-red' : ''}\">${formatCurrency(m.net)}</td>\r\n                            </tr>\r\n                        `).join('')}\r\n                    </tbody>\r\n                    <tfoot>\r\n                        <tr>\r\n                            <th><strong>Totals</strong></th>\r\n                            <th class=\"text-right font-mono\"><strong>${formatCurrency(ytdIncome)}</strong></th>\r\n                            <th class=\"text-right font-mono\"><strong>${formatCurrency(ytdExpenses)}</strong></th>\r\n                            <th class=\"text-right font-mono ${ytdNet >= 0 ? 'text-green' : 'text-red'}\"><strong>${formatCurrency(ytdNet)}</strong></th>\r\n                        </tr>\r\n                    </tfoot>\r\n                </table>\r\n            `;\r\n\r\n            const html = generateHtml(`Yearly Financial Summary — ${yearlyYear}`, bodyHtml);\r\n            const win = window.open('', '_blank');\r\n            if (win) {\r\n                win.document.write(html);\r\n                win.document.close();\r\n            }\r\n        } catch (error) {\r\n            console.error(\"Failed to generate report\", error);\r\n        } finally {\r\n            setIsGenerating(null);\r\n        }\r\n    };\r\n\r\n    const handleSubscriptionAudit = async () => {\r\n        setIsGenerating(\"subscription\");\r\n        try {\r\n            const res = await fetch(\"/api/finance/subscriptions\");\r\n            const json = await res.json();\r\n\r\n            const subs = json.data || [];\r\n\r\n            let totalMonthly = 0;\r\n            let totalAnnual = 0;\r\n\r\n            const rowsHtml = subs.map((s: any) => {\r\n                const amt = Number(s.amount);\r\n                let monthlyCost = 0;\r\n                let annualCost = 0;\r\n                if (s.billing_cycle === 'monthly') {\r\n                    monthlyCost = amt;\r\n                    annualCost = amt * 12;\r\n                } else if (s.billing_cycle === 'yearly') {\r\n                    monthlyCost = amt / 12;\r\n                    annualCost = amt;\r\n                } else if (s.billing_cycle === 'quarterly') {\r\n                    monthlyCost = amt / 3;\r\n                    annualCost = amt * 4;\r\n                }\r\n\r\n                if (s.status === 'active') {\r\n                    totalMonthly += monthlyCost;\r\n                    totalAnnual += annualCost;\r\n                }\r\n\r\n                return `\r\n                    <tr>\r\n                        <td>${s.name}</td>\r\n                        <td>${s.provider || ''}</td>\r\n                        <td style=\"text-transform: capitalize;\">${s.billing_cycle}</td>\r\n                        <td class=\"text-right font-mono\">${formatCurrency(amt)}</td>\r\n                        <td class=\"text-right font-mono\">${formatCurrency(annualCost)}</td>\r\n                    </tr>\r\n                `;\r\n            }).join('');\r\n\r\n            let bodyHtml = `\r\n                <div class=\"kpi-row\">\r\n                    <div class=\"kpi-box\">\r\n                        <div class=\"kpi-title\">Total Monthly Cost (Active)</div>\r\n                        <div class=\"kpi-value font-mono\">${formatCurrency(totalMonthly)}</div>\r\n                    </div>\r\n                    <div class=\"kpi-box\">\r\n                        <div class=\"kpi-title\">Total Annual Cost (Active)</div>\r\n                        <div class=\"kpi-value font-mono\">${formatCurrency(totalAnnual)}</div>\r\n                    </div>\r\n                </div>\r\n\r\n                <h2>All Subscriptions</h2>\r\n                ${subs.length > 0 ? `\r\n                <table>\r\n                    <thead>\r\n                        <tr>\r\n                            <th>Name</th>\r\n                            <th>Provider</th>\r\n                            <th>Billing Cycle</th>\r\n                            <th class=\"text-right\">Amount</th>\r\n                            <th class=\"text-right\">Annual Cost</th>\r\n                        </tr>\r\n                    </thead>\r\n                    <tbody>\r\n                        ${rowsHtml}\r\n                    </tbody>\r\n                </table>` : '<p>No subscriptions found.</p>'}\r\n            `;\r\n\r\n            const html = generateHtml(`Subscription Audit`, bodyHtml);\r\n            const win = window.open('', '_blank');\r\n            if (win) {\r\n                win.document.write(html);\r\n                win.document.close();\r\n            }\r\n        } catch (error) {\r\n            console.error(\"Failed to generate report\", error);\r\n        } finally {\r\n            setIsGenerating(null);\r\n        }\r\n    };\r\n\r\n    const handlePropFirmProfitability = async () => {\r\n        setIsGenerating(\"prop_firm\");\r\n        try {\r\n            const [expRes, payRes, accRes] = await Promise.all([\r\n                fetch(\"/api/finance/expenses\"),\r\n                fetch(\"/api/finance/payouts\"),\r\n                fetch(\"/api/accounts\")\r\n            ]);\r\n\r\n            const expJson = await expRes.json();\r\n            const payJson = await payRes.json();\r\n            const accJson = await accRes.json();\r\n\r\n            // The account objects are in { accounts: [] } \r\n            const accounts = accJson.accounts || [];\r\n\r\n            const expenses = (expJson.data || []).filter((e: any) => e.category === 'Prop Firm Fees');\r\n            const payouts = (payJson.data || []).filter((p: any) => p.status === 'received');\r\n\r\n            const accMap = new Map();\r\n            accounts.forEach((acc: any) => {\r\n                accMap.set(acc.id, { name: acc.name, payoutsReceived: 0, feesPaid: 0, net: 0 });\r\n            });\r\n            // We also need a catch-all for unnamed accounts\r\n            accMap.set('unknown', { name: 'Other/Unknown Account', payoutsReceived: 0, feesPaid: 0, net: 0 });\r\n\r\n            // Count fees? Currently, expenses are not tied directly to an account in the schema except maybe if we added an account_id \r\n            // The prompt says: fetch GET /api/finance/payouts and GET /api/finance/expenses (filter category = Prop Firm Fees)\r\n            // But wait, the expenses table doesn't have an account_id. Or does it?\r\n            // Actually, expenses table might not have account_id. If a fee is paid, maybe put it to \"Overall\" or if we do have account_id, group by it. Let's just sum it.\r\n            // Wait, looking at schema (I don't have it explicitly open, but I can assume expenses have an account_id nullable, or maybe we just group payouts by account and put ALL fees to one pool?)\r\n\r\n            // Wait, \"Per account table: account name, total payouts received, prop fees paid ... \" \r\n            // I'll group by account_id for both if possible. If an expense doesn't have account_id, assign to unknown.\r\n            expenses.forEach((e: any) => {\r\n                const id = e.account_id || 'unknown';\r\n                if (!accMap.has(id)) {\r\n                    accMap.set(id, { name: 'Unknown', payoutsReceived: 0, feesPaid: 0, net: 0 });\r\n                }\r\n                const record = accMap.get(id);\r\n                record.feesPaid += Number(e.amount);\r\n            });\r\n\r\n            payouts.forEach((p: any) => {\r\n                const id = p.account_id || 'unknown';\r\n                if (!accMap.has(id)) {\r\n                    accMap.set(id, { name: 'Unknown', payoutsReceived: 0, feesPaid: 0, net: 0 });\r\n                }\r\n                const record = accMap.get(id);\r\n                record.payoutsReceived += Number(p.amount);\r\n            });\r\n\r\n            const rows = Array.from(accMap.values()).filter(r => r.payoutsReceived > 0 || r.feesPaid > 0);\r\n\r\n            let totalPayouts = 0;\r\n            let totalFees = 0;\r\n\r\n            rows.forEach(r => {\r\n                r.net = r.payoutsReceived - r.feesPaid;\r\n                totalPayouts += r.payoutsReceived;\r\n                totalFees += r.feesPaid;\r\n            });\r\n\r\n            const totalNet = totalPayouts - totalFees;\r\n\r\n            let bodyHtml = `\r\n                <div class=\"kpi-row\">\r\n                    <div class=\"kpi-box\">\r\n                        <div class=\"kpi-title\">Total Payouts Received</div>\r\n                        <div class=\"kpi-value font-mono\">${formatCurrency(totalPayouts)}</div>\r\n                    </div>\r\n                    <div class=\"kpi-box\">\r\n                        <div class=\"kpi-title\">Total Prop Fees Paid</div>\r\n                        <div class=\"kpi-value font-mono\">${formatCurrency(totalFees)}</div>\r\n                    </div>\r\n                    <div class=\"kpi-box\">\r\n                        <div class=\"kpi-title\">Total Net Profitability</div>\r\n                        <div class=\"kpi-value font-mono ${totalNet >= 0 ? 'text-green' : 'text-red'}\">${formatCurrency(totalNet)}</div>\r\n                    </div>\r\n                </div>\r\n\r\n                <h2>Per Account Breakdown</h2>\r\n                ${rows.length > 0 ? `\r\n                <table>\r\n                    <thead>\r\n                        <tr>\r\n                            <th>Account</th>\r\n                            <th class=\"text-right\">Payouts Received</th>\r\n                            <th class=\"text-right\">Fees Paid</th>\r\n                            <th class=\"text-right\">Net Profit</th>\r\n                        </tr>\r\n                    </thead>\r\n                    <tbody>\r\n                        ${rows.map((r: any) => `\r\n                            <tr>\r\n                                <td>${r.name}</td>\r\n                                <td class=\"text-right font-mono\">${formatCurrency(r.payoutsReceived)}</td>\r\n                                <td class=\"text-right font-mono\">${formatCurrency(r.feesPaid)}</td>\r\n                                <td class=\"text-right font-mono ${r.net > 0 ? 'text-green' : r.net < 0 ? 'text-red' : ''}\">${formatCurrency(r.net)}</td>\r\n                            </tr>\r\n                        `).join('')}\r\n                    </tbody>\r\n                    <tfoot>\r\n                        <tr>\r\n                            <th><strong>Totals</strong></th>\r\n                            <th class=\"text-right font-mono\"><strong>${formatCurrency(totalPayouts)}</strong></th>\r\n                            <th class=\"text-right font-mono\"><strong>${formatCurrency(totalFees)}</strong></th>\r\n                            <th class=\"text-right font-mono ${totalNet >= 0 ? 'text-green' : 'text-red'}\"><strong>${formatCurrency(totalNet)}</strong></th>\r\n                        </tr>\r\n                    </tfoot>\r\n                </table>` : '<p>No data found.</p>'}\r\n            `;\r\n\r\n            const html = generateHtml(`Prop Firm Profitability Report`, bodyHtml);\r\n            const win = window.open('', '_blank');\r\n            if (win) {\r\n                win.document.write(html);\r\n                win.document.close();\r\n            }\r\n        } catch (error) {\r\n            console.error(\"Failed to generate report\", error);\r\n        } finally {\r\n            setIsGenerating(null);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"grid gap-4 md:grid-cols-2\">\r\n\r\n            {/* Card 1: Monthly Financial Summary */}\r\n            <Card className=\"flex flex-col\">\r\n                <CardHeader>\r\n                    <div className=\"flex items-center gap-2\">\r\n                        <FileText className=\"h-5 w-5 text-muted-foreground\" />\r\n                        <CardTitle className=\"text-lg\">Monthly Financial Summary</CardTitle>\r\n                    </div>\r\n                    <CardDescription>\r\n                        Complete breakdown of income, expenses, and net for a selected month\r\n                    </CardDescription>\r\n                </CardHeader>\r\n                <CardContent className=\"flex-1 space-y-4\">\r\n                    <div className=\"grid grid-cols-2 gap-4\">\r\n                        <div className=\"space-y-2\">\r\n                            <label className=\"text-sm font-medium\">Month</label>\r\n                            <Select value={monthlyMonth} onValueChange={setMonthlyMonth}>\r\n                                <SelectTrigger>\r\n                                    <SelectValue placeholder=\"Select month\" />\r\n                                </SelectTrigger>\r\n                                <SelectContent>\r\n                                    {monthOptions.map((m) => (\r\n                                        <SelectItem key={m.value} value={m.value}>{m.label}</SelectItem>\r\n                                    ))}\r\n                                </SelectContent>\r\n                            </Select>\r\n                        </div>\r\n                        <div className=\"space-y-2\">\r\n                            <label className=\"text-sm font-medium\">Year</label>\r\n                            <Select value={monthlyYear} onValueChange={setMonthlyYear}>\r\n                                <SelectTrigger>\r\n                                    <SelectValue placeholder=\"Select year\" />\r\n                                </SelectTrigger>\r\n                                <SelectContent>\r\n                                    {yearOptions.map((y) => (\r\n                                        <SelectItem key={y} value={y.toString()}>{y}</SelectItem>\r\n                                    ))}\r\n                                </SelectContent>\r\n                            </Select>\r\n                        </div>\r\n                    </div>\r\n                </CardContent>\r\n                <CardFooter>\r\n                    <Button\r\n                        onClick={handleMonthlySummary}\r\n                        disabled={isGenerating !== null}\r\n                        className=\"w-full\"\r\n                    >\r\n                        {isGenerating === \"monthly\" && <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />}\r\n                        Generate & Download\r\n                    </Button>\r\n                </CardFooter>\r\n            </Card>\r\n\r\n            {/* Card 2: Yearly Financial Summary */}\r\n            <Card className=\"flex flex-col\">\r\n                <CardHeader>\r\n                    <div className=\"flex items-center gap-2\">\r\n                        <Calendar className=\"h-5 w-5 text-muted-foreground\" />\r\n                        <CardTitle className=\"text-lg\">Yearly Financial Summary</CardTitle>\r\n                    </div>\r\n                    <CardDescription>\r\n                        Annual overview of all financial activity and ROI\r\n                    </CardDescription>\r\n                </CardHeader>\r\n                <CardContent className=\"flex-1 space-y-4\">\r\n                    <div className=\"space-y-2\">\r\n                        <label className=\"text-sm font-medium\">Year</label>\r\n                        <Select value={yearlyYear} onValueChange={setYearlyYear}>\r\n                            <SelectTrigger>\r\n                                <SelectValue placeholder=\"Select year\" />\r\n                            </SelectTrigger>\r\n                            <SelectContent>\r\n                                {yearOptions.map((y) => (\r\n                                    <SelectItem key={y} value={y.toString()}>{y}</SelectItem>\r\n                                ))}\r\n                            </SelectContent>\r\n                        </Select>\r\n                    </div>\r\n                </CardContent>\r\n                <CardFooter className=\"mt-auto\">\r\n                    <Button\r\n                        onClick={handleYearlySummary}\r\n                        disabled={isGenerating !== null}\r\n                        className=\"w-full\"\r\n                    >\r\n                        {isGenerating === \"yearly\" && <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />}\r\n                        Generate & Download\r\n                    </Button>\r\n                </CardFooter>\r\n            </Card>\r\n\r\n            {/* Card 3: Subscription Audit */}\r\n            <Card className=\"flex flex-col\">\r\n                <CardHeader>\r\n                    <div className=\"flex items-center gap-2\">\r\n                        <CreditCard className=\"h-5 w-5 text-muted-foreground\" />\r\n                        <CardTitle className=\"text-lg\">Subscription Audit</CardTitle>\r\n                    </div>\r\n                    <CardDescription>\r\n                        Full list of active subscriptions with annual cost analysis\r\n                    </CardDescription>\r\n                </CardHeader>\r\n                <CardContent className=\"flex-1\">\r\n                    {/* No input needed */}\r\n                </CardContent>\r\n                <CardFooter>\r\n                    <Button\r\n                        onClick={handleSubscriptionAudit}\r\n                        disabled={isGenerating !== null}\r\n                        className=\"w-full mt-auto\"\r\n                    >\r\n                        {isGenerating === \"subscription\" && <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />}\r\n                        Generate & Download\r\n                    </Button>\r\n                </CardFooter>\r\n            </Card>\r\n\r\n            {/* Card 4: Prop Firm Profitability */}\r\n            <Card className=\"flex flex-col\">\r\n                <CardHeader>\r\n                    <div className=\"flex items-center gap-2\">\r\n                        <TrendingUp className=\"h-5 w-5 text-muted-foreground\" />\r\n                        <CardTitle className=\"text-lg\">Prop Firm Profitability</CardTitle>\r\n                    </div>\r\n                    <CardDescription>\r\n                        Per-account revenue vs fees and net profitability\r\n                    </CardDescription>\r\n                </CardHeader>\r\n                <CardContent className=\"flex-1\">\r\n                    {/* No input needed */}\r\n                </CardContent>\r\n                <CardFooter>\r\n                    <Button\r\n                        onClick={handlePropFirmProfitability}\r\n                        disabled={isGenerating !== null}\r\n                        className=\"w-full mt-auto\"\r\n                    >\r\n                        {isGenerating === \"prop_firm\" && <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />}\r\n                        Generate & Download\r\n                    </Button>\r\n                </CardFooter>\r\n            </Card>\r\n\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\components\\finance\\settings-tab.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CardFooter' is defined but never used.","line":5,"column":69,"nodeType":"Identifier","messageId":"unusedVar","endLine":5,"endColumn":79,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"CardFooter"},"fix":{"range":[224,236],"text":""},"desc":"Remove unused variable \"CardFooter\"."}]},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\components\\finance\\settings-tab.tsx:33:13\n  31 |     useEffect(() => {\n  32 |         if (settings) {\n> 33 |             setFiscalYearStart(settings.fiscal_year_start?.toString() || \"1\");\n     |             ^^^^^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  34 |             setVendorPresets(settings.vendor_presets || []);\n  35 |             setCustomTags(settings.custom_tags || []);\n  36 |         }","line":33,"column":13,"nodeType":null,"endLine":33,"endColumn":31}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useState, KeyboardEvent, useEffect } from \"react\";\r\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle, CardFooter } from \"@/components/ui/card\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Loader2, X } from \"lucide-react\";\r\n\r\nexport function SettingsTab() {\r\n    const queryClient = useQueryClient();\r\n\r\n    const [fiscalYearStart, setFiscalYearStart] = useState(\"1\");\r\n    const [vendorPresets, setVendorPresets] = useState<string[]>([]);\r\n    const [customTags, setCustomTags] = useState<string[]>([]);\r\n\r\n    const [vendorInput, setVendorInput] = useState(\"\");\r\n    const [tagInput, setTagInput] = useState(\"\");\r\n\r\n    const { data: settings, isLoading } = useQuery({\r\n        queryKey: [\"finance\", \"settings\"],\r\n        queryFn: async () => {\r\n            const res = await fetch(\"/api/finance/settings\");\r\n            if (!res.ok) throw new Error(\"Failed to fetch settings\");\r\n            const json = await res.json();\r\n            return json.data;\r\n        }\r\n    });\r\n\r\n    useEffect(() => {\r\n        if (settings) {\r\n            setFiscalYearStart(settings.fiscal_year_start?.toString() || \"1\");\r\n            setVendorPresets(settings.vendor_presets || []);\r\n            setCustomTags(settings.custom_tags || []);\r\n        }\r\n    }, [settings]);\r\n\r\n    const mutation = useMutation({\r\n        mutationFn: async () => {\r\n            const res = await fetch(\"/api/finance/settings\", {\r\n                method: \"POST\",\r\n                headers: { \"Content-Type\": \"application/json\" },\r\n                body: JSON.stringify({\r\n                    fiscal_year_start: parseInt(fiscalYearStart),\r\n                    vendor_presets: vendorPresets,\r\n                    custom_tags: customTags\r\n                })\r\n            });\r\n            if (!res.ok) throw new Error(\"Failed to save settings\");\r\n            return res.json();\r\n        },\r\n        onSuccess: () => {\r\n            queryClient.invalidateQueries({ queryKey: [\"finance\", \"settings\"] });\r\n            alert(\"Settings saved successfully.\");\r\n        },\r\n        onError: () => {\r\n            alert(\"Failed to save settings. Please try again.\");\r\n        }\r\n    });\r\n\r\n    const handleVendorKeyDown = (e: KeyboardEvent<HTMLInputElement>) => {\r\n        if (e.key === \"Enter\" && vendorInput.trim()) {\r\n            e.preventDefault();\r\n            if (!vendorPresets.includes(vendorInput.trim())) {\r\n                setVendorPresets([...vendorPresets, vendorInput.trim()]);\r\n            }\r\n            setVendorInput(\"\");\r\n        }\r\n    };\r\n\r\n    const removeVendor = (vendor: string) => {\r\n        setVendorPresets(vendorPresets.filter(v => v !== vendor));\r\n    };\r\n\r\n    const handleTagKeyDown = (e: KeyboardEvent<HTMLInputElement>) => {\r\n        if (e.key === \"Enter\" && tagInput.trim()) {\r\n            e.preventDefault();\r\n            if (!customTags.includes(tagInput.trim())) {\r\n                setCustomTags([...customTags, tagInput.trim()]);\r\n            }\r\n            setTagInput(\"\");\r\n        }\r\n    };\r\n\r\n    const removeTag = (tag: string) => {\r\n        setCustomTags(customTags.filter(t => t !== tag));\r\n    };\r\n\r\n    if (isLoading) {\r\n        return (\r\n            <div className=\"flex items-center justify-center py-10\">\r\n                <Loader2 className=\"h-8 w-8 animate-spin text-muted-foreground\" />\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div className=\"space-y-6 max-w-4xl\">\r\n            <Card>\r\n                <CardHeader>\r\n                    <CardTitle>General</CardTitle>\r\n                    <CardDescription>Basic configurations for your financial data</CardDescription>\r\n                </CardHeader>\r\n                <CardContent className=\"space-y-4\">\r\n                    <div className=\"space-y-2 max-w-md\">\r\n                        <label className=\"text-sm font-medium\">Fiscal Year Start Month</label>\r\n                        <Select value={fiscalYearStart} onValueChange={setFiscalYearStart}>\r\n                            <SelectTrigger>\r\n                                <SelectValue placeholder=\"Select month\" />\r\n                            </SelectTrigger>\r\n                            <SelectContent>\r\n                                <SelectItem value=\"1\">January</SelectItem>\r\n                                <SelectItem value=\"2\">February</SelectItem>\r\n                                <SelectItem value=\"3\">March</SelectItem>\r\n                                <SelectItem value=\"4\">April</SelectItem>\r\n                                <SelectItem value=\"5\">May</SelectItem>\r\n                                <SelectItem value=\"6\">June</SelectItem>\r\n                                <SelectItem value=\"7\">July</SelectItem>\r\n                                <SelectItem value=\"8\">August</SelectItem>\r\n                                <SelectItem value=\"9\">September</SelectItem>\r\n                                <SelectItem value=\"10\">October</SelectItem>\r\n                                <SelectItem value=\"11\">November</SelectItem>\r\n                                <SelectItem value=\"12\">December</SelectItem>\r\n                            </SelectContent>\r\n                        </Select>\r\n                        <p className=\"text-sm text-muted-foreground\">Used to calculate YTD figures.</p>\r\n                    </div>\r\n                </CardContent>\r\n            </Card>\r\n\r\n            <Card>\r\n                <CardHeader>\r\n                    <CardTitle>Expense Entry</CardTitle>\r\n                    <CardDescription>Presets to speed up manual data entry</CardDescription>\r\n                </CardHeader>\r\n                <CardContent className=\"space-y-6\">\r\n                    <div className=\"space-y-2\">\r\n                        <label className=\"text-sm font-medium\">Vendor Presets</label>\r\n                        <Input\r\n                            value={vendorInput}\r\n                            onChange={(e) => setVendorInput(e.target.value)}\r\n                            onKeyDown={handleVendorKeyDown}\r\n                            placeholder=\"Type a vendor and press Enter\"\r\n                        />\r\n                        <p className=\"text-sm text-muted-foreground\">These appear as suggestions when adding expenses.</p>\r\n\r\n                        {vendorPresets.length > 0 && (\r\n                            <div className=\"flex flex-wrap gap-2 mt-3\">\r\n                                {vendorPresets.map(vendor => (\r\n                                    <div key={vendor} className=\"flex items-center gap-1 bg-secondary text-secondary-foreground px-3 py-1 rounded-full text-sm\">\r\n                                        <span>{vendor}</span>\r\n                                        <button onClick={() => removeVendor(vendor)} className=\"hover:bg-muted p-0.5 rounded-full transition-colors ml-1\">\r\n                                            <X className=\"h-3 w-3\" />\r\n                                        </button>\r\n                                    </div>\r\n                                ))}\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n\r\n                    <div className=\"space-y-2\">\r\n                        <label className=\"text-sm font-medium\">Custom Tags</label>\r\n                        <Input\r\n                            value={tagInput}\r\n                            onChange={(e) => setTagInput(e.target.value)}\r\n                            onKeyDown={handleTagKeyDown}\r\n                            placeholder=\"Type a tag and press Enter\"\r\n                        />\r\n                        <p className=\"text-sm text-muted-foreground\">Custom tags for organizing and filtering expenses.</p>\r\n\r\n                        {customTags.length > 0 && (\r\n                            <div className=\"flex flex-wrap gap-2 mt-3\">\r\n                                {customTags.map(tag => (\r\n                                    <div key={tag} className=\"flex items-center gap-1 bg-secondary text-secondary-foreground px-3 py-1 rounded-full text-sm\">\r\n                                        <span>{tag}</span>\r\n                                        <button onClick={() => removeTag(tag)} className=\"hover:bg-muted p-0.5 rounded-full transition-colors ml-1\">\r\n                                            <X className=\"h-3 w-3\" />\r\n                                        </button>\r\n                                    </div>\r\n                                ))}\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                </CardContent>\r\n            </Card>\r\n\r\n            <div className=\"flex justify-start\">\r\n                <Button\r\n                    onClick={() => mutation.mutate()}\r\n                    disabled={mutation.isPending}\r\n                >\r\n                    {mutation.isPending && <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />}\r\n                    Save Settings\r\n                </Button>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\components\\finance\\subscriptions-tab.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":56,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":56,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2644,2647],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2644,2647],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":72,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":72,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3268,3271],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3268,3271],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useState } from \"react\";\r\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\r\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Label } from \"@/components/ui/label\";\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\r\nimport { Switch } from \"@/components/ui/switch\";\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\r\nimport { AlertDialog, AlertDialogAction, AlertDialogCancel, AlertDialogContent, AlertDialogDescription, AlertDialogFooter, AlertDialogHeader, AlertDialogTitle } from \"@/components/ui/alert-dialog\";\r\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\r\nimport { Skeleton } from \"@/components/ui/skeleton\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { Pencil, Trash2, Power, Loader2, Plus } from \"lucide-react\";\r\n\r\ntype Subscription = {\r\n    id: string;\r\n    name: string;\r\n    provider: string | null;\r\n    amount: number;\r\n    billing_cycle: \"monthly\" | \"yearly\" | \"weekly\";\r\n    next_billing_date: string | null;\r\n    category: string | null;\r\n    is_active: boolean;\r\n};\r\n\r\nexport function SubscriptionsTab() {\r\n    const queryClient = useQueryClient();\r\n    const [isDialogOpen, setIsDialogOpen] = useState(false);\r\n    const [isDeleteDialogOpen, setIsDeleteDialogOpen] = useState(false);\r\n    const [selectedSubscription, setSelectedSubscription] = useState<Subscription | null>(null);\r\n    const [subscriptionToDelete, setSubscriptionToDelete] = useState<string | null>(null);\r\n\r\n    // Form State\r\n    const [name, setName] = useState(\"\");\r\n    const [provider, setProvider] = useState(\"\");\r\n    const [amount, setAmount] = useState(\"\");\r\n    const [billingCycle, setBillingCycle] = useState(\"monthly\");\r\n    const [nextBillingDate, setNextBillingDate] = useState(\"\");\r\n    const [category, setCategory] = useState(\"\");\r\n    const [isActive, setIsActive] = useState(true);\r\n\r\n    const { data: subscriptions, isLoading } = useQuery({\r\n        queryKey: [\"finance\", \"subscriptions\"],\r\n        queryFn: async () => {\r\n            const res = await fetch(\"/api/finance/subscriptions\");\r\n            if (!res.ok) throw new Error(\"Failed to fetch subscriptions\");\r\n            const json = await res.json();\r\n            return json.data as Subscription[];\r\n        }\r\n    });\r\n\r\n    const createMutation = useMutation({\r\n        mutationFn: async (newSub: any) => {\r\n            const res = await fetch(\"/api/finance/subscriptions\", {\r\n                method: \"POST\",\r\n                headers: { \"Content-Type\": \"application/json\" },\r\n                body: JSON.stringify(newSub),\r\n            });\r\n            if (!res.ok) throw new Error(\"Failed to create subscription\");\r\n            return res.json();\r\n        },\r\n        onSuccess: () => {\r\n            queryClient.invalidateQueries({ queryKey: [\"finance\"] });\r\n            setIsDialogOpen(false);\r\n        }\r\n    });\r\n\r\n    const updateMutation = useMutation({\r\n        mutationFn: async ({ id, data }: { id: string, data: any }) => {\r\n            const res = await fetch(`/api/finance/subscriptions/${id}`, {\r\n                method: \"PATCH\",\r\n                headers: { \"Content-Type\": \"application/json\" },\r\n                body: JSON.stringify(data),\r\n            });\r\n            if (!res.ok) throw new Error(\"Failed to update subscription\");\r\n            return res.json();\r\n        },\r\n        onSuccess: () => {\r\n            queryClient.invalidateQueries({ queryKey: [\"finance\"] });\r\n            setIsDialogOpen(false);\r\n        }\r\n    });\r\n\r\n    const deleteMutation = useMutation({\r\n        mutationFn: async (id: string) => {\r\n            const res = await fetch(`/api/finance/subscriptions/${id}`, {\r\n                method: \"DELETE\",\r\n            });\r\n            if (!res.ok) throw new Error(\"Failed to delete subscription\");\r\n            return res.json();\r\n        },\r\n        onSuccess: () => {\r\n            queryClient.invalidateQueries({ queryKey: [\"finance\"] });\r\n            setIsDeleteDialogOpen(false);\r\n        }\r\n    });\r\n\r\n    const handleSubmit = (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        const payload = {\r\n            name,\r\n            provider,\r\n            amount: parseFloat(amount),\r\n            billing_cycle: billingCycle,\r\n            next_billing_date: nextBillingDate || null,\r\n            category,\r\n            is_active: isActive\r\n        };\r\n\r\n        if (selectedSubscription) {\r\n            updateMutation.mutate({ id: selectedSubscription.id, data: payload });\r\n        } else {\r\n            createMutation.mutate(payload);\r\n        }\r\n    };\r\n\r\n    const handleEdit = (sub: Subscription) => {\r\n        setSelectedSubscription(sub);\r\n        setName(sub.name);\r\n        setProvider(sub.provider || \"\");\r\n        setAmount(sub.amount.toString());\r\n        setBillingCycle(sub.billing_cycle);\r\n        setNextBillingDate(sub.next_billing_date || \"\");\r\n        setCategory(sub.category || \"\");\r\n        setIsActive(sub.is_active);\r\n        setIsDialogOpen(true);\r\n    };\r\n\r\n    const handleAddNew = () => {\r\n        setSelectedSubscription(null);\r\n        setName(\"\");\r\n        setProvider(\"\");\r\n        setAmount(\"\");\r\n        setBillingCycle(\"monthly\");\r\n        setNextBillingDate(\"\");\r\n        setCategory(\"\");\r\n        setIsActive(true);\r\n        setIsDialogOpen(true);\r\n    };\r\n\r\n    const handleToggleActive = (sub: Subscription) => {\r\n        updateMutation.mutate({ id: sub.id, data: { is_active: !sub.is_active } });\r\n    };\r\n\r\n    if (isLoading) {\r\n        return (\r\n            <div className=\"space-y-4\">\r\n                <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-4\">\r\n                    {[...Array(4)].map((_, i) => <Skeleton key={i} className=\"h-24 w-full rounded-xl\" />)}\r\n                </div>\r\n                <Skeleton className=\"h-[400px] w-full rounded-xl\" />\r\n            </div>\r\n        );\r\n    }\r\n\r\n    const data = subscriptions || [];\r\n\r\n    const getMonthlyCost = (amount: number, cycle: string) => {\r\n        if (cycle === 'yearly') return amount / 12;\r\n        if (cycle === 'weekly') return amount * 4.33;\r\n        return amount; // monthly\r\n    };\r\n\r\n    const formatCurrency = (val: number) => {\r\n        return new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(val);\r\n    };\r\n\r\n    const formatDate = (dateStr: string | null) => {\r\n        if (!dateStr) return \"-\";\r\n        return new Date(dateStr).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });\r\n    };\r\n\r\n    const activeSubs = data.filter(s => s.is_active);\r\n    const activeSubsCount = activeSubs.length;\r\n    const monthlyCost = activeSubs.reduce((sum, s) => sum + getMonthlyCost(Number(s.amount), s.billing_cycle), 0);\r\n    const yearlyCost = monthlyCost * 12;\r\n\r\n    const currentMonth = new Date().getMonth();\r\n    const currentYear = new Date().getFullYear();\r\n    const dueThisMonth = activeSubs.filter(s => {\r\n        if (!s.next_billing_date) return false;\r\n        const d = new Date(s.next_billing_date);\r\n        return d.getMonth() === currentMonth && d.getFullYear() === currentYear;\r\n    }).length;\r\n\r\n    const isSubmitting = createMutation.isPending || updateMutation.isPending;\r\n\r\n    return (\r\n        <div className=\"space-y-4\">\r\n            {/* KPI Row */}\r\n            <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-4\">\r\n                <Card>\r\n                    <CardHeader className=\"pb-2\">\r\n                        <CardTitle className=\"text-sm font-medium text-muted-foreground\">Active Subscriptions</CardTitle>\r\n                    </CardHeader>\r\n                    <CardContent>\r\n                        <div className=\"text-2xl font-bold font-mono\">\r\n                            {activeSubsCount}\r\n                        </div>\r\n                    </CardContent>\r\n                </Card>\r\n                <Card>\r\n                    <CardHeader className=\"pb-2\">\r\n                        <CardTitle className=\"text-sm font-medium text-muted-foreground\">Monthly Cost</CardTitle>\r\n                    </CardHeader>\r\n                    <CardContent>\r\n                        <div className=\"text-2xl font-bold font-mono text-[#EF4444]\">\r\n                            {formatCurrency(monthlyCost)}\r\n                        </div>\r\n                    </CardContent>\r\n                </Card>\r\n                <Card>\r\n                    <CardHeader className=\"pb-2\">\r\n                        <CardTitle className=\"text-sm font-medium text-muted-foreground\">Yearly Cost</CardTitle>\r\n                    </CardHeader>\r\n                    <CardContent>\r\n                        <div className=\"text-2xl font-bold font-mono text-[#EF4444]\">\r\n                            {formatCurrency(yearlyCost)}\r\n                        </div>\r\n                    </CardContent>\r\n                </Card>\r\n                <Card>\r\n                    <CardHeader className=\"pb-2\">\r\n                        <CardTitle className=\"text-sm font-medium text-muted-foreground\">Due This Month</CardTitle>\r\n                    </CardHeader>\r\n                    <CardContent>\r\n                        <div className=\"text-2xl font-bold font-mono text-[#F59E0B]\">\r\n                            {dueThisMonth}\r\n                        </div>\r\n                    </CardContent>\r\n                </Card>\r\n            </div>\r\n\r\n            <div className=\"flex justify-between items-center\">\r\n                <h3 className=\"text-lg font-medium\">All Subscriptions</h3>\r\n                <Dialog open={isDialogOpen} onOpenChange={setIsDialogOpen}>\r\n                    <DialogTrigger asChild>\r\n                        <Button onClick={handleAddNew} size=\"sm\">\r\n                            <Plus className=\"h-4 w-4 mr-2\" />\r\n                            Add Subscription\r\n                        </Button>\r\n                    </DialogTrigger>\r\n                    <DialogContent>\r\n                        <DialogHeader>\r\n                            <DialogTitle>{selectedSubscription ? 'Edit Subscription' : 'Add Subscription'}</DialogTitle>\r\n                        </DialogHeader>\r\n                        <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n                            <div className=\"space-y-2\">\r\n                                <Label>Name</Label>\r\n                                <Input required value={name} onChange={e => setName(e.target.value)} />\r\n                            </div>\r\n                            <div className=\"grid grid-cols-2 gap-4\">\r\n                                <div className=\"space-y-2\">\r\n                                    <Label>Provider</Label>\r\n                                    <Input value={provider} onChange={e => setProvider(e.target.value)} />\r\n                                </div>\r\n                                <div className=\"space-y-2\">\r\n                                    <Label>Category</Label>\r\n                                    <Input value={category} onChange={e => setCategory(e.target.value)} />\r\n                                </div>\r\n                            </div>\r\n                            <div className=\"grid grid-cols-2 gap-4\">\r\n                                <div className=\"space-y-2\">\r\n                                    <Label>Amount</Label>\r\n                                    <Input type=\"number\" step=\"0.01\" required value={amount} onChange={e => setAmount(e.target.value)} />\r\n                                </div>\r\n                                <div className=\"space-y-2\">\r\n                                    <Label>Billing Cycle</Label>\r\n                                    <Select value={billingCycle} onValueChange={setBillingCycle} required>\r\n                                        <SelectTrigger>\r\n                                            <SelectValue placeholder=\"Select Cycle\" />\r\n                                        </SelectTrigger>\r\n                                        <SelectContent>\r\n                                            <SelectItem value=\"monthly\">Monthly</SelectItem>\r\n                                            <SelectItem value=\"yearly\">Yearly</SelectItem>\r\n                                            <SelectItem value=\"weekly\">Weekly</SelectItem>\r\n                                        </SelectContent>\r\n                                    </Select>\r\n                                </div>\r\n                            </div>\r\n                            <div className=\"grid grid-cols-2 gap-4 items-center\">\r\n                                <div className=\"space-y-2\">\r\n                                    <Label>Next Billing Date</Label>\r\n                                    <Input type=\"date\" value={nextBillingDate} onChange={e => setNextBillingDate(e.target.value)} />\r\n                                </div>\r\n                                <div className=\"flex items-center space-x-2 pt-6\">\r\n                                    <Switch id=\"is-active\" checked={isActive} onCheckedChange={setIsActive} />\r\n                                    <Label htmlFor=\"is-active\">Active</Label>\r\n                                </div>\r\n                            </div>\r\n                            <Button type=\"submit\" className=\"w-full\" disabled={isSubmitting}>\r\n                                {isSubmitting && <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />}\r\n                                Save Subscription\r\n                            </Button>\r\n                        </form>\r\n                    </DialogContent>\r\n                </Dialog>\r\n            </div>\r\n\r\n            <Card>\r\n                <Table>\r\n                    <TableHeader>\r\n                        <TableRow>\r\n                            <TableHead>Name</TableHead>\r\n                            <TableHead>Provider</TableHead>\r\n                            <TableHead className=\"hidden md:table-cell\">Category</TableHead>\r\n                            <TableHead className=\"hidden md:table-cell\">Billing Cycle</TableHead>\r\n                            <TableHead className=\"text-right\">Monthly Cost</TableHead>\r\n                            <TableHead>Next Billing</TableHead>\r\n                            <TableHead>Status</TableHead>\r\n                            <TableHead className=\"text-right\">Actions</TableHead>\r\n                        </TableRow>\r\n                    </TableHeader>\r\n                    <TableBody>\r\n                        {data.length === 0 ? (\r\n                            <TableRow>\r\n                                <TableCell colSpan={8} className=\"text-center text-muted-foreground h-32\">\r\n                                    No subscriptions tracked yet.\r\n                                </TableCell>\r\n                            </TableRow>\r\n                        ) : (\r\n                            data.map(sub => (\r\n                                <TableRow key={sub.id} className={!sub.is_active ? \"opacity-60\" : \"\"}>\r\n                                    <TableCell className=\"font-medium\">{sub.name}</TableCell>\r\n                                    <TableCell>{sub.provider || '-'}</TableCell>\r\n                                    <TableCell className=\"hidden md:table-cell\">{sub.category || '-'}</TableCell>\r\n                                    <TableCell className=\"hidden md:table-cell capitalize\">{sub.billing_cycle}</TableCell>\r\n                                    <TableCell className=\"text-right font-mono text-[#EF4444]\">\r\n                                        {formatCurrency(getMonthlyCost(Number(sub.amount), sub.billing_cycle))}\r\n                                    </TableCell>\r\n                                    <TableCell className=\"whitespace-nowrap\">{formatDate(sub.next_billing_date)}</TableCell>\r\n                                    <TableCell>\r\n                                        <Badge variant={sub.is_active ? \"default\" : \"secondary\"} className={sub.is_active ? \"bg-[#22C55E]\" : \"\"}>\r\n                                            {sub.is_active ? 'Active' : 'Inactive'}\r\n                                        </Badge>\r\n                                    </TableCell>\r\n                                    <TableCell className=\"text-right\">\r\n                                        <div className=\"flex justify-end gap-2\">\r\n                                            <Button variant=\"ghost\" size=\"icon\" onClick={() => handleToggleActive(sub)}>\r\n                                                <Power className={`h-4 w-4 ${sub.is_active ? 'text-muted-foreground' : 'text-[#22C55E]'}`} />\r\n                                            </Button>\r\n                                            <Button variant=\"ghost\" size=\"icon\" onClick={() => handleEdit(sub)}>\r\n                                                <Pencil className=\"h-4 w-4 text-muted-foreground\" />\r\n                                            </Button>\r\n                                            <Button variant=\"ghost\" size=\"icon\" onClick={() => {\r\n                                                setSubscriptionToDelete(sub.id);\r\n                                                setIsDeleteDialogOpen(true);\r\n                                            }}>\r\n                                                <Trash2 className=\"h-4 w-4 text-red-500\" />\r\n                                            </Button>\r\n                                        </div>\r\n                                    </TableCell>\r\n                                </TableRow>\r\n                            ))\r\n                        )}\r\n                    </TableBody>\r\n                </Table>\r\n            </Card>\r\n\r\n            <AlertDialog open={isDeleteDialogOpen} onOpenChange={setIsDeleteDialogOpen}>\r\n                <AlertDialogContent>\r\n                    <AlertDialogHeader>\r\n                        <AlertDialogTitle>Delete Subscription</AlertDialogTitle>\r\n                        <AlertDialogDescription>\r\n                            Are you sure you want to delete this subscription? This action cannot be undone.\r\n                        </AlertDialogDescription>\r\n                    </AlertDialogHeader>\r\n                    <AlertDialogFooter>\r\n                        <AlertDialogCancel>Cancel</AlertDialogCancel>\r\n                        <AlertDialogAction\r\n                            onClick={() => subscriptionToDelete && deleteMutation.mutate(subscriptionToDelete)}\r\n                            className=\"bg-red-500 hover:bg-red-600\"\r\n                        >\r\n                            {deleteMutation.isPending ? <Loader2 className=\"h-4 w-4 animate-spin\" /> : \"Delete\"}\r\n                        </AlertDialogAction>\r\n                    </AlertDialogFooter>\r\n                </AlertDialogContent>\r\n            </AlertDialog>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\components\\goals\\forms\\goal-dialog.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":51,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":51,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1601,1604],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1601,1604],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":82,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":82,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2839,2842],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2839,2842],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\r\n\r\nimport { useState } from 'react'\r\nimport { Goal } from '../goals-client'\r\nimport {\r\n    Dialog,\r\n    DialogContent,\r\n    DialogHeader,\r\n    DialogTitle,\r\n    DialogFooter,\r\n} from '@/components/ui/dialog'\r\nimport { Button } from '@/components/ui/button'\r\nimport { Input } from '@/components/ui/input'\r\nimport { Label } from '@/components/ui/label'\r\nimport { Textarea } from '@/components/ui/textarea'\r\nimport {\r\n    Select,\r\n    SelectContent,\r\n    SelectItem,\r\n    SelectTrigger,\r\n    SelectValue,\r\n} from '@/components/ui/select'\r\nimport { useMutation, useQueryClient } from '@tanstack/react-query'\r\n\r\ninterface GoalDialogProps {\r\n    goal?: Goal // If provided, we are editing. If undefined, we are creating.\r\n    open: boolean\r\n    onOpenChange: (open: boolean) => void\r\n}\r\n\r\nexport function GoalDialog({ goal, open, onOpenChange }: GoalDialogProps) {\r\n    const queryClient = useQueryClient()\r\n    const isEditing = !!goal\r\n\r\n    const [formData, setFormData] = useState({\r\n        title: goal?.title || '',\r\n        description: goal?.description || '',\r\n        goal_type: goal?.goal_type || 'performance',\r\n        metric: goal?.metric || '',\r\n        unit: goal?.unit || '',\r\n        target_value: goal?.target_value?.toString() || '',\r\n        current_value: goal?.current_value?.toString() || '0',\r\n        deadline: goal?.deadline || '',\r\n        status: goal?.status || 'active'\r\n    })\r\n\r\n    const [error, setError] = useState<string | null>(null)\r\n\r\n    const mutation = useMutation({\r\n        mutationFn: async (data: typeof formData) => {\r\n            const payload: any = {\r\n                title: data.title,\r\n                goal_type: data.goal_type,\r\n                target_value: parseFloat(data.target_value),\r\n                current_value: parseFloat(data.current_value),\r\n            }\r\n\r\n            if (data.description) payload.description = data.description\r\n            if (data.metric) payload.metric = data.metric\r\n            if (data.unit) payload.unit = data.unit\r\n            if (data.deadline) payload.deadline = data.deadline\r\n            if (isEditing && data.status) payload.status = data.status\r\n\r\n            const url = isEditing ? `/api/goals/${goal.id}` : '/api/goals'\r\n            const method = isEditing ? 'PATCH' : 'POST'\r\n\r\n            const res = await fetch(url, {\r\n                method,\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify(payload)\r\n            })\r\n\r\n            if (!res.ok) {\r\n                const errorData = await res.json()\r\n                throw new Error(errorData.error || 'Failed to save goal')\r\n            }\r\n        },\r\n        onSuccess: () => {\r\n            queryClient.invalidateQueries({ queryKey: ['goals'] })\r\n            onOpenChange(false)\r\n        },\r\n        onError: (err: any) => {\r\n            setError(err.message)\r\n        }\r\n    })\r\n\r\n    const handleSubmit = (e: React.FormEvent) => {\r\n        e.preventDefault()\r\n        setError(null)\r\n\r\n        if (!formData.title.trim()) {\r\n            setError('Title is required')\r\n            return\r\n        }\r\n        if (isNaN(parseFloat(formData.target_value))) {\r\n            setError('Target value must be a valid number')\r\n            return\r\n        }\r\n        if (isNaN(parseFloat(formData.current_value))) {\r\n            setError('Current value must be a valid number')\r\n            return\r\n        }\r\n\r\n        mutation.mutate(formData)\r\n    }\r\n\r\n    return (\r\n        <Dialog open={open} onOpenChange={onOpenChange}>\r\n            <DialogContent className=\"bg-[var(--surface)] border-[var(--border)] sm:max-w-[500px] max-h-[90vh] overflow-y-auto\">\r\n                <DialogHeader>\r\n                    <DialogTitle className=\"text-[var(--foreground)]\">\r\n                        {isEditing ? 'Edit Goal' : 'New Goal'}\r\n                    </DialogTitle>\r\n                </DialogHeader>\r\n\r\n                <form onSubmit={handleSubmit} className=\"space-y-4 pt-4\">\r\n                    {error && (\r\n                        <div className=\"p-3 text-sm text-[var(--color-error)] bg-[var(--color-error)]/10 border border-[var(--color-error)]/20 rounded-md\">\r\n                            {error}\r\n                        </div>\r\n                    )}\r\n\r\n                    <div className=\"space-y-2\">\r\n                        <Label className=\"text-[var(--foreground)]\">Goal Title <span className=\"text-[var(--color-error)]\">*</span></Label>\r\n                        <Input\r\n                            value={formData.title}\r\n                            onChange={(e) => setFormData({ ...formData, title: e.target.value })}\r\n                            className=\"bg-[var(--sidebar)] border-[var(--border)] text-[var(--foreground)]\"\r\n                            placeholder=\"e.g., Reach $5k in profits\"\r\n                            required\r\n                        />\r\n                    </div>\r\n\r\n                    <div className=\"space-y-2\">\r\n                        <Label className=\"text-[var(--foreground)]\">Description</Label>\r\n                        <Textarea\r\n                            value={formData.description}\r\n                            onChange={(e) => setFormData({ ...formData, description: e.target.value })}\r\n                            className=\"bg-[var(--sidebar)] border-[var(--border)] text-[var(--foreground)] resize-none\"\r\n                            placeholder=\"Detail your plan to achieve this goal...\"\r\n                            rows={3}\r\n                        />\r\n                    </div>\r\n\r\n                    <div className=\"grid grid-cols-2 gap-4\">\r\n                        <div className=\"space-y-2\">\r\n                            <Label className=\"text-[var(--foreground)]\">Goal Type</Label>\r\n                            <Select\r\n                                value={formData.goal_type}\r\n                                onValueChange={(val) => setFormData({ ...formData, goal_type: val as \"performance\" | \"consistency\" | \"financial\" | \"custom\" })}\r\n                            >\r\n                                <SelectTrigger className=\"bg-[var(--sidebar)] border-[var(--border)] text-[var(--foreground)]\">\r\n                                    <SelectValue />\r\n                                </SelectTrigger>\r\n                                <SelectContent>\r\n                                    <SelectItem value=\"performance\">Performance</SelectItem>\r\n                                    <SelectItem value=\"consistency\">Consistency</SelectItem>\r\n                                    <SelectItem value=\"financial\">Financial</SelectItem>\r\n                                    <SelectItem value=\"custom\">Custom</SelectItem>\r\n                                </SelectContent>\r\n                            </Select>\r\n                        </div>\r\n\r\n                        <div className=\"space-y-2\">\r\n                            <Label className=\"text-[var(--foreground)]\">Deadline (Optional)</Label>\r\n                            <Input\r\n                                type=\"date\"\r\n                                value={formData.deadline}\r\n                                onChange={(e) => setFormData({ ...formData, deadline: e.target.value })}\r\n                                className=\"bg-[var(--sidebar)] border-[var(--border)] text-[var(--foreground)]\"\r\n                            />\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className=\"grid grid-cols-2 gap-4\">\r\n                        <div className=\"space-y-2\">\r\n                            <Label className=\"text-[var(--foreground)]\">Metric Name</Label>\r\n                            <Input\r\n                                value={formData.metric}\r\n                                onChange={(e) => setFormData({ ...formData, metric: e.target.value })}\r\n                                className=\"bg-[var(--sidebar)] border-[var(--border)] text-[var(--foreground)]\"\r\n                                placeholder=\"e.g., Total PnL\"\r\n                            />\r\n                        </div>\r\n                        <div className=\"space-y-2\">\r\n                            <Label className=\"text-[var(--foreground)]\">Unit</Label>\r\n                            <Input\r\n                                value={formData.unit}\r\n                                onChange={(e) => setFormData({ ...formData, unit: e.target.value })}\r\n                                className=\"bg-[var(--sidebar)] border-[var(--border)] text-[var(--foreground)]\"\r\n                                placeholder=\"e.g., $ or %\"\r\n                            />\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className=\"grid grid-cols-2 gap-4\">\r\n                        <div className=\"space-y-2\">\r\n                            <Label className=\"text-[var(--foreground)]\">Target Value <span className=\"text-[var(--color-error)]\">*</span></Label>\r\n                            <Input\r\n                                type=\"number\"\r\n                                step=\"any\"\r\n                                value={formData.target_value}\r\n                                onChange={(e) => setFormData({ ...formData, target_value: e.target.value })}\r\n                                className=\"bg-[var(--sidebar)] border-[var(--border)] text-[var(--foreground)]\"\r\n                                required\r\n                            />\r\n                        </div>\r\n                        <div className=\"space-y-2\">\r\n                            <Label className=\"text-[var(--foreground)]\">Current Value</Label>\r\n                            <Input\r\n                                type=\"number\"\r\n                                step=\"any\"\r\n                                value={formData.current_value}\r\n                                onChange={(e) => setFormData({ ...formData, current_value: e.target.value })}\r\n                                className=\"bg-[var(--sidebar)] border-[var(--border)] text-[var(--foreground)]\"\r\n                            />\r\n                        </div>\r\n                    </div>\r\n\r\n                    {isEditing && (\r\n                        <div className=\"space-y-2 pt-2 border-t border-[var(--border)] mt-4\">\r\n                            <Label className=\"text-[var(--foreground)]\">Status</Label>\r\n                            <Select\r\n                                value={formData.status}\r\n                                onValueChange={(val) => setFormData({ ...formData, status: val as \"active\" | \"completed\" | \"failed\" | \"paused\" })}\r\n                            >\r\n                                <SelectTrigger className=\"bg-[var(--sidebar)] border-[var(--border)] text-[var(--foreground)]\">\r\n                                    <SelectValue />\r\n                                </SelectTrigger>\r\n                                <SelectContent>\r\n                                    <SelectItem value=\"active\">Active</SelectItem>\r\n                                    <SelectItem value=\"completed\">Completed</SelectItem>\r\n                                    <SelectItem value=\"failed\">Failed</SelectItem>\r\n                                    <SelectItem value=\"paused\">Paused</SelectItem>\r\n                                </SelectContent>\r\n                            </Select>\r\n                        </div>\r\n                    )}\r\n\r\n                    <DialogFooter className=\"pt-4 border-t border-[var(--border)]\">\r\n                        <Button\r\n                            type=\"button\"\r\n                            variant=\"outline\"\r\n                            onClick={() => onOpenChange(false)}\r\n                            className=\"bg-transparent border-[var(--border)] text-[var(--foreground)] hover:bg-[var(--sidebar-accent)]\"\r\n                        >\r\n                            Cancel\r\n                        </Button>\r\n                        <Button\r\n                            type=\"submit\"\r\n                            disabled={mutation.isPending}\r\n                            className=\"bg-[var(--color-accent)] text-white hover:bg-[var(--color-accent)]/90\"\r\n                        >\r\n                            {mutation.isPending ? 'Saving...' : (isEditing ? 'Save Changes' : 'Create Goal')}\r\n                        </Button>\r\n                    </DialogFooter>\r\n                </form>\r\n            </DialogContent>\r\n        </Dialog>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\components\\goals\\forms\\habit-dialog.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":55,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":55,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1921,1924],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1921,1924],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":82,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":82,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2892,2895],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2892,2895],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\r\n\r\nimport { useState } from 'react'\r\nimport { Habit } from '../goals-client'\r\nimport {\r\n    Dialog,\r\n    DialogContent,\r\n    DialogHeader,\r\n    DialogTitle,\r\n    DialogFooter,\r\n} from '@/components/ui/dialog'\r\nimport { Button } from '@/components/ui/button'\r\nimport { Input } from '@/components/ui/input'\r\nimport { Label } from '@/components/ui/label'\r\nimport { Textarea } from '@/components/ui/textarea'\r\nimport {\r\n    Select,\r\n    SelectContent,\r\n    SelectItem,\r\n    SelectTrigger,\r\n    SelectValue,\r\n} from '@/components/ui/select'\r\nimport { useMutation, useQueryClient } from '@tanstack/react-query'\r\n\r\nconst PREDEFINED_CATEGORIES = ['Preparation', 'Discipline', 'Review', 'Risk Management', 'Other']\r\n\r\ninterface HabitDialogProps {\r\n    habit?: Habit // If provided, we are editing. If undefined, we are creating.\r\n    open: boolean\r\n    onOpenChange: (open: boolean) => void\r\n}\r\n\r\nexport function HabitDialog({ habit, open, onOpenChange }: HabitDialogProps) {\r\n    const queryClient = useQueryClient()\r\n    const isEditing = !!habit\r\n\r\n    const initialCategory = habit?.category || 'Preparation'\r\n    const isCustomCategoryInitially = !PREDEFINED_CATEGORIES.includes(initialCategory) && !!habit?.category\r\n\r\n    const [formData, setFormData] = useState({\r\n        name: habit?.name || '',\r\n        description: habit?.description || '',\r\n        frequency: habit?.frequency || 'daily',\r\n        categorySelect: isCustomCategoryInitially ? 'Custom...' : initialCategory,\r\n        customCategory: isCustomCategoryInitially ? initialCategory : '',\r\n        is_active: habit?.is_active ?? true\r\n    })\r\n\r\n    const [error, setError] = useState<string | null>(null)\r\n\r\n    const mutation = useMutation({\r\n        mutationFn: async (data: typeof formData) => {\r\n            const finalCategory = data.categorySelect === 'Custom...' ? data.customCategory : data.categorySelect\r\n\r\n            const payload: any = {\r\n                name: data.name,\r\n                frequency: data.frequency,\r\n                category: finalCategory,\r\n            }\r\n\r\n            if (data.description) payload.description = data.description\r\n            if (isEditing) payload.is_active = data.is_active\r\n\r\n            const url = isEditing ? `/api/habits/${habit.id}` : '/api/habits'\r\n            const method = isEditing ? 'PATCH' : 'POST'\r\n\r\n            const res = await fetch(url, {\r\n                method,\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify(payload)\r\n            })\r\n\r\n            if (!res.ok) {\r\n                const errorData = await res.json()\r\n                throw new Error(errorData.error || 'Failed to save habit')\r\n            }\r\n        },\r\n        onSuccess: () => {\r\n            queryClient.invalidateQueries({ queryKey: ['habits'] })\r\n            onOpenChange(false)\r\n        },\r\n        onError: (err: any) => {\r\n            setError(err.message)\r\n        }\r\n    })\r\n\r\n    const handleSubmit = (e: React.FormEvent) => {\r\n        e.preventDefault()\r\n        setError(null)\r\n\r\n        if (!formData.name.trim()) {\r\n            setError('Name is required')\r\n            return\r\n        }\r\n\r\n        if (formData.categorySelect === 'Custom...' && !formData.customCategory.trim()) {\r\n            setError('Please specify a custom category')\r\n            return\r\n        }\r\n\r\n        mutation.mutate(formData)\r\n    }\r\n\r\n    return (\r\n        <Dialog open={open} onOpenChange={onOpenChange}>\r\n            <DialogContent className=\"bg-[var(--surface)] border-[var(--border)] sm:max-w-[425px]\">\r\n                <DialogHeader>\r\n                    <DialogTitle className=\"text-[var(--foreground)]\">\r\n                        {isEditing ? 'Edit Habit' : 'New Habit'}\r\n                    </DialogTitle>\r\n                </DialogHeader>\r\n\r\n                <form onSubmit={handleSubmit} className=\"space-y-4 pt-4\">\r\n                    {error && (\r\n                        <div className=\"p-3 text-sm text-[var(--color-error)] bg-[var(--color-error)]/10 border border-[var(--color-error)]/20 rounded-md\">\r\n                            {error}\r\n                        </div>\r\n                    )}\r\n\r\n                    <div className=\"space-y-2\">\r\n                        <Label className=\"text-[var(--foreground)]\">Habit Name <span className=\"text-[var(--color-error)]\">*</span></Label>\r\n                        <Input\r\n                            value={formData.name}\r\n                            onChange={(e) => setFormData({ ...formData, name: e.target.value })}\r\n                            className=\"bg-[var(--sidebar)] border-[var(--border)] text-[var(--foreground)]\"\r\n                            placeholder=\"e.g., Pre-market checklist\"\r\n                            required\r\n                        />\r\n                    </div>\r\n\r\n                    <div className=\"space-y-2\">\r\n                        <Label className=\"text-[var(--foreground)]\">Description</Label>\r\n                        <Textarea\r\n                            value={formData.description}\r\n                            onChange={(e) => setFormData({ ...formData, description: e.target.value })}\r\n                            className=\"bg-[var(--sidebar)] border-[var(--border)] text-[var(--foreground)] resize-none\"\r\n                            placeholder=\"What exactly does this habit entail?\"\r\n                            rows={2}\r\n                        />\r\n                    </div>\r\n\r\n                    <div className=\"grid grid-cols-2 gap-4\">\r\n                        <div className=\"space-y-2\">\r\n                            <Label className=\"text-[var(--foreground)]\">Frequency</Label>\r\n                            <Select\r\n                                value={formData.frequency}\r\n                                onValueChange={(val) => setFormData({ ...formData, frequency: val as \"daily\" | \"weekly\" | \"monthly\" })}\r\n                            >\r\n                                <SelectTrigger className=\"bg-[var(--sidebar)] border-[var(--border)] text-[var(--foreground)]\">\r\n                                    <SelectValue />\r\n                                </SelectTrigger>\r\n                                <SelectContent>\r\n                                    <SelectItem value=\"daily\">Daily</SelectItem>\r\n                                    <SelectItem value=\"weekly\">Weekly</SelectItem>\r\n                                    <SelectItem value=\"monthly\">Monthly</SelectItem>\r\n                                </SelectContent>\r\n                            </Select>\r\n                        </div>\r\n\r\n                        <div className=\"space-y-2\">\r\n                            <Label className=\"text-[var(--foreground)]\">Category</Label>\r\n                            <Select\r\n                                value={formData.categorySelect}\r\n                                onValueChange={(val) => setFormData({ ...formData, categorySelect: val })}\r\n                            >\r\n                                <SelectTrigger className=\"bg-[var(--sidebar)] border-[var(--border)] text-[var(--foreground)]\">\r\n                                    <SelectValue />\r\n                                </SelectTrigger>\r\n                                <SelectContent>\r\n                                    {PREDEFINED_CATEGORIES.map(cat => (\r\n                                        <SelectItem key={cat} value={cat}>{cat}</SelectItem>\r\n                                    ))}\r\n                                    <SelectItem value=\"Custom...\">Custom...</SelectItem>\r\n                                </SelectContent>\r\n                            </Select>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {formData.categorySelect === 'Custom...' && (\r\n                        <div className=\"space-y-2 animate-in fade-in slide-in-from-top-1\">\r\n                            <Label className=\"text-[var(--foreground)]\">Custom Category <span className=\"text-[var(--color-error)]\">*</span></Label>\r\n                            <Input\r\n                                value={formData.customCategory}\r\n                                onChange={(e) => setFormData({ ...formData, customCategory: e.target.value })}\r\n                                className=\"bg-[var(--sidebar)] border-[var(--border)] text-[var(--foreground)]\"\r\n                                placeholder=\"e.g., Fitness\"\r\n                                required\r\n                            />\r\n                        </div>\r\n                    )}\r\n\r\n                    {isEditing && (\r\n                        <div className=\"space-y-2 pt-2 border-t border-[var(--border)] mt-4\">\r\n                            <Label className=\"text-[var(--foreground)]\">Status</Label>\r\n                            <Select\r\n                                value={formData.is_active ? 'active' : 'inactive'}\r\n                                onValueChange={(val) => setFormData({ ...formData, is_active: val === 'active' })}\r\n                            >\r\n                                <SelectTrigger className=\"bg-[var(--sidebar)] border-[var(--border)] text-[var(--foreground)]\">\r\n                                    <SelectValue />\r\n                                </SelectTrigger>\r\n                                <SelectContent>\r\n                                    <SelectItem value=\"active\">Active</SelectItem>\r\n                                    <SelectItem value=\"inactive\">Inactive</SelectItem>\r\n                                </SelectContent>\r\n                            </Select>\r\n                        </div>\r\n                    )}\r\n\r\n                    <DialogFooter className=\"pt-4 border-t border-[var(--border)]\">\r\n                        <Button\r\n                            type=\"button\"\r\n                            variant=\"outline\"\r\n                            onClick={() => onOpenChange(false)}\r\n                            className=\"bg-transparent border-[var(--border)] text-[var(--foreground)] hover:bg-[var(--sidebar-accent)]\"\r\n                        >\r\n                            Cancel\r\n                        </Button>\r\n                        <Button\r\n                            type=\"submit\"\r\n                            disabled={mutation.isPending}\r\n                            className=\"bg-[var(--color-accent)] text-white hover:bg-[var(--color-accent)]/90\"\r\n                        >\r\n                            {mutation.isPending ? 'Saving...' : (isEditing ? 'Save Changes' : 'Create Habit')}\r\n                        </Button>\r\n                    </DialogFooter>\r\n                </form>\r\n            </DialogContent>\r\n        </Dialog>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\components\\goals\\forms\\update-progress-dialog.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":46,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":46,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1546,1549],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1546,1549],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\r\n\r\nimport { useState } from 'react'\r\nimport { Goal } from '../goals-client'\r\nimport {\r\n    Dialog,\r\n    DialogContent,\r\n    DialogHeader,\r\n    DialogTitle,\r\n    DialogFooter,\r\n} from '@/components/ui/dialog'\r\nimport { Button } from '@/components/ui/button'\r\nimport { Input } from '@/components/ui/input'\r\nimport { Label } from '@/components/ui/label'\r\nimport { useMutation, useQueryClient } from '@tanstack/react-query'\r\n\r\ninterface UpdateProgressDialogProps {\r\n    goal: Goal\r\n    open: boolean\r\n    onOpenChange: (open: boolean) => void\r\n}\r\n\r\nexport function UpdateProgressDialog({ goal, open, onOpenChange }: UpdateProgressDialogProps) {\r\n    const queryClient = useQueryClient()\r\n    const [value, setValue] = useState(goal.current_value.toString())\r\n    const [error, setError] = useState<string | null>(null)\r\n\r\n    const mutation = useMutation({\r\n        mutationFn: async (newValue: number) => {\r\n            const res = await fetch(`/api/goals/${goal.id}`, {\r\n                method: 'PATCH',\r\n                headers: {\r\n                    'Content-Type': 'application/json',\r\n                },\r\n                body: JSON.stringify({ current_value: newValue })\r\n            })\r\n            if (!res.ok) {\r\n                const data = await res.json()\r\n                throw new Error(data.error || 'Failed to update progress')\r\n            }\r\n        },\r\n        onSuccess: () => {\r\n            queryClient.invalidateQueries({ queryKey: ['goals'] })\r\n            onOpenChange(false)\r\n        },\r\n        onError: (err: any) => {\r\n            setError(err.message)\r\n        }\r\n    })\r\n\r\n    const handleSubmit = (e: React.FormEvent) => {\r\n        e.preventDefault()\r\n        setError(null)\r\n        const num = parseFloat(value)\r\n        if (isNaN(num)) {\r\n            setError('Please enter a valid number')\r\n            return\r\n        }\r\n        mutation.mutate(num)\r\n    }\r\n\r\n    return (\r\n        <Dialog open={open} onOpenChange={onOpenChange}>\r\n            <DialogContent className=\"bg-[var(--surface)] border-[var(--border)] sm:max-w-[400px]\">\r\n                <DialogHeader>\r\n                    <DialogTitle className=\"text-[var(--foreground)]\">Update Progress</DialogTitle>\r\n                </DialogHeader>\r\n                <form onSubmit={handleSubmit} className=\"space-y-6 pt-4\">\r\n                    {error && (\r\n                        <div className=\"p-3 text-sm text-[var(--color-error)] bg-[var(--color-error)]/10 border border-[var(--color-error)]/20 rounded-md\">\r\n                            {error}\r\n                        </div>\r\n                    )}\r\n\r\n                    <div className=\"space-y-4\">\r\n                        <div className=\"flex justify-between items-center text-sm text-[var(--muted-foreground)]\">\r\n                            <span>Goal:</span>\r\n                            <span className=\"font-medium text-[var(--foreground)]\">{goal.title}</span>\r\n                        </div>\r\n                        <div className=\"flex justify-between items-center text-sm text-[var(--muted-foreground)]\">\r\n                            <span>Target:</span>\r\n                            <span className=\"font-mono text-[var(--foreground)]\">{goal.target_value} {goal.unit}</span>\r\n                        </div>\r\n\r\n                        <div className=\"space-y-2 pt-2\">\r\n                            <Label htmlFor=\"currentValue\" className=\"text-[var(--foreground)]\">New Current Value</Label>\r\n                            <Input\r\n                                id=\"currentValue\"\r\n                                type=\"number\"\r\n                                step=\"any\"\r\n                                value={value}\r\n                                onChange={(e) => setValue(e.target.value)}\r\n                                className=\"bg-[var(--sidebar)] border-[var(--border)] text-[var(--foreground)]\"\r\n                                autoFocus\r\n                                required\r\n                            />\r\n                        </div>\r\n                    </div>\r\n\r\n                    <DialogFooter>\r\n                        <Button\r\n                            type=\"button\"\r\n                            variant=\"outline\"\r\n                            onClick={() => onOpenChange(false)}\r\n                            className=\"bg-transparent border-[var(--border)] text-[var(--foreground)] hover:bg-[var(--sidebar-accent)]\"\r\n                        >\r\n                            Cancel\r\n                        </Button>\r\n                        <Button\r\n                            type=\"submit\"\r\n                            disabled={mutation.isPending}\r\n                            className=\"bg-[var(--color-accent)] text-white hover:bg-[var(--color-accent)]/90\"\r\n                        >\r\n                            {mutation.isPending ? 'Saving...' : 'Save Progress'}\r\n                        </Button>\r\n                    </DialogFooter>\r\n                </form>\r\n            </DialogContent>\r\n        </Dialog>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\components\\goals\\goals-client.tsx","messages":[{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":123,"column":99,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[5102,5116],"text":"Today&apos;s Habits"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[5102,5116],"text":"Today&lsquo;s Habits"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[5102,5116],"text":"Today&#39;s Habits"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[5102,5116],"text":"Today&rsquo;s Habits"},"desc":"Replace with `&rsquo;`."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\r\n\r\nimport { useState } from 'react'\r\nimport { useQuery } from '@tanstack/react-query'\r\nimport { Plus, Target, Flame, CheckCircle2, TrendingUp } from 'lucide-react'\r\nimport { Button } from '@/components/ui/button'\r\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs'\r\nimport { GoalsTab } from './goals-tab'\r\nimport { HabitsTab } from './habits-tab'\r\n\r\n// Types for our APIs\r\nexport type Goal = {\r\n    id: string\r\n    title: string\r\n    description: string | null\r\n    goal_type: 'performance' | 'consistency' | 'financial' | 'custom'\r\n    metric: string | null\r\n    unit: string | null\r\n    target_value: string\r\n    current_value: string\r\n    deadline: string | null\r\n    status: 'active' | 'completed' | 'failed' | 'paused'\r\n    progress: number\r\n}\r\n\r\nexport type Habit = {\r\n    id: string\r\n    name: string\r\n    description: string | null\r\n    frequency: 'daily' | 'weekly' | 'monthly'\r\n    category: string\r\n    is_active: boolean\r\n    completedToday: boolean\r\n    currentStreak: number\r\n    bestStreak: number\r\n    weeklyRate: number\r\n}\r\n\r\nexport function GoalsClient() {\r\n    const [activeTab, setActiveTab] = useState('goals')\r\n\r\n    // Fetch data\r\n    const { data: goalsData, isLoading: goalsLoading } = useQuery<{ data: Goal[] }>({\r\n        queryKey: ['goals'],\r\n        queryFn: async () => {\r\n            const res = await fetch('/api/goals')\r\n            if (!res.ok) throw new Error('Failed to fetch goals')\r\n            return res.json()\r\n        }\r\n    })\r\n\r\n    const { data: habitsData, isLoading: habitsLoading } = useQuery<{ data: Habit[] }>({\r\n        queryKey: ['habits'],\r\n        queryFn: async () => {\r\n            const res = await fetch('/api/habits')\r\n            if (!res.ok) throw new Error('Failed to fetch habits')\r\n            return res.json()\r\n        }\r\n    })\r\n\r\n    const goals = goalsData?.data || []\r\n    const habits = habitsData?.data || []\r\n\r\n    // KPI Calculations\r\n    const completedGoals = goals.filter(g => g.status === 'completed').length\r\n    const totalGoals = goals.length\r\n\r\n    const activeHabits = habits.filter(h => h.is_active)\r\n    const completedTodayHabits = activeHabits.filter(h => h.completedToday).length\r\n    const totalActiveHabits = activeHabits.length\r\n\r\n    const bestStreak = habits.length > 0\r\n        ? Math.max(...habits.map(h => h.currentStreak))\r\n        : 0\r\n\r\n    const avgWeeklyRate = activeHabits.length > 0\r\n        ? activeHabits.reduce((acc, h) => acc + h.weeklyRate, 0) / activeHabits.length\r\n        : 0\r\n\r\n    return (\r\n        <div className=\"flex flex-col gap-6 p-6 md:p-8 max-w-[1600px] mx-auto w-full\">\r\n            {/* Page Header */}\r\n            <div className=\"flex flex-col sm:flex-row sm:items-center justify-between gap-4\">\r\n                <div>\r\n                    <h1 className=\"text-2xl font-semibold text-[var(--foreground)]\">Goals & Habits</h1>\r\n                    <p className=\"text-sm text-[var(--muted-foreground)] mt-1\">\r\n                        Set targets, build habits, and track your progress\r\n                    </p>\r\n                </div>\r\n                <div className=\"flex items-center gap-3\">\r\n                    {/* Note: In future steps, buttons will trigger dialogs */}\r\n                    <Button variant=\"secondary\" size=\"sm\" className=\"gap-2\">\r\n                        <Plus className=\"h-4 w-4\" />\r\n                        New Habit\r\n                    </Button>\r\n                    <Button size=\"sm\" className=\"gap-2 bg-[var(--color-accent)] text-white hover:bg-[var(--color-accent)]/90\">\r\n                        <Plus className=\"h-4 w-4\" />\r\n                        New Goal\r\n                    </Button>\r\n                </div>\r\n            </div>\r\n\r\n            {/* KPI Cards */}\r\n            <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4\">\r\n                {/* KPI 1: Goals Progress */}\r\n                <div className=\"rounded-xl border border-[var(--border)] bg-[var(--surface)] p-5\">\r\n                    <div className=\"flex items-center gap-2 mb-2\">\r\n                        <Target className=\"h-4 w-4 text-[var(--muted-foreground)]\" />\r\n                        <span className=\"text-sm font-medium text-[var(--muted-foreground)]\">Goals Progress</span>\r\n                    </div>\r\n                    <div className=\"flex items-end gap-2\">\r\n                        <span className=\"text-2xl font-semibold font-mono text-[var(--foreground)]\">\r\n                            {completedGoals}/{totalGoals}\r\n                        </span>\r\n                        <span className=\"text-sm text-[var(--muted-foreground)] mb-1\">completed</span>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* KPI 2: Today's Habits */}\r\n                <div className=\"rounded-xl border border-[var(--border)] bg-[var(--surface)] p-5\">\r\n                    <div className=\"flex items-center gap-2 mb-2\">\r\n                        <CheckCircle2 className=\"h-4 w-4 text-[var(--muted-foreground)]\" />\r\n                        <span className=\"text-sm font-medium text-[var(--muted-foreground)]\">Today's Habits</span>\r\n                    </div>\r\n                    <div className=\"flex items-end gap-2\">\r\n                        <span className=\"text-2xl font-semibold font-mono text-[var(--foreground)]\">\r\n                            {completedTodayHabits}/{totalActiveHabits}\r\n                        </span>\r\n                        <span className=\"text-sm text-[var(--muted-foreground)] mb-1\">completed</span>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* KPI 3: Best Streak */}\r\n                <div className=\"rounded-xl border border-[var(--border)] bg-[var(--surface)] p-5\">\r\n                    <div className=\"flex items-center gap-2 mb-2\">\r\n                        <Flame className=\"h-4 w-4 text-[var(--muted-foreground)]\" />\r\n                        <span className=\"text-sm font-medium text-[var(--muted-foreground)]\">Best Streak</span>\r\n                    </div>\r\n                    <div className=\"flex items-end gap-2\">\r\n                        <span className=\"flex items-center text-2xl font-semibold font-mono text-[var(--foreground)]\">\r\n                            {bestStreak}\r\n                            {bestStreak > 0 && <Flame className=\"h-5 w-5 text-orange-500 ml-1\" fill=\"currentColor\" />}\r\n                        </span>\r\n                        <span className=\"text-sm text-[var(--muted-foreground)] mb-1\">days</span>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* KPI 4: Weekly Rate */}\r\n                <div className=\"rounded-xl border border-[var(--border)] bg-[var(--surface)] p-5\">\r\n                    <div className=\"flex items-center gap-2 mb-2\">\r\n                        <TrendingUp className=\"h-4 w-4 text-[var(--muted-foreground)]\" />\r\n                        <span className=\"text-sm font-medium text-[var(--muted-foreground)]\">Weekly Rate</span>\r\n                    </div>\r\n                    <div className=\"flex items-end gap-2\">\r\n                        <span className={`text-2xl font-semibold font-mono ${avgWeeklyRate >= 70 ? 'text-[var(--color-success)]' : 'text-[var(--color-error)]'\r\n                            }`}>\r\n                            {avgWeeklyRate.toFixed(1)}%\r\n                        </span>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Tabs */}\r\n            <Tabs value={activeTab} onValueChange={setActiveTab} className=\"w-full\">\r\n                <TabsList className=\"mb-6\">\r\n                    <TabsTrigger value=\"goals\">Goals</TabsTrigger>\r\n                    <TabsTrigger value=\"habits\">Habits</TabsTrigger>\r\n                </TabsList>\r\n\r\n                <TabsContent value=\"goals\" className=\"m-0 mt-2\">\r\n                    <GoalsTab goals={goals} isLoading={goalsLoading} />\r\n                </TabsContent>\r\n\r\n                <TabsContent value=\"habits\" className=\"m-0 mt-2\">\r\n                    <HabitsTab habits={habits} isLoading={habitsLoading} />\r\n                </TabsContent>\r\n            </Tabs>\r\n\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\components\\goals\\goals-tab.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\components\\goals\\habits-tab.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\components\\grading\\configure-client.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\components\\grading\\configure-client.tsx:82:13\n  80 |                 weight: Number(v) || 0\n  81 |             }))\n> 82 |             setLocalWeights(parsed.length > 0 ? parsed : [\n     |             ^^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  83 |                 { id: crypto.randomUUID(), name: 'Risk Management', weight: 25 },\n  84 |                 { id: crypto.randomUUID(), name: 'Execution', weight: 20 },\n  85 |                 { id: crypto.randomUUID(), name: 'Discipline', weight: 25 },","line":82,"column":13,"nodeType":null,"endLine":82,"endColumn":28},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\components\\grading\\configure-client.tsx:223:13\n  221 |     useEffect(() => {\n  222 |         if (settingsData?.data?.grading_rubric) {\n> 223 |             setLabels(settingsData.data.grading_rubric)\n      |             ^^^^^^^^^ Avoid calling setState() directly within an effect\n  224 |         } else {\n  225 |             // init from defaults\n  226 |             const init: Record<string, string> = {}","line":223,"column":13,"nodeType":null,"endLine":223,"endColumn":22},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":233,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":233,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10749,10752],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10749,10752],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":336,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":336,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15153,15156],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15153,15156],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":341,"column":80,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":341,"endColumn":83,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15342,15345],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15342,15345],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\components\\grading\\configure-client.tsx:345:13\n  343 |                 ...r\n  344 |             }))\n> 345 |             setLocalRules(parsedRules)\n      |             ^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  346 |\n  347 |             // Overrides\n  348 |             if (selectedStrategy.category_overrides) {","line":345,"column":13,"nodeType":null,"endLine":345,"endColumn":26},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'id' is defined but never used.","line":370,"column":52,"nodeType":"Identifier","messageId":"unusedVar","endLine":370,"endColumn":54},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":461,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":461,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20570,20573],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20570,20573],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":7,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\r\n\r\nimport React, { useState, useEffect, Suspense, useMemo } from 'react'\r\nimport { useRouter, useSearchParams } from 'next/navigation'\r\nimport { ArrowLeft, Save, Plus, Trash2, ArrowUp, ArrowDown, Settings2 } from 'lucide-react'\r\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query'\r\nimport { Button } from '@/components/ui/button'\r\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription, CardFooter } from \"@/components/ui/card\"\r\nimport { Input } from '@/components/ui/input'\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select'\r\nimport { Label } from '@/components/ui/label'\r\nimport { Switch } from '@/components/ui/switch'\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter, DialogDescription } from '@/components/ui/dialog'\r\nimport { Checkbox } from '@/components/ui/checkbox'\r\nimport { cn } from '@/lib/utils'\r\nimport type { Confluence } from '@/types/grading'\r\n\r\nexport function ConfigureClient() {\r\n    return (\r\n        <Suspense fallback={<div className=\"p-8 text-[var(--muted-foreground)]\">Loading configuration...</div>}>\r\n            <ConfigureContent />\r\n        </Suspense>\r\n    )\r\n}\r\n\r\nfunction ConfigureContent() {\r\n    const router = useRouter()\r\n    const searchParams = useSearchParams()\r\n    const initialStrategyId = searchParams.get('strategy') || ''\r\n\r\n    return (\r\n        <div className=\"max-w-6xl mx-auto space-y-8 pb-32\">\r\n            {/* Header */}\r\n            <div className=\"flex items-center gap-4\">\r\n                <Button variant=\"ghost\" size=\"icon\" onClick={() => router.push('/grading')}>\r\n                    <ArrowLeft className=\"w-5 h-5\" />\r\n                </Button>\r\n                <div>\r\n                    <h1 className=\"text-2xl font-bold tracking-tight text-[var(--foreground)]\">Configure Grading</h1>\r\n                    <p className=\"text-[var(--muted-foreground)]\">Manage category weights, score definitions, and strategy rules.</p>\r\n                </div>\r\n            </div>\r\n\r\n            <div className=\"grid gap-8 lg:grid-cols-12 items-start\">\r\n                <div className=\"lg:col-span-4 space-y-8\">\r\n                    <CategoryWeightsSection />\r\n                    <ScoringRubricSection />\r\n                </div>\r\n                <div className=\"lg:col-span-8\">\r\n                    <GradingRulesSection initialStrategyId={initialStrategyId} />\r\n                </div>\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n\r\n// ============================================================================\r\n// Section A: Global Category Weights\r\n// ============================================================================\r\ntype WeightItem = { id: string, name: string, weight: number }\r\n\r\nfunction CategoryWeightsSection() {\r\n    const queryClient = useQueryClient()\r\n    const { data: settingsData, isLoading } = useQuery({\r\n        queryKey: ['finance-settings'],\r\n        queryFn: async () => {\r\n            const res = await fetch('/api/finance/settings')\r\n            if (!res.ok) throw new Error('Failed to fetch settings')\r\n            return res.json()\r\n        }\r\n    })\r\n\r\n    const [localWeights, setLocalWeights] = useState<WeightItem[]>([])\r\n\r\n    useEffect(() => {\r\n        if (settingsData?.data?.grading_weights) {\r\n            const parsed = Object.entries(settingsData.data.grading_weights).map(([k, v]) => ({\r\n                id: crypto.randomUUID(),\r\n                name: k,\r\n                weight: Number(v) || 0\r\n            }))\r\n            setLocalWeights(parsed.length > 0 ? parsed : [\r\n                { id: crypto.randomUUID(), name: 'Risk Management', weight: 25 },\r\n                { id: crypto.randomUUID(), name: 'Execution', weight: 20 },\r\n                { id: crypto.randomUUID(), name: 'Discipline', weight: 25 },\r\n                { id: crypto.randomUUID(), name: 'Strategy', weight: 15 },\r\n                { id: crypto.randomUUID(), name: 'Efficiency', weight: 15 }\r\n            ])\r\n        } else if (settingsData) {\r\n            setLocalWeights([\r\n                { id: crypto.randomUUID(), name: 'Risk Management', weight: 25 },\r\n                { id: crypto.randomUUID(), name: 'Execution', weight: 20 },\r\n                { id: crypto.randomUUID(), name: 'Discipline', weight: 25 },\r\n                { id: crypto.randomUUID(), name: 'Strategy', weight: 15 },\r\n                { id: crypto.randomUUID(), name: 'Efficiency', weight: 15 }\r\n            ])\r\n        }\r\n    }, [settingsData])\r\n\r\n    const total = localWeights.reduce((sum, item) => sum + item.weight, 0)\r\n    const isValid = total === 100\r\n\r\n    const updateSettings = useMutation({\r\n        mutationFn: async (weightsArray: WeightItem[]) => {\r\n            const payloadObj = weightsArray.reduce((acc, curr) => {\r\n                const key = curr.name.trim() || 'Unnamed Category'\r\n                acc[key] = curr.weight\r\n                return acc\r\n            }, {} as Record<string, number>)\r\n\r\n            const res = await fetch('/api/finance/settings', {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({ grading_weights: payloadObj })\r\n            })\r\n            if (!res.ok) throw new Error('Failed to update weights')\r\n            return res.json()\r\n        },\r\n        onSuccess: () => {\r\n            queryClient.invalidateQueries({ queryKey: ['finance-settings'] })\r\n        }\r\n    })\r\n\r\n    const addCategory = () => {\r\n        setLocalWeights([...localWeights, { id: crypto.randomUUID(), name: 'New Category', weight: 0 }])\r\n    }\r\n\r\n    const removeCategory = (id: string) => {\r\n        setLocalWeights(localWeights.filter(w => w.id !== id))\r\n    }\r\n\r\n    const updateCategory = (id: string, field: 'name' | 'weight', value: string | number) => {\r\n        setLocalWeights(localWeights.map(w => w.id === id ? { ...w, [field]: value } : w))\r\n    }\r\n\r\n    if (isLoading) return <Card><CardContent className=\"p-6\">Loading weights...</CardContent></Card>\r\n\r\n    return (\r\n        <Card className=\"flex flex-col\">\r\n            <CardHeader className=\"flex flex-row items-start justify-between pb-4\">\r\n                <div>\r\n                    <CardTitle className=\"text-lg\">Global Category Weights</CardTitle>\r\n                    <CardDescription>Define how scores are weighted globally.</CardDescription>\r\n                </div>\r\n            </CardHeader>\r\n            <CardContent className=\"flex-1 space-y-4\">\r\n                <div className=\"space-y-3\">\r\n                    {localWeights.map((w) => (\r\n                        <div key={w.id} className=\"flex items-center gap-2\">\r\n                            <Input\r\n                                value={w.name}\r\n                                onChange={(e) => updateCategory(w.id, 'name', e.target.value)}\r\n                                className=\"flex-1\"\r\n                                placeholder=\"Category Name\"\r\n                            />\r\n                            <div className=\"relative w-24 flex-shrink-0\">\r\n                                <Input\r\n                                    type=\"number\"\r\n                                    value={w.weight === 0 ? '' : w.weight}\r\n                                    onChange={(e) => updateCategory(w.id, 'weight', e.target.value === '' ? 0 : Number(e.target.value))}\r\n                                    className=\"pr-6 text-right font-mono\"\r\n                                    min=\"0\" max=\"100\"\r\n                                />\r\n                                <span className=\"absolute right-3 top-1/2 -translate-y-1/2 text-xs text-[var(--muted-foreground)]\">%</span>\r\n                            </div>\r\n                            <Button variant=\"ghost\" size=\"icon\" className=\"shrink-0 text-[var(--muted-foreground)] hover:text-[var(--color-red)]\" onClick={() => removeCategory(w.id)}>\r\n                                <Trash2 className=\"w-4 h-4\" />\r\n                            </Button>\r\n                        </div>\r\n                    ))}\r\n                </div>\r\n                <Button variant=\"outline\" size=\"sm\" onClick={addCategory} className=\"w-full mt-2 border-dashed\">\r\n                    <Plus className=\"w-4 h-4 mr-2\" /> Add Category\r\n                </Button>\r\n            </CardContent>\r\n            <CardFooter className=\"pt-4 border-t flex items-center justify-between bg-[var(--secondary)]/30\">\r\n                <div className=\"flex items-center gap-2\">\r\n                    <span className=\"text-sm font-medium text-[var(--muted-foreground)]\">Total Weight:</span>\r\n                    <span className={cn(\"text-base font-mono font-bold\", isValid ? \"text-[var(--color-green)]\" : \"text-[var(--color-red)]\")}>\r\n                        {total}%\r\n                    </span>\r\n                </div>\r\n                <Button\r\n                    disabled={!isValid || updateSettings.isPending}\r\n                    onClick={() => updateSettings.mutate(localWeights)}\r\n                    size=\"sm\"\r\n                >\r\n                    <Save className=\"w-4 h-4 mr-2\" />\r\n                    {updateSettings.isPending ? 'Saving...' : 'Save Weights'}\r\n                </Button>\r\n            </CardFooter>\r\n        </Card>\r\n    )\r\n}\r\n\r\n// ============================================================================\r\n// Section C: Scoring Rubric\r\n// ============================================================================\r\nconst DEFAULT_RUBRIC = [\r\n    { grade: 'A+', label: 'Excellent', color: '#22C55E' },\r\n    { grade: 'A', label: 'Great', color: '#22C55E' },\r\n    { grade: 'B+', label: 'Good', color: '#3B82F6' },\r\n    { grade: 'B', label: 'Average', color: '#E8EAF0' },\r\n    { grade: 'B-', label: 'Poor', color: '#F59E0B' },\r\n    { grade: 'C', label: 'Critical', color: '#EF4444' }\r\n]\r\n\r\nfunction ScoringRubricSection() {\r\n    const queryClient = useQueryClient()\r\n    const { data: settingsData, isLoading } = useQuery({\r\n        queryKey: ['finance-settings'],\r\n        queryFn: async () => {\r\n            const res = await fetch('/api/finance/settings')\r\n            if (!res.ok) throw new Error('Failed to fetch settings')\r\n            return res.json()\r\n        }\r\n    })\r\n\r\n    const [labels, setLabels] = useState<Record<string, string>>({})\r\n\r\n    useEffect(() => {\r\n        if (settingsData?.data?.grading_rubric) {\r\n            setLabels(settingsData.data.grading_rubric)\r\n        } else {\r\n            // init from defaults\r\n            const init: Record<string, string> = {}\r\n            DEFAULT_RUBRIC.forEach(r => { init[r.grade] = r.label })\r\n            setLabels(init)\r\n        }\r\n    }, [settingsData])\r\n\r\n    const updateSettings = useMutation({\r\n        mutationFn: async (newRubric: any) => {\r\n            const res = await fetch('/api/finance/settings', {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({ grading_rubric: newRubric })\r\n            })\r\n            if (!res.ok) throw new Error('Failed to update rubric')\r\n            return res.json()\r\n        },\r\n        onSuccess: () => {\r\n            queryClient.invalidateQueries({ queryKey: ['finance-settings'] })\r\n        }\r\n    })\r\n\r\n    if (isLoading) return <Card><CardContent className=\"p-6\">Loading rubric...</CardContent></Card>\r\n\r\n    return (\r\n        <Card>\r\n            <CardHeader className=\"flex flex-row items-start justify-between pb-4\">\r\n                <div>\r\n                    <CardTitle className=\"text-lg\">Scoring Rubric</CardTitle>\r\n                    <CardDescription>Customize the labels for each grade bracket.</CardDescription>\r\n                </div>\r\n                <Button\r\n                    disabled={updateSettings.isPending}\r\n                    onClick={() => updateSettings.mutate(labels)}\r\n                    size=\"sm\"\r\n                >\r\n                    <Save className=\"w-4 h-4 mr-2\" />\r\n                    Save Labels\r\n                </Button>\r\n            </CardHeader>\r\n            <CardContent>\r\n                <div className=\"space-y-3\">\r\n                    {DEFAULT_RUBRIC.map((item) => (\r\n                        <div key={item.grade} className=\"flex items-center gap-3\">\r\n                            <div\r\n                                className=\"w-10 h-8 rounded shrink-0 flex items-center justify-center font-bold font-mono text-sm border shadow-sm\"\r\n                                style={{ backgroundColor: `${item.color}15`, color: item.color, borderColor: `${item.color}30` }}\r\n                            >\r\n                                {item.grade}\r\n                            </div>\r\n                            <Input\r\n                                value={labels[item.grade] || ''}\r\n                                onChange={(e) => setLabels({ ...labels, [item.grade]: e.target.value })}\r\n                                placeholder={item.label}\r\n                                className=\"h-8 text-sm\"\r\n                            />\r\n                        </div>\r\n                    ))}\r\n                </div>\r\n            </CardContent>\r\n        </Card >\r\n    )\r\n}\r\n\r\n// ============================================================================\r\n// Section B: Strategy Grading Rules\r\n// ============================================================================\r\ntype GradingRule = {\r\n    id: string\r\n    grade: string\r\n    type: 'specific' | 'threshold' | 'exact'\r\n    required_confluence_ids?: string[]\r\n    min_count?: number\r\n    exact_count?: number\r\n}\r\n\r\nfunction GradingRulesSection({ initialStrategyId }: { initialStrategyId: string }) {\r\n    const queryClient = useQueryClient()\r\n    const [strategyId, setStrategyId] = useState<string>(initialStrategyId)\r\n    const [localRules, setLocalRules] = useState<GradingRule[]>([])\r\n    const [localOverrides, setLocalOverrides] = useState<WeightItem[]>([])\r\n    const [enableOverrides, setEnableOverrides] = useState(false)\r\n    const [isAddRuleOpen, setIsAddRuleOpen] = useState(false)\r\n\r\n    // Form stuff for adding confluences\r\n    const [newConfName, setNewConfName] = useState('')\r\n    const [newConfWeight, setNewConfWeight] = useState('1.0')\r\n    const [newConfCat, setNewConfCat] = useState('Execution')\r\n\r\n    const { data: strategiesData } = useQuery({\r\n        queryKey: ['strategies'],\r\n        queryFn: async () => {\r\n            const res = await fetch('/api/strategies')\r\n            if (!res.ok) throw new Error('Failed to fetch strategies')\r\n            return res.json()\r\n        }\r\n    })\r\n\r\n    const { data: confluencesData } = useQuery({\r\n        queryKey: ['confluences', strategyId],\r\n        queryFn: async () => {\r\n            if (!strategyId) return { data: [] }\r\n            const res = await fetch(`/api/confluences?strategy_id=${strategyId}`)\r\n            if (!res.ok) throw new Error('Failed to fetch confluences')\r\n            return res.json()\r\n        },\r\n        enabled: !!strategyId\r\n    })\r\n\r\n    const strategies = strategiesData?.data || []\r\n    const confluences: Confluence[] = confluencesData?.data || []\r\n    const selectedStrategy = strategies.find((s: any) => s.id === strategyId)\r\n\r\n    useEffect(() => {\r\n        if (selectedStrategy) {\r\n            // Rules\r\n            const parsedRules = (selectedStrategy.grading_rules || []).map((r: any) => ({\r\n                id: crypto.randomUUID(),\r\n                ...r\r\n            }))\r\n            setLocalRules(parsedRules)\r\n\r\n            // Overrides\r\n            if (selectedStrategy.category_overrides) {\r\n                setEnableOverrides(true)\r\n                const parsed = Object.entries(selectedStrategy.category_overrides).map(([k, v]) => ({\r\n                    id: crypto.randomUUID(),\r\n                    name: k,\r\n                    weight: Number(v) || 0\r\n                }))\r\n                setLocalOverrides(parsed)\r\n            } else {\r\n                setEnableOverrides(false)\r\n                setLocalOverrides([])\r\n            }\r\n        } else {\r\n            setLocalRules([])\r\n            setEnableOverrides(false)\r\n            setLocalOverrides([])\r\n        }\r\n    }, [selectedStrategy])\r\n\r\n    const updateStrategy = useMutation({\r\n        mutationFn: async () => {\r\n            // clean rules payload\r\n            const rulesPayload = localRules.map(({ id, ...rest }) => rest)\r\n\r\n            // clean overrides payload\r\n            let overridesPayload = null\r\n            if (enableOverrides) {\r\n                overridesPayload = localOverrides.reduce((acc, curr) => {\r\n                    const key = curr.name.trim() || 'Unnamed'\r\n                    acc[key] = curr.weight\r\n                    return acc\r\n                }, {} as Record<string, number>)\r\n            }\r\n\r\n            const res = await fetch(`/api/strategies/${strategyId}`, {\r\n                method: 'PATCH',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({\r\n                    grading_rules: rulesPayload,\r\n                    category_overrides: overridesPayload\r\n                })\r\n            })\r\n            if (!res.ok) throw new Error('Failed to save strategy rules')\r\n            return res.json()\r\n        },\r\n        onSuccess: () => {\r\n            queryClient.invalidateQueries({ queryKey: ['strategies'] })\r\n        }\r\n    })\r\n\r\n    const createConfluence = useMutation({\r\n        mutationFn: async () => {\r\n            const res = await fetch('/api/confluences', {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({\r\n                    strategy_id: strategyId,\r\n                    name: newConfName,\r\n                    weight: Number(newConfWeight),\r\n                    category: newConfCat\r\n                })\r\n            })\r\n            if (!res.ok) throw new Error('Failed to create confluence')\r\n            return res.json()\r\n        },\r\n        onSuccess: () => {\r\n            setNewConfName('')\r\n            setNewConfWeight('1.0')\r\n            queryClient.invalidateQueries({ queryKey: ['confluences', strategyId] })\r\n        }\r\n    })\r\n\r\n    const moveRule = (index: number, direction: 'up' | 'down') => {\r\n        if (direction === 'up' && index === 0) return\r\n        if (direction === 'down' && index === localRules.length - 1) return\r\n        const newRules = [...localRules]\r\n        const target = direction === 'up' ? index - 1 : index + 1\r\n        const temp = newRules[index]\r\n        newRules[index] = newRules[target]\r\n        newRules[target] = temp\r\n        setLocalRules(newRules)\r\n    }\r\n\r\n    const deleteRule = (id: string) => {\r\n        setLocalRules(localRules.filter(r => r.id !== id))\r\n    }\r\n\r\n    const { addCategoryOverride, removeCategoryOverride, updateCategoryOverride, overridesTotal, overridesValid } = useMemo(() => {\r\n        return {\r\n            addCategoryOverride: () => setLocalOverrides([...localOverrides, { id: crypto.randomUUID(), name: 'New Category', weight: 0 }]),\r\n            removeCategoryOverride: (id: string) => setLocalOverrides(localOverrides.filter(w => w.id !== id)),\r\n            updateCategoryOverride: (id: string, field: 'name' | 'weight', value: string | number) => setLocalOverrides(localOverrides.map(w => w.id === id ? { ...w, [field]: value } : w)),\r\n            overridesTotal: localOverrides.reduce((s, w) => s + w.weight, 0),\r\n            overridesValid: localOverrides.reduce((s, w) => s + w.weight, 0) === 100\r\n        }\r\n    }, [localOverrides])\r\n\r\n    const canSave = !enableOverrides || overridesValid\r\n\r\n    return (\r\n        <Card className=\"flex flex-col h-full bg-[var(--background)]\">\r\n            <CardHeader className=\"pb-4 border-b\">\r\n                <div className=\"flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between\">\r\n                    <div>\r\n                        <CardTitle className=\"text-xl\">Strategy Grading Rules</CardTitle>\r\n                        <CardDescription>Setup confluences and auto-grading mapping.</CardDescription>\r\n                    </div>\r\n                    <div className=\"flex items-center gap-3 w-full sm:w-auto\">\r\n                        <Select value={strategyId} onValueChange={setStrategyId}>\r\n                            <SelectTrigger className=\"w-full sm:w-[250px]\">\r\n                                <SelectValue placeholder=\"Select Strategy...\" />\r\n                            </SelectTrigger>\r\n                            <SelectContent>\r\n                                {strategies.map((s: any) => (\r\n                                    <SelectItem key={s.id} value={s.id}>{s.name}</SelectItem>\r\n                                ))}\r\n                            </SelectContent>\r\n                        </Select>\r\n                        <Button\r\n                            disabled={!strategyId || updateStrategy.isPending || !canSave}\r\n                            onClick={() => updateStrategy.mutate()}\r\n                        >\r\n                            <Save className=\"w-4 h-4 mr-2\" />\r\n                            {updateStrategy.isPending ? 'Saving...' : 'Save Strategy'}\r\n                        </Button>\r\n                    </div>\r\n                </div>\r\n            </CardHeader>\r\n\r\n            {!strategyId ? (\r\n                <div className=\"p-16 text-center text-[var(--muted-foreground)] flex flex-col items-center\">\r\n                    <Settings2 className=\"w-12 h-12 mb-4 opacity-20\" />\r\n                    <p className=\"text-lg font-medium text-[var(--foreground)]\">No Strategy Selected</p>\r\n                    <p>Select a strategy above to configure its rules.</p>\r\n                </div>\r\n            ) : (\r\n                <CardContent className=\"p-0 flex-1\">\r\n                    <div className=\"grid md:grid-cols-2 divide-y md:divide-y-0 md:divide-x border-b\">\r\n\r\n                        {/* LEFT COLUMN: Confluences */}\r\n                        <div className=\"p-6 space-y-6 bg-[var(--background)]\">\r\n                            <div>\r\n                                <h3 className=\"font-semibold text-base mb-1\">Checklist Confluences</h3>\r\n                                <p className=\"text-sm text-[var(--muted-foreground)]\">Items required to take trades for this strategy.</p>\r\n                            </div>\r\n\r\n                            <div className=\"space-y-2\">\r\n                                {confluences.length === 0 ? (\r\n                                    <div className=\"p-4 border border-dashed rounded-lg text-center text-sm text-[var(--muted-foreground)]\">\r\n                                        No confluences configured yet.\r\n                                    </div>\r\n                                ) : (\r\n                                    confluences.map(c => (\r\n                                        <div key={c.id} className=\"flex items-center justify-between p-3 border rounded-lg bg-[var(--card)] shadow-sm\">\r\n                                            <div className=\"min-w-0\">\r\n                                                <p className=\"text-sm font-medium truncate\">{c.name}</p>\r\n                                                <p className=\"text-xs text-[var(--muted-foreground)]\">{c.category} • Wt: {c.weight}</p>\r\n                                            </div>\r\n                                            <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8 text-[var(--muted-foreground)] opacity-50\"><Trash2 className=\"w-4 h-4\" /></Button>\r\n                                        </div>\r\n                                    ))\r\n                                )}\r\n                            </div>\r\n\r\n                            <div className=\"p-4 border rounded-lg bg-[var(--secondary)]/30 space-y-4\">\r\n                                <h4 className=\"text-sm font-semibold\">Add Confluence</h4>\r\n                                <div className=\"space-y-3\">\r\n                                    <div className=\"space-y-1\">\r\n                                        <Label className=\"text-xs\">Name</Label>\r\n                                        <Input value={newConfName} onChange={e => setNewConfName(e.target.value)} placeholder=\"e.g. 5m FVG Sweep\" className=\"h-8 text-sm\" />\r\n                                    </div>\r\n                                    <div className=\"grid grid-cols-2 gap-3\">\r\n                                        <div className=\"space-y-1\">\r\n                                            <Label className=\"text-xs\">Category</Label>\r\n                                            <Select value={newConfCat} onValueChange={setNewConfCat}>\r\n                                                <SelectTrigger className=\"h-8 text-sm\"><SelectValue /></SelectTrigger>\r\n                                                <SelectContent>\r\n                                                    {['Risk Management', 'Execution', 'Discipline', 'Strategy', 'Efficiency', 'Custom'].map(c => <SelectItem key={c} value={c}>{c}</SelectItem>)}\r\n                                                </SelectContent>\r\n                                            </Select>\r\n                                        </div>\r\n                                        <div className=\"space-y-1\">\r\n                                            <Label className=\"text-xs\">Weight</Label>\r\n                                            <Input type=\"number\" step=\"0.5\" value={newConfWeight} onChange={e => setNewConfWeight(e.target.value)} className=\"h-8 text-sm font-mono\" />\r\n                                        </div>\r\n                                    </div>\r\n                                    <Button\r\n                                        size=\"sm\"\r\n                                        className=\"w-full\"\r\n                                        disabled={!newConfName || createConfluence.isPending}\r\n                                        onClick={() => createConfluence.mutate()}\r\n                                    >\r\n                                        <Plus className=\"w-4 h-4 mr-2\" /> Add Confluence\r\n                                    </Button>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* RIGHT COLUMN: Grade Rules */}\r\n                        <div className=\"p-6 space-y-6 bg-[var(--secondary)]/10\">\r\n                            <div className=\"flex items-center justify-between\">\r\n                                <div>\r\n                                    <h3 className=\"font-semibold text-base mb-1\">Auto-Grading Rules</h3>\r\n                                    <p className=\"text-sm text-[var(--muted-foreground)]\">Evaluated top to bottom.</p>\r\n                                </div>\r\n                                <Button size=\"sm\" variant=\"secondary\" onClick={() => setIsAddRuleOpen(true)}>\r\n                                    <Plus className=\"w-4 h-4 mr-2\" /> New Rule\r\n                                </Button>\r\n                            </div>\r\n\r\n                            <div className=\"space-y-3\">\r\n                                {localRules.length === 0 ? (\r\n                                    <div className=\"p-6 border border-dashed border-[var(--border)] rounded-lg text-center text-sm text-[var(--muted-foreground)]\">\r\n                                        No grading rules defined.\r\n                                    </div>\r\n                                ) : (\r\n                                    localRules.map((rule, idx) => (\r\n                                        <div key={rule.id} className=\"group relative flex items-center justify-between p-4 border rounded-lg bg-[var(--card)] shadow-sm\">\r\n                                            <div className=\"flex flex-col gap-1 pr-12\">\r\n                                                <div className=\"flex items-center gap-2\">\r\n                                                    <span className=\"inline-flex items-center justify-center px-2 py-0.5 rounded text-xs font-bold font-mono border\" style={{ color: DEFAULT_RUBRIC.find(r => r.grade === rule.grade)?.color || 'inherit', borderColor: 'currentcolor' }}>\r\n                                                        Grade: {rule.grade}\r\n                                                    </span>\r\n                                                    <span className=\"text-xs font-mono px-2 py-0.5 rounded bg-[var(--secondary)] text-[var(--muted-foreground)]\">\r\n                                                        {rule.type.toUpperCase()}\r\n                                                    </span>\r\n                                                </div>\r\n                                                <p className=\"text-sm text-[var(--muted-foreground)] mt-1\">\r\n                                                    {rule.type === 'threshold'\r\n                                                        ? `Requires at least ${rule.min_count} of ${confluences.length} confluences.`\r\n                                                        : rule.type === 'exact'\r\n                                                            ? `Requires exactly ${rule.exact_count} of ${confluences.length} confluences.`\r\n                                                            : `Requires ${rule.required_confluence_ids?.length || 0} specific confluences.`\r\n                                                    }\r\n                                                </p>\r\n                                            </div>\r\n\r\n                                            {/* Actions visible on hover */}\r\n                                            <div className=\"absolute top-1/2 -translate-y-1/2 right-2 flex flex-col gap-1 opacity-0 group-hover:opacity-100 transition-opacity\">\r\n                                                <Button variant=\"ghost\" size=\"icon\" className=\"h-6 w-6\" disabled={idx === 0} onClick={() => moveRule(idx, 'up')}><ArrowUp className=\"w-3 h-3\" /></Button>\r\n                                                <Button variant=\"ghost\" size=\"icon\" className=\"h-6 w-6 text-[var(--color-red)] hover:text-[var(--color-red)] hover:bg-[var(--color-red)]/10\" onClick={() => deleteRule(rule.id)}><Trash2 className=\"w-3 h-3\" /></Button>\r\n                                                <Button variant=\"ghost\" size=\"icon\" className=\"h-6 w-6\" disabled={idx === localRules.length - 1} onClick={() => moveRule(idx, 'down')}><ArrowDown className=\"w-3 h-3\" /></Button>\r\n                                            </div>\r\n                                        </div>\r\n                                    ))\r\n                                )}\r\n                            </div>\r\n                        </div>\r\n\r\n                    </div>\r\n\r\n                    {/* OVERRIDES SECTION */}\r\n                    <div className=\"p-6 bg-[var(--background)]\">\r\n                        <div className=\"flex items-center justify-between border border-[var(--border)] rounded-lg p-4 bg-[var(--secondary)]/20\">\r\n                            <div>\r\n                                <h4 className=\"font-semibold text-sm\">Strategy Category Overrides</h4>\r\n                                <p className=\"text-xs text-[var(--muted-foreground)]\">Use custom category weights for trades in this strategy instead of global ones.</p>\r\n                            </div>\r\n                            <Switch checked={enableOverrides} onCheckedChange={(v) => {\r\n                                setEnableOverrides(v)\r\n                                if (v && localOverrides.length === 0) {\r\n                                    // init with default fields\r\n                                    setLocalOverrides([\r\n                                        { id: crypto.randomUUID(), name: 'Strategy', weight: 80 },\r\n                                        { id: crypto.randomUUID(), name: 'Execution', weight: 20 },\r\n                                    ])\r\n                                }\r\n                            }} />\r\n                        </div>\r\n\r\n                        {enableOverrides && (\r\n                            <div className=\"mt-4 p-4 border rounded-lg bg-[var(--card)]\">\r\n                                <div className=\"space-y-3 max-w-sm\">\r\n                                    {localOverrides.map((w) => (\r\n                                        <div key={w.id} className=\"flex items-center gap-2\">\r\n                                            <Input value={w.name} onChange={(e) => updateCategoryOverride(w.id, 'name', e.target.value)} className=\"h-8 text-sm flex-1\" placeholder=\"Category\" />\r\n                                            <div className=\"relative w-20 flex-shrink-0\">\r\n                                                <Input type=\"number\" value={w.weight === 0 ? '' : w.weight} onChange={(e) => updateCategoryOverride(w.id, 'weight', e.target.value === '' ? 0 : Number(e.target.value))} className=\"h-8 text-sm text-right pr-6 font-mono\" />\r\n                                                <span className=\"absolute right-2 top-1/2 -translate-y-1/2 text-[10px] text-[var(--muted-foreground)]\">%</span>\r\n                                            </div>\r\n                                            <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8 text-[var(--muted-foreground)] hover:text-[var(--color-red)]\" onClick={() => removeCategoryOverride(w.id)}>\r\n                                                <Trash2 className=\"w-3 h-3\" />\r\n                                            </Button>\r\n                                        </div>\r\n                                    ))}\r\n                                    <Button variant=\"outline\" size=\"sm\" onClick={addCategoryOverride} className=\"w-full h-8 text-xs border-dashed mt-2\"><Plus className=\"w-3 h-3 mr-2\" /> Add Override</Button>\r\n                                </div>\r\n                                <div className=\"max-w-sm flex justify-between items-center mt-4 pt-4 border-t\">\r\n                                    <span className=\"text-sm font-semibold\">Override Total</span>\r\n                                    <span className={cn(\"text-sm font-mono font-bold\", overridesValid ? \"text-[var(--color-green)]\" : \"text-[var(--color-red)]\")}>{overridesTotal}%</span>\r\n                                </div>\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                </CardContent>\r\n            )}\r\n\r\n            {/* Dialog: Add Rule (Moved outside to prevent nesting issues) */}\r\n            {isAddRuleOpen && (\r\n                <AddRuleDialog\r\n                    open={isAddRuleOpen}\r\n                    onOpenChange={setIsAddRuleOpen}\r\n                    confluences={confluences}\r\n                    onAdd={(r) => {\r\n                        setLocalRules([...localRules, { id: crypto.randomUUID(), ...r }])\r\n                        setIsAddRuleOpen(false)\r\n                    }}\r\n                />\r\n            )}\r\n        </Card>\r\n    )\r\n}\r\n\r\nfunction AddRuleDialog({ open, onOpenChange, confluences, onAdd }: {\r\n    open: boolean,\r\n    onOpenChange: (v: boolean) => void,\r\n    confluences: Confluence[],\r\n    onAdd: (rule: Omit<GradingRule, 'id'>) => void\r\n}) {\r\n    const [grade, setGrade] = useState('A')\r\n    const [ruleType, setRuleType] = useState<'specific' | 'threshold' | 'exact'>('threshold')\r\n    const [minCount, setMinCount] = useState(1)\r\n    const [exactCount, setExactCount] = useState(1)\r\n    const [reqIds, setReqIds] = useState<string[]>([])\r\n\r\n    const toggleReq = (id: string) => {\r\n        if (reqIds.includes(id)) {\r\n            setReqIds(reqIds.filter(i => i !== id))\r\n        } else {\r\n            setReqIds([...reqIds, id])\r\n        }\r\n    }\r\n\r\n    const handleSave = () => {\r\n        onAdd({\r\n            grade,\r\n            type: ruleType,\r\n            min_count: ruleType === 'threshold' ? minCount : undefined,\r\n            exact_count: ruleType === 'exact' ? exactCount : undefined,\r\n            required_confluence_ids: ruleType === 'specific' ? reqIds : undefined\r\n        })\r\n    }\r\n\r\n    const isRuleValid = ruleType === 'threshold'\r\n        ? (minCount > 0 && minCount <= confluences.length)\r\n        : ruleType === 'exact'\r\n            ? (exactCount > 0 && exactCount <= confluences.length)\r\n            : (reqIds.length > 0)\r\n\r\n    return (\r\n        <Dialog open={open} onOpenChange={onOpenChange}>\r\n            <DialogContent className=\"sm:max-w-[450px]\">\r\n                <DialogHeader>\r\n                    <DialogTitle>Add Grading Rule</DialogTitle>\r\n                    <DialogDescription>Create an auto-grade mapping for this strategy.</DialogDescription>\r\n                </DialogHeader>\r\n\r\n                <div className=\"space-y-6 py-4\">\r\n                    <div className=\"space-y-2\">\r\n                        <Label>Resulting Grade</Label>\r\n                        <Select value={grade} onValueChange={setGrade}>\r\n                            <SelectTrigger>\r\n                                <SelectValue />\r\n                            </SelectTrigger>\r\n                            <SelectContent>\r\n                                {DEFAULT_RUBRIC.map(g => (\r\n                                    <SelectItem key={g.grade} value={g.grade}>\r\n                                        <div className=\"flex items-center gap-2\">\r\n                                            <span className=\"font-mono w-6\" style={{ color: g.color }}>{g.grade}</span>\r\n                                            <span className=\"text-[var(--muted-foreground)]\">({g.label})</span>\r\n                                        </div>\r\n                                    </SelectItem>\r\n                                ))}\r\n                            </SelectContent>\r\n                        </Select>\r\n                    </div>\r\n\r\n                    <div className=\"space-y-3\">\r\n                        <Label>Rule Type</Label>\r\n                        <div className=\"grid grid-cols-3 gap-4\">\r\n                            <div>\r\n                                <input type=\"radio\" value=\"threshold\" checked={ruleType === 'threshold'} onChange={() => setRuleType('threshold')} id=\"opt-threshold\" className=\"peer sr-only\" />\r\n                                <label htmlFor=\"opt-threshold\" className=\"flex flex-col items-center justify-between rounded-md border-2 border-muted bg-popover p-4 hover:bg-[var(--secondary)] peer-checked:border-[var(--primary)] cursor-pointer\">\r\n                                    <span className=\"text-sm font-semibold\">Min Count</span>\r\n                                    <span className=\"text-xs text-[var(--muted-foreground)] mt-1\">At least X confs</span>\r\n                                </label>\r\n                            </div>\r\n                            <div>\r\n                                <input type=\"radio\" value=\"specific\" checked={ruleType === 'specific'} onChange={() => setRuleType('specific')} id=\"opt-specific\" className=\"peer sr-only\" />\r\n                                <label htmlFor=\"opt-specific\" className=\"flex flex-col items-center justify-between text-center rounded-md border-2 border-muted bg-popover p-4 hover:bg-[var(--secondary)] peer-checked:border-[var(--primary)] cursor-pointer\">\r\n                                    <span className=\"text-sm font-semibold\">Specific</span>\r\n                                    <span className=\"text-xs text-[var(--muted-foreground)] mt-1\">Exact combinations</span>\r\n                                </label>\r\n                            </div>\r\n                            <div>\r\n                                <input type=\"radio\" value=\"exact\" checked={ruleType === 'exact'} onChange={() => setRuleType('exact')} id=\"opt-exact\" className=\"peer sr-only\" />\r\n                                <label htmlFor=\"opt-exact\" className=\"flex flex-col items-center justify-between text-center rounded-md border-2 border-muted bg-popover p-4 hover:bg-[var(--secondary)] peer-checked:border-[var(--primary)] cursor-pointer\">\r\n                                    <span className=\"text-sm font-semibold\">Exact Count</span>\r\n                                    <span className=\"text-xs text-[var(--muted-foreground)] mt-1\">Exactly X confs</span>\r\n                                </label>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className=\"p-4 rounded-lg bg-[var(--secondary)]/30 border border-[var(--border)]\">\r\n                        {ruleType === 'threshold' ? (\r\n                            <div className=\"space-y-3\">\r\n                                <Label>Select Minimum Count</Label>\r\n                                <Select value={String(minCount)} onValueChange={(v) => setMinCount(Number(v))}>\r\n                                    <SelectTrigger>\r\n                                        <SelectValue />\r\n                                    </SelectTrigger>\r\n                                    <SelectContent>\r\n                                        {Array.from({ length: Math.max(1, confluences.length) }).map((_, i) => (\r\n                                            <SelectItem key={i + 1} value={String(i + 1)}>\r\n                                                At least {i + 1} of {confluences.length} confluences\r\n                                            </SelectItem>\r\n                                        ))}\r\n                                    </SelectContent>\r\n                                </Select>\r\n                            </div>\r\n                        ) : ruleType === 'exact' ? (\r\n                            <div className=\"space-y-3\">\r\n                                <Label>Select Exact Count</Label>\r\n                                <Select value={String(exactCount)} onValueChange={(v) => setExactCount(Number(v))}>\r\n                                    <SelectTrigger>\r\n                                        <SelectValue />\r\n                                    </SelectTrigger>\r\n                                    <SelectContent>\r\n                                        {Array.from({ length: Math.max(1, confluences.length) }).map((_, i) => (\r\n                                            <SelectItem key={i + 1} value={String(i + 1)}>\r\n                                                Exactly {i + 1} of {confluences.length} confluences\r\n                                            </SelectItem>\r\n                                        ))}\r\n                                    </SelectContent>\r\n                                </Select>\r\n                            </div>\r\n                        ) : (\r\n                            <div className=\"space-y-3\">\r\n                                <Label>Required Confluences</Label>\r\n                                <div className=\"space-y-2 max-h-[150px] overflow-y-auto pr-2\">\r\n                                    {confluences.length === 0 ? <p className=\"text-sm text-[var(--muted-foreground)]\">No confluences available.</p> : null}\r\n                                    {confluences.map(c => (\r\n                                        <div key={c.id} className=\"flex items-center space-x-2\">\r\n                                            <Checkbox id={`req-${c.id}`} checked={reqIds.includes(c.id)} onCheckedChange={() => toggleReq(c.id)} />\r\n                                            <label htmlFor={`req-${c.id}`} className=\"text-sm cursor-pointer\">{c.name}</label>\r\n                                        </div>\r\n                                    ))}\r\n                                </div>\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n\r\n                <DialogFooter>\r\n                    <Button variant=\"outline\" onClick={() => onOpenChange(false)}>Cancel</Button>\r\n                    <Button disabled={!isRuleValid} onClick={handleSave}>Add Rule</Button>\r\n                </DialogFooter>\r\n            </DialogContent>\r\n        </Dialog >\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\components\\grading\\grading-client.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Target' is defined but never used.","line":7,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":7,"endColumn":16,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Target"},"fix":{"range":[288,295],"text":""},"desc":"Remove unused variable \"Target\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Area' is defined but never used.","line":8,"column":134,"nodeType":"Identifier","messageId":"unusedVar","endLine":8,"endColumn":138,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Area"},"fix":{"range":[469,475],"text":""},"desc":"Remove unused variable \"Area\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'AreaChart' is defined but never used.","line":8,"column":140,"nodeType":"Identifier","messageId":"unusedVar","endLine":8,"endColumn":149,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"AreaChart"},"fix":{"range":[475,486],"text":""},"desc":"Remove unused variable \"AreaChart\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Bar' is defined but never used.","line":8,"column":151,"nodeType":"Identifier","messageId":"unusedVar","endLine":8,"endColumn":154,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Bar"},"fix":{"range":[486,491],"text":""},"desc":"Remove unused variable \"Bar\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'BarChart' is defined but never used.","line":8,"column":156,"nodeType":"Identifier","messageId":"unusedVar","endLine":8,"endColumn":164,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"BarChart"},"fix":{"range":[491,501],"text":""},"desc":"Remove unused variable \"BarChart\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Dialog' is defined but never used.","line":12,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":12,"endColumn":16,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Dialog"},"fix":{"range":[745,752],"text":""},"desc":"Remove unused variable \"Dialog\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'DialogContent' is defined but never used.","line":12,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":12,"endColumn":31,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"DialogContent"},"fix":{"range":[751,766],"text":""},"desc":"Remove unused variable \"DialogContent\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'DialogHeader' is defined but never used.","line":12,"column":33,"nodeType":"Identifier","messageId":"unusedVar","endLine":12,"endColumn":45,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"DialogHeader"},"fix":{"range":[766,780],"text":""},"desc":"Remove unused variable \"DialogHeader\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'DialogTitle' is defined but never used.","line":12,"column":47,"nodeType":"Identifier","messageId":"unusedVar","endLine":12,"endColumn":58,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"DialogTitle"},"fix":{"range":[780,793],"text":""},"desc":"Remove unused variable \"DialogTitle\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'DialogDescription' is defined but never used.","line":12,"column":60,"nodeType":"Identifier","messageId":"unusedVar","endLine":12,"endColumn":77,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"DialogDescription"},"fix":{"range":[793,812],"text":""},"desc":"Remove unused variable \"DialogDescription\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'DialogFooter' is defined but never used.","line":12,"column":79,"nodeType":"Identifier","messageId":"unusedVar","endLine":12,"endColumn":91,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"DialogFooter"},"fix":{"range":[736,860],"text":""},"desc":"Remove unused import declaration."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Input' is defined but never used.","line":13,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":13,"endColumn":15,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"Input"},"fix":{"range":[860,907],"text":""},"desc":"Remove unused import declaration."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Label' is defined but never used.","line":14,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":14,"endColumn":15,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"Label"},"fix":{"range":[907,954],"text":""},"desc":"Remove unused import declaration."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'cn' is defined but never used.","line":15,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":15,"endColumn":12,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"cn"},"fix":{"range":[954,988],"text":""},"desc":"Remove unused import declaration."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isLoading' is assigned a value but never used.","line":109,"column":19,"nodeType":"Identifier","messageId":"unusedVar","endLine":109,"endColumn":28},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has a missing dependency: 'now'. Either include it or remove the dependency array.","line":237,"column":8,"nodeType":"ArrayExpression","endLine":237,"endColumn":16,"suggestions":[{"desc":"Update the dependencies array to be: [now, trades]","fix":{"range":[8853,8861],"text":"[now, trades]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":373,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":373,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16841,16844],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16841,16844],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":422,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":422,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19779,19782],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19779,19782],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":538,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":538,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[28463,28466],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[28463,28466],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":16,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\r\n\r\nimport React, { useState, useEffect, useMemo } from 'react'\r\nimport { useQuery } from '@tanstack/react-query'\r\nimport { format, subDays, startOfWeek, endOfWeek, startOfMonth, endOfMonth, isWithinInterval, parseISO } from 'date-fns'\r\nimport Link from 'next/link'\r\nimport { Target, Download, Settings } from 'lucide-react'\r\nimport { Line, LineChart, Radar, RadarChart, PolarGrid, PolarAngleAxis, PolarRadiusAxis, ResponsiveContainer, XAxis, YAxis, Tooltip, Area, AreaChart, Bar, BarChart } from 'recharts'\r\nimport { Button } from '@/components/ui/button'\r\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\"\r\nimport { Tabs, TabsList, TabsTrigger } from '@/components/ui/tabs'\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription, DialogFooter } from '@/components/ui/dialog'\r\nimport { Input } from '@/components/ui/input'\r\nimport { Label } from '@/components/ui/label'\r\nimport { cn } from '@/lib/utils'\r\n\r\nconst formatCurrency = (val: number) => {\r\n    return new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(val);\r\n};\r\n\r\n// Types\r\ntype TradeGrade = {\r\n    id: string\r\n    tradeId: string\r\n    grade: string\r\n    riskManagementScore: number | null\r\n    executionScore: number | null\r\n    disciplineScore: number | null\r\n    strategyScore: number | null\r\n    efficiencyScore: number | null\r\n    createdAt: string\r\n    tradingDay: string | null\r\n    netPnl: number\r\n}\r\n\r\ntype CategoryWeights = {\r\n    risk_management: number\r\n    execution: number\r\n    discipline: number\r\n    strategy: number\r\n    efficiency: number\r\n}\r\n\r\nconst DEFAULT_WEIGHTS: CategoryWeights = {\r\n    risk_management: 25,\r\n    execution: 20,\r\n    discipline: 25,\r\n    strategy: 15,\r\n    efficiency: 15\r\n}\r\n\r\n// Helpers\r\nconst getGradeColor = (score: number) => {\r\n    if (score >= 90) return '#22C55E' // A+ / A\r\n    if (score >= 75) return '#3B82F6' // B+\r\n    if (score >= 60) return '#F59E0B' // B / B-\r\n    if (score >= 40) return '#F97316' // C (Poor)\r\n    return '#EF4444' // D / F (Critical)\r\n}\r\n\r\nconst getGradeLabel = (score: number) => {\r\n    if (score >= 90) return { label: 'Excellent', grade: 'A' }\r\n    if (score >= 75) return { label: 'Good', grade: 'B+' }\r\n    if (score >= 60) return { label: 'Average', grade: 'B' }\r\n    if (score >= 40) return { label: 'Poor', grade: 'C' }\r\n    return { label: 'Critical', grade: 'C-' }\r\n}\r\n\r\nconst getOverallScore = (trade: TradeGrade) => {\r\n    let sum = 0\r\n    let count = 0\r\n    const cols = ['riskManagementScore', 'executionScore', 'disciplineScore', 'strategyScore', 'efficiencyScore'] as const\r\n    cols.forEach(c => {\r\n        if (trade[c] !== null) {\r\n            sum += trade[c]!\r\n            count++\r\n        }\r\n    })\r\n    return count > 0 ? sum / count : null\r\n}\r\n\r\nexport function GradingClient() {\r\n    const [weights, setWeights] = useState<CategoryWeights>(DEFAULT_WEIGHTS)\r\n    const [activeTab, setActiveTab] = useState<'today' | 'week' | 'month' | 'lifetime'>('today')\r\n    const [showHowItWorks, setShowHowItWorks] = useState(false)\r\n\r\n    useEffect(() => {\r\n        const seen = localStorage.getItem('seen-grading-dashboard-how')\r\n        if (!seen) setShowHowItWorks(true)\r\n    }, [])\r\n\r\n    const toggleHowItWorks = () => {\r\n        setShowHowItWorks(prev => !prev)\r\n        localStorage.setItem('seen-grading-dashboard-how', 'true')\r\n    }\r\n\r\n    // Load weights from local storage\r\n    useEffect(() => {\r\n        const stored = localStorage.getItem('grading-weights')\r\n        if (stored) {\r\n            try {\r\n                setWeights(JSON.parse(stored))\r\n            } catch (e) {\r\n                console.error(\"Failed parsing valid weights\", e)\r\n            }\r\n        }\r\n    }, [])\r\n\r\n    const { data, isLoading } = useQuery<{ data: TradeGrade[] }>({\r\n        queryKey: ['grading-summary'],\r\n        queryFn: async () => {\r\n            const res = await fetch('/api/grading/summary')\r\n            if (!res.ok) throw new Error('Failed to fetch grading summary')\r\n            return res.json()\r\n        }\r\n    })\r\n\r\n    const trades = data?.data || []\r\n\r\n    // Derived periods logic\r\n    const now = new Date()\r\n    const todayStr = format(now, 'yyyy-MM-dd')\r\n    const weekStart = startOfWeek(now, { weekStartsOn: 1 })\r\n    const weekEnd = endOfWeek(now, { weekStartsOn: 1 })\r\n    const monthStart = startOfMonth(now)\r\n    const monthEnd = endOfMonth(now)\r\n\r\n    const filterByPeriod = (period: 'today' | 'week' | 'month' | 'lifetime') => {\r\n        return trades.filter(t => {\r\n            if (!t.tradingDay) return false\r\n            const d = parseISO(t.tradingDay)\r\n            if (period === 'today') return t.tradingDay === todayStr\r\n            if (period === 'week') return isWithinInterval(d, { start: weekStart, end: weekEnd })\r\n            if (period === 'month') return isWithinInterval(d, { start: monthStart, end: monthEnd })\r\n            return true\r\n        })\r\n    }\r\n\r\n    const periodData = {\r\n        today: filterByPeriod('today'),\r\n        week: filterByPeriod('week'),\r\n        month: filterByPeriod('month'),\r\n        lifetime: filterByPeriod('lifetime'),\r\n    }\r\n\r\n    const computeStats = (periodTrades: TradeGrade[]) => {\r\n        if (periodTrades.length === 0) return null\r\n\r\n        let totalScore = 0\r\n        let scorableCount = 0\r\n        let totalPnl = 0\r\n\r\n        // Component averages\r\n        const categorySums = { rm: 0, ex: 0, di: 0, st: 0, ef: 0 }\r\n        const categoryCounts = { rm: 0, ex: 0, di: 0, st: 0, ef: 0 }\r\n\r\n        // Distributions\r\n        const dist: Record<string, number> = { 'A+': 0, 'A': 0, 'B+': 0, 'B': 0, 'B-': 0, 'C': 0 }\r\n\r\n        periodTrades.forEach(t => {\r\n            totalPnl += Number(t.netPnl || 0)\r\n\r\n            if (dist[t.grade] !== undefined) dist[t.grade]++\r\n            else dist[t.grade] = 1\r\n\r\n            const score = getOverallScore(t)\r\n            if (score !== null) {\r\n                totalScore += score\r\n                scorableCount++\r\n            }\r\n\r\n            if (t.riskManagementScore !== null) { categorySums.rm += t.riskManagementScore; categoryCounts.rm++ }\r\n            if (t.executionScore !== null) { categorySums.ex += t.executionScore; categoryCounts.ex++ }\r\n            if (t.disciplineScore !== null) { categorySums.di += t.disciplineScore; categoryCounts.di++ }\r\n            if (t.strategyScore !== null) { categorySums.st += t.strategyScore; categoryCounts.st++ }\r\n            if (t.efficiencyScore !== null) { categorySums.ef += t.efficiencyScore; categoryCounts.ef++ }\r\n        })\r\n\r\n        const avgScore = scorableCount > 0 ? totalScore / scorableCount : 0\r\n\r\n        // Category specific averages\r\n        const catAverages = {\r\n            rm: categoryCounts.rm > 0 ? categorySums.rm / categoryCounts.rm : 0,\r\n            ex: categoryCounts.ex > 0 ? categorySums.ex / categoryCounts.ex : 0,\r\n            di: categoryCounts.di > 0 ? categorySums.di / categoryCounts.di : 0,\r\n            st: categoryCounts.st > 0 ? categorySums.st / categoryCounts.st : 0,\r\n            ef: categoryCounts.ef > 0 ? categorySums.ef / categoryCounts.ef : 0,\r\n        }\r\n\r\n        // Weighted Score\r\n        const weightedTotal =\r\n            (catAverages.rm * (weights.risk_management / 100)) +\r\n            (catAverages.ex * (weights.execution / 100)) +\r\n            (catAverages.di * (weights.discipline / 100)) +\r\n            (catAverages.st * (weights.strategy / 100)) +\r\n            (catAverages.ef * (weights.efficiency / 100))\r\n\r\n        return {\r\n            count: periodTrades.length,\r\n            avgScore,\r\n            totalPnl,\r\n            catAverages,\r\n            weightedTotal,\r\n            dist\r\n        }\r\n    }\r\n\r\n    const activeStats = computeStats(periodData[activeTab])\r\n\r\n    // Chart Data preparation\r\n    const historyData = useMemo(() => {\r\n        // Generate buckets (last 12 weeks)\r\n        const buckets: Record<string, { sum: number, count: number }> = {}\r\n\r\n        // Fill last 12 weeks with empty data to ensure contiguous line\r\n        for (let i = 11; i >= 0; i--) {\r\n            const wStart = startOfWeek(subDays(now, i * 7), { weekStartsOn: 1 })\r\n            buckets[format(wStart, 'MMM d')] = { sum: 0, count: 0 }\r\n        }\r\n\r\n        trades.forEach(t => {\r\n            if (!t.tradingDay) return\r\n            const d = parseISO(t.tradingDay)\r\n            const wStart = startOfWeek(d, { weekStartsOn: 1 })\r\n            const key = format(wStart, 'MMM d')\r\n            const score = getOverallScore(t)\r\n            if (score !== null && buckets[key]) {\r\n                buckets[key].sum += score\r\n                buckets[key].count++\r\n            }\r\n        })\r\n\r\n        return Object.entries(buckets).map(([week, data]) => ({\r\n            week,\r\n            score: data.count > 0 ? Math.round(data.sum / data.count) : null\r\n        }))\r\n    }, [trades])\r\n\r\n    const radarData = useMemo(() => {\r\n        if (!activeStats) return []\r\n        return [\r\n            { subject: 'Risk', A: Math.round(activeStats.catAverages.rm) || 0, fullMark: 100 },\r\n            { subject: 'Execution', A: Math.round(activeStats.catAverages.ex) || 0, fullMark: 100 },\r\n            { subject: 'Discipline', A: Math.round(activeStats.catAverages.di) || 0, fullMark: 100 },\r\n            { subject: 'Strategy', A: Math.round(activeStats.catAverages.st) || 0, fullMark: 100 },\r\n            { subject: 'Efficiency', A: Math.round(activeStats.catAverages.ef) || 0, fullMark: 100 },\r\n        ]\r\n    }, [activeStats])\r\n\r\n    const exportCSV = () => {\r\n        const rows = [\r\n            ['Period', 'Trade Count', 'Avg Score', 'Weighted Total', 'Grade', 'Total PnL', 'Risk Score', 'Execution Score', 'Discipline Score', 'Strategy Score', 'Efficiency Score'],\r\n        ]\r\n\r\n        const periods = [\r\n            { key: 'Today', data: computeStats(periodData.today) },\r\n            { key: 'This Week', data: computeStats(periodData.week) },\r\n            { key: 'This Month', data: computeStats(periodData.month) },\r\n            { key: 'Lifetime', data: computeStats(periodData.lifetime) },\r\n        ]\r\n\r\n        periods.forEach(p => {\r\n            if (p.data) {\r\n                rows.push([\r\n                    p.key,\r\n                    p.data.count.toString(),\r\n                    p.data.avgScore.toFixed(1),\r\n                    p.data.weightedTotal.toFixed(1),\r\n                    getGradeLabel(p.data.weightedTotal).grade,\r\n                    p.data.totalPnl.toString(),\r\n                    p.data.catAverages.rm.toFixed(1),\r\n                    p.data.catAverages.ex.toFixed(1),\r\n                    p.data.catAverages.di.toFixed(1),\r\n                    p.data.catAverages.st.toFixed(1),\r\n                    p.data.catAverages.ef.toFixed(1)\r\n                ])\r\n            } else {\r\n                rows.push([p.key, '0', '', '', '', '', '', '', '', '', ''])\r\n            }\r\n        })\r\n\r\n        const csvContent = \"data:text/csv;charset=utf-8,\" + rows.map(e => e.join(\",\")).join(\"\\n\");\r\n        const encodedUri = encodeURI(csvContent);\r\n        const link = document.createElement(\"a\");\r\n        link.setAttribute(\"href\", encodedUri);\r\n        link.setAttribute(\"download\", `grading-report-${format(new Date(), 'yyyy-MM-dd')}.csv`);\r\n        document.body.appendChild(link);\r\n        link.click();\r\n        document.body.removeChild(link);\r\n    }\r\n\r\n    return (\r\n        <div className=\"space-y-6 max-w-7xl mx-auto pb-20\">\r\n            {/* Header */}\r\n            <div className=\"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4\">\r\n                <div>\r\n                    <h1 className=\"text-3xl font-bold tracking-tight text-[var(--foreground)]\">Grading</h1>\r\n                    <p className=\"text-[var(--muted-foreground)]\">Your performance scorecards calculated from actual trades.</p>\r\n                </div>\r\n                <div className=\"flex gap-2 w-full sm:w-auto\">\r\n                    <Link href=\"/grading/configure\" className=\"flex-1 sm:flex-none\">\r\n                        <Button variant=\"outline\" className=\"w-full\">\r\n                            <Settings className=\"w-4 h-4 mr-2\" /> Customize & Configure\r\n                        </Button>\r\n                    </Link>\r\n                    <Button variant=\"outline\" onClick={exportCSV} className=\"flex-1 sm:flex-none\">\r\n                        <Download className=\"w-4 h-4 mr-2\" /> Export Report\r\n                    </Button>\r\n                </div>\r\n            </div>\r\n\r\n            {/* How It Works Collapsible */}\r\n            <div className=\"bg-[var(--secondary)]/20 border border-[var(--border)] rounded-md overflow-hidden\">\r\n                <button\r\n                    onClick={toggleHowItWorks}\r\n                    className=\"w-full flex items-center justify-between px-4 py-3 text-sm font-semibold uppercase tracking-wide text-[var(--muted-foreground)] hover:text-[var(--foreground)] hover:bg-[var(--secondary)]/40 transition-colors\"\r\n                >\r\n                    <span>Understanding Your Grading Dashboard</span>\r\n                    <span className=\"text-xl leading-none\">{showHowItWorks ? '−' : '+'}</span>\r\n                </button>\r\n                {showHowItWorks && (\r\n                    <div className=\"px-4 pb-4 pt-2 border-t border-[var(--border)] text-sm text-[var(--muted-foreground)] space-y-3 border-l-2 border-l-[var(--color-blue)]\">\r\n                        <p>1. <strong>Data Source:</strong> Grades are pulled from individual trades logged in your Journal.</p>\r\n                        <p>2. <strong>Weighted Scores:</strong> The overall grade relies on how you weighted each category (e.g. Risk Management, Execution) in your global or strategy-specific settings.</p>\r\n                        <p>3. <strong>Confluences:</strong> Strategies automatically calculate grades if you set up Auto-Grading Rules based on checklist confluences.</p>\r\n                        <div className=\"pt-2\">\r\n                            <Link href=\"/grading/configure\" className=\"text-[var(--color-blue)] hover:underline inline-flex items-center gap-1 font-medium\">\r\n                                <Settings className=\"w-4 h-4\" /> Go to Grading Configuration\r\n                            </Link>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n            </div>\r\n            {/* Scorecards */}\r\n            <div className=\"grid grid-cols-2 lg:grid-cols-4 gap-4\">\r\n                <Scorecard title=\"Today\" stats={computeStats(periodData.today)} />\r\n                <Scorecard title=\"This Week\" stats={computeStats(periodData.week)} />\r\n                <Scorecard title=\"This Month\" stats={computeStats(periodData.month)} />\r\n                <Scorecard title=\"Lifetime\" stats={computeStats(periodData.lifetime)} />\r\n            </div>\r\n\r\n            {/* Charts */}\r\n            <div className=\"grid lg:grid-cols-2 gap-4\">\r\n                <Card className=\"flex flex-col h-[350px]\">\r\n                    <CardHeader>\r\n                        <CardTitle className=\"text-lg\">Score History</CardTitle>\r\n                        <CardDescription>Weekly performance score trend</CardDescription>\r\n                    </CardHeader>\r\n                    <CardContent className=\"flex-1 min-h-0 pt-0\">\r\n                        {historyData.some(d => d.score !== null) ? (\r\n                            <ResponsiveContainer width=\"100%\" height=\"100%\">\r\n                                <LineChart data={historyData} margin={{ top: 5, right: 10, left: -20, bottom: 0 }}>\r\n                                    <XAxis\r\n                                        dataKey=\"week\"\r\n                                        stroke=\"var(--muted-foreground)\"\r\n                                        fontSize={11}\r\n                                        tickLine={false}\r\n                                        axisLine={false}\r\n                                        dy={10}\r\n                                    />\r\n                                    <YAxis\r\n                                        stroke=\"var(--muted-foreground)\"\r\n                                        fontSize={11}\r\n                                        tickLine={false}\r\n                                        axisLine={false}\r\n                                        domain={[0, 100]}\r\n                                        ticks={[0, 25, 50, 75, 100]}\r\n                                    />\r\n                                    <Tooltip\r\n                                        contentStyle={{ backgroundColor: 'var(--card)', borderColor: 'var(--border)', color: 'var(--foreground)' }}\r\n                                        itemStyle={{ color: '#3B82F6' }}\r\n                                        labelStyle={{ color: 'var(--muted-foreground)', marginBottom: '4px' }}\r\n                                        formatter={(value: any) => [`${value}/100`, 'Score']}\r\n                                    />\r\n                                    <Line\r\n                                        type=\"monotone\"\r\n                                        dataKey=\"score\"\r\n                                        stroke=\"#3B82F6\"\r\n                                        strokeWidth={2}\r\n                                        dot={{ fill: '#3B82F6', r: 3, strokeWidth: 0 }}\r\n                                        activeDot={{ r: 5 }}\r\n                                        connectNulls\r\n                                    />\r\n                                </LineChart>\r\n                            </ResponsiveContainer>\r\n                        ) : (\r\n                            <div className=\"w-full h-full flex items-center justify-center text-sm text-[var(--muted-foreground)]\">\r\n                                No score history yet\r\n                            </div>\r\n                        )}\r\n                    </CardContent>\r\n                </Card>\r\n\r\n                <Card className=\"flex flex-col h-[350px]\">\r\n                    <CardHeader>\r\n                        <CardTitle className=\"text-lg\">Performance Radar</CardTitle>\r\n                        <CardDescription>Strengths and weaknesses by category</CardDescription>\r\n                    </CardHeader>\r\n                    <CardContent className=\"flex-1 min-h-0 flex items-center justify-center pt-0\">\r\n                        {activeStats && activeStats.count > 0 ? (\r\n                            <ResponsiveContainer width=\"100%\" height=\"100%\">\r\n                                <RadarChart cx=\"50%\" cy=\"50%\" outerRadius=\"70%\" data={radarData}>\r\n                                    <PolarGrid stroke=\"var(--border)\" />\r\n                                    <PolarAngleAxis dataKey=\"subject\" tick={{ fill: 'var(--muted-foreground)', fontSize: 11 }} />\r\n                                    <PolarRadiusAxis angle={30} domain={[0, 100]} tick={false} axisLine={false} />\r\n                                    <Radar name=\"Score\" dataKey=\"A\" stroke=\"#3B82F6\" fill=\"#3B82F6\" fillOpacity={0.2} strokeWidth={2} />\r\n                                    <Tooltip\r\n                                        contentStyle={{ backgroundColor: 'var(--card)', borderColor: 'var(--border)', color: 'var(--foreground)' }}\r\n                                        itemStyle={{ color: '#3B82F6' }}\r\n                                    />\r\n                                </RadarChart>\r\n                            </ResponsiveContainer>\r\n                        ) : (\r\n                            <div className=\"text-sm text-[var(--muted-foreground)]\">No data for selected period</div>\r\n                        )}\r\n                    </CardContent>\r\n                </Card>\r\n            </div>\r\n\r\n            {/* Tabs and Breakdown */}\r\n            <div>\r\n                <Tabs value={activeTab} onValueChange={(v: any) => setActiveTab(v)}>\r\n                    <TabsList className=\"mb-4\">\r\n                        <TabsTrigger value=\"today\">Today</TabsTrigger>\r\n                        <TabsTrigger value=\"week\">This Week</TabsTrigger>\r\n                        <TabsTrigger value=\"month\">This Month</TabsTrigger>\r\n                        <TabsTrigger value=\"lifetime\">Lifetime</TabsTrigger>\r\n                    </TabsList>\r\n\r\n                    <Card>\r\n                        <CardContent className=\"p-5 sm:p-6\">\r\n                            {!activeStats || activeStats.count === 0 ? (\r\n                                <div className=\"py-12 text-center text-[var(--muted-foreground)]\">\r\n                                    No graded trades in this period.\r\n                                </div>\r\n                            ) : (\r\n                                <div className=\"space-y-8\">\r\n                                    {/* Header */}\r\n                                    <div className=\"flex justify-between items-start\">\r\n                                        <div>\r\n                                            <h3 className=\"text-lg font-semibold capitalize\">{activeTab === 'lifetime' ? 'Lifetime' : `This ${activeTab}`} Breakdown</h3>\r\n                                            <p className=\"text-sm text-[var(--muted-foreground)]\">{activeStats.count} trades · {activeStats.totalPnl >= 0 ? '+' : ''}{formatCurrency(activeStats.totalPnl)}</p>\r\n                                        </div>\r\n                                        <div className=\"text-right\">\r\n                                            <div className=\"text-4xl font-mono font-bold\" style={{ color: getGradeColor(activeStats.weightedTotal) }}>\r\n                                                {Math.round(activeStats.weightedTotal)} <span className=\"text-xl text-[var(--muted-foreground)] font-sans\">/ 100</span>\r\n                                            </div>\r\n                                        </div>\r\n                                    </div>\r\n\r\n                                    {/* Progress Bars */}\r\n                                    <div className=\"grid gap-4\">\r\n                                        <CategoryRow name=\"Risk Management\" score={activeStats.catAverages.rm} weight={weights.risk_management} />\r\n                                        <CategoryRow name=\"Execution\" score={activeStats.catAverages.ex} weight={weights.execution} />\r\n                                        <CategoryRow name=\"Discipline\" score={activeStats.catAverages.di} weight={weights.discipline} />\r\n                                        <CategoryRow name=\"Strategy\" score={activeStats.catAverages.st} weight={weights.strategy} />\r\n                                        <CategoryRow name=\"Efficiency\" score={activeStats.catAverages.ef} weight={weights.efficiency} />\r\n                                    </div>\r\n\r\n                                    {/* Total row */}\r\n                                    <div className=\"pt-4 border-t flex justify-between items-center bg-[var(--sidebar)]/50 p-4 rounded-lg\">\r\n                                        <span className=\"font-semibold\">Weighted Total</span>\r\n                                        <div className=\"flex items-center gap-3\">\r\n                                            <span className=\"text-xl font-mono font-bold\">{activeStats.weightedTotal.toFixed(1)}</span>\r\n                                            <span className=\"text-xl text-[var(--muted-foreground)]\">→</span>\r\n                                            <span className=\"px-2.5 py-1 text-sm font-bold font-mono rounded bg-[var(--background)] border\" style={{ color: getGradeColor(activeStats.weightedTotal), borderColor: getGradeColor(activeStats.weightedTotal) + '40' }}>\r\n                                                {getGradeLabel(activeStats.weightedTotal).grade}\r\n                                            </span>\r\n                                        </div>\r\n                                    </div>\r\n\r\n                                    {/* Distribution */}\r\n                                    <div className=\"pt-4\">\r\n                                        <h4 className=\"font-medium mb-4 text-sm uppercase tracking-wider text-[var(--muted-foreground)]\">Grade Distribution</h4>\r\n                                        <div className=\"space-y-2\">\r\n                                            {['A+', 'A', 'B+', 'B', 'B-', 'C'].map((g) => {\r\n                                                const count = activeStats.dist[g] || 0\r\n                                                const pct = activeStats.count > 0 ? (count / activeStats.count) * 100 : 0\r\n                                                let rawScoreMap = 0;\r\n                                                if (g === 'A+') rawScoreMap = 100\r\n                                                else if (g === 'A') rawScoreMap = 95\r\n                                                else if (g === 'B+') rawScoreMap = 85\r\n                                                else if (g === 'B') rawScoreMap = 70\r\n                                                else if (g === 'B-') rawScoreMap = 65\r\n                                                else rawScoreMap = 40\r\n                                                return (\r\n                                                    <div key={g} className=\"flex items-center gap-3 text-sm font-mono\">\r\n                                                        <div className=\"w-8 font-bold\" style={{ color: getGradeColor(rawScoreMap) }}>{g}</div>\r\n                                                        <div className=\"flex-1 h-2.5 bg-[var(--sidebar)] rounded overflow-hidden\">\r\n                                                            <div className=\"h-full rounded transition-all duration-500\" style={{ width: `${pct}%`, backgroundColor: getGradeColor(rawScoreMap) }} />\r\n                                                        </div>\r\n                                                        <div className=\"w-8 text-right text-[var(--muted-foreground)]\">{count}</div>\r\n                                                    </div>\r\n                                                )\r\n                                            })}\r\n                                        </div>\r\n                                    </div>\r\n\r\n                                </div>\r\n                            )}\r\n                        </CardContent>\r\n                    </Card>\r\n                </Tabs>\r\n            </div>\r\n\r\n            {/* Rubric */}\r\n            <div>\r\n                <h4 className=\"font-medium mb-3 text-sm uppercase tracking-wider text-[var(--muted-foreground)]\">Scoring Rubric</h4>\r\n                <div className=\"grid grid-cols-2 md:grid-cols-5 gap-2\">\r\n                    <div className=\"border rounded bg-[#22C55E]/10 border-[#22C55E]/30 p-2 text-center\">\r\n                        <div className=\"text-[#22C55E] font-mono font-bold\">90-100</div>\r\n                        <div className=\"text-[11px] text-[#22C55E] uppercase tracking-wider mt-0.5\">Excellent</div>\r\n                    </div>\r\n                    <div className=\"border rounded bg-[#3B82F6]/10 border-[#3B82F6]/30 p-2 text-center\">\r\n                        <div className=\"text-[#3B82F6] font-mono font-bold\">75-89</div>\r\n                        <div className=\"text-[11px] text-[#3B82F6] uppercase tracking-wider mt-0.5\">Good</div>\r\n                    </div>\r\n                    <div className=\"border rounded bg-[#F59E0B]/10 border-[#F59E0B]/30 p-2 text-center\">\r\n                        <div className=\"text-[#F59E0B] font-mono font-bold\">60-74</div>\r\n                        <div className=\"text-[11px] text-[#F59E0B] uppercase tracking-wider mt-0.5\">Average</div>\r\n                    </div>\r\n                    <div className=\"border rounded bg-[#F97316]/10 border-[#F97316]/30 p-2 text-center\">\r\n                        <div className=\"text-[#F97316] font-mono font-bold\">40-59</div>\r\n                        <div className=\"text-[11px] text-[#F97316] uppercase tracking-wider mt-0.5\">Poor</div>\r\n                    </div>\r\n                    <div className=\"border rounded bg-[#EF4444]/10 border-[#EF4444]/30 p-2 text-center\">\r\n                        <div className=\"text-[#EF4444] font-mono font-bold\">0-39</div>\r\n                        <div className=\"text-[11px] text-[#EF4444] uppercase tracking-wider mt-0.5\">Critical</div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Weights Configure Link is in Header now */}\r\n        </div>\r\n    )\r\n}\r\n\r\nfunction Scorecard({ title, stats }: { title: string, stats: any }) {\r\n    if (!stats || stats.count === 0) {\r\n        return (\r\n            <Card className=\"flex flex-col justify-between h-[140px] border-red-900/10\">\r\n                <CardContent className=\"p-4 flex flex-col justify-between h-full pt-4\">\r\n                    <div className=\"text-[10px] uppercase font-semibold text-[var(--muted-foreground)] tracking-wider\">\r\n                        {title}\r\n                    </div>\r\n                    <div className=\"text-center\">\r\n                        <div className=\"text-3xl font-mono text-[var(--muted-foreground)]\">—</div>\r\n                        <div className=\"text-xs text-[var(--muted-foreground)] mt-1\">No graded trades</div>\r\n                    </div>\r\n                    <div className=\"text-[11px] text-center text-[var(--muted-foreground)]\">\r\n                        0 trades\r\n                    </div>\r\n                </CardContent>\r\n            </Card>\r\n        )\r\n    }\r\n\r\n    const scoreInfo = getGradeLabel(stats.weightedTotal)\r\n\r\n    return (\r\n        <Card className=\"flex flex-col justify-between h-[140px]\">\r\n            <CardContent className=\"p-4 flex flex-col justify-between h-full pt-4\">\r\n                <div className=\"text-[10px] uppercase font-semibold text-[var(--muted-foreground)] tracking-wider\">\r\n                    {title}\r\n                </div>\r\n                <div className=\"text-center\">\r\n                    <div className=\"text-4xl font-mono font-bold\" style={{ color: getGradeColor(stats.weightedTotal) }}>\r\n                        {Math.round(stats.weightedTotal)}\r\n                    </div>\r\n                    <div className=\"text-[11px] uppercase tracking-wider font-semibold mt-1\" style={{ color: getGradeColor(stats.weightedTotal) }}>\r\n                        {scoreInfo.label}\r\n                    </div>\r\n                </div>\r\n                <div className=\"h-px bg-[var(--border)] w-full opacity-50\" />\r\n                <div className=\"text-[11px] text-center flex justify-between px-2 font-mono\">\r\n                    <span className=\"text-[var(--muted-foreground)]\">{stats.count} trades</span>\r\n                    <span className={stats.totalPnl >= 0 ? \"text-[#22C55E]\" : \"text-[#EF4444]\"}>\r\n                        {stats.totalPnl >= 0 ? '+' : ''}{formatCurrency(stats.totalPnl)}\r\n                    </span>\r\n                </div>\r\n            </CardContent>\r\n        </Card>\r\n    )\r\n}\r\n\r\nfunction CategoryRow({ name, score, weight }: { name: string, score: number, weight: number }) {\r\n    const normScore = Math.max(0, Math.min(100, Math.round(score)))\r\n\r\n    return (\r\n        <div className=\"flex items-center gap-3\">\r\n            <div className=\"w-[140px] font-semibold text-sm\">{name}</div>\r\n            <div className=\"flex-1 h-3 bg-[var(--sidebar)] rounded overflow-hidden\">\r\n                <div\r\n                    className=\"h-full rounded transition-all duration-500\"\r\n                    style={{\r\n                        width: `${normScore}%`,\r\n                        backgroundColor: getGradeColor(normScore),\r\n                        opacity: 0.8\r\n                    }}\r\n                />\r\n            </div>\r\n            <div className=\"w-12 text-right font-mono font-bold text-sm\" style={{ color: getGradeColor(normScore) }}>\r\n                {normScore}\r\n            </div>\r\n            <div className=\"w-20 text-right text-xs text-[var(--muted-foreground)] font-mono\">\r\n                weight {weight}%\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\components\\import\\import-modal-root.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\components\\import\\import-modal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\components\\journal\\grade-section.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TrendingUp' is defined but never used.","line":4,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":4,"endColumn":20,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"TrendingUp"},"fix":{"range":[70,81],"text":""},"desc":"Remove unused variable \"TrendingUp\"."}]},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\components\\journal\\grade-section.tsx:102:7\n  100 |     const seen = localStorage.getItem('seen-grading-how-it-works')\n  101 |     if (!seen) {\n> 102 |       setShowHowItWorks(true)\n      |       ^^^^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  103 |     }\n  104 |   }, [])\n  105 |   const toggleHowItWorks = () => {","line":102,"column":7,"nodeType":null,"endLine":102,"endColumn":24},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\components\\journal\\grade-section.tsx:127:7\n  125 |   useEffect(() => {\n  126 |     if (existingGrade) {\n> 127 |       setGrade(existingGrade.grade as GradeValue)\n      |       ^^^^^^^^ Avoid calling setState() directly within an effect\n  128 |       setScores({\n  129 |         risk_management_score: existingGrade.riskManagementScore?.toString() || '',\n  130 |         execution_score: existingGrade.executionScore?.toString() || '',","line":127,"column":7,"nodeType":null,"endLine":127,"endColumn":15}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\r\n\r\nimport { useState, useEffect } from 'react'\r\nimport { TrendingUp, Check, Settings2 } from 'lucide-react'\r\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query'\r\nimport { cn } from '@/lib/utils'\r\nimport type { TradeGrade, Confluence } from '@/types/grading'\r\n\r\ntype GradingRule = {\r\n  grade: 'A+' | 'A' | 'B+' | 'B' | 'B-' | 'C'\r\n  type: 'specific' | 'threshold' | 'exact'\r\n  required_confluence_ids?: string[]\r\n  min_count?: number\r\n  exact_count?: number\r\n}\r\n\r\ninterface GradeSectionProps {\r\n  tradeId: string\r\n  strategyId: string\r\n}\r\n\r\nconst GRADES = ['A+', 'A', 'B+', 'B', 'B-', 'C'] as const\r\ntype GradeValue = typeof GRADES[number]\r\n\r\nfunction getGradeColor(grade: string, isSelected: boolean): string {\r\n  if (!isSelected) return 'bg-[var(--secondary)] text-[var(--muted-foreground)] border-transparent'\r\n  switch (grade) {\r\n    case 'A+': return 'bg-[#22C55E] text-white border-transparent shadow-[#22C55E]/20 shadow-lg' // green\r\n    case 'A': return 'bg-[#22C55E]/90 text-white border-transparent' // lighter green\r\n    case 'B+': return 'bg-[#3B82F6] text-white border-transparent' // blue\r\n    case 'B': return 'bg-[#E8EAF0] text-black border-transparent' // neutral\r\n    case 'B-': return 'bg-[#F59E0B] text-white border-transparent' // amber\r\n    case 'C': return 'bg-[#EF4444] text-white border-transparent' // red\r\n    default: return 'bg-[var(--primary)] text-white border-transparent'\r\n  }\r\n}\r\n\r\nexport function GradeSection({ tradeId, strategyId }: GradeSectionProps) {\r\n  const queryClient = useQueryClient()\r\n\r\n  // 1. Fetch Grade\r\n  const { data: gradeData, isLoading: isLoadingGrade } = useQuery<{ data: TradeGrade & { confluence_ids: string[] } }>({\r\n    queryKey: ['trade-grade', tradeId],\r\n    queryFn: async () => {\r\n      const res = await fetch(`/api/trades/${tradeId}/grade`)\r\n      if (!res.ok) throw new Error('Failed to fetch trade grade')\r\n      return res.json()\r\n    },\r\n    staleTime: 0, // Always fetch fresh to ensure sync with panel open\r\n  })\r\n\r\n  // 2. Fetch Confluences\r\n  const { data: confluencesData, isLoading: isLoadingConfluences } = useQuery<{ data: Confluence[] }>({\r\n    queryKey: ['confluences', strategyId],\r\n    queryFn: async () => {\r\n      if (!strategyId) return { data: [] }\r\n      const res = await fetch(`/api/confluences?strategy_id=${strategyId}`)\r\n      if (!res.ok) throw new Error('Failed to fetch confluences')\r\n      return res.json()\r\n    },\r\n    enabled: !!strategyId,\r\n    staleTime: 5 * 60 * 1000,\r\n  })\r\n\r\n  // 2.5 Fetch Finance Settings to get global weights & rubric\r\n  const { data: settingsData } = useQuery({\r\n    queryKey: ['finance-settings'],\r\n    queryFn: async () => {\r\n      const res = await fetch('/api/finance/settings')\r\n      if (!res.ok) throw new Error('Failed to fetch settings')\r\n      return res.json()\r\n    },\r\n    staleTime: 5 * 60 * 1000,\r\n  })\r\n\r\n  const confluences = confluencesData?.data || []\r\n  const existingGrade = gradeData?.data\r\n\r\n  // 3. Fetch Strategy Rules & Overrides\r\n  const { data: strategyData } = useQuery<{ data: { grading_rules: GradingRule[], category_overrides?: Record<string, number> | null } }>({\r\n    queryKey: ['strategy', strategyId],\r\n    queryFn: async () => {\r\n      if (!strategyId) return { data: { grading_rules: [] } }\r\n      const res = await fetch(`/api/strategies/${strategyId}`)\r\n      if (!res.ok) throw new Error('Failed to fetch strategy')\r\n      return res.json()\r\n    },\r\n    enabled: !!strategyId,\r\n    staleTime: 5 * 60 * 1000,\r\n  })\r\n\r\n  const activeCategoriesObj = strategyData?.data?.category_overrides || settingsData?.data?.grading_weights || {}\r\n  const activeCategoryEntries = Object.entries(activeCategoriesObj).slice(0, 5) // max 5 mapped to db columns\r\n  const hasOverrides = !!strategyData?.data?.category_overrides\r\n\r\n  const dynamicRubric = settingsData?.data?.grading_rubric || {}\r\n\r\n  const [showHowItWorks, setShowHowItWorks] = useState(false)\r\n  useEffect(() => {\r\n    const seen = localStorage.getItem('seen-grading-how-it-works')\r\n    if (!seen) {\r\n      setShowHowItWorks(true)\r\n    }\r\n  }, [])\r\n  const toggleHowItWorks = () => {\r\n    setShowHowItWorks(prev => !prev)\r\n    localStorage.setItem('seen-grading-how-it-works', 'true')\r\n  }\r\n\r\n  // Form State\r\n  const [grade, setGrade] = useState<GradeValue | null>(null)\r\n  const [autoGraded, setAutoGraded] = useState(false)\r\n  const [scores, setScores] = useState({\r\n    risk_management_score: '',\r\n    execution_score: '',\r\n    discipline_score: '',\r\n    strategy_score: '',\r\n    efficiency_score: ''\r\n  })\r\n  const [notes, setNotes] = useState('')\r\n  const [checkedIds, setCheckedIds] = useState<Set<string>>(new Set())\r\n  const [saveStatus, setSaveStatus] = useState<'idle' | 'saving' | 'saved' | 'error'>('idle')\r\n\r\n  // Pre-fill from existing grade\r\n  useEffect(() => {\r\n    if (existingGrade) {\r\n      setGrade(existingGrade.grade as GradeValue)\r\n      setScores({\r\n        risk_management_score: existingGrade.riskManagementScore?.toString() || '',\r\n        execution_score: existingGrade.executionScore?.toString() || '',\r\n        discipline_score: existingGrade.disciplineScore?.toString() || '',\r\n        strategy_score: existingGrade.strategyScore?.toString() || '',\r\n        efficiency_score: existingGrade.efficiencyScore?.toString() || ''\r\n      })\r\n      setNotes(existingGrade.notes || '')\r\n      if (existingGrade.confluence_ids) {\r\n        setCheckedIds(new Set(existingGrade.confluence_ids))\r\n      }\r\n    } else {\r\n      // Reset if no grade\r\n      setGrade(null)\r\n      setScores({\r\n        risk_management_score: '',\r\n        execution_score: '',\r\n        discipline_score: '',\r\n        strategy_score: '',\r\n        efficiency_score: ''\r\n      })\r\n      setNotes('')\r\n      setCheckedIds(new Set())\r\n    }\r\n  }, [existingGrade])\r\n\r\n  // Save Mutation\r\n  const saveMutation = useMutation({\r\n    mutationFn: async () => {\r\n      if (!grade) throw new Error(\"Grade is required\")\r\n      const payload = {\r\n        grade,\r\n        risk_management_score: scores.risk_management_score ? parseFloat(scores.risk_management_score) : null,\r\n        execution_score: scores.execution_score ? parseFloat(scores.execution_score) : null,\r\n        discipline_score: scores.discipline_score ? parseFloat(scores.discipline_score) : null,\r\n        strategy_score: scores.strategy_score ? parseFloat(scores.strategy_score) : null,\r\n        efficiency_score: scores.efficiency_score ? parseFloat(scores.efficiency_score) : null,\r\n        notes: notes || null,\r\n        confluence_ids: Array.from(checkedIds)\r\n      }\r\n      const res = await fetch(`/api/trades/${tradeId}/grade`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify(payload)\r\n      })\r\n      if (!res.ok) {\r\n        const err = await res.json().catch(() => ({}))\r\n        throw new Error(err.error || 'Failed to save grade')\r\n      }\r\n      return res.json()\r\n    },\r\n    onMutate: () => setSaveStatus('saving'),\r\n    onSuccess: () => {\r\n      setSaveStatus('saved')\r\n      // Invalidate related lists\r\n      queryClient.invalidateQueries({ queryKey: ['trades'] })\r\n      queryClient.invalidateQueries({ queryKey: ['grading-summary'] })\r\n      queryClient.invalidateQueries({ queryKey: ['trade-grade', tradeId] })\r\n      setTimeout(() => setSaveStatus('idle'), 2000)\r\n    },\r\n    onError: () => {\r\n      setSaveStatus('error')\r\n      setTimeout(() => setSaveStatus('idle'), 3000)\r\n    }\r\n  })\r\n\r\n  const toggleConfluence = (id: string) => {\r\n    const next = new Set(checkedIds)\r\n    if (next.has(id)) next.delete(id)\r\n    else next.add(id)\r\n    setCheckedIds(next)\r\n\r\n    // Evaluate Auto-grading\r\n    const rules = strategyData?.data?.grading_rules || []\r\n    if (rules.length > 0) {\r\n      let matchedGrade: GradeValue | null = null\r\n      for (const rule of rules) {\r\n        if (rule.type === 'specific' && rule.required_confluence_ids) {\r\n          const hasAll = rule.required_confluence_ids.every((cid: string) => next.has(cid))\r\n          if (hasAll) {\r\n            matchedGrade = rule.grade as GradeValue\r\n            break\r\n          }\r\n        } else if (rule.type === 'threshold' && rule.min_count !== undefined) {\r\n          if (next.size >= rule.min_count) {\r\n            matchedGrade = rule.grade as GradeValue\r\n            break\r\n          }\r\n        } else if (rule.type === 'exact' && rule.exact_count !== undefined) {\r\n          if (next.size === rule.exact_count) {\r\n            matchedGrade = rule.grade as GradeValue\r\n            break\r\n          }\r\n        }\r\n      }\r\n      if (matchedGrade) {\r\n        setGrade(matchedGrade)\r\n        setAutoGraded(true)\r\n      } else {\r\n        setAutoGraded(false)\r\n      }\r\n    }\r\n  }\r\n\r\n  const handleScoreChange = (field: keyof typeof scores, val: string) => {\r\n    // Only allow numbers, max 100\r\n    if (val !== '' && (isNaN(Number(val)) || Number(val) < 0 || Number(val) > 100)) return\r\n    setScores(prev => ({ ...prev, [field]: val }))\r\n  }\r\n\r\n  if (isLoadingGrade) {\r\n    return <div className=\"text-sm text-[var(--muted-foreground)]\">Loading grade...</div>\r\n  }\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n\r\n      {/* ── How It Works Collapsible ── */}\r\n      <div className=\"bg-[var(--secondary)]/20 border border-[var(--border)] rounded-md overflow-hidden\">\r\n        <button\r\n          onClick={toggleHowItWorks}\r\n          className=\"w-full flex items-center justify-between px-3 py-2.5 text-xs font-semibold uppercase tracking-wide text-[var(--muted-foreground)] hover:text-[var(--foreground)] hover:bg-[var(--secondary)]/40 transition-colors\"\r\n        >\r\n          <span>How Grading Works</span>\r\n          <span className=\"text-lg leading-none\">{showHowItWorks ? '−' : '+'}</span>\r\n        </button>\r\n        {showHowItWorks && (\r\n          <div className=\"px-3 pb-3 pt-1 border-t border-[var(--border)] text-sm text-[var(--muted-foreground)] space-y-2 border-l-2 border-l-[var(--color-blue)]\">\r\n            <p>1. <strong>Confluences:</strong> Check off the rules met for this trade.</p>\r\n            <p>2. <strong>Auto-Grade:</strong> The system assigns a letter grade based on matched confluences (configured in Strategy settings).</p>\r\n            <p>3. <strong>Categories:</strong> Score individual execution categories out of 100.</p>\r\n            <div className=\"pt-2\">\r\n              <a href={`/grading/configure${strategyId ? `?strategy=${strategyId}` : ''}`} className=\"text-[var(--color-blue)] hover:underline text-xs flex items-center gap-1\">\r\n                <Settings2 className=\"w-3 h-3\" /> Configure Grading Rules\r\n              </a>\r\n            </div>\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* ── Confluences ── */}\r\n      <div className=\"space-y-3\">\r\n        <h4 className=\"text-xs font-semibold uppercase text-[var(--muted-foreground)] tracking-wide\">\r\n          Confluences Present\r\n        </h4>\r\n\r\n        {!strategyId ? (\r\n          <div className=\"text-sm px-3 py-2.5 bg-[var(--color-blue)]/10 text-[var(--color-blue)] rounded border border-[var(--color-blue)]/20\">\r\n            Tag this trade with a strategy to see confluences.\r\n          </div>\r\n        ) : isLoadingConfluences ? (\r\n          <div className=\"text-sm text-[var(--muted-foreground)]\">Loading confluences...</div>\r\n        ) : confluences.length === 0 ? (\r\n          <div className=\"text-sm px-3 py-2.5 bg-[var(--secondary)] text-[var(--muted-foreground)] rounded border border-[var(--border)]\">\r\n            No confluences defined for this strategy yet. Add them in the Strategies page.\r\n          </div>\r\n        ) : (\r\n          <div className=\"space-y-1 bg-[var(--secondary)]/30 rounded-md border border-[var(--border)] overflow-hidden\">\r\n            {confluences.map(ci => (\r\n              <label\r\n                key={ci.id}\r\n                onClick={() => toggleConfluence(ci.id)}\r\n                className=\"flex items-center justify-between px-3 py-2 hover:bg-[var(--secondary)] cursor-pointer transition-colors border-b border-[var(--border)] last:border-0 group\"\r\n              >\r\n                <div className=\"flex items-center gap-3\">\r\n                  <div className={cn(\r\n                    \"w-4 h-4 rounded-sm border flex items-center justify-center transition-colors\",\r\n                    checkedIds.has(ci.id)\r\n                      ? \"bg-[var(--primary)] border-[var(--primary)] text-white\"\r\n                      : \"border-[var(--muted-foreground)]/40 bg-transparent group-hover:border-[var(--muted-foreground)]\"\r\n                  )}>\r\n                    {checkedIds.has(ci.id) && <Check size={12} strokeWidth={3} />}\r\n                  </div>\r\n                  <span className={cn(\r\n                    \"text-sm transition-colors\",\r\n                    checkedIds.has(ci.id) ? \"text-[var(--foreground)]\" : \"text-[var(--muted-foreground)]\"\r\n                  )}>\r\n                    {ci.name}\r\n                  </span>\r\n                </div>\r\n                <div className=\"flex items-center gap-2\">\r\n                  <span className=\"text-[10px] uppercase text-[var(--muted-foreground)] px-1.5 py-0.5 rounded bg-[var(--background)] border border-[var(--border)]\">\r\n                    {ci.category}\r\n                  </span>\r\n                </div>\r\n              </label>\r\n            ))}\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* ── Category Scores ── */}\r\n      <div className=\"space-y-3\">\r\n        <div className=\"flex items-center justify-between\">\r\n          <h4 className=\"text-xs font-semibold uppercase text-[var(--muted-foreground)] tracking-wide flex items-center gap-2\">\r\n            Category Scores\r\n            {hasOverrides && <span className=\"bg-[var(--color-blue)]/20 text-[var(--color-blue)] text-[10px] px-1.5 py-0.5 rounded normal-case\">Strategy Overrides</span>}\r\n          </h4>\r\n        </div>\r\n        <div className=\"grid grid-cols-1 gap-1.5\">\r\n          {activeCategoryEntries.length === 0 ? (\r\n            <div className=\"text-sm px-3 py-2.5 bg-[var(--secondary)] text-[var(--muted-foreground)] rounded border border-[var(--border)]\">\r\n              No categories configured.\r\n            </div>\r\n          ) : activeCategoryEntries.map(([label, weight], index) => {\r\n            const dbScoreKeys = ['risk_management_score', 'execution_score', 'discipline_score', 'strategy_score', 'efficiency_score'] as const\r\n            const key = dbScoreKeys[index]\r\n            if (!key) return null\r\n            return (\r\n              <div key={label} className=\"flex items-center justify-between px-3 py-1.5 bg-[var(--secondary)]/50 rounded-md border border-[var(--border)]\">\r\n                <div className=\"flex items-center gap-2\">\r\n                  <span className=\"text-sm font-medium text-[var(--foreground)]\">{label}</span>\r\n                  <span className=\"text-[10px] text-[var(--muted-foreground)]\">{String(weight)}%</span>\r\n                </div>\r\n                <div className=\"flex items-center gap-2\">\r\n                  <input\r\n                    type=\"number\"\r\n                    min=\"0\"\r\n                    max=\"100\"\r\n                    value={scores[key]}\r\n                    onChange={(e) => handleScoreChange(key, e.target.value)}\r\n                    placeholder=\"—\"\r\n                    className={cn(\r\n                      \"w-12 h-7 bg-[var(--background)] border border-[var(--border)] rounded text-right px-2 font-mono text-xs text-[var(--foreground)]\",\r\n                      \"focus:border-[var(--ring)] focus:ring-1 focus:ring-[var(--ring)] focus:outline-none placeholder:text-[var(--muted-foreground)]/50\"\r\n                    )}\r\n                  />\r\n                </div>\r\n              </div>\r\n            )\r\n          })}\r\n        </div>\r\n      </div>\r\n\r\n      {/* ── Grade Selector ── */}\r\n      <div className=\"space-y-3\">\r\n        <h4 className=\"text-xs font-semibold uppercase text-[var(--muted-foreground)] tracking-wide\">\r\n          Grade\r\n        </h4>\r\n        <div className=\"flex gap-1\">\r\n          {GRADES.map((g) => {\r\n            const isSelected = grade === g\r\n            const customLabel = dynamicRubric[g] // use custom label from rubric if exists\r\n            return (\r\n              <button\r\n                key={g}\r\n                onClick={() => {\r\n                  setGrade(g)\r\n                  setAutoGraded(false)\r\n                }}\r\n                title={customLabel}\r\n                className={cn(\r\n                  \"flex-1 py-1 flex flex-col items-center justify-center rounded-md font-bold text-sm border transition-all duration-200\",\r\n                  getGradeColor(g, isSelected),\r\n                  !isSelected && \"hover:bg-[var(--secondary)]/80 hover:text-[var(--foreground)] border-[var(--border)]\"\r\n                )}\r\n              >\r\n                <span>{g}</span>\r\n                {customLabel && isSelected && <span className=\"text-[9px] font-normal leading-tight opacity-90 truncate max-w-full px-1\">{String(customLabel)}</span>}\r\n              </button>\r\n            )\r\n          })}\r\n        </div>\r\n        {autoGraded && (\r\n          <p className=\"text-[10px] text-[var(--muted-foreground)] text-center mt-1 animate-in fade-in slide-in-from-top-1\">\r\n            Auto-graded · tap to override\r\n          </p>\r\n        )}\r\n      </div>\r\n\r\n      {/* ── Notes ── */}\r\n      <div className=\"space-y-3\">\r\n        <h4 className=\"text-xs font-semibold uppercase text-[var(--muted-foreground)] tracking-wide\">\r\n          Notes\r\n        </h4>\r\n        <textarea\r\n          value={notes}\r\n          onChange={(e) => setNotes(e.target.value)}\r\n          placeholder=\"Grading notes...\"\r\n          rows={3}\r\n          className={cn(\r\n            'w-full resize-none rounded-md border border-[var(--border)]',\r\n            'bg-[var(--secondary)]/50 text-[var(--foreground)]',\r\n            'px-3 py-2 text-sm placeholder:text-[var(--muted-foreground)]',\r\n            'focus:outline-none focus:ring-1 focus:ring-[var(--ring)] focus:border-[var(--ring)]',\r\n            'transition-colors duration-150'\r\n          )}\r\n        />\r\n      </div>\r\n\r\n      {/* ── Save ── */}\r\n      <button\r\n        onClick={() => saveMutation.mutate()}\r\n        disabled={saveStatus === 'saving' || !grade}\r\n        className={cn(\r\n          \"w-full py-2.5 rounded-md text-sm font-semibold transition-all\",\r\n          grade\r\n            ? \"bg-[var(--primary)] text-white hover:opacity-90 shadow-sm\"\r\n            : \"bg-[var(--secondary)] text-[var(--muted-foreground)] cursor-not-allowed border border-[var(--border)]\"\r\n        )}\r\n      >\r\n        {saveStatus === 'saving' ? 'Saving...' :\r\n          saveStatus === 'saved' ? 'Grade saved ✓' :\r\n            saveStatus === 'error' ? 'Error saving grade' : 'Save Grade'}\r\n      </button>\r\n\r\n    </div>\r\n  )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\components\\journal\\journal-client.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":341,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":341,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10972,10975],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10972,10975],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":368,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":368,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11733,11736],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11733,11736],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":428,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":428,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13711,13714],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13711,13714],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"The 'trades' logical expression could make the dependencies of useMemo Hook (at line 565) change on every render. To fix this, wrap the initialization of 'trades' in its own useMemo() Hook.","line":554,"column":9,"nodeType":"VariableDeclarator","endLine":554,"endColumn":36},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":576,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":576,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19133,19136],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19133,19136],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\r\n\r\nimport { useState, useMemo, useEffect, useRef } from 'react'\r\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query'\r\nimport { ArrowUp, ArrowDown, BookOpen, RefreshCw, Info, Check, X } from 'lucide-react'\r\nimport { cn } from '@/lib/utils'\r\nimport { useFiltersStore, type DatePreset } from '@/stores/filters'\r\nimport type { Trade } from '@/types/trades'\r\nimport { NotebookPanel } from './notebook-panel'\r\nimport { TradeDetailPanel } from './trade-detail-panel'\r\n\r\n// ─── Date helpers ────────────────────────────────────────────────────────────\r\n\r\nfunction pad(n: number): string {\r\n  return n.toString().padStart(2, '0')\r\n}\r\n\r\nfunction fmt(d: Date, endOfDay = false): string {\r\n  const dateStr = `${d.getFullYear()}-${pad(d.getMonth() + 1)}-${pad(d.getDate())}`\r\n  return endOfDay ? `${dateStr}T23:59:59` : `${dateStr}T00:00:00`\r\n}\r\n\r\nfunction getEffectiveDateRange(\r\n  preset: DatePreset,\r\n  dateFrom: string | null,\r\n  dateTo: string | null\r\n): { from: string; to: string } {\r\n  const today = new Date()\r\n\r\n  switch (preset) {\r\n    case 'today':\r\n      return { from: fmt(today), to: fmt(today, true) }\r\n\r\n    case 'this_week': {\r\n      const d = new Date(today)\r\n      const day = d.getDay() // 0=Sun, 1=Mon\r\n      d.setDate(d.getDate() - (day === 0 ? 6 : day - 1))\r\n      return { from: fmt(d), to: fmt(today, true) }\r\n    }\r\n\r\n    case 'this_month': {\r\n      const d = new Date(today.getFullYear(), today.getMonth(), 1)\r\n      return { from: fmt(d), to: fmt(today, true) }\r\n    }\r\n\r\n    case 'last_30d': {\r\n      const d = new Date(today)\r\n      d.setDate(d.getDate() - 29)\r\n      return { from: fmt(d), to: fmt(today, true) }\r\n    }\r\n\r\n    case 'custom':\r\n      return {\r\n        from: dateFrom ? `${dateFrom}T00:00:00` : fmt(today),\r\n        to: dateTo ? `${dateTo}T23:59:59` : fmt(today, true)\r\n      }\r\n\r\n    default:\r\n      return { from: fmt(today), to: fmt(today, true) }\r\n  }\r\n}\r\n\r\n// ─── Format helpers ──────────────────────────────────────────────────────────\r\n\r\nfunction formatPnl(value: string | null): string {\r\n  if (!value) return '$0.00'\r\n  const num = parseFloat(value)\r\n  if (isNaN(num)) return '$0.00'\r\n  const abs = Math.abs(num).toFixed(2)\r\n  return `${num >= 0 ? '+' : '-'}$${abs}`\r\n}\r\n\r\nfunction formatTime(timestamp: string): string {\r\n  return new Date(timestamp).toLocaleTimeString('en-US', {\r\n    hour: '2-digit',\r\n    minute: '2-digit',\r\n    hour12: false,\r\n  })\r\n}\r\n\r\nfunction formatDayHeader(date: string): string {\r\n  const d = new Date(date + 'T12:00:00')\r\n  return d.toLocaleDateString('en-US', {\r\n    weekday: 'long',\r\n    year: 'numeric',\r\n    month: 'short',\r\n    day: 'numeric',\r\n  })\r\n}\r\n\r\nfunction formatDuration(seconds: number | null): string {\r\n  if (!seconds) return '—'\r\n  const h = Math.floor(seconds / 3600)\r\n  const m = Math.floor((seconds % 3600) / 60)\r\n  const s = seconds % 60\r\n  if (h > 0) return `${h}h ${m}m`\r\n  if (m > 0) return `${m}m ${s}s`\r\n  return `${s}s`\r\n}\r\n\r\nfunction formatPrice(value: string | null): string {\r\n  if (!value) return '—'\r\n  return parseFloat(value).toFixed(2)\r\n}\r\n\r\nfunction pnlClass(value: string | null): string {\r\n  if (!value) return 'text-[var(--muted-foreground)]'\r\n  const num = parseFloat(value)\r\n  if (num > 0) return 'text-profit'\r\n  if (num < 0) return 'text-loss'\r\n  return 'text-[var(--muted-foreground)]'\r\n}\r\n\r\n// ─── Outcome badge ───────────────────────────────────────────────────────────\r\n\r\nfunction OutcomeBadge({ outcome, isOpen }: { outcome: string | null; isOpen: boolean }) {\r\n  if (isOpen) {\r\n    return (\r\n      <span className=\"inline-flex items-center rounded-full px-2 py-0.5 text-[10px] font-medium bg-[var(--color-blue)]/15 text-[var(--color-blue)]\">\r\n        OPEN\r\n      </span>\r\n    )\r\n  }\r\n  if (!outcome) return null\r\n\r\n  const styles: Record<string, string> = {\r\n    WIN: 'bg-[var(--color-green-muted)] text-[var(--color-green)]',\r\n    LOSS: 'bg-[var(--color-red-muted)] text-[var(--color-red)]',\r\n    BE: 'bg-[var(--color-yellow-muted)] text-[var(--color-yellow)]',\r\n  }\r\n\r\n  return (\r\n    <span\r\n      className={cn(\r\n        'inline-flex items-center rounded-full px-2 py-0.5 text-[10px] font-medium',\r\n        styles[outcome] ?? 'bg-[var(--muted)] text-[var(--muted-foreground)]'\r\n      )}\r\n    >\r\n      {outcome}\r\n    </span>\r\n  )\r\n}\r\n\r\nfunction GradeBadge({ grade }: { grade: string | null }) {\r\n  if (!grade) return null\r\n\r\n  const getGradeStyle = (g: string) => {\r\n    switch (g) {\r\n      case 'A+': return 'bg-[#22C55E]/15 text-[#22C55E] border-[#22C55E]/30'\r\n      case 'A': return 'bg-[#22C55E]/10 text-[#22C55E] border-[#22C55E]/20'\r\n      case 'B+': return 'bg-[#3B82F6]/15 text-[#3B82F6] border-[#3B82F6]/30'\r\n      case 'B': return 'bg-[#E8EAF0]/20 text-[var(--foreground)] border-[#E8EAF0]/40'\r\n      case 'B-': return 'bg-[#F59E0B]/15 text-[#F59E0B] border-[#F59E0B]/30'\r\n      case 'C': return 'bg-[#EF4444]/15 text-[#EF4444] border-[#EF4444]/30'\r\n      default: return 'bg-[var(--muted)] text-[var(--muted-foreground)] border-[var(--border)]'\r\n    }\r\n  }\r\n\r\n  return (\r\n    <span className={cn(\r\n      \"inline-flex items-center justify-center rounded px-1.5 py-0.5 text-[10px] font-bold font-mono border\",\r\n      getGradeStyle(grade)\r\n    )}>\r\n      {grade}\r\n    </span>\r\n  )\r\n}\r\n\r\n// ─── Loading skeleton ────────────────────────────────────────────────────────\r\n\r\nfunction Skeleton({ className }: { className?: string }) {\r\n  return (\r\n    <div\r\n      className={cn(\r\n        'animate-pulse rounded bg-[var(--secondary)]',\r\n        className\r\n      )}\r\n    />\r\n  )\r\n}\r\n\r\nfunction LoadingSkeleton() {\r\n  return (\r\n    <div className=\"space-y-6 p-6\">\r\n      {[0, 1, 2].map((g) => (\r\n        <div key={g} className=\"space-y-2\">\r\n          {/* Day header skeleton */}\r\n          <div className=\"flex items-center gap-3 py-2\">\r\n            <Skeleton className=\"h-4 w-40\" />\r\n            <Skeleton className=\"h-px flex-1\" />\r\n            <Skeleton className=\"h-4 w-20\" />\r\n          </div>\r\n          {/* Trade rows skeleton */}\r\n          {[0, 1, 2].map((r) => (\r\n            <div\r\n              key={r}\r\n              className=\"flex items-center gap-4 px-4 py-3 rounded-lg border border-[var(--border)]\"\r\n            >\r\n              <Skeleton className=\"h-4 w-14\" />\r\n              <Skeleton className=\"h-4 w-10\" />\r\n              <Skeleton className=\"h-4 w-4\" />\r\n              <Skeleton className=\"h-4 flex-1\" />\r\n              <Skeleton className=\"h-5 w-16 rounded-full\" />\r\n            </div>\r\n          ))}\r\n        </div>\r\n      ))}\r\n    </div>\r\n  )\r\n}\r\n\r\n// ─── Empty state ─────────────────────────────────────────────────────────────\r\n\r\nfunction EmptyState() {\r\n  return (\r\n    <div className=\"flex flex-1 flex-col items-center justify-center gap-4 py-24 text-center\">\r\n      <div className=\"p-4 rounded-full bg-[var(--secondary)]\">\r\n        <BookOpen size={28} className=\"text-[var(--muted-foreground)]\" />\r\n      </div>\r\n      <div>\r\n        <h3 className=\"text-base font-semibold text-[var(--foreground)] mb-1\">\r\n          No trades found\r\n        </h3>\r\n        <p className=\"text-sm text-[var(--muted-foreground)] max-w-xs\">\r\n          Import a CSV from your broker to get started, or adjust your filters.\r\n        </p>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n\r\n// ─── Trade row ───────────────────────────────────────────────────────────────\r\n\r\ninterface TradeRowProps {\r\n  trade: Trade\r\n  isSelected: boolean\r\n  onClick: () => void\r\n  onInfoClick: (e: React.MouseEvent) => void\r\n}\r\n\r\nfunction TradeRow({ trade, isSelected, onClick, onInfoClick }: TradeRowProps) {\r\n  const isLong = trade.side === 'LONG'\r\n\r\n  return (\r\n    <button\r\n      onClick={onClick}\r\n      className={cn(\r\n        'w-full flex items-center gap-4 px-4 py-3 rounded-lg text-left',\r\n        'border transition-all duration-150',\r\n        'hover:bg-[var(--accent)] hover:border-[var(--color-accent-primary)]/30',\r\n        isSelected\r\n          ? 'border-[var(--color-accent-primary)]/60 bg-[var(--color-accent-muted)]'\r\n          : 'border-[var(--border)] bg-[var(--card)]'\r\n      )}\r\n    >\r\n      {/* Time */}\r\n      <span className=\"font-mono text-xs text-[var(--muted-foreground)] w-14 shrink-0 tabular-nums\">\r\n        {formatTime(trade.entryTime)}\r\n      </span>\r\n\r\n      {/* Instrument */}\r\n      <span className=\"text-sm font-semibold text-[var(--foreground)] w-12 shrink-0\">\r\n        {trade.rootSymbol}\r\n      </span>\r\n\r\n      {/* Side icon */}\r\n      <span className=\"shrink-0\">\r\n        {isLong ? (\r\n          <ArrowUp size={14} className=\"text-[var(--color-green)]\" />\r\n        ) : (\r\n          <ArrowDown size={14} className=\"text-[var(--color-red)]\" />\r\n        )}\r\n      </span>\r\n\r\n      {/* Entry → Exit prices */}\r\n      <span className=\"font-mono text-xs text-[var(--muted-foreground)] shrink-0\">\r\n        {formatPrice(trade.avgEntryPrice)}\r\n        {trade.avgExitPrice && (\r\n          <span className=\"mx-1 opacity-50\">→</span>\r\n        )}\r\n        {trade.avgExitPrice && formatPrice(trade.avgExitPrice)}\r\n      </span>\r\n\r\n      {/* Duration */}\r\n      <span className=\"text-xs text-[var(--muted-foreground)] shrink-0 hidden sm:block\">\r\n        {formatDuration(trade.durationSeconds)}\r\n      </span>\r\n\r\n      {/* Fills count */}\r\n      <span className=\"text-xs text-[var(--muted-foreground)] shrink-0 hidden md:block\">\r\n        {trade.fillsCount} fill{trade.fillsCount !== 1 ? 's' : ''}\r\n      </span>\r\n\r\n      {/* Tags & Grade */}\r\n      {(trade.tags.length > 0 || trade.grade) && (\r\n        <div className=\"hidden lg:flex items-center gap-1.5 overflow-hidden\">\r\n          {trade.grade && <GradeBadge grade={trade.grade} />}\r\n          {trade.tags.slice(0, 2).map((tag) => (\r\n            <span\r\n              key={tag.id}\r\n              className=\"inline-flex items-center rounded-full px-2 py-0.5 text-[10px] font-medium border border-[var(--border)] text-[var(--muted-foreground)]\"\r\n              style={\r\n                tag.color\r\n                  ? { borderColor: tag.color + '60', color: tag.color }\r\n                  : undefined\r\n              }\r\n            >\r\n              {tag.name}\r\n            </span>\r\n          ))}\r\n          {trade.tags.length > 2 && (\r\n            <span className=\"text-[10px] text-[var(--muted-foreground)]\">\r\n              +{trade.tags.length - 2}\r\n            </span>\r\n          )}\r\n        </div>\r\n      )}\r\n\r\n      {/* Spacer */}\r\n      <div className=\"flex-1\" />\r\n\r\n      {/* Net P&L */}\r\n      <span\r\n        className={cn(\r\n          'font-mono text-sm font-semibold tabular-nums shrink-0',\r\n          pnlClass(trade.netPnl)\r\n        )}\r\n      >\r\n        {formatPnl(trade.netPnl)}\r\n      </span>\r\n\r\n      {/* Detail button */}\r\n      <div className=\"shrink-0 flex items-center justify-center pl-3 pr-1\">\r\n        <div\r\n          role=\"button\"\r\n          tabIndex={0}\r\n          onClick={onInfoClick}\r\n          onKeyDown={(e) => {\r\n            if (e.key === 'Enter' || e.key === ' ') {\r\n              e.preventDefault()\r\n              onInfoClick(e as any)\r\n            }\r\n          }}\r\n          className={cn(\r\n            'p-1.5 flex items-center justify-center rounded-md text-[var(--muted-foreground)]',\r\n            'hover:bg-[var(--border)] hover:text-[var(--foreground)]',\r\n            'transition-all duration-150 cursor-pointer'\r\n          )}\r\n          title=\"Trade Details\"\r\n        >\r\n          <Info size={14} />\r\n        </div>\r\n      </div>\r\n\r\n      {/* Outcome badge */}\r\n      <div className=\"shrink-0 w-12 flex justify-end\">\r\n        <OutcomeBadge outcome={trade.outcome} isOpen={trade.isOpen} />\r\n      </div>\r\n    </button>\r\n  )\r\n}\r\n\r\n// ─── Day group ───────────────────────────────────────────────────────────────\r\n\r\ninterface DayGroupProps {\r\n  date: string\r\n  trades: Trade[]\r\n  checkin: any | null\r\n  selectedId: string | null\r\n  onSelectTrade: (trade: Trade) => void\r\n  onInfoTrade: (trade: Trade) => void\r\n}\r\n\r\nfunction DayGroup({ date, trades, checkin, selectedId, onSelectTrade, onInfoTrade }: DayGroupProps) {\r\n  const dayPnl = trades.reduce((sum, t) => sum + parseFloat(t.netPnl || '0'), 0)\r\n  const pnlColor =\r\n    dayPnl > 0\r\n      ? 'text-[var(--color-green)]'\r\n      : dayPnl < 0\r\n        ? 'text-[var(--color-red)]'\r\n        : 'text-[var(--muted-foreground)]'\r\n\r\n  return (\r\n    <div className=\"space-y-1.5\">\r\n      {/* Day header */}\r\n      <div className=\"flex items-center gap-3 py-1 sticky top-0 bg-[var(--background)] z-10\">\r\n        <span className=\"text-xs font-semibold text-[var(--muted-foreground)] shrink-0\">\r\n          {formatDayHeader(date)}\r\n        </span>\r\n        <div className=\"shrink-0 flex items-center\">\r\n          <RoutinePill date={date} checkin={checkin} />\r\n        </div>\r\n        <div className=\"flex-1 h-px bg-[var(--border)]\" />\r\n        <span className=\"text-xs text-[var(--muted-foreground)] shrink-0\">\r\n          {trades.length} trade{trades.length !== 1 ? 's' : ''}\r\n        </span>\r\n        <span\r\n          className={cn(\r\n            'font-mono text-sm font-semibold tabular-nums shrink-0',\r\n            pnlColor\r\n          )}\r\n        >\r\n          {formatPnl(dayPnl.toString())}\r\n        </span>\r\n      </div>\r\n\r\n      {/* Trade rows */}\r\n      <div className=\"space-y-1\">\r\n        {trades.map((trade) => (\r\n          <TradeRow\r\n            key={trade.id}\r\n            trade={trade}\r\n            isSelected={selectedId === trade.id}\r\n            onClick={() => onSelectTrade(trade)}\r\n            onInfoClick={(e) => {\r\n              e.stopPropagation()\r\n              onInfoTrade(trade)\r\n            }}\r\n          />\r\n        ))}\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n\r\n// ─── Routine Pill ────────────────────────────────────────────────────────────\r\n\r\nfunction RoutinePill({ date, checkin }: { date: string, checkin: any | null }) {\r\n  const [isOpen, setIsOpen] = useState(false)\r\n  const menuRef = useRef<HTMLDivElement>(null)\r\n  const queryClient = useQueryClient()\r\n\r\n  const mutation = useMutation({\r\n    mutationFn: async (followed: boolean) => {\r\n      const res = await fetch('/api/discipline/checkin', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ date, followed_routine: followed })\r\n      })\r\n      if (!res.ok) throw new Error('Failed to update')\r\n      return res.json()\r\n    },\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: ['discipline-checkins'] })\r\n      queryClient.invalidateQueries({ queryKey: ['discipline-score', date] })\r\n      setIsOpen(false)\r\n    }\r\n  })\r\n\r\n  useEffect(() => {\r\n    if (!isOpen) return\r\n    const handleClick = (e: MouseEvent) => {\r\n      if (menuRef.current && !menuRef.current.contains(e.target as Node)) {\r\n        setIsOpen(false)\r\n      }\r\n    }\r\n    document.addEventListener('mousedown', handleClick)\r\n    return () => document.removeEventListener('mousedown', handleClick)\r\n  }, [isOpen])\r\n\r\n  let pillClass = \"text-[var(--muted-foreground)] border-[var(--border)]\"\r\n  let text = \"Routine: ?\"\r\n\r\n  if (checkin) {\r\n    if (checkin.followed_routine) {\r\n      pillClass = \"text-[var(--color-green)] border-[var(--color-green)]/30\"\r\n      text = \"Routine: ✓\"\r\n    } else {\r\n      pillClass = \"text-[var(--color-red)] border-[var(--color-red)]/30\"\r\n      text = \"Routine: ✗\"\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div className=\"relative isolate\" ref={menuRef}>\r\n      <button\r\n        onClick={(e) => { e.stopPropagation(); setIsOpen(!isOpen) }}\r\n        className={cn(\r\n          \"inline-flex items-center justify-center rounded-full px-2 py-0.5 text-[10px] font-medium border transition-colors\",\r\n          pillClass,\r\n          isOpen ? \"bg-[var(--accent)]\" : \"hover:bg-[var(--accent)]\"\r\n        )}\r\n      >\r\n        {text}\r\n      </button>\r\n\r\n      {isOpen && (\r\n        <div\r\n          onClick={e => e.stopPropagation()}\r\n          className=\"absolute right-0 top-full mt-1.5 w-32 rounded-md border border-[var(--border)] bg-[var(--popover)] p-1 shadow-md flex gap-1 z-50 text-xs font-semibold animate-in fade-in zoom-in-95\"\r\n        >\r\n          <button\r\n            onClick={() => mutation.mutate(true)}\r\n            disabled={mutation.isPending}\r\n            className=\"flex-1 flex items-center justify-center gap-1.5 py-1.5 rounded-sm text-[var(--color-green)] hover:bg-[var(--color-green)]/10\"\r\n          >\r\n            <Check size={12} /> Yes\r\n          </button>\r\n          <button\r\n            onClick={() => mutation.mutate(false)}\r\n            disabled={mutation.isPending}\r\n            className=\"flex-1 flex items-center justify-center gap-1.5 py-1.5 rounded-sm text-[var(--color-red)] hover:bg-[var(--color-red)]/10\"\r\n          >\r\n            <X size={12} /> No\r\n          </button>\r\n        </div>\r\n      )}\r\n    </div>\r\n  )\r\n}\r\n\r\n// ─── Main component ──────────────────────────────────────────────────────────\r\n\r\nexport function JournalClient() {\r\n  const { accountIds, datePreset, dateFrom, dateTo, instruments, strategyIds } =\r\n    useFiltersStore()\r\n\r\n  const [selectedTrade, setSelectedTrade] = useState<Trade | null>(null)\r\n  const [detailedTrade, setDetailedTrade] = useState<Trade | null>(null)\r\n\r\n  // Compute effective date range from preset\r\n  const dateRange = useMemo(\r\n    () => getEffectiveDateRange(datePreset, dateFrom, dateTo),\r\n    [datePreset, dateFrom, dateTo]\r\n  )\r\n\r\n  // Build query params\r\n  const queryParams = useMemo(() => {\r\n    const p = new URLSearchParams()\r\n    p.set('date_from', dateRange.from)\r\n    p.set('date_to', dateRange.to)\r\n    if (accountIds.length > 0) p.set('account_id', accountIds[0])\r\n    if (instruments.length > 0) p.set('instrument', instruments[0])\r\n    if (strategyIds.length > 0) p.set('strategy_id', strategyIds[0])\r\n    return p.toString()\r\n  }, [dateRange, accountIds, instruments, strategyIds])\r\n\r\n  // Fetch trades\r\n  const {\r\n    data,\r\n    isLoading,\r\n    isError,\r\n    refetch,\r\n  } = useQuery({\r\n    queryKey: ['trades', accountIds, datePreset, dateFrom, dateTo, instruments, strategyIds],\r\n    queryFn: async () => {\r\n      const res = await fetch(`/api/trades?${queryParams}`)\r\n      if (!res.ok) throw new Error('Failed to fetch trades')\r\n      return res.json() as Promise<{ trades: Trade[] }>\r\n    },\r\n    staleTime: 30 * 1000,\r\n  })\r\n\r\n  const trades = data?.trades ?? []\r\n\r\n  // Group trades by trading day (already sorted DESC from API)\r\n  const groupedTrades = useMemo(() => {\r\n    const groups: Record<string, Trade[]> = {}\r\n    for (const trade of trades) {\r\n      if (!groups[trade.tradingDay]) groups[trade.tradingDay] = []\r\n      groups[trade.tradingDay].push(trade)\r\n    }\r\n    // Days are already in DESC order from the API\r\n    return Object.entries(groups)\r\n  }, [trades])\r\n\r\n  const visibleDates = useMemo(() => groupedTrades.map(([d]) => d), [groupedTrades])\r\n\r\n  // Fetch checkins for visible dates\r\n  const { data: checkinsData } = useQuery({\r\n    queryKey: ['discipline-checkins', visibleDates],\r\n    queryFn: async () => {\r\n      if (visibleDates.length === 0) return { data: {} }\r\n      const res = await fetch(`/api/discipline/checkin?dates=${visibleDates.join(',')}`)\r\n      if (!res.ok) throw new Error('Failed to fetch checkins')\r\n      return res.json() as Promise<{ data: Record<string, any> }>\r\n    },\r\n    enabled: visibleDates.length > 0,\r\n    staleTime: 60 * 1000\r\n  })\r\n\r\n  const checkinsMap = checkinsData?.data || {}\r\n\r\n  const handleSelectTrade = (trade: Trade) => {\r\n    setSelectedTrade((prev) => (prev?.id === trade.id ? null : trade))\r\n  }\r\n\r\n  const handleInfoTrade = (trade: Trade) => setDetailedTrade(trade)\r\n  const handleCloseDetailPanel = () => setDetailedTrade(null)\r\n\r\n  if (isError) {\r\n    return (\r\n      <div className=\"flex flex-1 flex-col items-center justify-center gap-4 py-24\">\r\n        <p className=\"text-sm text-[var(--color-red)]\">Failed to load trades.</p>\r\n        <button\r\n          onClick={() => refetch()}\r\n          className={cn(\r\n            'flex items-center gap-2 rounded-md px-4 py-2 text-sm',\r\n            'border border-[var(--border)] bg-[var(--secondary)]',\r\n            'hover:bg-[var(--accent)] transition-colors duration-150'\r\n          )}\r\n        >\r\n          <RefreshCw size={14} />\r\n          Retry\r\n        </button>\r\n      </div>\r\n    )\r\n  }\r\n\r\n  return (\r\n    <div className=\"flex flex-1 min-h-0 overflow-hidden flex-row\">\r\n      {/* Main list (60%) */}\r\n      <div className=\"w-[60%] overflow-y-auto border-r border-[var(--border)]\">\r\n        {isLoading ? (\r\n          <LoadingSkeleton />\r\n        ) : trades.length === 0 ? (\r\n          <div className=\"px-6 py-5 space-y-6 max-w-5xl\">\r\n            <EmptyState />\r\n          </div>\r\n        ) : (\r\n          <div className=\"px-6 py-5 space-y-6 max-w-5xl\">\r\n            {groupedTrades.map(([date, dayTrades]) => (\r\n              <DayGroup\r\n                key={date}\r\n                date={date}\r\n                trades={dayTrades}\r\n                checkin={checkinsMap[date] ?? null}\r\n                selectedId={selectedTrade?.id ?? null}\r\n                onSelectTrade={handleSelectTrade}\r\n                onInfoTrade={handleInfoTrade}\r\n              />\r\n            ))}\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* Notebook panel (40%) */}\r\n      <NotebookPanel trade={selectedTrade} />\r\n\r\n      {/* Slide-over trade detail panel */}\r\n      <TradeDetailPanel trade={detailedTrade} onClose={handleCloseDetailPanel} />\r\n    </div>\r\n  )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\components\\journal\\notebook-panel.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\components\\journal\\trade-detail-panel.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\components\\journal\\trade-detail-panel.tsx:188:5\n  186 |   // Sync local state when trade changes\n  187 |   useEffect(() => {\n> 188 |     setNotes(trade?.notes ?? '')\n      |     ^^^^^^^^ Avoid calling setState() directly within an effect\n  189 |     setTvLink(trade?.tradingviewLink ?? '')\n  190 |     setStrategyId(trade?.strategyId ?? '')\n  191 |   }, [trade?.id, trade?.notes, trade?.tradingviewLink, trade?.strategyId])","line":188,"column":5,"nodeType":null,"endLine":188,"endColumn":13}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\r\n\r\nimport { useCallback, useEffect, useRef, useState } from 'react'\r\nimport { X, ArrowUp, ArrowDown, ExternalLink, Clock } from 'lucide-react'\r\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query'\r\nimport { cn } from '@/lib/utils'\r\nimport type { Trade, Strategy } from '@/types/trades'\r\nimport { GradeSection } from '@/components/journal/grade-section'\r\n\r\n// ─── Helpers ────────────────────────────────────────────────────────────────\r\n\r\nfunction formatPnl(value: string | number | null): string {\r\n  if (value === null || value === undefined) return '—'\r\n  const num = typeof value === 'string' ? parseFloat(value) : value\r\n  if (isNaN(num)) return '—'\r\n  const abs = Math.abs(num).toFixed(2)\r\n  return `${num >= 0 ? '+' : '-'}$${abs}`\r\n}\r\n\r\nfunction formatPrice(value: string | null): string {\r\n  if (!value) return '—'\r\n  const num = parseFloat(value)\r\n  if (isNaN(num)) return value\r\n  return num.toFixed(2)\r\n}\r\n\r\nfunction formatDuration(seconds: number | null): string {\r\n  if (seconds === null || seconds === undefined) return '—'\r\n  const h = Math.floor(seconds / 3600)\r\n  const m = Math.floor((seconds % 3600) / 60)\r\n  const s = seconds % 60\r\n  if (h > 0) return `${h}h ${m}m`\r\n  if (m > 0) return `${m}m ${s}s`\r\n  return `${s}s`\r\n}\r\n\r\nfunction formatTime(timestamp: string): string {\r\n  return new Date(timestamp).toLocaleTimeString('en-US', {\r\n    hour: '2-digit',\r\n    minute: '2-digit',\r\n    second: '2-digit',\r\n    hour12: false,\r\n  })\r\n}\r\n\r\nfunction formatDate(dateStr: string): string {\r\n  // Avoid UTC offset issues by appending noon time\r\n  const d = new Date(dateStr + 'T12:00:00')\r\n  return d.toLocaleDateString('en-US', {\r\n    weekday: 'short',\r\n    year: 'numeric',\r\n    month: 'short',\r\n    day: 'numeric',\r\n  })\r\n}\r\n\r\nfunction pnlClass(value: string | null): string {\r\n  if (!value) return 'text-[var(--muted-foreground)]'\r\n  const num = parseFloat(value)\r\n  if (num > 0) return 'text-profit'\r\n  if (num < 0) return 'text-loss'\r\n  return 'text-[var(--muted-foreground)]'\r\n}\r\n\r\n// ─── Outcome Badge ──────────────────────────────────────────────────────────\r\n\r\nfunction OutcomeBadge({ outcome, isOpen }: { outcome: string | null; isOpen: boolean }) {\r\n  if (isOpen) {\r\n    return (\r\n      <span className=\"inline-flex items-center rounded-full px-2 py-0.5 text-xs font-medium bg-[var(--color-blue)]/15 text-[var(--color-blue)]\">\r\n        OPEN\r\n      </span>\r\n    )\r\n  }\r\n  if (!outcome) return null\r\n\r\n  const styles: Record<string, string> = {\r\n    WIN: 'bg-[var(--color-green-muted)] text-[var(--color-green)]',\r\n    LOSS: 'bg-[var(--color-red-muted)] text-[var(--color-red)]',\r\n    BE: 'bg-[var(--color-yellow-muted)] text-[var(--color-yellow)]',\r\n  }\r\n\r\n  return (\r\n    <span\r\n      className={cn(\r\n        'inline-flex items-center rounded-full px-2 py-0.5 text-xs font-medium',\r\n        styles[outcome] ?? 'bg-[var(--muted)] text-[var(--muted-foreground)]'\r\n      )}\r\n    >\r\n      {outcome}\r\n    </span>\r\n  )\r\n}\r\n\r\n// ─── Save feedback hook ──────────────────────────────────────────────────────\r\n\r\ntype SaveState = 'idle' | 'saving' | 'saved' | 'error'\r\n\r\nfunction useSaveState() {\r\n  const [state, setState] = useState<SaveState>('idle')\r\n  const timerRef = useRef<ReturnType<typeof setTimeout> | null>(null)\r\n\r\n  const setSaving = () => setState('saving')\r\n  const setSaved = () => {\r\n    setState('saved')\r\n    if (timerRef.current) clearTimeout(timerRef.current)\r\n    timerRef.current = setTimeout(() => setState('idle'), 2000)\r\n  }\r\n  const setError = () => {\r\n    setState('error')\r\n    if (timerRef.current) clearTimeout(timerRef.current)\r\n    timerRef.current = setTimeout(() => setState('idle'), 3000)\r\n  }\r\n\r\n  useEffect(() => () => {\r\n    if (timerRef.current) clearTimeout(timerRef.current)\r\n  }, [])\r\n\r\n  return { state, setSaving, setSaved, setError }\r\n}\r\n\r\n// ─── Section Header ──────────────────────────────────────────────────────────\r\n\r\nfunction SectionHeader({ title }: { title: string }) {\r\n  return (\r\n    <div className=\"flex items-center gap-2 mb-3\">\r\n      <span className=\"text-xs font-semibold uppercase tracking-wider text-[var(--muted-foreground)]\">\r\n        {title}\r\n      </span>\r\n      <div className=\"flex-1 h-px bg-[var(--border)]\" />\r\n    </div>\r\n  )\r\n}\r\n\r\n// ─── Metric Card ────────────────────────────────────────────────────────────\r\n\r\nfunction Metric({\r\n  label,\r\n  value,\r\n  mono = false,\r\n  className,\r\n}: {\r\n  label: string\r\n  value: string\r\n  mono?: boolean\r\n  className?: string\r\n}) {\r\n  return (\r\n    <div className=\"flex flex-col gap-0.5\">\r\n      <span className=\"text-[11px] text-[var(--muted-foreground)] uppercase tracking-wide\">\r\n        {label}\r\n      </span>\r\n      <span\r\n        className={cn(\r\n          'text-sm font-medium',\r\n          mono && 'font-mono',\r\n          className\r\n        )}\r\n      >\r\n        {value}\r\n      </span>\r\n    </div>\r\n  )\r\n}\r\n\r\n// ─── Main Component ──────────────────────────────────────────────────────────\r\n\r\ninterface TradeDetailPanelProps {\r\n  trade: Trade | null\r\n  onClose: () => void\r\n}\r\n\r\nexport function TradeDetailPanel({ trade, onClose }: TradeDetailPanelProps) {\r\n  const queryClient = useQueryClient()\r\n  const isOpen = trade !== null\r\n\r\n  // Local editable state — sync from trade prop\r\n  const [notes, setNotes] = useState(trade?.notes ?? '')\r\n  const [tvLink, setTvLink] = useState(trade?.tradingviewLink ?? '')\r\n  const [strategyId, setStrategyId] = useState(trade?.strategyId ?? '')\r\n\r\n  const notesSave = useSaveState()\r\n  const tvSave = useSaveState()\r\n  const strategySave = useSaveState()\r\n\r\n  // Sync local state when trade changes\r\n  useEffect(() => {\r\n    setNotes(trade?.notes ?? '')\r\n    setTvLink(trade?.tradingviewLink ?? '')\r\n    setStrategyId(trade?.strategyId ?? '')\r\n  }, [trade?.id, trade?.notes, trade?.tradingviewLink, trade?.strategyId])\r\n\r\n  // Close on Escape\r\n  useEffect(() => {\r\n    if (!isOpen) return\r\n    const handler = (e: KeyboardEvent) => {\r\n      if (e.key === 'Escape') onClose()\r\n    }\r\n    window.addEventListener('keydown', handler)\r\n    return () => window.removeEventListener('keydown', handler)\r\n  }, [isOpen, onClose])\r\n\r\n  // Strategies query\r\n  const { data: strategiesData, isLoading } = useQuery({\r\n    queryKey: ['strategies'],\r\n    queryFn: async () => {\r\n      const res = await fetch('/api/strategies')\r\n      if (!res.ok) throw new Error('Failed to fetch strategies')\r\n      return res.json() as Promise<{ data: Strategy[] }>\r\n    },\r\n    staleTime: 5 * 60 * 1000,\r\n  })\r\n  const strategies = strategiesData?.data ?? []\r\n  const isLoadingStrategies = isLoading\r\n\r\n  // PATCH mutation\r\n  const patchMutation = useMutation({\r\n    mutationFn: async (patch: Record<string, string | null>) => {\r\n      const res = await fetch(`/api/trades/${trade!.id}`, {\r\n        method: 'PATCH',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify(patch),\r\n      })\r\n      if (!res.ok) {\r\n        const body = await res.json().catch(() => ({}))\r\n        throw new Error((body as { error?: string }).error ?? 'Update failed')\r\n      }\r\n      return res.json()\r\n    },\r\n    onSuccess: () => {\r\n      // Invalidate trades list so it refetches with updated data\r\n      queryClient.invalidateQueries({ queryKey: ['trades'] })\r\n      // Invalidate strategies so stats update in real time\r\n      queryClient.invalidateQueries({ queryKey: ['strategies'] })\r\n    },\r\n  })\r\n\r\n  const saveField = useCallback(\r\n    async (\r\n      field: 'notes' | 'tradingview_link' | 'strategy_id',\r\n      value: string | null,\r\n      saveHook: ReturnType<typeof useSaveState>\r\n    ) => {\r\n      if (!trade) return\r\n      saveHook.setSaving()\r\n      try {\r\n        await patchMutation.mutateAsync({ [field]: value || null })\r\n        saveHook.setSaved()\r\n      } catch {\r\n        saveHook.setError()\r\n      }\r\n    },\r\n    [trade, patchMutation]\r\n  )\r\n\r\n  // Backdrop click closes panel\r\n  const handleBackdropClick = useCallback(\r\n    (e: React.MouseEvent<HTMLDivElement>) => {\r\n      if (e.target === e.currentTarget) onClose()\r\n    },\r\n    [onClose]\r\n  )\r\n\r\n  return (\r\n    <>\r\n      {/* Backdrop */}\r\n      <div\r\n        className={cn(\r\n          'fixed inset-0 z-40 bg-black/40 backdrop-blur-[1px]',\r\n          'transition-opacity duration-300',\r\n          isOpen ? 'opacity-100' : 'opacity-0 pointer-events-none'\r\n        )}\r\n        onClick={handleBackdropClick}\r\n        aria-hidden=\"true\"\r\n      />\r\n\r\n      {/* Slide panel */}\r\n      <aside\r\n        role=\"dialog\"\r\n        aria-modal=\"true\"\r\n        aria-label=\"Trade detail\"\r\n        className={cn(\r\n          'fixed right-0 top-0 bottom-0 z-50 w-[520px] max-w-full',\r\n          'flex flex-col bg-[var(--card)] border-l border-[var(--border)]',\r\n          'shadow-[var(--shadow-lg)]',\r\n          'transition-transform duration-300 ease-[var(--ease-default)]',\r\n          isOpen ? 'translate-x-0' : 'translate-x-full'\r\n        )}\r\n      >\r\n        {trade && (\r\n          <>\r\n            {/* ── Header ─────────────────────────────────────────────────── */}\r\n            <div className=\"flex items-center justify-between px-5 py-4 border-b border-[var(--border)] shrink-0\">\r\n              <div className=\"flex items-center gap-3\">\r\n                <div className=\"flex items-center gap-1.5\">\r\n                  {trade.side === 'LONG' ? (\r\n                    <ArrowUp size={16} className=\"text-[var(--color-green)]\" />\r\n                  ) : (\r\n                    <ArrowDown size={16} className=\"text-[var(--color-red)]\" />\r\n                  )}\r\n                  <span className=\"text-base font-semibold text-[var(--foreground)]\">\r\n                    {trade.rootSymbol}\r\n                  </span>\r\n                  <span className=\"text-sm text-[var(--muted-foreground)]\">\r\n                    {trade.side === 'LONG' ? 'Long' : 'Short'}\r\n                  </span>\r\n                </div>\r\n                <OutcomeBadge outcome={trade.outcome} isOpen={trade.isOpen} />\r\n              </div>\r\n              <div className=\"flex items-center gap-3\">\r\n                <span className=\"text-xs text-[var(--muted-foreground)]\">\r\n                  {formatDate(trade.tradingDay)}\r\n                </span>\r\n                <button\r\n                  onClick={onClose}\r\n                  className={cn(\r\n                    'p-1.5 rounded-md text-[var(--muted-foreground)]',\r\n                    'hover:text-[var(--foreground)] hover:bg-[var(--accent)]',\r\n                    'transition-colors duration-150'\r\n                  )}\r\n                  aria-label=\"Close panel\"\r\n                >\r\n                  <X size={16} />\r\n                </button>\r\n              </div>\r\n            </div>\r\n\r\n            {/* ── Scrollable body ─────────────────────────────────────────── */}\r\n            <div className=\"flex-1 overflow-y-auto px-5 py-5 space-y-6\">\r\n\r\n              {/* ── Summary metrics ──────────────────────────────────────── */}\r\n              <section>\r\n                <SectionHeader title=\"Summary\" />\r\n                <div className=\"grid grid-cols-3 gap-4\">\r\n                  <Metric\r\n                    label=\"Net P&L\"\r\n                    value={formatPnl(trade.netPnl)}\r\n                    mono\r\n                    className={pnlClass(trade.netPnl)}\r\n                  />\r\n                  <Metric\r\n                    label=\"Gross P&L\"\r\n                    value={formatPnl(trade.grossPnl)}\r\n                    mono\r\n                    className={pnlClass(trade.grossPnl)}\r\n                  />\r\n                  <Metric\r\n                    label=\"Commission\"\r\n                    value={`$${parseFloat(trade.commissionTotal || '0').toFixed(2)}`}\r\n                    mono\r\n                    className=\"text-[var(--muted-foreground)]\"\r\n                  />\r\n                  <Metric\r\n                    label=\"Entry\"\r\n                    value={formatPrice(trade.avgEntryPrice)}\r\n                    mono\r\n                  />\r\n                  <Metric\r\n                    label=\"Exit\"\r\n                    value={formatPrice(trade.avgExitPrice)}\r\n                    mono\r\n                  />\r\n                  <Metric\r\n                    label=\"Qty\"\r\n                    value={`${trade.entryQty}`}\r\n                    mono\r\n                  />\r\n                  <Metric\r\n                    label=\"Duration\"\r\n                    value={formatDuration(trade.durationSeconds)}\r\n                    className=\"flex items-center gap-1\"\r\n                  />\r\n                  {trade.rMultiple !== null && (\r\n                    <Metric\r\n                      label=\"R-Multiple\"\r\n                      value={`${parseFloat(trade.rMultiple).toFixed(2)}R`}\r\n                      mono\r\n                      className={\r\n                        parseFloat(trade.rMultiple) >= 0\r\n                          ? 'text-profit'\r\n                          : 'text-loss'\r\n                      }\r\n                    />\r\n                  )}\r\n                  <Metric\r\n                    label=\"Entry Time\"\r\n                    value={formatTime(trade.entryTime)}\r\n                    mono\r\n                    className=\"text-[var(--muted-foreground)]\"\r\n                  />\r\n                </div>\r\n              </section>\r\n\r\n              {/* ── Fills table ────────────────────────────────────────────── */}\r\n              {trade.fills.length > 0 && (\r\n                <section>\r\n                  <SectionHeader title={`Fills (${trade.fills.length})`} />\r\n                  <div className=\"rounded-md border border-[var(--border)] overflow-hidden\">\r\n                    <table className=\"w-full text-xs\">\r\n                      <thead>\r\n                        <tr className=\"border-b border-[var(--border)] bg-[var(--secondary)]\">\r\n                          <th className=\"px-3 py-2 text-left text-[var(--muted-foreground)] font-medium uppercase tracking-wide\">\r\n                            Time\r\n                          </th>\r\n                          <th className=\"px-3 py-2 text-left text-[var(--muted-foreground)] font-medium uppercase tracking-wide\">\r\n                            Side\r\n                          </th>\r\n                          <th className=\"px-3 py-2 text-right text-[var(--muted-foreground)] font-medium uppercase tracking-wide\">\r\n                            Qty\r\n                          </th>\r\n                          <th className=\"px-3 py-2 text-right text-[var(--muted-foreground)] font-medium uppercase tracking-wide\">\r\n                            Price\r\n                          </th>\r\n                          <th className=\"px-3 py-2 text-right text-[var(--muted-foreground)] font-medium uppercase tracking-wide\">\r\n                            Comm.\r\n                          </th>\r\n                        </tr>\r\n                      </thead>\r\n                      <tbody>\r\n                        {trade.fills.map((fill, idx) => (\r\n                          <tr\r\n                            key={fill.id}\r\n                            className={cn(\r\n                              'border-b border-[var(--border)] last:border-0',\r\n                              idx % 2 === 1 && 'bg-[var(--secondary)]/40'\r\n                            )}\r\n                          >\r\n                            <td className=\"px-3 py-2 font-mono text-[var(--muted-foreground)]\">\r\n                              {formatTime(fill.fillTime)}\r\n                            </td>\r\n                            <td className=\"px-3 py-2\">\r\n                              <span\r\n                                className={\r\n                                  fill.side === 'BUY'\r\n                                    ? 'text-[var(--color-green)]'\r\n                                    : 'text-[var(--color-red)]'\r\n                                }\r\n                              >\r\n                                {fill.side}\r\n                              </span>\r\n                            </td>\r\n                            <td className=\"px-3 py-2 text-right font-mono\">\r\n                              {fill.quantity}\r\n                            </td>\r\n                            <td className=\"px-3 py-2 text-right font-mono\">\r\n                              {formatPrice(fill.price)}\r\n                            </td>\r\n                            <td className=\"px-3 py-2 text-right font-mono text-[var(--muted-foreground)]\">\r\n                              {fill.commission\r\n                                ? `$${parseFloat(fill.commission).toFixed(2)}`\r\n                                : '—'}\r\n                            </td>\r\n                          </tr>\r\n                        ))}\r\n                      </tbody>\r\n                    </table>\r\n                  </div>\r\n                </section>\r\n              )}\r\n\r\n              {/* ── Editable fields ─────────────────────────────────────────── */}\r\n              <section>\r\n                <SectionHeader title=\"Annotations\" />\r\n                <div className=\"space-y-4\">\r\n\r\n                  {/* Strategy dropdown */}\r\n                  <div>\r\n                    <label className=\"block text-xs text-[var(--muted-foreground)] mb-1.5\">\r\n                      Strategy\r\n                    </label>\r\n                    <div className=\"relative\">\r\n                      <select\r\n                        value={strategyId}\r\n                        onChange={(e) => {\r\n                          setStrategyId(e.target.value)\r\n                          saveField('strategy_id', e.target.value || null, strategySave)\r\n                        }}\r\n                        className={cn(\r\n                          'w-full appearance-none rounded-md border border-[var(--border)]',\r\n                          'bg-[var(--secondary)] text-[var(--foreground)]',\r\n                          'px-3 py-2 text-sm',\r\n                          'focus:outline-none focus:ring-2 focus:ring-[var(--ring)] focus:border-[var(--ring)]',\r\n                          'transition-colors duration-150'\r\n                        )}\r\n                      >\r\n                        <option value=\"\">No strategy</option>\r\n                        {isLoadingStrategies ? (\r\n                          <option disabled>Loading...</option>\r\n                        ) : (\r\n                          strategies.map((s) => (\r\n                            <option key={s.id} value={s.id}>\r\n                              {s.name}\r\n                            </option>\r\n                          ))\r\n                        )}\r\n                      </select>\r\n                      <div className=\"pointer-events-none absolute right-2.5 top-1/2 -translate-y-1/2 text-[var(--muted-foreground)]\">\r\n                        <svg width=\"10\" height=\"6\" viewBox=\"0 0 10 6\" fill=\"none\">\r\n                          <path d=\"M1 1l4 4 4-4\" stroke=\"currentColor\" strokeWidth=\"1.5\" strokeLinecap=\"round\" strokeLinejoin=\"round\" />\r\n                        </svg>\r\n                      </div>\r\n                    </div>\r\n                    <SaveIndicator state={strategySave.state} />\r\n                  </div>\r\n\r\n                  {/* Notes textarea */}\r\n                  <div>\r\n                    <label className=\"block text-xs text-[var(--muted-foreground)] mb-1.5\">\r\n                      Notes\r\n                    </label>\r\n                    <textarea\r\n                      value={notes}\r\n                      onChange={(e) => setNotes(e.target.value)}\r\n                      onBlur={() => saveField('notes', notes, notesSave)}\r\n                      rows={4}\r\n                      placeholder=\"Add trade notes…\"\r\n                      className={cn(\r\n                        'w-full resize-none rounded-md border border-[var(--border)]',\r\n                        'bg-[var(--secondary)] text-[var(--foreground)]',\r\n                        'px-3 py-2 text-sm placeholder:text-[var(--muted-foreground)]',\r\n                        'focus:outline-none focus:ring-2 focus:ring-[var(--ring)] focus:border-[var(--ring)]',\r\n                        'transition-colors duration-150'\r\n                      )}\r\n                    />\r\n                    <SaveIndicator state={notesSave.state} />\r\n                  </div>\r\n\r\n                  {/* TradingView link */}\r\n                  <div>\r\n                    <label className=\"block text-xs text-[var(--muted-foreground)] mb-1.5\">\r\n                      TradingView Link\r\n                    </label>\r\n                    <div className=\"relative\">\r\n                      <input\r\n                        type=\"url\"\r\n                        value={tvLink}\r\n                        onChange={(e) => setTvLink(e.target.value)}\r\n                        onBlur={() => saveField('tradingview_link', tvLink, tvSave)}\r\n                        placeholder=\"https://www.tradingview.com/x/...\"\r\n                        className={cn(\r\n                          'w-full rounded-md border border-[var(--border)]',\r\n                          'bg-[var(--secondary)] text-[var(--foreground)]',\r\n                          'px-3 py-2 pr-9 text-sm placeholder:text-[var(--muted-foreground)]',\r\n                          'focus:outline-none focus:ring-2 focus:ring-[var(--ring)] focus:border-[var(--ring)]',\r\n                          'transition-colors duration-150'\r\n                        )}\r\n                      />\r\n                      {tvLink && (\r\n                        <a\r\n                          href={tvLink}\r\n                          target=\"_blank\"\r\n                          rel=\"noopener noreferrer\"\r\n                          className={cn(\r\n                            'absolute right-2.5 top-1/2 -translate-y-1/2',\r\n                            'text-[var(--muted-foreground)] hover:text-[var(--foreground)]',\r\n                            'transition-colors duration-150'\r\n                          )}\r\n                          aria-label=\"Open in TradingView\"\r\n                        >\r\n                          <ExternalLink size={14} />\r\n                        </a>\r\n                      )}\r\n                    </div>\r\n                    <SaveIndicator state={tvSave.state} />\r\n                  </div>\r\n                </div>\r\n              </section>\r\n\r\n              {/* ── Tags ───────────────────────────────────────────────────── */}\r\n              {trade.tags.length > 0 && (\r\n                <section>\r\n                  <SectionHeader title=\"Tags\" />\r\n                  <div className=\"flex flex-wrap gap-1.5\">\r\n                    {trade.tags.map((tag) => (\r\n                      <span\r\n                        key={tag.id}\r\n                        className={cn(\r\n                          'inline-flex items-center rounded-full px-2.5 py-1 text-xs font-medium',\r\n                          'border border-[var(--border)] bg-[var(--secondary)] text-[var(--foreground)]'\r\n                        )}\r\n                        style={\r\n                          tag.color\r\n                            ? {\r\n                              borderColor: tag.color + '60',\r\n                              backgroundColor: tag.color + '20',\r\n                              color: tag.color,\r\n                            }\r\n                            : undefined\r\n                        }\r\n                      >\r\n                        {tag.name}\r\n                      </span>\r\n                    ))}\r\n                  </div>\r\n                </section>\r\n              )}\r\n\r\n              {/* ── Grade ─────────────────────────────────────────────────── */}\r\n              <section>\r\n                <SectionHeader title=\"Grade\" />\r\n                <GradeSection tradeId={trade.id} strategyId={strategyId} />\r\n              </section>\r\n\r\n            </div>\r\n          </>\r\n        )}\r\n      </aside>\r\n    </>\r\n  )\r\n}\r\n\r\n// ─── Save Indicator ──────────────────────────────────────────────────────────\r\n\r\nfunction SaveIndicator({ state }: { state: SaveState }) {\r\n  if (state === 'idle') return null\r\n  return (\r\n    <div className=\"mt-1 flex items-center gap-1\">\r\n      {state === 'saving' && (\r\n        <>\r\n          <Clock size={10} className=\"animate-spin text-[var(--muted-foreground)]\" />\r\n          <span className=\"text-[11px] text-[var(--muted-foreground)]\">Saving…</span>\r\n        </>\r\n      )}\r\n      {state === 'saved' && (\r\n        <span className=\"text-[11px] text-[var(--color-green)]\">Saved</span>\r\n      )}\r\n      {state === 'error' && (\r\n        <span className=\"text-[11px] text-[var(--color-red)]\">Save failed</span>\r\n      )}\r\n    </div>\r\n  )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\components\\layout\\app-shell.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\components\\layout\\global-toolbar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\components\\layout\\sidebar.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Layers' is defined but never used.","line":10,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":10,"endColumn":9,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Layers"},"fix":{"range":[181,192],"text":""},"desc":"Remove unused variable \"Layers\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Award' is defined but never used.","line":14,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":14,"endColumn":8,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Award"},"fix":{"range":[236,246],"text":""},"desc":"Remove unused variable \"Award\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Upload' is defined but never used.","line":18,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":18,"endColumn":9,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Upload"},"fix":{"range":[276,287],"text":""},"desc":"Remove unused variable \"Upload\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Zap' is defined but never used.","line":23,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":23,"endColumn":6,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Zap"},"fix":{"range":[342,350],"text":""},"desc":"Remove unused variable \"Zap\"."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\r\n\r\nimport Link from 'next/link'\r\nimport { usePathname } from 'next/navigation'\r\nimport { cn } from '@/lib/utils'\r\nimport {\r\n  LayoutDashboard,\r\n  BookOpen,\r\n  BarChart2,\r\n  Layers,\r\n  Building2,\r\n  DollarSign,\r\n  BookMarked,\r\n  Award,\r\n  Search,\r\n  Bot,\r\n  Target,\r\n  Upload,\r\n  Settings,\r\n  ChevronLeft,\r\n  ChevronRight,\r\n  User,\r\n  Zap,\r\n} from 'lucide-react'\r\n\r\nexport interface NavItem {\r\n  label: string\r\n  icon: React.ElementType\r\n  href: string\r\n  badge?: number | string\r\n}\r\n\r\nconst mainNavItems: NavItem[] = [\r\n  { label: 'Command Center', icon: LayoutDashboard, href: '/' },\r\n  { label: 'Trade Journal', icon: BookOpen, href: '/journal' },\r\n  { label: 'Analytics Lab', icon: BarChart2, href: '/analytics' },\r\n  { label: 'Grading', icon: Target, href: '/grading' },\r\n  { label: 'Prop Firm HQ', icon: Building2, href: '/prop' },\r\n  { label: 'Strategies', icon: BookMarked, href: '/strategies' },\r\n  { label: 'Goals', icon: Target, href: '/goals' },\r\n  { label: 'Finance', icon: DollarSign, href: '/finance' },\r\n  { label: 'Ledger', icon: BookOpen, href: '/ledger' },\r\n  { label: 'Leak Detector', icon: Search, href: '/leaks' },\r\n  { label: 'AI Coach', icon: Bot, href: '/coach' },\r\n]\r\n\r\ninterface SidebarProps {\r\n  collapsed: boolean\r\n  onToggle: () => void\r\n}\r\n\r\nexport function Sidebar({ collapsed, onToggle }: SidebarProps) {\r\n  const pathname = usePathname()\r\n\r\n  const isActive = (href: string) => {\r\n    if (href === '/') return pathname === '/'\r\n    return pathname.startsWith(href)\r\n  }\r\n\r\n  return (\r\n    <aside\r\n      className={cn(\r\n        'flex flex-col border-r transition-all duration-300',\r\n        'bg-[var(--sidebar)] border-[var(--sidebar-border)]',\r\n        collapsed ? 'w-[60px]' : 'w-[220px]'\r\n      )}\r\n    >\r\n      {/* Logo + collapse toggle */}\r\n      <div\r\n        className={cn(\r\n          'flex items-center border-b border-[var(--sidebar-border)] h-[52px] px-3 shrink-0',\r\n          collapsed ? 'justify-center' : 'justify-between'\r\n        )}\r\n      >\r\n        {!collapsed && (\r\n          <span className=\"text-sm font-semibold text-[var(--foreground)] truncate\">\r\n            Trading Journal OS\r\n          </span>\r\n        )}\r\n        <button\r\n          onClick={onToggle}\r\n          className=\"flex h-7 w-7 items-center justify-center rounded-md text-[var(--sidebar-foreground)] hover:bg-[var(--sidebar-accent)] hover:text-[var(--sidebar-accent-foreground)] transition-colors duration-150\"\r\n          aria-label={collapsed ? 'Expand sidebar' : 'Collapse sidebar'}\r\n        >\r\n          {collapsed ? <ChevronRight size={14} /> : <ChevronLeft size={14} />}\r\n        </button>\r\n      </div>\r\n\r\n      {/* Main nav */}\r\n      <nav className=\"flex-1 overflow-y-auto py-2 px-2 space-y-0.5\">\r\n        {mainNavItems.map((item) => (\r\n          <SidebarItem\r\n            key={item.href}\r\n            item={item}\r\n            active={isActive(item.href)}\r\n            collapsed={collapsed}\r\n          />\r\n        ))}\r\n      </nav>\r\n\r\n      {/* Bottom actions */}\r\n      <div className=\"shrink-0 border-t border-[var(--sidebar-border)] py-2 px-2 space-y-0.5\">\r\n\r\n        <SidebarItem\r\n          item={{ label: 'Settings', icon: Settings, href: '/settings/preferences' }}\r\n          active={isActive('/settings')}\r\n          collapsed={collapsed}\r\n        />\r\n        <SidebarItem\r\n          item={{ label: 'Account', icon: User, href: '/settings/accounts' }}\r\n          active={false}\r\n          collapsed={collapsed}\r\n        />\r\n      </div>\r\n    </aside>\r\n  )\r\n}\r\n\r\ninterface SidebarItemProps {\r\n  item: NavItem\r\n  active: boolean\r\n  collapsed: boolean\r\n  variant?: 'default' | 'action'\r\n}\r\n\r\nfunction SidebarItem({ item, active, collapsed, variant = 'default' }: SidebarItemProps) {\r\n  const Icon = item.icon\r\n\r\n  const content = (\r\n    <span\r\n      className={cn(\r\n        'group flex items-center gap-2.5 rounded-md px-2.5 py-1.5 text-[13px] font-medium transition-all duration-150 cursor-pointer select-none',\r\n        collapsed && 'justify-center px-2',\r\n        active\r\n          ? 'bg-[var(--color-accent-muted)] text-[var(--sidebar-primary)] shadow-[inset_0_0_0_1px_var(--color-accent-muted)]'\r\n          : variant === 'action'\r\n            ? 'text-[var(--sidebar-primary)] hover:bg-[var(--sidebar-accent)] hover:text-[var(--sidebar-primary)]'\r\n            : 'text-[var(--sidebar-foreground)] hover:bg-[var(--sidebar-accent)] hover:text-[var(--sidebar-accent-foreground)]'\r\n      )}\r\n    >\r\n      <Icon\r\n        size={16}\r\n        className={cn(\r\n          'shrink-0 transition-colors duration-150',\r\n          active ? 'text-[var(--sidebar-primary)]' : ''\r\n        )}\r\n      />\r\n      {!collapsed && <span className=\"truncate\">{item.label}</span>}\r\n      {!collapsed && item.badge !== undefined && (\r\n        <span className=\"ml-auto flex h-4 min-w-4 items-center justify-center rounded-full bg-[var(--sidebar-primary)] px-1 text-[10px] font-semibold text-white\">\r\n          {item.badge}\r\n        </span>\r\n      )}\r\n    </span>\r\n  )\r\n\r\n  return (\r\n    <Link href={item.href} className=\"block\">\r\n      {content}\r\n    </Link>\r\n  )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\components\\ledger\\ledger-client.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":71,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":71,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1923,1926],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1923,1926],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":129,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":129,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3772,3775],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3772,3775],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":146,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":146,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4500,4503],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4500,4503],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":151,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":151,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4643,4646],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4643,4646],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":167,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":167,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5259,5262],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5259,5262],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":184,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":184,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5873,5876],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5873,5876],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"The 'entries' logical expression could make the dependencies of useMemo Hook (at line 201) change on every render. To fix this, wrap the initialization of 'entries' in its own useMemo() Hook.","line":187,"column":11,"nodeType":"VariableDeclarator","endLine":187,"endColumn":61},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"The 'entries' logical expression could make the dependencies of useMemo Hook (at line 206) change on every render. To fix this, wrap the initialization of 'entries' in its own useMemo() Hook.","line":187,"column":11,"nodeType":"VariableDeclarator","endLine":187,"endColumn":61},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":788,"column":86,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[41616,41704],"text":"\r\n                            This will permanently delete the manual ledger entry for &quot;"},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[41616,41704],"text":"\r\n                            This will permanently delete the manual ledger entry for &ldquo;"},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[41616,41704],"text":"\r\n                            This will permanently delete the manual ledger entry for &#34;"},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[41616,41704],"text":"\r\n                            This will permanently delete the manual ledger entry for &rdquo;"},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":788,"column":115,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[41732,41819],"text":"&quot;.\r\n                            This action cannot be undone.\r\n                        "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[41732,41819],"text":"&ldquo;.\r\n                            This action cannot be undone.\r\n                        "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[41732,41819],"text":"&#34;.\r\n                            This action cannot be undone.\r\n                        "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[41732,41819],"text":"&rdquo;.\r\n                            This action cannot be undone.\r\n                        "},"desc":"Replace with `&rdquo;`."}]}],"suppressedMessages":[],"errorCount":8,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useState, useMemo } from \"react\";\r\nimport { format } from \"date-fns\";\r\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\r\nimport {\r\n    Plus,\r\n    Download,\r\n    Wallet,\r\n    TrendingUp,\r\n    TrendingDown,\r\n    Percent,\r\n    Repeat,\r\n    Briefcase,\r\n    Target,\r\n    Clock,\r\n    Pencil,\r\n    Trash2,\r\n    ChevronRight,\r\n    Loader2,\r\n    Info,\r\n} from \"lucide-react\";\r\nimport {\r\n    PieChart, Pie, Cell, Tooltip as RechartsTooltip, ResponsiveContainer\r\n} from \"recharts\";\r\n\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\r\nimport { Skeleton } from \"@/components/ui/skeleton\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { Tooltip, TooltipContent, TooltipProvider, TooltipTrigger } from \"@/components/ui/tooltip\";\r\nimport {\r\n    Dialog,\r\n    DialogContent,\r\n    DialogHeader,\r\n    DialogTitle,\r\n    DialogFooter\r\n} from \"@/components/ui/dialog\";\r\nimport {\r\n    AlertDialog,\r\n    AlertDialogAction,\r\n    AlertDialogCancel,\r\n    AlertDialogContent,\r\n    AlertDialogDescription,\r\n    AlertDialogFooter,\r\n    AlertDialogHeader,\r\n    AlertDialogTitle,\r\n} from \"@/components/ui/alert-dialog\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Label } from \"@/components/ui/label\";\r\nimport {\r\n    Select,\r\n    SelectContent,\r\n    SelectItem,\r\n    SelectTrigger,\r\n    SelectValue,\r\n} from \"@/components/ui/select\";\r\n\r\n// Helper for formatting currency\r\nconst formatCurrency = (val: number | null | undefined) => {\r\n    if (val == null) return \"$0.00\";\r\n    return new Intl.NumberFormat(\"en-US\", {\r\n        style: \"currency\",\r\n        currency: \"USD\",\r\n    }).format(val);\r\n};\r\n\r\n// Colors for Pie Chart\r\nconst COLORS = [\"#3B82F6\", \"#F59E0B\", \"#10B981\", \"#8B5CF6\", \"#EC4899\", \"#14B8A6\", \"#F43F5E\", \"#6366F1\"];\r\n\r\nconst CustomTooltip = ({ active, payload }: any) => {\r\n    if (active && payload && payload.length) {\r\n        return (\r\n            <div className=\"rounded-lg border border-[#2A2F3E] bg-[#14171E] p-3 text-sm shadow-xl\">\r\n                <p className=\"mb-2 font-medium text-[#E8EAF0]\">{payload[0].name}</p>\r\n                <p className=\"font-mono text-[#EF4444]\">\r\n                    ${Number(payload[0].value).toFixed(2)}\r\n                </p>\r\n            </div>\r\n        );\r\n    }\r\n    return null;\r\n};\r\n\r\ntype EntryType = \"income\" | \"expense\" | \"payout\" | \"funding\";\r\ntype EntrySource = \"trade\" | \"expense\" | \"payout\" | \"manual\";\r\n\r\nexport interface LedgerEntry {\r\n    id: string;\r\n    date: string;\r\n    type: EntryType;\r\n    amount: number;\r\n    description: string;\r\n    category: string;\r\n    source: EntrySource;\r\n}\r\n\r\nexport function LedgerClient() {\r\n    const queryClient = useQueryClient();\r\n\r\n    // Dialog States\r\n    const [isAddOpen, setIsAddOpen] = useState(false);\r\n    const [isEditOpen, setIsEditOpen] = useState(false);\r\n    const [isDeleteOpen, setIsDeleteOpen] = useState(false);\r\n\r\n    // Form States\r\n    const [selectedEntry, setSelectedEntry] = useState<LedgerEntry | null>(null);\r\n    const [formData, setFormData] = useState({\r\n        type: \"income\" as EntryType,\r\n        amount: \"\",\r\n        description: \"\",\r\n        category: \"\",\r\n        date: format(new Date(), \"yyyy-MM-dd\")\r\n    });\r\n\r\n    // Fetch Ledger Data\r\n    const { data: ledgerData, isLoading } = useQuery({\r\n        queryKey: [\"ledger\"],\r\n        queryFn: async () => {\r\n            const res = await fetch(\"/api/ledger\");\r\n            if (!res.ok) throw new Error(\"Failed to fetch ledger\");\r\n            const json = await res.json();\r\n            return json.data;\r\n        }\r\n    });\r\n\r\n    // Add Entry Mutation\r\n    const addMutation = useMutation({\r\n        mutationFn: async (payload: any) => {\r\n            const res = await fetch(\"/api/ledger\", {\r\n                method: \"POST\",\r\n                headers: { \"Content-Type\": \"application/json\" },\r\n                body: JSON.stringify(payload)\r\n            });\r\n            if (!res.ok) {\r\n                const err = await res.json();\r\n                throw new Error(err.error || \"Failed to add entry\");\r\n            }\r\n            return res.json();\r\n        },\r\n        onSuccess: () => {\r\n            queryClient.invalidateQueries({ queryKey: [\"ledger\"] });\r\n            setIsAddOpen(false);\r\n            setFormData({ type: \"income\", amount: \"\", description: \"\", category: \"\", date: format(new Date(), \"yyyy-MM-dd\") });\r\n        },\r\n        onError: (err: any) => alert(err.message)\r\n    });\r\n\r\n    // Edit Entry Mutation\r\n    const editMutation = useMutation({\r\n        mutationFn: async (payload: any) => {\r\n            const res = await fetch(`/api/ledger/${payload.id}`, {\r\n                method: \"PATCH\",\r\n                headers: { \"Content-Type\": \"application/json\" },\r\n                body: JSON.stringify(payload)\r\n            });\r\n            if (!res.ok) {\r\n                const err = await res.json();\r\n                throw new Error(err.error || \"Failed to edit entry\");\r\n            }\r\n            return res.json();\r\n        },\r\n        onSuccess: () => {\r\n            queryClient.invalidateQueries({ queryKey: [\"ledger\"] });\r\n            setIsEditOpen(false);\r\n        },\r\n        onError: (err: any) => alert(err.message)\r\n    });\r\n\r\n    // Delete Entry Mutation\r\n    const deleteMutation = useMutation({\r\n        mutationFn: async (id: string) => {\r\n            const res = await fetch(`/api/ledger/${id}`, { method: \"DELETE\" });\r\n            if (!res.ok) {\r\n                const err = await res.json();\r\n                throw new Error(err.error || \"Failed to delete entry\");\r\n            }\r\n            return res.json();\r\n        },\r\n        onSuccess: () => {\r\n            queryClient.invalidateQueries({ queryKey: [\"ledger\"] });\r\n            setIsDeleteOpen(false);\r\n        },\r\n        onError: (err: any) => alert(err.message)\r\n    });\r\n\r\n    const entries: LedgerEntry[] = ledgerData?.entries || [];\r\n    const summary = ledgerData?.summary || {};\r\n    const propStats = ledgerData?.propStats || {};\r\n\r\n    const expenseBreakdown = useMemo(() => {\r\n        if (!entries) return [];\r\n        const expenses = entries.filter((e: LedgerEntry) => e.type === \"expense\");\r\n        const map = new Map<string, number>();\r\n        expenses.forEach((e: LedgerEntry) => {\r\n            map.set(e.category || \"General\", (map.get(e.category || \"General\") || 0) + e.amount);\r\n        });\r\n        return Array.from(map.entries())\r\n            .map(([name, value]) => ({ name, value }))\r\n            .sort((a, b) => b.value - a.value);\r\n    }, [entries]);\r\n\r\n    const recentExpenses = useMemo(() => {\r\n        if (!entries) return [];\r\n        return entries.filter((e: LedgerEntry) => e.type === \"expense\").slice(0, 10);\r\n    }, [entries]);\r\n\r\n    const handleAddSubmit = (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        addMutation.mutate({\r\n            ...formData,\r\n            amount: parseFloat(formData.amount)\r\n        });\r\n    };\r\n\r\n    const handleEditSubmit = (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        if (!selectedEntry) return;\r\n        editMutation.mutate({\r\n            id: selectedEntry.id,\r\n            ...formData,\r\n            amount: parseFloat(formData.amount)\r\n        });\r\n    };\r\n\r\n    const handleExport = () => {\r\n        if (!entries.length) return;\r\n        const csvRows = [\"Date,Type,Source,Description,Category,Amount\"];\r\n        entries.forEach((e: LedgerEntry) => {\r\n            // Escape quotes and wrap in quotes for robust CSV\r\n            const desc = `\"${(e.description || \"\").replace(/\"/g, '\"\"')}\"`;\r\n            const cat = `\"${(e.category || \"\").replace(/\"/g, '\"\"')}\"`;\r\n            csvRows.push(`${e.date},${e.type},${e.source},${desc},${cat},${e.amount}`);\r\n        });\r\n        const blob = new Blob([csvRows.join(\"\\n\")], { type: \"text/csv\" });\r\n        const url = URL.createObjectURL(blob);\r\n        const a = document.createElement(\"a\");\r\n        a.href = url;\r\n        a.download = \"ledger-export.csv\";\r\n        a.click();\r\n    };\r\n\r\n    if (isLoading) {\r\n        return (\r\n            <div className=\"space-y-6\">\r\n                <Skeleton className=\"h-10 w-48\" />\r\n                <div className=\"grid gap-4 md:grid-cols-4\"><Skeleton className=\"h-32\" /><Skeleton className=\"h-32\" /><Skeleton className=\"h-32\" /><Skeleton className=\"h-32\" /></div>\r\n                <div className=\"grid gap-4 md:grid-cols-4\"><Skeleton className=\"h-32\" /><Skeleton className=\"h-32\" /><Skeleton className=\"h-32\" /><Skeleton className=\"h-32\" /></div>\r\n                <Skeleton className=\"h-64\" />\r\n                <Skeleton className=\"h-96\" />\r\n            </div>\r\n        );\r\n    }\r\n\r\n    const {\r\n        totalRevenue = 0,\r\n        totalExpenses = 0,\r\n        netProfit = 0,\r\n        roi = 0,\r\n        monthlyRecurring = 0,\r\n        totalFunding = 0,\r\n        fundedAccountCount = 0,\r\n        paybackPeriod = null\r\n    } = summary;\r\n\r\n    const passRate = propStats.evalsPurchased > 0\r\n        ? ((propStats.passed / propStats.evalsPurchased) * 100).toFixed(1)\r\n        : 0;\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            {/* Page Header */}\r\n            <div className=\"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between\">\r\n                <div>\r\n                    <h1 className=\"text-3xl font-bold tracking-tight\">Business Ledger</h1>\r\n                    <p className=\"text-muted-foreground\">Track expenses, revenue, and ROI like a CFO</p>\r\n                </div>\r\n                <div className=\"flex items-center gap-2\">\r\n                    <Button variant=\"outline\" onClick={handleExport}>\r\n                        <Download className=\"mr-2 h-4 w-4\" /> Export\r\n                    </Button>\r\n                    <Button onClick={() => {\r\n                        setFormData({ type: \"income\", amount: \"\", description: \"\", category: \"\", date: format(new Date(), \"yyyy-MM-dd\") });\r\n                        setIsAddOpen(true);\r\n                    }}>\r\n                        <Plus className=\"mr-2 h-4 w-4\" /> Add Entry\r\n                    </Button>\r\n                </div>\r\n            </div>\r\n\r\n            {/* SECTION 1 - KPIs Row 1 */}\r\n            <div className=\"grid gap-4 md:grid-cols-4\">\r\n                <Card>\r\n                    <CardHeader className=\"flex flex-row items-center justify-between pb-2\">\r\n                        <CardTitle className=\"text-sm font-medium\">Total Revenue</CardTitle>\r\n                        <TrendingUp className=\"h-4 w-4 text-emerald-500\" />\r\n                    </CardHeader>\r\n                    <CardContent>\r\n                        <div className=\"text-2xl font-bold text-emerald-500\">{formatCurrency(totalRevenue)}</div>\r\n                    </CardContent>\r\n                </Card>\r\n                <Card>\r\n                    <CardHeader className=\"flex flex-row items-center justify-between pb-2\">\r\n                        <CardTitle className=\"text-sm font-medium\">Total Expenses</CardTitle>\r\n                        <TrendingDown className=\"h-4 w-4 text-rose-500\" />\r\n                    </CardHeader>\r\n                    <CardContent>\r\n                        <div className=\"text-2xl font-bold text-rose-500\">{formatCurrency(totalExpenses)}</div>\r\n                    </CardContent>\r\n                </Card>\r\n                <Card>\r\n                    <CardHeader className=\"flex flex-row items-center justify-between pb-2\">\r\n                        <CardTitle className=\"text-sm font-medium\">Net Profit</CardTitle>\r\n                        <Wallet className={`h-4 w-4 ${netProfit >= 0 ? 'text-emerald-500' : 'text-rose-500'}`} />\r\n                    </CardHeader>\r\n                    <CardContent>\r\n                        <div className={`text-2xl font-bold ${netProfit >= 0 ? 'text-emerald-500' : 'text-rose-500'}`}>\r\n                            {formatCurrency(netProfit)}\r\n                        </div>\r\n                    </CardContent>\r\n                </Card>\r\n                <Card>\r\n                    <CardHeader className=\"flex flex-row items-center justify-between pb-2\">\r\n                        <CardTitle className=\"text-sm font-medium\">ROI</CardTitle>\r\n                        <Percent className={`h-4 w-4 ${roi >= 0 ? 'text-emerald-500' : 'text-rose-500'}`} />\r\n                    </CardHeader>\r\n                    <CardContent>\r\n                        <div className={`text-2xl font-bold ${roi >= 0 ? 'text-emerald-500' : 'text-rose-500'}`}>\r\n                            {roi.toFixed(2)}%\r\n                        </div>\r\n                    </CardContent>\r\n                </Card>\r\n            </div>\r\n\r\n            {/* SECTION 2 - KPIs Row 2 */}\r\n            <div className=\"grid gap-4 md:grid-cols-4\">\r\n                <Card>\r\n                    <CardHeader className=\"flex flex-row items-center justify-between pb-2\">\r\n                        <CardTitle className=\"text-sm font-medium\">Monthly Recurring</CardTitle>\r\n                        <Repeat className=\"h-4 w-4 text-muted-foreground\" />\r\n                    </CardHeader>\r\n                    <CardContent>\r\n                        <div className=\"text-2xl font-bold\">{formatCurrency(monthlyRecurring)}</div>\r\n                    </CardContent>\r\n                </Card>\r\n                <Card>\r\n                    <CardHeader className=\"flex flex-row items-center justify-between pb-2\">\r\n                        <CardTitle className=\"text-sm font-medium\">Total Funding</CardTitle>\r\n                        <Target className=\"h-4 w-4 text-muted-foreground\" />\r\n                    </CardHeader>\r\n                    <CardContent>\r\n                        <div className=\"text-2xl font-bold\">{formatCurrency(totalFunding)}</div>\r\n                    </CardContent>\r\n                </Card>\r\n                <Card>\r\n                    <CardHeader className=\"flex flex-row items-center justify-between pb-2\">\r\n                        <CardTitle className=\"text-sm font-medium\">Funded Accounts</CardTitle>\r\n                        <Briefcase className=\"h-4 w-4 text-muted-foreground\" />\r\n                    </CardHeader>\r\n                    <CardContent>\r\n                        <div className=\"text-2xl font-bold\">{fundedAccountCount}</div>\r\n                    </CardContent>\r\n                </Card>\r\n                <Card>\r\n                    <CardHeader className=\"flex flex-row items-center justify-between pb-2\">\r\n                        <div className=\"flex items-center gap-1.5\">\r\n                            <CardTitle className=\"text-sm font-medium\">Payback Period</CardTitle>\r\n                            <TooltipProvider delayDuration={100}>\r\n                                <Tooltip>\r\n                                    <TooltipTrigger asChild>\r\n                                        <Info className=\"h-[14px] w-[14px] text-muted-foreground/60 hover:text-muted-foreground cursor-help\" />\r\n                                    </TooltipTrigger>\r\n                                    <TooltipContent\r\n                                        side=\"top\"\r\n                                        className=\"max-w-[280px] bg-[#14171E] border-[#2A2F3E] text-[#E8EAF0] text-sm leading-relaxed p-3 shadow-xl\"\r\n                                    >\r\n                                        <div className=\"space-y-2\">\r\n                                            <p className=\"font-semibold\">Calculated as: Total Expenses ÷ (Net Profit ÷ 12)</p>\r\n                                            <p>The estimated number of months until your total trading business expenses are fully recovered by your net profit.</p>\r\n                                            <p className=\"text-muted-foreground/80 mt-1\">\r\n                                                {paybackPeriod === null ? \"Your business is not yet profitable. Focus on reducing expenses or increasing payout frequency.\" :\r\n                                                    paybackPeriod <= 6 ? \"Excellent — you are recovering costs quickly.\" :\r\n                                                        paybackPeriod <= 12 ? \"Good — on track to break even within a year.\" :\r\n                                                            paybackPeriod <= 24 ? \"Moderate — consider reviewing your expense structure.\" :\r\n                                                                \"High — your expenses may be outpacing your returns.\"}\r\n                                            </p>\r\n                                        </div>\r\n                                    </TooltipContent>\r\n                                </Tooltip>\r\n                            </TooltipProvider>\r\n                        </div>\r\n                        <Clock className=\"h-4 w-4 text-muted-foreground\" />\r\n                    </CardHeader>\r\n                    <CardContent>\r\n                        <div className=\"text-2xl font-bold\">{paybackPeriod !== null ? `${paybackPeriod.toFixed(1)} mo` : 'N/A'}</div>\r\n                    </CardContent>\r\n                </Card>\r\n            </div>\r\n\r\n            {/* SECTION 3 - Prop Firm Funnel */}\r\n            <Card>\r\n                <CardHeader>\r\n                    <CardTitle>Prop Firm Funnel</CardTitle>\r\n                    <CardDescription>Track the lifecycle of your funded evaluations</CardDescription>\r\n                </CardHeader>\r\n                <CardContent>\r\n                    <div className=\"flex flex-col space-y-8\">\r\n                        {/* Funnel Vis */}\r\n                        <div className=\"flex flex-col sm:flex-row items-center justify-between rounded-lg border border-border p-6 bg-muted/20\">\r\n                            <div className=\"flex flex-col items-center p-2\">\r\n                                <span className=\"text-muted-foreground text-sm font-medium mb-1\">Evals Purchased</span>\r\n                                <span className=\"text-3xl font-bold\">{propStats.evalsPurchased}</span>\r\n                            </div>\r\n                            <ChevronRight className=\"hidden sm:block h-6 w-6 text-muted-foreground/50 mx-2\" />\r\n                            <div className=\"flex flex-col items-center p-2\">\r\n                                <span className=\"text-muted-foreground text-sm font-medium mb-1\">Currently Active</span>\r\n                                <span className=\"text-3xl font-bold\">{propStats.currentlyActive}</span>\r\n                            </div>\r\n                            <ChevronRight className=\"hidden sm:block h-6 w-6 text-muted-foreground/50 mx-2\" />\r\n                            <div className=\"flex flex-col items-center p-2\">\r\n                                <span className=\"text-muted-foreground text-sm font-medium mb-1\">Passed</span>\r\n                                <span className=\"text-3xl font-bold\">{propStats.passed}</span>\r\n                            </div>\r\n                            <ChevronRight className=\"hidden sm:block h-6 w-6 text-emerald-500/50 mx-2\" />\r\n                            <div className=\"flex flex-col items-center p-2\">\r\n                                <span className=\"text-emerald-500 text-sm font-medium mb-1\">Funded</span>\r\n                                <span className=\"text-3xl font-bold text-emerald-500\">{propStats.funded}</span>\r\n                            </div>\r\n                        </div>\r\n                        {/* Funnel Stats */}\r\n                        <div className=\"grid grid-cols-1 md:grid-cols-3 divide-y-2 md:divide-y-0 md:divide-x-2 divide-border\">\r\n                            <div className=\"flex flex-col items-center text-center py-2\">\r\n                                <span className=\"text-sm text-muted-foreground\">Pass Rate</span>\r\n                                <span className=\"text-xl font-bold\">{passRate}%</span>\r\n                            </div>\r\n                            <div className=\"flex flex-col items-center text-center py-2\">\r\n                                <span className=\"text-sm text-muted-foreground\">Failed Accounts</span>\r\n                                <span className=\"text-xl font-bold\">{propStats.failed}</span>\r\n                            </div>\r\n                            <div className=\"flex flex-col items-center text-center py-2\">\r\n                                <span className=\"text-sm text-muted-foreground\">Total Funding</span>\r\n                                <span className=\"text-xl font-bold\">{formatCurrency(propStats.totalFunding)}</span>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </CardContent>\r\n            </Card>\r\n\r\n            {/* SECTION 4 - Two Columns */}\r\n            <div className=\"grid gap-4 md:grid-cols-5\">\r\n                {/* Left (40%) */}\r\n                <Card className=\"md:col-span-2\">\r\n                    <CardHeader>\r\n                        <CardTitle>Expense Breakdown</CardTitle>\r\n                    </CardHeader>\r\n                    <CardContent>\r\n                        {expenseBreakdown.length > 0 ? (\r\n                            <div className=\"h-[250px] w-full\">\r\n                                <ResponsiveContainer width=\"100%\" height=\"100%\">\r\n                                    <PieChart>\r\n                                        <Pie\r\n                                            data={expenseBreakdown}\r\n                                            cx=\"50%\"\r\n                                            cy=\"50%\"\r\n                                            innerRadius={60}\r\n                                            outerRadius={90}\r\n                                            paddingAngle={5}\r\n                                            dataKey=\"value\"\r\n                                        >\r\n                                            {expenseBreakdown.map((_, index) => (\r\n                                                <Cell key={`cell-${index}`} fill={COLORS[index % COLORS.length]} />\r\n                                            ))}\r\n                                        </Pie>\r\n                                        <RechartsTooltip content={<CustomTooltip />} />\r\n                                    </PieChart>\r\n                                </ResponsiveContainer>\r\n                            </div>\r\n                        ) : (\r\n                            <div className=\"flex h-[250px] items-center justify-center text-sm text-muted-foreground\">\r\n                                No expenses yet.\r\n                            </div>\r\n                        )}\r\n                    </CardContent>\r\n                </Card>\r\n                {/* Right (60%) */}\r\n                <Card className=\"md:col-span-3\">\r\n                    <CardHeader>\r\n                        <CardTitle>Recent Expenses</CardTitle>\r\n                    </CardHeader>\r\n                    <CardContent>\r\n                        {recentExpenses.length > 0 ? (\r\n                            <div className=\"rounded-md border border-border\">\r\n                                <table className=\"w-full text-sm\">\r\n                                    <thead>\r\n                                        <tr className=\"border-b border-border bg-muted/50 text-left\">\r\n                                            <th className=\"p-3 font-medium h-10\">Date</th>\r\n                                            <th className=\"p-3 font-medium h-10\">Description</th>\r\n                                            <th className=\"p-3 font-medium h-10\">Category</th>\r\n                                            <th className=\"p-3 font-medium text-right h-10\">Amount</th>\r\n                                        </tr>\r\n                                    </thead>\r\n                                    <tbody>\r\n                                        {recentExpenses.map((exp: LedgerEntry) => (\r\n                                            <tr key={exp.id} className=\"border-b border-border last:border-0 hover:bg-muted/30\">\r\n                                                <td className=\"p-3\">{format(new Date(exp.date), \"MMM d, yyyy\")}</td>\r\n                                                <td className=\"p-3\">{exp.description}</td>\r\n                                                <td className=\"p-3\">\r\n                                                    <Badge variant=\"secondary\" className=\"font-normal\">{exp.category}</Badge>\r\n                                                </td>\r\n                                                <td className=\"p-3 text-right font-mono text-rose-500\">\r\n                                                    -{formatCurrency(exp.amount)}\r\n                                                </td>\r\n                                            </tr>\r\n                                        ))}\r\n                                    </tbody>\r\n                                </table>\r\n                            </div>\r\n                        ) : (\r\n                            <div className=\"flex h-[200px] items-center justify-center text-sm text-muted-foreground\">\r\n                                No recent expenses.\r\n                            </div>\r\n                        )}\r\n                    </CardContent>\r\n                </Card>\r\n            </div>\r\n\r\n            {/* SECTION 5 - Full Ledger Table */}\r\n            <Card>\r\n                <CardHeader>\r\n                    <CardTitle>All Entries</CardTitle>\r\n                    <CardDescription>Comprehensive ledger of all income and expenses</CardDescription>\r\n                </CardHeader>\r\n                <CardContent>\r\n                    {entries.length > 0 ? (\r\n                        <div className=\"rounded-md border border-border overflow-x-auto\">\r\n                            <table className=\"w-full text-sm\">\r\n                                <thead>\r\n                                    <tr className=\"border-b border-border bg-muted/50 text-left\">\r\n                                        <th className=\"p-3 font-medium h-10\">Date</th>\r\n                                        <th className=\"p-3 font-medium h-10\">Type</th>\r\n                                        <th className=\"p-3 font-medium h-10\">Source</th>\r\n                                        <th className=\"p-3 font-medium h-10\">Description</th>\r\n                                        <th className=\"p-3 font-medium h-10\">Category</th>\r\n                                        <th className=\"p-3 font-medium text-right h-10\">Amount</th>\r\n                                        <th className=\"p-3 font-medium text-center h-10 w-24\">Actions</th>\r\n                                    </tr>\r\n                                </thead>\r\n                                <tbody>\r\n                                    {entries.map((entry: LedgerEntry) => (\r\n                                        <tr key={entry.id} className=\"border-b border-border last:border-0 hover:bg-muted/30 whitespace-nowrap\">\r\n                                            <td className=\"p-3\">{format(new Date(entry.date), \"yyyy-MM-dd\")}</td>\r\n                                            <td className=\"p-3\">\r\n                                                <Badge\r\n                                                    className={\r\n                                                        entry.type === 'income' ? 'bg-emerald-500/10 text-emerald-500 border-emerald-500/20' :\r\n                                                            entry.type === 'expense' ? 'bg-rose-500/10 text-rose-500 border-rose-500/20' :\r\n                                                                entry.type === 'payout' ? 'bg-blue-500/10 text-blue-500 border-blue-500/20' :\r\n                                                                    'bg-purple-500/10 text-purple-500 border-purple-500/20'\r\n                                                    }\r\n                                                    variant=\"outline\"\r\n                                                >\r\n                                                    {entry.type}\r\n                                                </Badge>\r\n                                            </td>\r\n                                            <td className=\"p-3\">\r\n                                                <Badge\r\n                                                    variant=\"outline\"\r\n                                                    className={entry.source === 'manual' ? \"border-yellow-500/50 text-yellow-500\" : \"text-muted-foreground\"}\r\n                                                >\r\n                                                    {entry.source}\r\n                                                </Badge>\r\n                                            </td>\r\n                                            <td className=\"p-3 truncate max-w-[200px]\" title={entry.description}>{entry.description}</td>\r\n                                            <td className=\"p-3\">\r\n                                                {entry.category ? (\r\n                                                    <Badge variant=\"secondary\" className=\"font-normal\">{entry.category}</Badge>\r\n                                                ) : <span className=\"text-muted-foreground\">-</span>}\r\n                                            </td>\r\n                                            <td className={`p-3 text-right font-mono ${['income', 'payout', 'funding'].includes(entry.type) ? 'text-emerald-500' : 'text-rose-500'}`}>\r\n                                                {['income', 'payout', 'funding'].includes(entry.type) ? '+' : '-'}{formatCurrency(entry.amount)}\r\n                                            </td>\r\n                                            <td className=\"p-3 text-center\">\r\n                                                {entry.source === \"manual\" ? (\r\n                                                    <div className=\"flex justify-center gap-2\">\r\n                                                        <Button\r\n                                                            variant=\"ghost\"\r\n                                                            size=\"icon\"\r\n                                                            className=\"h-8 w-8 text-muted-foreground hover:text-foreground\"\r\n                                                            onClick={() => {\r\n                                                                setSelectedEntry(entry);\r\n                                                                setFormData({\r\n                                                                    type: entry.type,\r\n                                                                    amount: entry.amount.toString(),\r\n                                                                    description: entry.description || \"\",\r\n                                                                    category: entry.category || \"\",\r\n                                                                    date: entry.date\r\n                                                                });\r\n                                                                setIsEditOpen(true);\r\n                                                            }}\r\n                                                        >\r\n                                                            <Pencil className=\"h-4 w-4\" />\r\n                                                        </Button>\r\n                                                        <Button\r\n                                                            variant=\"ghost\"\r\n                                                            size=\"icon\"\r\n                                                            className=\"h-8 w-8 text-muted-foreground hover:text-rose-500\"\r\n                                                            onClick={() => {\r\n                                                                setSelectedEntry(entry);\r\n                                                                setIsDeleteOpen(true);\r\n                                                            }}\r\n                                                        >\r\n                                                            <Trash2 className=\"h-4 w-4\" />\r\n                                                        </Button>\r\n                                                    </div>\r\n                                                ) : (\r\n                                                    <span className=\"text-muted-foreground text-xs\">-</span>\r\n                                                )}\r\n                                            </td>\r\n                                        </tr>\r\n                                    ))}\r\n                                </tbody>\r\n                            </table>\r\n                        </div>\r\n                    ) : (\r\n                        <div className=\"flex h-32 items-center justify-center rounded-md border border-dashed text-sm text-muted-foreground\">\r\n                            No ledger entries yet.\r\n                        </div>\r\n                    )}\r\n                </CardContent>\r\n            </Card>\r\n\r\n            {/* ADd Entry Dialog */}\r\n            <Dialog open={isAddOpen} onOpenChange={setIsAddOpen}>\r\n                <DialogContent>\r\n                    <DialogHeader>\r\n                        <DialogTitle>Add Manual Entry</DialogTitle>\r\n                    </DialogHeader>\r\n                    <form onSubmit={handleAddSubmit} className=\"space-y-4 py-4\">\r\n                        <div className=\"grid gap-2\">\r\n                            <Label htmlFor=\"type\">Type</Label>\r\n                            <Select\r\n                                value={formData.type}\r\n                                onValueChange={(val) => setFormData({ ...formData, type: val as EntryType })}\r\n                            >\r\n                                <SelectTrigger>\r\n                                    <SelectValue placeholder=\"Select type\" />\r\n                                </SelectTrigger>\r\n                                <SelectContent>\r\n                                    <SelectItem value=\"income\">Income</SelectItem>\r\n                                    <SelectItem value=\"expense\">Expense</SelectItem>\r\n                                    <SelectItem value=\"payout\">Payout</SelectItem>\r\n                                    <SelectItem value=\"funding\">Funding</SelectItem>\r\n                                </SelectContent>\r\n                            </Select>\r\n                        </div>\r\n                        <div className=\"grid gap-2\">\r\n                            <Label htmlFor=\"date\">Date</Label>\r\n                            <Input\r\n                                id=\"date\"\r\n                                type=\"date\"\r\n                                required\r\n                                value={formData.date}\r\n                                onChange={(e) => setFormData({ ...formData, date: e.target.value })}\r\n                            />\r\n                        </div>\r\n                        <div className=\"grid gap-2\">\r\n                            <Label htmlFor=\"amount\">Amount ($)</Label>\r\n                            <Input\r\n                                id=\"amount\"\r\n                                type=\"number\"\r\n                                step=\"0.01\"\r\n                                min=\"0\"\r\n                                required\r\n                                value={formData.amount}\r\n                                onChange={(e) => setFormData({ ...formData, amount: e.target.value })}\r\n                            />\r\n                        </div>\r\n                        <div className=\"grid gap-2\">\r\n                            <Label htmlFor=\"description\">Description</Label>\r\n                            <Input\r\n                                id=\"description\"\r\n                                required\r\n                                value={formData.description}\r\n                                onChange={(e) => setFormData({ ...formData, description: e.target.value })}\r\n                            />\r\n                        </div>\r\n                        <div className=\"grid gap-2\">\r\n                            <Label htmlFor=\"category\">Category</Label>\r\n                            <Input\r\n                                id=\"category\"\r\n                                required\r\n                                value={formData.category}\r\n                                onChange={(e) => setFormData({ ...formData, category: e.target.value })}\r\n                            />\r\n                        </div>\r\n                        <DialogFooter>\r\n                            <Button type=\"button\" variant=\"outline\" onClick={() => setIsAddOpen(false)}>Cancel</Button>\r\n                            <Button type=\"submit\" disabled={addMutation.isPending}>\r\n                                {addMutation.isPending && <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />}\r\n                                Add Entry\r\n                            </Button>\r\n                        </DialogFooter>\r\n                    </form>\r\n                </DialogContent>\r\n            </Dialog>\r\n\r\n            {/* Edit Entry Dialog */}\r\n            <Dialog open={isEditOpen} onOpenChange={setIsEditOpen}>\r\n                <DialogContent>\r\n                    <DialogHeader>\r\n                        <DialogTitle>Edit Manual Entry</DialogTitle>\r\n                    </DialogHeader>\r\n                    <form onSubmit={handleEditSubmit} className=\"space-y-4 py-4\">\r\n                        <div className=\"grid gap-2\">\r\n                            <Label htmlFor=\"edit-type\">Type</Label>\r\n                            <Select\r\n                                value={formData.type}\r\n                                onValueChange={(val) => setFormData({ ...formData, type: val as EntryType })}\r\n                            >\r\n                                <SelectTrigger>\r\n                                    <SelectValue placeholder=\"Select type\" />\r\n                                </SelectTrigger>\r\n                                <SelectContent>\r\n                                    <SelectItem value=\"income\">Income</SelectItem>\r\n                                    <SelectItem value=\"expense\">Expense</SelectItem>\r\n                                    <SelectItem value=\"payout\">Payout</SelectItem>\r\n                                    <SelectItem value=\"funding\">Funding</SelectItem>\r\n                                </SelectContent>\r\n                            </Select>\r\n                        </div>\r\n                        <div className=\"grid gap-2\">\r\n                            <Label htmlFor=\"edit-date\">Date</Label>\r\n                            <Input\r\n                                id=\"edit-date\"\r\n                                type=\"date\"\r\n                                required\r\n                                value={formData.date}\r\n                                onChange={(e) => setFormData({ ...formData, date: e.target.value })}\r\n                            />\r\n                        </div>\r\n                        <div className=\"grid gap-2\">\r\n                            <Label htmlFor=\"edit-amount\">Amount ($)</Label>\r\n                            <Input\r\n                                id=\"edit-amount\"\r\n                                type=\"number\"\r\n                                step=\"0.01\"\r\n                                min=\"0\"\r\n                                required\r\n                                value={formData.amount}\r\n                                onChange={(e) => setFormData({ ...formData, amount: e.target.value })}\r\n                            />\r\n                        </div>\r\n                        <div className=\"grid gap-2\">\r\n                            <Label htmlFor=\"edit-description\">Description</Label>\r\n                            <Input\r\n                                id=\"edit-description\"\r\n                                required\r\n                                value={formData.description}\r\n                                onChange={(e) => setFormData({ ...formData, description: e.target.value })}\r\n                            />\r\n                        </div>\r\n                        <div className=\"grid gap-2\">\r\n                            <Label htmlFor=\"edit-category\">Category</Label>\r\n                            <Input\r\n                                id=\"edit-category\"\r\n                                required\r\n                                value={formData.category}\r\n                                onChange={(e) => setFormData({ ...formData, category: e.target.value })}\r\n                            />\r\n                        </div>\r\n                        <DialogFooter>\r\n                            <Button type=\"button\" variant=\"outline\" onClick={() => setIsEditOpen(false)}>Cancel</Button>\r\n                            <Button type=\"submit\" disabled={editMutation.isPending}>\r\n                                {editMutation.isPending && <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />}\r\n                                Save Changes\r\n                            </Button>\r\n                        </DialogFooter>\r\n                    </form>\r\n                </DialogContent>\r\n            </Dialog>\r\n\r\n            {/* Delete Confirmation Dialog */}\r\n            <AlertDialog open={isDeleteOpen} onOpenChange={setIsDeleteOpen}>\r\n                <AlertDialogContent>\r\n                    <AlertDialogHeader>\r\n                        <AlertDialogTitle>Are you absolutely sure?</AlertDialogTitle>\r\n                        <AlertDialogDescription>\r\n                            This will permanently delete the manual ledger entry for \"{selectedEntry?.description}\".\r\n                            This action cannot be undone.\r\n                        </AlertDialogDescription>\r\n                    </AlertDialogHeader>\r\n                    <AlertDialogFooter>\r\n                        <AlertDialogCancel>Cancel</AlertDialogCancel>\r\n                        <AlertDialogAction\r\n                            className=\"bg-rose-500 hover:bg-rose-600\"\r\n                            onClick={() => selectedEntry && deleteMutation.mutate(selectedEntry.id)}\r\n                            disabled={deleteMutation.isPending}\r\n                        >\r\n                            {deleteMutation.isPending ? \"Deleting...\" : \"Delete Entry\"}\r\n                        </AlertDialogAction>\r\n                    </AlertDialogFooter>\r\n                </AlertDialogContent>\r\n            </AlertDialog>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\components\\prop\\prop-client.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\components\\providers.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\components\\settings\\grading-settings-client.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\components\\strategies\\strategies-client.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CardFooter' is defined but never used.","line":10,"column":52,"nodeType":"Identifier","messageId":"unusedVar","endLine":10,"endColumn":62,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"CardFooter"},"fix":{"range":[449,461],"text":""},"desc":"Remove unused variable \"CardFooter\"."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"The 'strategies' logical expression could make the dependencies of useMemo Hook (at line 181) change on every render. To fix this, wrap the initialization of 'strategies' in its own useMemo() Hook.","line":105,"column":11,"nodeType":"VariableDeclarator","endLine":105,"endColumn":62},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"The 'strategies' logical expression could make the dependencies of useMemo Hook (at line 187) change on every render. To fix this, wrap the initialization of 'strategies' in its own useMemo() Hook.","line":105,"column":11,"nodeType":"VariableDeclarator","endLine":105,"endColumn":62},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":109,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":109,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3337,3340],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3337,3340],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":420,"column":82,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":420,"endColumn":85,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[21360,21363],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[21360,21363],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\r\n\r\nimport React, { useState, useMemo } from 'react'\r\nimport { Plus, Check, PenLine, Trash2, BookMarked, TrendingUp, Presentation, AlertCircle, Percent, SlidersHorizontal } from 'lucide-react'\r\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query'\r\nimport Link from 'next/link'\r\nimport { cn } from '@/lib/utils'\r\n\r\nimport { Button } from '@/components/ui/button'\r\nimport { Card, CardContent, CardHeader, CardTitle, CardFooter, CardDescription } from '@/components/ui/card'\r\nimport { Input } from '@/components/ui/input'\r\nimport { Label } from '@/components/ui/label'\r\nimport { Textarea } from '@/components/ui/textarea'\r\nimport {\r\n    Select,\r\n    SelectContent,\r\n    SelectItem,\r\n    SelectTrigger,\r\n    SelectValue,\r\n} from '@/components/ui/select'\r\nimport {\r\n    Dialog,\r\n    DialogContent,\r\n    DialogDescription,\r\n    DialogFooter,\r\n    DialogHeader,\r\n    DialogTitle,\r\n} from '@/components/ui/dialog'\r\nimport {\r\n    AlertDialog,\r\n    AlertDialogAction,\r\n    AlertDialogCancel,\r\n    AlertDialogContent,\r\n    AlertDialogDescription,\r\n    AlertDialogFooter,\r\n    AlertDialogHeader,\r\n    AlertDialogTitle,\r\n} from '@/components/ui/alert-dialog'\r\nimport {\r\n    Sheet,\r\n    SheetContent,\r\n    SheetDescription,\r\n    SheetHeader,\r\n    SheetTitle,\r\n} from '@/components/ui/sheet'\r\nimport { Skeleton } from '@/components/ui/skeleton'\r\n\r\ntype Strategy = {\r\n    id: string\r\n    name: string\r\n    description: string | null\r\n    status: 'active' | 'testing' | 'retired'\r\n    entry_rules: string | null\r\n    invalidation_conditions: string | null\r\n    tradeCount: number\r\n    totalPnl: number\r\n    winRate: number | null\r\n    profitFactor: number | null\r\n}\r\n\r\nfunction formatPnl(value: number | null): string {\r\n    if (value === null) return '—'\r\n    const abs = Math.abs(value).toFixed(2)\r\n    return `${value >= 0 ? '+' : '-'}$${abs}`\r\n}\r\n\r\nfunction pnlClass(value: number | null): string {\r\n    if (value === null) return 'text-[var(--muted-foreground)]'\r\n    return value >= 0 ? 'text-profit' : 'text-loss'\r\n}\r\n\r\ntype Filter = 'All' | 'Active' | 'Testing' | 'Retired'\r\n\r\nexport function StrategiesClient() {\r\n    const queryClient = useQueryClient()\r\n    const [filter, setFilter] = useState<Filter>('All')\r\n\r\n    // Dialog / form state\r\n    const [isDialogOpen, setIsDialogOpen] = useState(false)\r\n    const [editingId, setEditingId] = useState<string | null>(null)\r\n    const [formData, setFormData] = useState({\r\n        name: '',\r\n        description: '',\r\n        status: 'active' as 'active' | 'testing' | 'retired',\r\n        entry_rules: '',\r\n        invalidation_conditions: ''\r\n    })\r\n\r\n    // Sheet state\r\n    const [viewingId, setViewingId] = useState<string | null>(null)\r\n\r\n    // Delete confirm state\r\n    const [deletingId, setDeletingId] = useState<string | null>(null)\r\n\r\n    // API Queries\r\n    const { data: strategiesData, isLoading, error } = useQuery({\r\n        queryKey: ['strategies'],\r\n        queryFn: async () => {\r\n            const res = await fetch('/api/strategies')\r\n            if (!res.ok) throw new Error('Failed to fetch')\r\n            return res.json() as Promise<{ data: Strategy[] }>\r\n        }\r\n    })\r\n\r\n    const strategies: Strategy[] = strategiesData?.data || []\r\n\r\n    // Mutations\r\n    const saveMutation = useMutation({\r\n        mutationFn: async (strat: any) => {\r\n            const url = editingId ? `/api/strategies/${editingId}` : '/api/strategies'\r\n            const method = editingId ? 'PATCH' : 'POST'\r\n            const res = await fetch(url, {\r\n                method,\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify(strat)\r\n            })\r\n            if (!res.ok) throw new Error('Failed to save strategy')\r\n            return res.json()\r\n        },\r\n        onSuccess: () => {\r\n            queryClient.invalidateQueries({ queryKey: ['strategies'] })\r\n            setIsDialogOpen(false)\r\n            setEditingId(null)\r\n            resetForm()\r\n        }\r\n    })\r\n\r\n    const deleteMutation = useMutation({\r\n        mutationFn: async (id: string) => {\r\n            const res = await fetch(`/api/strategies/${id}`, { method: 'DELETE' })\r\n            if (!res.ok) throw new Error('Failed to delete strategy')\r\n            return res.json()\r\n        },\r\n        onSuccess: () => {\r\n            queryClient.invalidateQueries({ queryKey: ['strategies'] })\r\n            queryClient.invalidateQueries({ queryKey: ['trades'] }) // Unlinked trades\r\n            setDeletingId(null)\r\n        }\r\n    })\r\n\r\n    // Computed Stats\r\n    const {\r\n        activeCount,\r\n        totalTrades,\r\n        combinedPnl,\r\n        avgWinRate,\r\n        avgProfitFactor,\r\n        bestStrategy\r\n    } = useMemo<{\r\n        activeCount: number\r\n        totalTrades: number\r\n        combinedPnl: number\r\n        avgWinRate: number | null\r\n        avgProfitFactor: number | null\r\n        bestStrategy: Strategy | null\r\n    }>(() => {\r\n        let active = 0, trades = 0, pnl = 0, wrSum = 0, pfSum = 0, wrCount = 0, pfCount = 0\r\n        let best: Strategy | null = null\r\n\r\n        strategies.forEach(s => {\r\n            if (s.status === 'active') active++\r\n            trades += s.tradeCount\r\n            pnl += s.totalPnl\r\n\r\n            if (s.winRate !== null) { wrSum += s.winRate; wrCount++ }\r\n            if (s.profitFactor !== null) { pfSum += s.profitFactor; pfCount++ }\r\n\r\n            if (!best || s.totalPnl > best.totalPnl) {\r\n                if (s.tradeCount > 0) best = s\r\n            }\r\n        })\r\n\r\n        return {\r\n            activeCount: active,\r\n            totalTrades: trades,\r\n            combinedPnl: pnl,\r\n            avgWinRate: wrCount > 0 ? wrSum / wrCount : null,\r\n            avgProfitFactor: pfCount > 0 ? pfSum / pfCount : null,\r\n            bestStrategy: best\r\n        }\r\n    }, [strategies])\r\n\r\n    // Filtered\r\n    const filteredStrategies = useMemo(() => {\r\n        if (filter === 'All') return strategies\r\n        return strategies.filter(s => s.status.toLowerCase() === filter.toLowerCase())\r\n    }, [strategies, filter])\r\n\r\n    const counts = {\r\n        All: strategies.length,\r\n        Active: strategies.filter(s => s.status === 'active').length,\r\n        Testing: strategies.filter(s => s.status === 'testing').length,\r\n        Retired: strategies.filter(s => s.status === 'retired').length,\r\n    }\r\n\r\n    const resetForm = () => setFormData({ name: '', description: '', status: 'active', entry_rules: '', invalidation_conditions: '' })\r\n\r\n    const handleEdit = (strategy: Strategy) => {\r\n        setFormData({\r\n            name: strategy.name,\r\n            description: strategy.description || '',\r\n            status: strategy.status,\r\n            entry_rules: strategy.entry_rules || '',\r\n            invalidation_conditions: strategy.invalidation_conditions || ''\r\n        })\r\n        setEditingId(strategy.id)\r\n        setIsDialogOpen(true)\r\n    }\r\n\r\n    const viewingStrategy = strategies.find(s => s.id === viewingId)\r\n\r\n    // Status badge classes\r\n    const statusBadge = (status: string) => {\r\n        if (status === 'active') return 'bg-[var(--color-green-muted)] text-[var(--color-green)] border-[var(--color-green)]/30'\r\n        if (status === 'testing') return 'bg-[var(--color-yellow-muted)] text-[var(--color-yellow)] border-[var(--color-yellow)]/30'\r\n        return 'bg-[var(--muted)] text-[var(--muted-foreground)] border-[var(--border)]'\r\n    }\r\n\r\n    if (error) return <div className=\"p-8 text-red-500\">Failed to load strategies</div>\r\n\r\n    return (\r\n        <div className=\"flex flex-col h-full bg-[var(--background)]\">\r\n            <div className=\"flex-1 space-y-8 p-8 pt-6 max-w-[1600px] w-full mx-auto\">\r\n\r\n                {/* Header */}\r\n                <div className=\"flex items-center justify-between space-y-2\">\r\n                    <div>\r\n                        <h2 className=\"text-3xl font-bold tracking-tight text-[var(--foreground)]\">Strategies</h2>\r\n                        <p className=\"text-[var(--muted-foreground)]\">Build, track, and refine your trading playbook</p>\r\n                    </div>\r\n                    <div className=\"flex items-center space-x-2\">\r\n                        <Button onClick={() => { resetForm(); setEditingId(null); setIsDialogOpen(true) }}>\r\n                            <Plus size={16} className=\"mr-2\" /> New Strategy\r\n                        </Button>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* KPI Cards */}\r\n                <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 border-b border-[var(--border)] pb-8\">\r\n                    <Card>\r\n                        <CardHeader className=\"flex flex-row items-center justify-between pb-2\">\r\n                            <CardTitle className=\"text-sm font-medium\">Active Strategies</CardTitle>\r\n                            <Presentation className=\"h-4 w-4 text-[var(--muted-foreground)]\" />\r\n                        </CardHeader>\r\n                        <CardContent>\r\n                            {isLoading ? <Skeleton className=\"h-7 w-12\" /> : <div className=\"text-2xl font-bold\">{activeCount}</div>}\r\n                        </CardContent>\r\n                    </Card>\r\n\r\n                    <Card>\r\n                        <CardHeader className=\"flex flex-row items-center justify-between pb-2\">\r\n                            <CardTitle className=\"text-sm font-medium\">Total Trades</CardTitle>\r\n                            <BookMarked className=\"h-4 w-4 text-[var(--muted-foreground)]\" />\r\n                        </CardHeader>\r\n                        <CardContent>\r\n                            {isLoading ? <Skeleton className=\"h-7 w-16\" /> : <div className=\"text-2xl font-bold\">{totalTrades}</div>}\r\n                        </CardContent>\r\n                    </Card>\r\n\r\n                    <Card>\r\n                        <CardHeader className=\"flex flex-row items-center justify-between pb-2\">\r\n                            <CardTitle className=\"text-sm font-medium\">Combined P&L</CardTitle>\r\n                            <TrendingUp className=\"h-4 w-4 text-[var(--muted-foreground)]\" />\r\n                        </CardHeader>\r\n                        <CardContent>\r\n                            {isLoading ? <Skeleton className=\"h-7 w-24\" /> : <div className={cn(\"text-2xl font-bold font-mono\", pnlClass(combinedPnl))}>{formatPnl(combinedPnl)}</div>}\r\n                        </CardContent>\r\n                    </Card>\r\n\r\n                    <Card>\r\n                        <CardHeader className=\"flex flex-row items-center justify-between pb-2\">\r\n                            <CardTitle className=\"text-sm font-medium\">Avg Win Rate</CardTitle>\r\n                            <Percent className=\"h-4 w-4 text-[var(--muted-foreground)]\" />\r\n                        </CardHeader>\r\n                        <CardContent>\r\n                            {isLoading ? <Skeleton className=\"h-7 w-16\" /> : <div className=\"text-2xl font-bold\">{avgWinRate !== null ? `${avgWinRate.toFixed(1)}%` : '—'}</div>}\r\n                        </CardContent>\r\n                    </Card>\r\n\r\n                    <Card>\r\n                        <CardHeader className=\"flex flex-row items-center justify-between pb-2\">\r\n                            <CardTitle className=\"text-sm font-medium\">Avg Profit Factor</CardTitle>\r\n                            <AlertCircle className=\"h-4 w-4 text-[var(--muted-foreground)]\" />\r\n                        </CardHeader>\r\n                        <CardContent>\r\n                            {isLoading ? <Skeleton className=\"h-7 w-16\" /> : <div className=\"text-2xl font-bold\">{avgProfitFactor !== null ? avgProfitFactor.toFixed(2) : '—'}</div>}\r\n                        </CardContent>\r\n                    </Card>\r\n\r\n                    <Card>\r\n                        <CardHeader className=\"flex flex-row items-center justify-between pb-2\">\r\n                            <CardTitle className=\"text-sm font-medium\">Best Strategy</CardTitle>\r\n                            <Check className=\"h-4 w-4 text-[var(--muted-foreground)]\" />\r\n                        </CardHeader>\r\n                        <CardContent>\r\n                            {isLoading ? <Skeleton className=\"h-7 w-24\" /> : (\r\n                                <>\r\n                                    <div className=\"text-lg font-bold truncate leading-tight mt-0.5\">{bestStrategy ? bestStrategy.name : 'N/A'}</div>\r\n                                    {bestStrategy && <p className={cn(\"text-xs font-mono font-medium mt-1 uppercase\", pnlClass(bestStrategy.totalPnl))}>{formatPnl(bestStrategy.totalPnl)}</p>}\r\n                                </>\r\n                            )}\r\n                        </CardContent>\r\n                    </Card>\r\n                </div>\r\n\r\n                {/* Filter Bar */}\r\n                <div className=\"flex items-center space-x-2\">\r\n                    {(['All', 'Active', 'Testing', 'Retired'] as Filter[]).map(f => (\r\n                        <button\r\n                            key={f}\r\n                            onClick={() => setFilter(f)}\r\n                            className={cn(\r\n                                \"inline-flex items-center justify-center rounded-md text-sm font-medium transition-colors h-9 px-4 py-2\",\r\n                                filter === f\r\n                                    ? \"bg-[var(--foreground)] text-[var(--background)] shadow hover:bg-[var(--foreground)]/90\"\r\n                                    : \"bg-transparent text-[var(--muted-foreground)] hover:bg-[var(--accent)] hover:text-[var(--accent-foreground)]\"\r\n                            )}\r\n                        >\r\n                            {f} <span className=\"ml-2 opacity-60 text-xs\">({counts[f]})</span>\r\n                        </button>\r\n                    ))}\r\n                </div>\r\n\r\n                {/* Strategies Grid */}\r\n                <div className=\"grid gap-6 md:grid-cols-2 lg:grid-cols-3\">\r\n                    {isLoading ? (\r\n                        Array.from({ length: 6 }).map((_, i) => <Skeleton key={i} className=\"h-64 w-full\" />)\r\n                    ) : filteredStrategies.length === 0 ? (\r\n                        <div className=\"col-span-full py-16 text-center border border-dashed border-[var(--border)] rounded-lg\">\r\n                            <h3 className=\"text-lg font-medium text-[var(--foreground)] mb-2\">\r\n                                {filter === 'All' ? 'No strategies yet.' : `No ${filter.toLowerCase()} strategies found.`}\r\n                            </h3>\r\n                            {filter === 'All' && (\r\n                                <p className=\"text-[var(--muted-foreground)] mb-4\">Click &quot;+ New Strategy&quot; to get started.</p>\r\n                            )}\r\n                        </div>\r\n                    ) : (\r\n                        filteredStrategies.map(strategy => (\r\n                            <Card key={strategy.id} className=\"flex flex-col\">\r\n                                <CardHeader className=\"pb-3\">\r\n                                    <div className=\"flex items-start justify-between gap-3\">\r\n                                        <CardTitle className=\"text-lg leading-tight truncate\">{strategy.name}</CardTitle>\r\n                                        <span className={cn(\"px-2 py-0.5 rounded-full text-[10px] font-medium uppercase tracking-wider border shrink-0\", statusBadge(strategy.status))}>\r\n                                            {strategy.status}\r\n                                        </span>\r\n                                    </div>\r\n                                    {strategy.description && (\r\n                                        <CardDescription className=\"line-clamp-2 mt-2 leading-relaxed h-[40px]\">\r\n                                            {strategy.description}\r\n                                        </CardDescription>\r\n                                    )}\r\n                                </CardHeader>\r\n                                <CardContent className=\"pb-4 flex-1\">\r\n                                    <div className=\"grid grid-cols-2 gap-y-4 gap-x-2 bg-[var(--secondary)] rounded-md p-3\">\r\n                                        <div className=\"flex flex-col\">\r\n                                            <span className=\"text-[10px] uppercase tracking-wider text-[var(--muted-foreground)]\">Trades</span>\r\n                                            <span className=\"text-sm font-semibold\">{strategy.tradeCount}</span>\r\n                                        </div>\r\n                                        <div className=\"flex flex-col\">\r\n                                            <span className=\"text-[10px] uppercase tracking-wider text-[var(--muted-foreground)]\">Total P&L</span>\r\n                                            <span className={cn(\"text-sm font-mono font-semibold\", pnlClass(strategy.totalPnl))}>{formatPnl(strategy.totalPnl)}</span>\r\n                                        </div>\r\n                                        <div className=\"flex flex-col\">\r\n                                            <span className=\"text-[10px] uppercase tracking-wider text-[var(--muted-foreground)]\">Win Rate</span>\r\n                                            <span className=\"text-sm font-semibold\">{strategy.winRate !== null ? `${strategy.winRate.toFixed(1)}%` : '—'}</span>\r\n                                        </div>\r\n                                        <div className=\"flex flex-col\">\r\n                                            <span className=\"text-[10px] uppercase tracking-wider text-[var(--muted-foreground)]\">Profit Factor</span>\r\n                                            <span className=\"text-sm font-semibold\">{strategy.profitFactor !== null ? strategy.profitFactor.toFixed(2) : '—'}</span>\r\n                                        </div>\r\n                                    </div>\r\n                                </CardContent>\r\n                                <div className=\"px-6 pb-4 pt-0\">\r\n                                    <div className=\"h-px bg-[var(--border)] w-full mb-4\" />\r\n                                    <div className=\"flex items-center justify-between\">\r\n                                        <div className=\"flex items-center space-x-2\">\r\n                                            <Button variant=\"ghost\" size=\"sm\" onClick={() => setViewingId(strategy.id)} className=\"h-8 px-3 text-xs\">\r\n                                                View Rules\r\n                                            </Button>\r\n                                            <Button variant=\"outline\" size=\"sm\" asChild className=\"h-8 px-3 text-xs bg-[var(--secondary)]\">\r\n                                                <Link href={`/grading/configure?strategy=${strategy.id}`}>\r\n                                                    <SlidersHorizontal className=\"w-3 h-3 mr-2\" />\r\n                                                    Configure Grading\r\n                                                </Link>\r\n                                            </Button>\r\n                                        </div>\r\n                                        <div className=\"flex items-center space-x-1\">\r\n                                            <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8 text-[var(--muted-foreground)] hover:text-[var(--foreground)]\" onClick={() => handleEdit(strategy)}>\r\n                                                <PenLine size={14} />\r\n                                            </Button>\r\n                                            <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8 text-[var(--muted-foreground)] hover:text-[var(--color-red)]\" onClick={() => setDeletingId(strategy.id)}>\r\n                                                <Trash2 size={14} />\r\n                                            </Button>\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n                            </Card>\r\n                        ))\r\n                    )}\r\n                </div>\r\n            </div>\r\n\r\n            {/* Dialog: Create / Edit */}\r\n            <Dialog open={isDialogOpen} onOpenChange={setIsDialogOpen}>\r\n                <DialogContent className=\"sm:max-w-[550px] bg-[var(--background)] border-[var(--border)]\">\r\n                    <DialogHeader>\r\n                        <DialogTitle>{editingId ? 'Edit Strategy' : 'New Strategy'}</DialogTitle>\r\n                        <DialogDescription>\r\n                            {editingId ? 'Update your playbook strategy details.' : 'Add a new trading playbook strategy.'}\r\n                        </DialogDescription>\r\n                    </DialogHeader>\r\n                    <div className=\"grid gap-4 py-4\">\r\n                        <div className=\"grid gap-2\">\r\n                            <Label htmlFor=\"name\">Strategy Name</Label>\r\n                            <Input id=\"name\" value={formData.name} onChange={e => setFormData({ ...formData, name: e.target.value })} placeholder=\"e.g. Bull Flag Breakout\" />\r\n                        </div>\r\n\r\n                        <div className=\"grid gap-2\">\r\n                            <Label htmlFor=\"status\">Status</Label>\r\n                            <Select value={formData.status} onValueChange={(val: any) => setFormData({ ...formData, status: val })}>\r\n                                <SelectTrigger>\r\n                                    <SelectValue placeholder=\"Select status\" />\r\n                                </SelectTrigger>\r\n                                <SelectContent>\r\n                                    <SelectItem value=\"active\">Active</SelectItem>\r\n                                    <SelectItem value=\"testing\">Testing</SelectItem>\r\n                                    <SelectItem value=\"retired\">Retired</SelectItem>\r\n                                </SelectContent>\r\n                            </Select>\r\n                        </div>\r\n\r\n                        <div className=\"grid gap-2\">\r\n                            <div className=\"flex justify-between\">\r\n                                <Label htmlFor=\"description\">Description <span className=\"text-[var(--muted-foreground)] font-normal\">(optional)</span></Label>\r\n                                <span className=\"text-xs text-[var(--muted-foreground)]\">{formData.description.length}/200</span>\r\n                            </div>\r\n                            <Textarea\r\n                                id=\"description\"\r\n                                maxLength={200}\r\n                                value={formData.description}\r\n                                onChange={e => setFormData({ ...formData, description: e.target.value })}\r\n                                placeholder=\"Brief summary...\"\r\n                                className=\"resize-none h-16\"\r\n                            />\r\n                        </div>\r\n\r\n                        <div className=\"grid gap-2\">\r\n                            <Label htmlFor=\"entry_rules\">Entry Rules</Label>\r\n                            <Textarea\r\n                                id=\"entry_rules\"\r\n                                value={formData.entry_rules}\r\n                                onChange={e => setFormData({ ...formData, entry_rules: e.target.value })}\r\n                                placeholder=\"Describe your entry criteria, setups, and conditions...\"\r\n                                className=\"min-h-[100px]\"\r\n                            />\r\n                        </div>\r\n\r\n                        <div className=\"grid gap-2\">\r\n                            <Label htmlFor=\"invalidation_conditions\">Invalidation Conditions</Label>\r\n                            <Textarea\r\n                                id=\"invalidation_conditions\"\r\n                                value={formData.invalidation_conditions}\r\n                                onChange={e => setFormData({ ...formData, invalidation_conditions: e.target.value })}\r\n                                placeholder=\"Describe what would invalidate this trade setup...\"\r\n                                className=\"min-h-[100px]\"\r\n                            />\r\n                        </div>\r\n                    </div>\r\n                    <DialogFooter>\r\n                        <Button variant=\"outline\" onClick={() => setIsDialogOpen(false)} disabled={saveMutation.isPending}>Cancel</Button>\r\n                        <Button onClick={() => saveMutation.mutate(formData)} disabled={!formData.name.trim() || saveMutation.isPending}>\r\n                            {saveMutation.isPending ? 'Saving...' : editingId ? 'Save Changes' : 'Create Strategy'}\r\n                        </Button>\r\n                    </DialogFooter>\r\n                </DialogContent>\r\n            </Dialog>\r\n\r\n            {/* Delete Confirm */}\r\n            <AlertDialog open={!!deletingId} onOpenChange={(open) => !open && setDeletingId(null)}>\r\n                <AlertDialogContent className=\"bg-[var(--background)] border-[var(--border)]\">\r\n                    <AlertDialogHeader>\r\n                        <AlertDialogTitle>Delete strategy?</AlertDialogTitle>\r\n                        <AlertDialogDescription>\r\n                            This will unlink this strategy from all associated trades, but the rules & stats will be permanently deleted. This action cannot be undone.\r\n                        </AlertDialogDescription>\r\n                    </AlertDialogHeader>\r\n                    <AlertDialogFooter>\r\n                        <AlertDialogCancel disabled={deleteMutation.isPending}>Cancel</AlertDialogCancel>\r\n                        <AlertDialogAction\r\n                            onClick={(e) => { e.preventDefault(); deleteMutation.mutate(deletingId!) }}\r\n                            className=\"bg-[var(--color-red)] text-white hover:bg-[var(--color-red)]/90\"\r\n                            disabled={deleteMutation.isPending}\r\n                        >\r\n                            {deleteMutation.isPending ? 'Deleting...' : 'Delete'}\r\n                        </AlertDialogAction>\r\n                    </AlertDialogFooter>\r\n                </AlertDialogContent>\r\n            </AlertDialog>\r\n\r\n            {/* View Rules Sheet */}\r\n            <Sheet open={!!viewingId} onOpenChange={(open) => !open && setViewingId(null)}>\r\n                <SheetContent className=\"bg-[var(--background)] border-l border-[var(--border)] sm:max-w-md w-full overflow-y-auto\">\r\n                    {viewingStrategy && (\r\n                        <>\r\n                            <SheetHeader className=\"pb-6 mb-6 border-b border-[var(--border)] text-left\">\r\n                                <div className=\"flex items-center gap-3 mb-2\">\r\n                                    <SheetTitle className=\"text-xl\">{viewingStrategy.name}</SheetTitle>\r\n                                    <span className={cn(\"px-2 py-0.5 rounded-full text-[10px] font-medium uppercase tracking-wider border shrink-0\", statusBadge(viewingStrategy.status))}>\r\n                                        {viewingStrategy.status}\r\n                                    </span>\r\n                                </div>\r\n                                {viewingStrategy.description && (\r\n                                    <SheetDescription className=\"text-base text-[var(--muted-foreground)]\">\r\n                                        {viewingStrategy.description}\r\n                                    </SheetDescription>\r\n                                )}\r\n                            </SheetHeader>\r\n\r\n                            <div className=\"space-y-8\">\r\n                                <div>\r\n                                    <h3 className=\"text-sm font-semibold uppercase tracking-wider text-[var(--muted-foreground)] mb-3 flex items-center gap-2\">\r\n                                        <Check size={14} /> Entry Rules\r\n                                    </h3>\r\n                                    {viewingStrategy.entry_rules ? (\r\n                                        <div className=\"text-sm bg-[var(--secondary)] p-4 rounded-md border border-[var(--border)] whitespace-pre-wrap leading-relaxed\">\r\n                                            {viewingStrategy.entry_rules}\r\n                                        </div>\r\n                                    ) : (\r\n                                        <p className=\"text-sm text-[var(--muted-foreground)] italic\">No rules defined yet.</p>\r\n                                    )}\r\n                                </div>\r\n\r\n                                <div>\r\n                                    <h3 className=\"text-sm font-semibold uppercase tracking-wider text-[var(--muted-foreground)] mb-3 flex items-center gap-2\">\r\n                                        <AlertCircle size={14} /> Invalidation Conditions\r\n                                    </h3>\r\n                                    {viewingStrategy.invalidation_conditions ? (\r\n                                        <div className=\"text-sm bg-[var(--color-red-muted)]/20 p-4 rounded-md border border-[var(--color-red)]/20 whitespace-pre-wrap leading-relaxed text-[var(--foreground)]\">\r\n                                            {viewingStrategy.invalidation_conditions}\r\n                                        </div>\r\n                                    ) : (\r\n                                        <p className=\"text-sm text-[var(--muted-foreground)] italic\">No conditions defined yet.</p>\r\n                                    )}\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className=\"mt-12 pt-6 border-t border-[var(--border)]\">\r\n                                <Button\r\n                                    className=\"w-full\"\r\n                                    variant=\"outline\"\r\n                                    onClick={() => {\r\n                                        setViewingId(null);\r\n                                        handleEdit(viewingStrategy);\r\n                                    }}\r\n                                >\r\n                                    <PenLine size={16} className=\"mr-2\" /> Edit Strategy\r\n                                </Button>\r\n                            </div>\r\n                        </>\r\n                    )}\r\n                </SheetContent>\r\n            </Sheet>\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\components\\ui\\alert-dialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\components\\ui\\badge.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\components\\ui\\button.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\components\\ui\\card.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\components\\ui\\checkbox.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\components\\ui\\dialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\components\\ui\\input.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\components\\ui\\label.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\components\\ui\\placeholder-page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\components\\ui\\progress.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\components\\ui\\select.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\components\\ui\\sheet.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\components\\ui\\skeleton.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\components\\ui\\switch.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\components\\ui\\table.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\components\\ui\\tabs.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\components\\ui\\textarea.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\components\\ui\\tooltip.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\lib\\auth\\actions.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\lib\\auth\\validation.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\lib\\db\\schema.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\lib\\import\\dedupe.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\lib\\import\\parse-csv.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\lib\\import\\reconstruct-trades.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\lib\\import\\resolve-account.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\lib\\import\\resolve-instrument.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\lib\\import\\run-import.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'FillWithHash' is defined but never used.","line":4,"column":33,"nodeType":"Identifier","messageId":"unusedVar","endLine":4,"endColumn":45,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"FillWithHash"},"fix":{"range":[166,185],"text":""},"desc":"Remove unused variable \"FillWithHash\"."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { createHash } from \"crypto\";\r\nimport type { SupabaseClient } from \"@supabase/supabase-js\";\r\nimport { parseCSV } from \"./parse-csv\";\r\nimport { deduplicateFills, type FillWithHash } from \"./dedupe\";\r\nimport { resolveAccount } from \"./resolve-account\";\r\nimport { resolveInstrument, type ResolvedInstrument } from \"./resolve-instrument\";\r\nimport { reconstructTrades, type InsertedFill } from \"./reconstruct-trades\";\r\nimport { recalcSummaries } from \"../services/recalc-summaries\";\r\n\r\n// ── Public result type ─────────────────────────────────────────────────────\r\nexport interface ImportResult {\r\n    batchId: string;\r\n    newFills: number;\r\n    duplicateFills: number;\r\n    tradesCreated: number;\r\n    errorRows: number;\r\n    errors: Array<{ row?: number; message: string }>;\r\n}\r\n\r\n// ── Helpers ────────────────────────────────────────────────────────────────\r\nfunction hashFile(content: string): string {\r\n    return createHash(\"sha256\").update(content).digest(\"hex\");\r\n}\r\n\r\nasync function finalizeBatch(\r\n    supabase: SupabaseClient,\r\n    batchId: string,\r\n    status: string,\r\n    totalRows: number,\r\n    newFills: number,\r\n    duplicateFills: number,\r\n    errorRows: number,\r\n    errors: Array<{ row?: number; message: string }>,\r\n) {\r\n    await supabase\r\n        .from(\"import_batches\")\r\n        .update({\r\n            status,\r\n            total_rows: totalRows,\r\n            new_fills: newFills,\r\n            duplicate_fills: duplicateFills,\r\n            error_rows: errorRows,\r\n            error_details: errors.length > 0 ? errors : null,\r\n            completed_at: new Date().toISOString(),\r\n        })\r\n        .eq(\"id\", batchId);\r\n}\r\n\r\n// ── Main orchestrator ──────────────────────────────────────────────────────\r\n// All writes use the admin client — RLS is bypassed, so the auto_set_user_id\r\n// trigger does NOT fire.  Every insert MUST include user_id explicitly.\r\n//\r\n// userEmail is required to ensure the user exists in public.users before we\r\n// attempt to insert into import_batches (which has a FK to public.users.id).\r\n// The admin client bypasses RLS, hitting the FK directly against public.users.\r\nexport async function runImport(\r\n    csvText: string,\r\n    filename: string,\r\n    userId: string,\r\n    userEmail: string,\r\n    supabase: SupabaseClient,\r\n): Promise<ImportResult> {\r\n    // ── Guard: both userId and userEmail must be non-empty strings ─────────\r\n    if (!userId || typeof userId !== \"string\") {\r\n        throw new Error(\r\n            `runImport: userId is required but received: ${JSON.stringify(userId)}`,\r\n        );\r\n    }\r\n    if (!userEmail || typeof userEmail !== \"string\") {\r\n        throw new Error(\r\n            `runImport: userEmail is required but received: ${JSON.stringify(userEmail)}`,\r\n        );\r\n    }\r\n\r\n    console.log(\"[run-import] starting for user:\", userId, \"email:\", userEmail, \"file:\", filename);\r\n\r\n    // ── Step 0: Ensure user exists in public.users ─────────────────────────\r\n    // The admin client bypasses RLS and hits FK constraints directly.\r\n    // import_batches.user_id → public.users.id — must exist before inserting.\r\n    // Supabase Auth writes to auth.users only; the trigger in the migration\r\n    // handles future signups, but we upsert here as a safety net for cases\r\n    // where the trigger hasn't run yet (e.g. existing users before migration).\r\n    const displayName = userEmail.split(\"@\")[0];\r\n    const { error: upsertUserError } = await supabase\r\n        .from(\"users\")\r\n        .upsert(\r\n            {\r\n                id: userId,\r\n                email: userEmail,\r\n                display_name: displayName,\r\n                password_hash: \"\", // auth handled by Supabase Auth — placeholder only\r\n            },\r\n            { onConflict: \"id\", ignoreDuplicates: true },\r\n        );\r\n\r\n    if (upsertUserError) {\r\n        // If the user already exists with a different email this is a conflict\r\n        // on the unique email index — log but do not abort, the FK will succeed.\r\n        console.warn(\"[run-import] public.users upsert warning:\", upsertUserError.message);\r\n    } else {\r\n        console.log(\"[run-import] public.users upsert OK for\", userId);\r\n    }\r\n\r\n    const errors: Array<{ row?: number; message: string }> = [];\r\n    const fileHash = hashFile(csvText);\r\n\r\n    // ── Step 1: Create import_batch ────────────────────────────────────────\r\n    // user_id must be explicit — the admin client bypasses the auto_set_user_id trigger.\r\n    const batchInsert = {\r\n        user_id: userId,\r\n        filename: filename,\r\n        file_hash: fileHash,\r\n        status: \"processing\",\r\n        started_at: new Date().toISOString(),\r\n    };\r\n    console.log(\"[run-import] inserting import_batch:\", batchInsert);\r\n\r\n    const { data: batch, error: batchCreateError } = await supabase\r\n        .from(\"import_batches\")\r\n        .insert(batchInsert)\r\n        .select(\"id\")\r\n        .single();\r\n\r\n    if (batchCreateError) {\r\n        console.error(\"[run-import] import_batch insert failed:\", batchCreateError);\r\n        throw new Error(`Failed to create import batch: ${batchCreateError.message}`);\r\n    }\r\n\r\n    const batchId = batch.id;\r\n    console.log(\"[run-import] batch created:\", batchId);\r\n\r\n    try {\r\n        // ── Step 2: Parse CSV ──────────────────────────────────────────────\r\n        const { fills, errors: parseErrors, totalRows } = parseCSV(csvText);\r\n        errors.push(...parseErrors.map((e) => ({ row: e.row, message: e.message })));\r\n\r\n        if (fills.length === 0 && totalRows === 0) {\r\n            await finalizeBatch(supabase, batchId, \"failed\", 0, 0, 0, parseErrors.length, errors);\r\n            return {\r\n                batchId,\r\n                newFills: 0,\r\n                duplicateFills: 0,\r\n                tradesCreated: 0,\r\n                errorRows: parseErrors.length,\r\n                errors,\r\n            };\r\n        }\r\n\r\n        // ── Step 3: Resolve accounts ───────────────────────────────────────\r\n        const accountExternalIds = [...new Set(fills.map((f) => f.accountExternalId))];\r\n        const accountIdMap = new Map<string, string>();\r\n        for (const extId of accountExternalIds) {\r\n            const accountId = await resolveAccount(extId, userId, supabase);\r\n            accountIdMap.set(extId, accountId);\r\n        }\r\n\r\n        // ── Step 4: Resolve instruments ────────────────────────────────────\r\n        const rootSymbols = [...new Set(fills.map((f) => f.rootSymbol))];\r\n        const instrumentMap = new Map<string, ResolvedInstrument>();\r\n        for (const symbol of rootSymbols) {\r\n            const instrument = await resolveInstrument(symbol, userId, supabase);\r\n            instrumentMap.set(symbol, instrument);\r\n        }\r\n\r\n        // ── Step 5: Deduplicate ────────────────────────────────────────────\r\n        const { newFills, duplicates } = await deduplicateFills(fills, userId, supabase);\r\n        console.log(\"[run-import] dedup: new=\", newFills.length, \"dupes=\", duplicates.length);\r\n\r\n        // ── Step 6: Insert new fills ───────────────────────────────────────\r\n        let insertedCount = 0;\r\n        const insertedFills: InsertedFill[] = [];\r\n\r\n        for (const fill of newFills) {\r\n            const accountId = accountIdMap.get(fill.accountExternalId);\r\n            const instrument = instrumentMap.get(fill.rootSymbol);\r\n\r\n            if (!accountId || !instrument) {\r\n                errors.push({\r\n                    message: `Could not resolve account or instrument for fill ${fill.rawFillId}`,\r\n                });\r\n                continue;\r\n            }\r\n\r\n            const { data: inserted, error: insertError } = await supabase\r\n                .from(\"fills\")\r\n                .insert({\r\n                    import_batch_id: batchId,\r\n                    user_id: userId,\r\n                    account_id: accountId,\r\n                    fill_hash: fill.fillHash,\r\n                    raw_fill_id: fill.rawFillId,\r\n                    raw_order_id: fill.rawOrderId,\r\n                    raw_instrument: fill.rawInstrument,\r\n                    root_symbol: fill.rootSymbol,\r\n                    side: fill.side,\r\n                    quantity: fill.quantity,\r\n                    price: fill.price.toString(),\r\n                    fill_time: fill.fillTime,\r\n                    commission: fill.commission.toString(),\r\n                    fee: \"0\",\r\n                    instrument_id: instrument.id,\r\n                    trading_day: fill.tradingDay,\r\n                })\r\n                .select(\"id\")\r\n                .single();\r\n\r\n            if (insertError) {\r\n                // 23505 = unique_violation — concurrent re-import; skip silently\r\n                if (insertError.code === \"23505\") continue;\r\n                errors.push({\r\n                    message: `Fill insert failed for ${fill.rawFillId}: ${insertError.message}`,\r\n                });\r\n                continue;\r\n            }\r\n\r\n            insertedFills.push({\r\n                ...fill,\r\n                id: inserted.id,\r\n                accountId,\r\n                instrumentId: instrument.id,\r\n            });\r\n            insertedCount++;\r\n        }\r\n\r\n        // ── Step 7: Reconstruct trades ─────────────────────────────────────\r\n        let tradesCreated = 0;\r\n        try {\r\n            tradesCreated = await reconstructTrades(\r\n                insertedFills,\r\n                userId,\r\n                instrumentMap,\r\n                supabase,\r\n            );\r\n        } catch (e) {\r\n            errors.push({\r\n                message: `Trade reconstruction error: ${e instanceof Error ? e.message : String(e)}`,\r\n            });\r\n        }\r\n\r\n        // ── Step 7.5: Recalculate daily summaries ─────────────────────────\r\n        // Run after trades are written so summaries reflect the new data.\r\n        // We must recalculate not only the days present in the imported fills,\r\n        // but ALSO all subsequent days for the affected accounts, because\r\n        // cumulative_pnl relies on the previous days' totals.\r\n        if (insertedFills.length > 0) {\r\n            try {\r\n                // 1. Get the actual trade IDs created or updated by this batch\r\n                const { data: batchFills } = await supabase\r\n                    .from(\"fills\")\r\n                    .select(\"trade_id\")\r\n                    .eq(\"import_batch_id\", batchId)\r\n                    .not(\"trade_id\", \"is\", null);\r\n\r\n                const validTradeIds = [...new Set((batchFills || []).map(f => f.trade_id))];\r\n\r\n                if (validTradeIds.length > 0) {\r\n                    // 2. The account_id must come from the trades themselves\r\n                    const { data: touchedTrades } = await supabase\r\n                        .from(\"trades\")\r\n                        .select(\"account_id, trading_day\")\r\n                        .in(\"id\", validTradeIds);\r\n\r\n                    if (touchedTrades) {\r\n                        const accountMinDayMap = new Map<string, string>();\r\n                        for (const trade of touchedTrades) {\r\n                            const currentMin = accountMinDayMap.get(trade.account_id);\r\n                            if (!currentMin || trade.trading_day < currentMin) {\r\n                                accountMinDayMap.set(trade.account_id, trade.trading_day);\r\n                            }\r\n                        }\r\n\r\n                        await Promise.all(\r\n                            [...accountMinDayMap.entries()].map(async ([accountId, minDay]) => {\r\n                                // 3. Get all trading days >= minDay for this account\r\n                                const { data: tradeDays } = await supabase\r\n                                    .from(\"trades\")\r\n                                    .select(\"trading_day\")\r\n                                    .eq(\"user_id\", userId)\r\n                                    .eq(\"account_id\", accountId)\r\n                                    .gte(\"trading_day\", minDay);\r\n\r\n                                const daySet = new Set<string>();\r\n                                if (tradeDays) {\r\n                                    for (const row of tradeDays) {\r\n                                        daySet.add(row.trading_day);\r\n                                    }\r\n                                }\r\n\r\n                                // Ensure we also include the actual days from the trades\r\n                                for (const trade of touchedTrades) {\r\n                                    if (trade.account_id === accountId) {\r\n                                        daySet.add(trade.trading_day);\r\n                                    }\r\n                                }\r\n\r\n                                // 4. Sort ascending so each day sees correct prior cumulative\r\n                                const days = [...daySet].sort();\r\n                                for (const tradingDay of days) {\r\n                                    await recalcSummaries(userId, accountId, tradingDay);\r\n                                }\r\n                            }),\r\n                        );\r\n                        console.log(\"[run-import] recalcSummaries complete for\", accountMinDayMap.size, \"account(s)\");\r\n                    }\r\n                }\r\n            } catch (recalcErr) {\r\n                // Non-fatal — trades are persisted; summaries are stale but recoverable\r\n                console.error(\"[run-import] recalcSummaries error (non-fatal):\", recalcErr);\r\n            }\r\n        }\r\n\r\n        // ── Step 8: Finalize batch ─────────────────────────────────────────\r\n        await finalizeBatch(\r\n            supabase,\r\n            batchId,\r\n            \"complete\",\r\n            totalRows,\r\n            insertedCount,\r\n            duplicates.length,\r\n            parseErrors.length,\r\n            errors,\r\n        );\r\n\r\n        console.log(\"[run-import] complete — fills:\", insertedCount, \"trades:\", tradesCreated);\r\n        return {\r\n            batchId,\r\n            newFills: insertedCount,\r\n            duplicateFills: duplicates.length,\r\n            tradesCreated,\r\n            errorRows: parseErrors.length,\r\n            errors,\r\n        };\r\n    } catch (e) {\r\n        const errMsg = e instanceof Error ? e.message : String(e);\r\n        errors.push({ message: errMsg });\r\n        await finalizeBatch(supabase, batchId, \"failed\", 0, 0, 0, 1, errors);\r\n        throw e;\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\lib\\inngest\\client.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\lib\\inngest\\functions.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\lib\\prop-migrate.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\lib\\services\\grading.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\lib\\services\\prop-rule-engine.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\lib\\services\\recalc-summaries.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\lib\\supabase\\admin.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\lib\\supabase\\client.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\lib\\supabase\\middleware.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\lib\\supabase\\server.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\lib\\utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\middleware.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\stores\\filters.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\stores\\import-modal.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\types\\analytics.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\types\\dashboard.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\types\\grading-legacy.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\types\\grading.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\types\\prop.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\proch\\Desktop\\TRADINGJOURNAL\\src\\types\\trades.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]